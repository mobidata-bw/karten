(function($,Se){typeof exports=="object"&&typeof module<"u"?Se(exports,require("maplibre-gl")):typeof define=="function"&&define.amd?define(["exports","maplibre-gl"],Se):($=typeof globalThis<"u"?globalThis:$||self,Se($.Geoman={},$.maplibregl))})(this,function($,Se){"use strict";var yw=Object.defineProperty;var ww=($,Se,jt)=>Se in $?yw($,Se,{enumerable:!0,configurable:!0,writable:!0,value:jt}):$[Se]=jt;var w=($,Se,jt)=>ww($,typeof Se!="symbol"?Se+"":Se,jt);var Xc,Kc,Qc;const jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AYht+mLYpUHOwgopChOtlFRRxrFYpQIdQKrTqYXPoHTRqSFBdHwbXg4M9i1cHFWVcHV0EQ/AFxdnBSdJESv0sKLWK847iH97735e47QGhWmWaFEoCm22YmlRRz+VWx5xUhmmGMIi4zy5iTpDR8x9c9Any/i/Ms/7o/R79asBgQEIkTzDBt4g3imU3b4LxPHGVlWSU+J54w6YLEj1xXPH7jXHJZ4JlRM5uZJ44Si6UuVrqYlU2NeJo4pmo65Qs5j1XOW5y1ap2178lfGCnoK8tcpzWCFBaxBAkiFNRRQRU24rTrpFjI0HnSxz/s+iVyKeSqgJFjATVokF0/+B/87q1VnJr0kiJJIPziOB9jQM8u0Go4zvex47ROgOAzcKV3/LUmMPtJeqOjxY6AgW3g4rqjKXvA5Q4w9GTIpuxKQVpCsQi8n9E35YHBW6Bvzetb+xynD0CWepW+AQ4OgfESZa/7vLu3u2//1rT79wN2rHKoBaSKHQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+gEBAUlKJesuC4AABWbSURBVHja7Z3fcxTHEce/t1ohYekA2QaBDBgocGLHNmW7Kg4pV9l5SeUleci/4b9H/0aeU3mJXXEF5yEmEOw4hgKFH7JBtpEQwhLS3eVhunV9w+7tHWh3e2Z7q64OyZJ18+Mz3+7pme4W7Bn6tBdXWwD4lYj3FMA0gCkAswCOAJihrw8AOAfgdwDOAmgDmKDf3YunB6ADYB3AdQB/BnANwEMAWwA2ANwH8Ii+3gSwA6BLv8vvvfWPD/VslPOflnVBLhQQYKQCiEl6zQCYB/AigGMA3gBwGMB+guQQgFfpfZKg2sunC2AbwCqA/9H7FoCfAKwA+ArAtwB+BHCPoNmmFwOzw6AAgMFigIyrFhMChgMERJu+PkJQHCNI5un7qfi9F+i9VUJf88TeBvCY3js06TcIih8Jkq9IUTZIde6R2myI3zNVMUBGAiOlST1NrwMAjgM4BeAtAUKbIJklxZim35WAJSXB4UPSlROcINkkRXlEcKwLcP4NYAnAHQJlk17bUlUMlIYDkgHGPpr8BwEcJWVYAPA2AXKcwGAza0ooRiL6s1Vx//Yy3rtCUbaEebVOYCwBuAJgmZTmOwBrBNETA6XBgAwBYw7ACYLhbYLjRYLlIP3MpOest2oAYhxgep5zvk0QrBEUPxIkVwia2wAeGCgNBGQEME4DeIcAOUHm1bRwztMaVWIv1WVHOOubZGbdJkAuAbhpoDQIELErlRSAcZq+nhNqMeEpReh91vOUpSNU5QGBcbMAlG5Tdr1aDYGjRROdYxZFYOzzHO4Y+8o3w3YIgCJQOLbSaYKatBoAR0JKsB/Ay2Q+nRkRjKaYoL0RQblBZtj3cPGWbQDdmCFpRQyGVI0DcFuybwL4FVx0+6SBMRYot+Ci9p8DuAq3dfwwdjVpRQxHCheoO0xKcY7geJNgaRsYY4GyTlBcJUiukbKswAUqd2KEpBUhHBM06WfgotznAVwgQE6TmbWffiYxMEYCpUsA/ETm1U0C5CKAy3DR+g36mU5MkLQiAsM3qeYJjg/pfZ6+P4X+wUEDYzxQOmRSPYSLyF8G8Cm934vR5GpFBEeWSXWB4DiGwXNSMDieCRJg8LzXtwTHxVhNrlZEcMzCRb59k+owgZOaauypmuwQCCsZJtcy3HZw8JCkEcHxCoB3AXxkJlUli2oqVHmGFqIZsRDdZUjai6vBBhXTwOHgo+gMx2/ofcEzqQyMvYfEP7YzhcGjOCBINgBshwpJGigciYBjwYPjFQFHYnCUDgovQKzi/rMsIAkuqJgGCscU+kfSz5NZxXDMmr9ROSS8YPmQsLrwUfqt0CBpBQrHS+SE/xzArwmSBYNDjfP+iJTjMoC/A/ianPgf4LaBg4GkFRAcLbjI9xyA1wH8Fu6G31m4yLjtVOmC5DFc5P063A3GvwD4D9yxlScIZHcrCQgO9jmOknK8Re9Hvd0Tg6N+5z0tGKtJAC1xDcEAeU44UuGQnyez6iz6x0ZsG1cfJBPon6A+65nCuwuadkiSQODIinMcMTiCgeTIsM0UzZCkyjvZh0PGOV4wOILwbydorBbQP67Cz24wMeO/GSAF6iE71o9z2G5VWJDIhc536u8A2Ggvrqp02lPFcEzBHV+wOEeckPBu1xYrSHtxVd1R+UQhHGxaHYA7bHghy7kzOIL0SfzNlgs0xge0+iOpwo7kTpyHCwaew2BaT4MjfCXxx3eFlKSrzR9RoyCe33EsZ4Wxs1XhQ5LkWAjHeONFk4okiuBIPL+DbwIexuCRdXvCh2SiYKwTLZAkSuDgSHnuqmJwRAlJnrWgJtKuxcSSAaU8v8Oe+CDJ8kdkALjZCuKZVi+jn7dqYGcDcWY19EsX5L3kz8YGiL9jyWmZXtZiaqVKVpFZuIyHfgfFYlrllSfojdFPdZZXqMIf4QVyDS5Dyjr6JRt6jQMk4wj7GfSPrquR2D2Cwi9BwAEyruxUpPI8ieROntbSC89rYp+luXAHlGurvbjaqiuAmNa8erANegIuV+5JuIyHIZtWWdnT/SI2G/DS4xT0Eacz4qPiecV7QuwzGR9p0xx4By5TCt8dqU1FagEkQz1O02uOvhdivMNP18n1N7LKoN2HuzwkA2S9HLOKt0NfR7+Sblb5t0mEm0aV2+rPh9t1q0haY4f46nEi0F2rvITPsoJTViHNFfTTdfZG6KcryC8gKitghZpvOGtO1K4ilQMygnqEMqhFJQOWMFgD0C/FvAWvDPOQnZ4HBJQsQX0VT9dQDLmUQ968qFVFUiUrRWjqIZ3tvFoaS/S1rCK74znrow42A8WmyAO4JNJchfc6ATKs5kkSCCSqVKRSQCJQDz+J8yMUly3z65Dv7nCNuhpSv3VF32yLv79GCnWL/nZW1Sz2VbRfMFOnIqmCFSIU9cjKSbsEV3WpsPDlOED4j/i9ngcM1xfMUjEG5Qypi8xRDOWQqFGRyjpJRM33w12a+RDAH+HO4cyhX15Zs0nVwWDOp4tk3txCTRVhCyr3noSLK8g7NbN4uq67tofLVT+gfv4TXJmFu3A1SirLq1W1giRkNx8lxzIE9fDriy8D+ALAJzR4XIqsllLJ9Hd6BMq25xc9FDtn/Nn44tmkYkh8FXkbwH8hEs/FaGLxsYJpsfuye3JT6UCxv8G1xLlozCcEyTKZW9vsY9QV8c0AhQOUm56pt4N+5vtp6DzO45/wXqA5M00K3qnKzKoEkIwj7bLBE8rh4AyBN5BdA6MDRak0BShyQ+GugGMD7tTsGfQzUmqFJGtBXYNLhF2Js55W2FiWzOMkmUep8YlSOLq0+t4H8E8AnwH4BoFUUVr/+FCvvbjKO2eP4M42bdFnfw3ABwDeo3HYr9Tc8k3ya7RjV5mzXvrkzEjEcIpeB5WaV9LneEjK8RmAfwD4EoMFK1Xnl2U1wWDJtC+pLZ9R2x5KE1GpmXVQzJtKEzykFa8E83B5Wo8rdc6lWbJBPsc1Uo5lAKu0CgdTyTXD5OLP/Q21ja+5tqHvZLBvebwFd4btB1KRbhUTt8qVoE2QtBWrh5++/yKZVWuhwZEBCgc416hNmTUFlapILXOnKvtfVoSSW4xanXJ/K3clZDhyIFlB9o5cB/puL9Y2f0r9IxnZ2Y8oVQ/2O4ZOnBjqfgtIhi0EmvwRX0WOoMLs8GlFELL/8QY1cEqZgkjTaikA02OvTcmsBWxS0QLG92L4mP9VuMOapQcNkwro5+uiL8LdX9CWW5cd1ydwRxtuwB0fuS9NjhjUI2N3S8Z5rlPbdytAKVkU/DIYfAemkpwFpQGSUd+j0oY9w2q6AXfQ7xLc2ard7c+Y4PAgkdvZt6jtuydnlZlZuQttmWZW2QriS+M8dAUHffW4icGTo1HCkQFJXvs1pRuqxVSvwsRi+/Yw9CWgzlIPjSto0/ugVTCXggSEG8WX8aehKzBYpB69mNUjwx8JQUUYkmkMJvcI1sSqvEGmHtGrSKULbimAZMQ/KpPEMdVjGy6qvESvRqnHEBXh/lhD/1CgFkgy51RZjnpSMnwyp9Nh6Ip/8Gnd7+CyjzRVPfJU5Ar1zSYqvKCkbU6V7YNwinttDro8cvEjXLCMt3UbpR4ZKsLbvpyuiFOk1t0nWVZJ6XdZkhIbw///FP00mZrMK44kf0sTYRM6zyHVsXBsop/wTp4k0GRmyVzFKGtuVXWaV5NzzubVFlwE+Su4Y+2aTAkNpuc99LNBbinqmxaeznYflpM+RFG0rJJsSqzDS2rQRPMqw8xiX4TzCWty1CudU0lD54LMUsLJ3Uw9rH8aD0hIK6RKhW1aHzVRQeS9D78EgT3WR40HRB7zXjH/o9AP4Qwujdzha6KJxSskV31qamBwlL6SfdT1+tAAacAE6JrvUeiLdJvcP4lNAnusjwwQe+wxQOyxxwCxp+qnZYDY4NuT3TeVnXkyQHROAG2HKLX1T2WnZg0QXYqh8Ri+iifnNqjWGiIGSEmQZF7kqiKdfkDzQvNtUAPEBl+FeaU1XVN0gGhLhKw9mbYW51xjuqZK51RSUUO0HekIoRyDBgXRmq6psiMwScl0azwUWGs6/QAddG2VwCo9RJmU3JDMY+UKQNGeM7juvtFYrqKWY/hlNlrrpZu8rPOaS1JX2Tey9LK2chWVz6lSAMm5dKMtjaVMp881uCebamYNqWWvqVxF7pwq67JbUlGDNtGvSqrFWfdrcJ+Azsq7VTvmM9QX2mrZS+f8Cc2p0hfcJLYGPYOjLmtwz9GuTaNURKjHPuoD7g9ttewrX3CrUpANhY66v2K+02AV0d4XtZnsZQOiOTuGv2qeplejVCRDPZ7qByWLRS1zqTRAAsnSZyoSRh/Ulg0zqYh8rVn6ilbPJGYVobYlAahHbfMoqZN8xSpyEv1t3yghEXDwtu5J5epRiyVSlYJoztLnq8gZAGfhIsi79yBigkT4HXzs/wi1+Yxi9ahlDpUKSEDZwmVk/RSACwDOwwXLZiP0R2R7F6itF6jt2tpbazb+pMIVQHO2cDY3+J7IeQAfAXiXJtALACZiUBFqAyvHArXxI2qzvBujqa21zZ+0xhVgjuzfnpLB8CeOVL/d08jtxdVOqDl8BRxDFwKF6lGbBVKlgoRQ0SnP9DgNF1WeClVJPDgOUptCMCVrrXhVuoKsf3yo115czasJOKtsxeLPMUE7OfMAzgF4Da48MuBKI2+1F1c7CCAjvOeQMxwL1KZz1MYZMQ7aqoHl1kysou+TihuaWVUW+kp7ye3PMwA+APA+gF/AHQEP4oJVxgWoY9SG96lNZyC2s6G3VF5tVXerPKXp1yW/A711yRmSabgt0PcA/B7AHwD8EsBxYZKojJOIOAebjMfps/+B2vIetW0aOpPDSd/jDmqq216Fky7NrG0yUZbo9aqYaD1lgySd9qPIrve+DHerbbu9uNrVYHIJ1WAVzNqtmifl0HpJTKqHnC9rqLiWfVrzivAzAC9Bb9odhmQ/nk40x6bLfTIBngDYoYWgclAEGPy59hEERzJ2q2aUmlXqLI7KAPFURNqUGp31PJ+kDeAVz66/DuAWOfEbVYOSA8YM3Db6SbgIub9bNaEcDt85H/BZq1x80pobzrsSh6ArJpIHSUvY85z04QaASwBuAridBwovEnsIBYaAcQJuG/cdcsRPoZ9CVHsCuDznfBM11ElMa+gAua/9Je2qvAz92Q1bos/YD2kTLKcJkCxQtmlguwQLxgXGA0ICO4F+fi8fjNP09RxBLe+Wa47jqHDOawEksJhIHiS+E+xPTgZliUB5SO3jK8d8TVQCM46C8c7UNL0O0N8+lQHGDClLijDKGKhxzutUkDz78qByMyvPL8kzb5Zo9WMT4Z5QlG0MJtPrFQDJGwSTAsp59DOyvE2AZIHRQlhpVVWFA1IlnXCWBnsf+kkCEAAkLRq0LFBepV069rX4mMQG3HmiUe5V+1kO2+jnFH4D/ZxeR2mBCRkMVc55bYAMiYmcFLZ9L6CBzQNlFm4Le4vMybcIDD50599r6OWolMxEz2lSOWUq+xbT4m+HCIY657xuBZGO2G2y2eVVz8kABzgLlCka3IO0EcHm1QaZRY9HVBAZpGQzi2Mycss25Az1/pyo1TmvFRChIk9ot+cmvU4EqiJ5oMidpin084TN0YTvjDD4/P+Y8pxtP+N6yHdVWD14PtTunNetILGqiA8KPFh4kCUw4+5iIRIoiubCbSg4q1db3EFcx/VV5AF9T9sp371QlUS8UmGKDXtNCuVIEF/h0cJ5UOf5tlThyhGTihSpC2BVrdSqR60K0kAVsScw9agdkBBWEHuaPfa1A2IqYuqhVT20KIipiKmH2jFXAYipiKmHRvXQpCCmIqYeKsdaDSCmIqYe2tRDm4KYiph6qBtjVYCMoCJdgyR4OLqhqIdGBclbYW7BHRXXVFfEnmczrXZoLG+FYCGoAyRDRW7AZQ65D+AnuBOw9oT5dGgM79OY3tCsHkD9Z7GKVOQR3LHnz9G/Mcf5nEK4Y23PoGm1BeB7AFdpTJcgcu1q/OAqs4jQShJkh9oz8oJ3lcZ2C0BXaxLwRHnHDpNkc9jDdMyDMpnVAuKVb5NOnTns4TvmA2OouYSEagURppY57HE65l3t9VXSADrYHHZzzE1BnsFhvwm9RXjsCdgxDwqQHKm+Ri8ztcwxN0CEw85JxW5mrUimIuaYN1ZBLDZijrkBsgedb5DUrh6dmBaxoAApiI2Yw67HtMo1g0NSjyAVpCA2UpTr1p5yAeFT2Pdi2UhJAx8M3kK8iH5cZIL+HVP2wVBMq8dwpR4u05gMbMWHph6h+iC+w75CA/IpvQ8rKWBPOXAUjkWIcAQLiICkcNUySCrxO+T2+0Uai29pbDqhwhE0IDHbvYE9WQFcLjcXvD8YNCDerpYFEOszrbKOAAUVEIxVQaSpZWe16jWt/IWpEzocUQBSIPVmall/GyAjntWqrRBkhOpRqNgxqEdUCjLCsXi7gbh3plVU0fJhTxrhIGZJ/2G4moBc+swCiM8OSKN2DWPyQfJMraf25U1Fnsu0ii5a3hhAMkytvMiuQfLsfkd00fJGASIgGbbamT/yfH5HVNHypvkgRfay+SN704/RRMsbpyCeP7Jj/khpfkcU0fJGAuKZWuaPlON3dGKGI3pAzB8xv8N8EPNHzO8wBTF/xPwOA8T8EfM7DJAA/JGm3h/hAGvj/Y7GAjKifd1poNPeE+rReL+j0YAU+CPLaGaWRpklZrnpfkfTFSTPH/kEwBc0QZrktEuzc5n64JMm+x3ySdHQZ/3jQ7324qqcGJxHK4Xb+uVt3wnEu/070kLRVDgaDUiOaZHCJZ07TO8MSYwFeoY55U01Nc3EyvFHRnFOe5HBMdJmRZPVo/GACEiGraSxQeLDkeeUd5sOhwEymtN+NzJzQ5qVd80pNx/keZx2floAjiP8pNhZO1Z/NafcAHnW1ZXhiGFnq0kqaSZWyU57oX0e2EQa2c8y9TBAxoUk9J2tkdtjcBgg40ASw86W7VgZIKVCMqrN3lMOh+1YmZNeDiRDdrYA4BUAs6IfW8rhsB0rA6SUyebvbOVB0lL6mSUctmNlgOy5imAIJNpiJMNiHQNwmHoYIGVDoi1GMrLfZHCYk16G0645RmKxDgNEHSRaYiQW6zBAVEGiKUZisQ4DRCUkGmIkFuswJ121415njMRiHQaI+mecGMleQlIEh8U6DBA1KoKKIRkLDlMPA6RJkBgcBohBYnAYIAbJeJAYHAaIQWJwGCAGyXiQGBwGiEGSA4nBYYAYJDmQGBwGiEGSAwkMDgPEIBkOicFhgBgkGZDM0L83DA4DxCDpP1xi4Sh9/R2ASwaHAdJkSPjuRgJgEv167QBwFcDfAPwLdhuw1sfug9QAiXDCH8Pd+Psa7v7GHXpdpu/do58xOGp6/g9eQPkxBqxc0wAAAABJRU5ErkJggg==",Xo={draw:{marker:{type:"draw",eventType:"toggle",targetMode:"marker",settings:{exclusive:!0}},circle_marker:{type:"draw",eventType:"toggle",targetMode:"circle_marker",settings:{exclusive:!0}},text_marker:{type:"draw",eventType:"toggle",targetMode:"text_marker",settings:{exclusive:!0}},circle:{type:"draw",eventType:"toggle",targetMode:"circle",settings:{exclusive:!0}},line:{type:"draw",eventType:"toggle",targetMode:"line",settings:{exclusive:!0}},rectangle:{type:"draw",eventType:"toggle",targetMode:"rectangle",settings:{exclusive:!0}},polygon:{type:"draw",eventType:"toggle",targetMode:"polygon",settings:{exclusive:!0}},freehand:{type:"draw",eventType:"toggle",targetMode:"freehand",settings:{exclusive:!0}},custom_shape:{type:"draw",eventType:"toggle",targetMode:"custom_shape",settings:{exclusive:!0}}},edit:{drag:{type:"edit",eventType:"toggle",targetMode:"drag",settings:{exclusive:!0}},change:{type:"edit",eventType:"toggle",targetMode:"change",settings:{exclusive:!0}},rotate:{type:"edit",eventType:"toggle",targetMode:"rotate",settings:{exclusive:!0}},scale:{type:"edit",eventType:"toggle",targetMode:"scale",settings:{exclusive:!0}},copy:{type:"edit",eventType:"toggle",targetMode:"copy",settings:{exclusive:!0}},cut:{type:"edit",eventType:"toggle",targetMode:"cut",settings:{exclusive:!0}},split:{type:"edit",eventType:"toggle",targetMode:"split",settings:{exclusive:!0}},union:{type:"edit",eventType:"toggle",targetMode:"union",settings:{exclusive:!0}},difference:{type:"edit",eventType:"toggle",targetMode:"difference",settings:{exclusive:!0}},line_simplification:{type:"edit",eventType:"toggle",targetMode:"line_simplification",settings:{exclusive:!0}},lasso:{type:"edit",eventType:"toggle",targetMode:"lasso",settings:{exclusive:!0}},delete:{type:"edit",eventType:"toggle",targetMode:"delete",settings:{exclusive:!0}}},helper:{shape_markers:{type:"helper",eventType:"toggle",targetMode:"shape_markers",settings:{exclusive:!1,enabledBy:["drag","change","rotate","scale","line_simplification"]}},snapping:{type:"helper",eventType:"toggle",targetMode:"snapping",settings:{exclusive:!1}},pin:{type:"helper",eventType:"toggle",targetMode:"pin",settings:{exclusive:!1}},snap_guides:{type:"helper",eventType:"toggle",targetMode:"snap_guides",settings:{exclusive:!1}},measurements:{type:"helper",eventType:"toggle",targetMode:"measurements",settings:{exclusive:!1}},auto_trace:{type:"helper",eventType:"toggle",targetMode:"auto_trace",settings:{exclusive:!1}},geofencing:{type:"helper",eventType:"toggle",targetMode:"geofencing",settings:{exclusive:!1}},zoom_to_features:{type:"helper",eventType:"click",targetMode:"zoom_to_features",settings:{exclusive:!1}},click_to_edit:{type:"helper",eventType:"toggle",targetMode:"click_to_edit",settings:{exclusive:!1}}}},Ef=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path d="m22.775 29.562 6.75-6.75-5.625-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.626-5.55-6.75 6.75zm25.95 26.101 6.75-6.825-5.624-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.55-5.55-6.75 6.75zm.6-46.126 5.25 5.25ZM16.7 59.039H5v-11.7l14.55-14.551L2 15.237l13.05-13.2L32.75 19.661 46.1 6.312q.676-.676 1.5-.976.826-.3 1.65-.3.826 0 1.65.3.826.3 1.5.976l5.326 5.325q.675.675.975 1.5.3.825.3 1.65t-.3 1.65q-.3.825-.975 1.5l-13.35 13.35L62 48.913l-13.125 13.05-17.551-17.55Zm-7.2-4.5h5.25l29.476-29.552-5.25-5.25L9.5 49.288ZM41.6 22.361l-2.625-2.625 5.25 5.25Z"
          fill="currentColor"
          style="stroke-width:.0750028"/>
</svg>
`,Ko=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor"
            style="stroke-width:7"/>
    <circle cx="32" cy="32" r="5" fill="currentColor"/>
</svg>
`,te={marker:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M32 62.81s23.107-21.898 23.107-38.512a23.107 23.107 0 0 0-46.214 0C8.893 40.912 32 62.809 32 62.809m0-26.958a11.554 11.554 0 1 1 0-23.107 11.554 11.554 0 0 1 0 23.107"/>
</svg>
`,circle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor" style="stroke-width:7"/>
    <line x1="6" y1="32" x2="58" y2="32" stroke="currentColor" stroke-width="4" stroke-dasharray="3"/>
    <line x1="32" y1="6" x2="32" y2="58" stroke="currentColor" stroke-width="4" stroke-dasharray="3"/>
</svg>
`,circle_marker:Ko,text_marker:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <path fill="currentColor"
          d="M6.962 3.385h50.076a3.577 3.577 0 0 1 3.577 3.577v50.076a3.577 3.577 0 0 1-3.577 3.577H6.962a3.577 3.577 0 0 1-3.577-3.577V6.962a3.577 3.577 0 0 1 3.577-3.577Zm3.577 7.154v42.922h42.922V10.539Zm7.154 7.154h28.614v7.153H17.693Zm0 14.307h28.614v7.154H17.693Z"
          style="stroke-width:4"/>
</svg>
`,line:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <line x1="8" y1="50" x2="24" y2="20" stroke="currentColor" stroke-width="8"/>
    <line x1="24" y1="20" x2="40" y2="54" stroke="currentColor" stroke-width="8"/>
    <line x1="40" y1="54" x2="54" y2="10" stroke="currentColor" stroke-width="8"/>
    <circle cx="8" cy="50" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="24" cy="20" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,rectangle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Rectangle -->
    <polygon points="10,10 54,10 54,54 10,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="10" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="10" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,polygon:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Polygon -->
    <polygon points="8,28 40,6 55,35 51,55 18,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="9" cy="28" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="8" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="55" cy="35" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="50" cy="55" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="18" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,freehand:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M44.698 2.661a1.644 1.644 0 0 1 2.328 0l9.866 9.866a1.644 1.644 0 0 1 0 2.329L24.004 47.744a1.644 1.644 0 0 1-.552.362L7.008 54.683a1.644 1.644 0 0 1-2.138-2.138l6.578-16.444a1.644 1.644 0 0 1 .362-.552zm-3.089 7.742 7.542 7.541 4.252-4.252-7.541-7.541zm5.216 9.866-7.54-7.54-21.378 21.376v.964h1.644a1.644 1.644 0 0 1 1.645 1.644v1.645h1.644a1.644 1.644 0 0 1 1.645 1.644v1.644h.963zM14.724 37.29l-.35.348L9.35 50.204l12.566-5.025.349-.35a1.644 1.644 0 0 1-1.07-1.538v-1.645h-1.644a1.644 1.644 0 0 1-1.644-1.644v-1.644h-1.644a1.644 1.644 0 0 1-1.54-1.07"/>
    <path stroke="currentColor" stroke-width="5.107"
          d="M6.298 59.53c3.44-1.692 6.88-3.384 10.558-4.319s7.594-1.111 11.719-.298c4.125.814 8.459 2.617 13.483 2.655 5.023.038 10.737-1.689 16.45-3.415"/>
</svg>
`,custom_shape:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <circle cx="49.754" cy="50.219" r="10.098" fill="none" stroke="currentColor" stroke-width="5.1"/>
    <path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="4.491"
          d="M44.516 26.657H17.842l6.669-11.55 6.668-11.55 6.669 11.55Z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="4.683" d="M4.481 40.605h20.761v19.093H4.481z"/>
</svg>
`,drag:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path
            fill="currentColor"
            d="M32 61.4 19.85 49.42l3.28-3.235 6.634 6.542V34.205H10.98l6.26 6.174-3.279 3.234L2.185 32l11.852-11.686 3.28 3.234-6.336 6.247h18.783V11.273l-6.261 6.174-3.28-3.234L32 2.6l11.777 11.613-3.28 3.234-6.26-6.174v18.522h18.782l-6.26-6.174 3.279-3.234L61.815 32 50.038 43.613l-3.28-3.234 6.261-6.174H34.236v18.522l6.634-6.542 3.28 3.234z"
    />
</svg>
`,change:Ef,rotate:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M58.709 17.724c-.3-.6-.601-.901-.902-1.502l-.3-.601c-.301-.601-.602-.902-.902-1.503l-.3-.601c-.301-.601-.602-.902-1.203-1.503l-.6-.901 8.414-9.317-13.825.3-13.824.301 1.502 13.524 1.503 13.524 9.617-10.819v.3l.3.602c.301.3.301.6.602.6l.3.602c0 .6 0 .901.3 1.202.903 2.104 1.804 4.208 2.105 6.311.6 4.208 0 8.716-1.804 12.623l-.6 1.202-.301.3-.902 1.503-.3.601c-.601.601-1.202 1.503-1.804 2.104-1.502 1.503-3.305 3.005-5.109 3.907-1.803 1.202-3.907 1.803-6.311 2.404-2.104.301-4.508.601-6.612.301-2.404-.3-4.508-.902-6.612-1.503-2.103-.901-3.907-2.104-5.71-3.606l-1.202-1.202-.601-.902-.601-.601c-.3-.3-.601-.601-.601-.902l-.902-1.202-.3-.3-.602-1.203c0-.3-.3-.3-.3-.6l-.902-1.503-.3-.601-.902-2.705q-.901-3.607-.901-7.213V27.04c0-.601 0-.901.3-1.202l.3-1.803.602-1.803c.901-2.405 2.103-4.509 3.606-6.612q2.254-3.156 5.41-5.41c.6-.3.901-1.202.3-1.803-.3-.3-.6-.601-.901-.601h-.601l-.3.3c-2.706 1.202-4.81 3.006-6.913 4.809-2.104 2.104-3.607 4.508-5.11 7.213-2.704 5.41-3.606 11.42-2.404 17.431.3 1.503.601 2.705.902 4.207l.902 2.405c.3.3.6.6.6 1.202l.602 1.202c0 .3.3.601.3.601l.902 1.503c.3.601.6.901.901 1.503l.301.6c.3.301.601.902.902 1.203l2.103 1.803c2.104 2.104 4.809 3.907 7.514 5.41q4.057 2.254 9.016 2.705c1.503.3 3.005.3 4.508.3 1.803 0 3.306 0 4.809-.3 3.005-.602 6.311-1.503 9.016-3.006l.6-.3c.602-.3.903-.601 1.504-.902l2.103-1.202c.601-.3.902-.601 1.203-.902l.6-.6a3.622 3.622 0 0 0 1.503-1.504l.3-.3c.902-.902 2.105-2.104 2.706-3.005l1.803-2.705 1.202-1.804c3.005-5.71 4.208-12.322 3.306-18.633-.601-3.306-1.503-6.612-3.005-9.317z"/>
</svg>
`,scale:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor" stroke="currentColor">
        <path d="m37.62 5.028-.337.284-4.039 4.068 3.547 3.523L39.875 9.8l2.846.596 1.025-4.893-4.176-.877Zm9.995 6.393 9.787 2.053 1.026-4.895-9.787-2.05zm14.68 3.078 9.787 2.05 1.025-4.892-9.787-2.053zm-39.623 5.522 3.547 3.523 7.049-7.094-3.547-3.523zm-10.57 10.642 3.546 3.524 7.047-7.094-3.547-3.524zM1.529 41.306l3.55 3.523 7.046-7.096-3.547-3.523Zm70.977 4.027 3.91 3.115 3.44-4.387-1.118-6.55zM.947 48.319l5.617 8.274 4.137-2.809-5.617-8.273Zm62.211 8.744 3.91 3.116 6.233-7.82-3.91-3.116zM9.373 60.73l5.62 8.272 4.134-2.809-5.617-8.271zm44.438 8.067 3.91 3.115 6.232-7.82-3.91-3.117zM17.8 73.138l5.617 8.273 4.137-2.808-5.617-8.274zm26.662 7.388 3.91 3.116 6.232-7.82-3.91-3.116zm-18.236 5.022 5.617 8.273 4.136-2.81-5.617-8.272zm8.888 6.709 3.91 3.117 6.233-7.822-3.91-3.115z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="M22.672 20.02a3.5 3.5 0 0 0-2.506 1.034L-.514 41.872a3.5 3.5 0 0 0-.412 4.434L18 74.176a3.5 3.5 0 0 0 5.633.216l33.494-42.038a3.5 3.5 0 0 0-2.018-5.605l-31.742-6.654a3.5 3.5 0 0 0-.695-.074zm1.121 7.317 24.32 5.098-26.992 33.877L6.484 44.759Z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="m78.734 7.668 2.61 11.396-18.145 4.154 2.705 11.816L84.05 30.88l2.609 11.396L100 21.011Z"
              stroke-width="3"
              transform="translate(1.586 1.586) scale(.60827)"/>
    </g>
</svg>
`,copy:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.687.926a2.173 2.173 0 0 0-.433.045c-4.075.232-7.358 3.618-7.358 7.747 0 .084.01.164.012.246l-12.987 4.261a7.842 7.842 0 0 0-6.126-3.563 2.173 2.173 0 0 0-.424-.043 2.173 2.173 0 0 0-.435.044c-4.073.232-7.358 3.618-7.358 7.747 0 3.143 1.901 5.869 4.604 7.097L8.377 35.11a2.173 2.173 0 0 0-.028.007C4.274 35.35.99 38.736.99 42.865c0 4.277 3.514 7.791 7.791 7.791 2.497 0 4.727-1.201 6.157-3.048l12.887 6.235a7.67 7.67 0 0 0-.139 1.44c0 4.277 3.515 7.791 7.792 7.791 4.278 0 7.793-3.514 7.793-7.792a7.67 7.67 0 0 0-1.885-5.027l.508-1.05-3.263-1.579 4.505-29.969.888-.29-.368-1.122a7.78 7.78 0 0 0 2.28-1.018l.447 1.364 4.72-1.547-.774-2.359-2.522.826a7.73 7.73 0 0 0 1.672-4.793c0-4.132-3.288-7.52-7.368-7.748a2.173 2.173 0 0 0-.424-.044zm0 4.346a3.414 3.414 0 0 1 3.447 3.446 3.415 3.415 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.446-3.447 3.414 3.414 0 0 1 3.445-3.446zm20.076 3.725a1.242 1.242 0 0 0-.382.062l-1.612.528.578 1.76-.293 1.94 2.456.37.486-3.234a1.242 1.242 0 0 0-1.233-1.426Zm-4.354 1.364-4.72 1.548.775 2.36 4.719-1.548-.774-2.36zm-22.153 2.732a7.877 7.877 0 0 0 3.735 2.922l-.062.408-.397.13.26.793-4.255 28.298-3.818-1.847-1.082 2.235 3.718 1.798a7.841 7.841 0 0 0-3.543 2.147l-13.272-6.42c.02-.23.035-.458.035-.692 0-2.888-1.609-5.408-3.969-6.745l2.912-11.012c3.74-.562 6.645-3.81 6.645-7.698l-.001-.02 13.094-4.297zm-20.885.87a3.414 3.414 0 0 1 3.445 3.447 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm45.314 1.78-.738 4.912 2.456.37.738-4.912zM36.172 17.33l-1.793.588a1.242 1.242 0 0 0-.813.862l-.788 2.978 2.401.634.615-2.325 1.15-.377-.773-2.36zm22.405 5.781-.737 4.913 2.455.368.739-4.91zm-26.432 1.048-1.27 4.802 2.401.634 1.27-4.802zm25.325 6.32-.739 4.913 2.457.368.738-4.911-2.456-.37zm-27.23.882-1.27 4.802 2.402.634 1.27-4.801zm26.124 6.486-.739 4.91 2.455.37.74-4.912-2.457-.368zm-28.027.717-1.27 4.803 2.4.634 1.27-4.802-2.401-.634zm-19.555.856a3.414 3.414 0 0 1 3.446 3.446 3.414 3.414 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.445-3.447 3.414 3.414 0 0 1 3.445-3.446zm46.473 5.795-.739 4.91 2.456.37.74-4.911zm-11.124 5.072-1.082 2.236 4.47 2.164 1.083-2.237zm-8.651 1.55a3.414 3.414 0 0 1 3.445 3.446 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm18.669.745-.358 2.378-2.953-1.428-1.083 2.236 4.472 2.163.541-1.117 1.228.183.608-4.046-2.455-.37z"/>
</svg>
`,cut:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor" fill="currentColor" stroke-width="2"
          d="M44.095 2.247a2.285 2.285 0 0 0-.135.04L12.025 12.762a2.285 2.285 0 0 0-1.497 1.588l-7.772 29.4a2.285 2.285 0 0 0 1.213 2.641L35.397 61.6a2.285 2.285 0 0 0 2.873-.754l22.64-32.582a2.285 2.285 0 0 0 .05-2.534L46.6 3.23a2.285 2.285 0 0 0-2.504-.982ZM43.7 7.182l12.203 19.12-5.167 1.76 1.052 3.09 2.031-.693L38.07 53.122l.01-1.375-3.262-.023-.034 4.5-27.13-13.127 6.975-26.38Zm3.946 21.932-6.18 2.105 1.052 3.09 6.18-2.105zm-9.27 3.157-2.329.793a1.632 1.632 0 0 0-1.105 1.534l-.03 4.068 3.265.024.02-2.91 1.232-.419zm-3.488 9.66-.047 6.529 3.264.023.048-6.528z"/>
</svg>
`,split:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor">
        <path d="m4.879 2.684-2.832 2.8L7.65 11.15l2.832-2.801Zm8.403 8.495-2.832 2.802 5.603 5.662 2.831-2.802zm8.404 8.494-2.832 2.8 5.602 5.664 2.832-2.802z"
        />
        <path d="M27.814 7.408a3.576 3.576 0 0 0-1.161-.176 3.2 3.2 0 0 0-.878.138l7.963 26.068L7.18 27.3c-.543 2.352 1.67 6.055 4.962 6.816l23.054 5.297 2.326 6.42c-2.27-.175-4.279 1.912-4.908 3.805-.535 1.698-.512 3.656.085 5.61.597 1.954 1.671 3.59 3.064 4.7 1.393 1.11 3.238 1.71 5.023 1.164 8.064-3.039 2.135-15.793.467-20.58 5.917 1.023 18.77 5.88 20.578-1.979.42-1.819-.306-3.616-1.509-4.929-1.203-1.313-2.909-2.27-4.9-2.73-1.99-.46-3.866-.547-5.602.303-1.737.849-3.768 2.642-3.468 4.73a6.17 6.17 0 0 0 .012.43l-6.563-1.794-6.88-22.632c-.702-2.297-3.445-3.99-5.108-4.523Zm26.824 26.88c1.36.315 2.472.99 3.116 1.692.644.703.795 1.307.684 1.79-.112.482-.511.956-1.399 1.305-.887.348-2.182.467-3.542.152-1.361-.314-2.472-.99-3.116-1.693-.644-.703-.797-1.304-.686-1.787.112-.482.513-.956 1.4-1.305a5.198 5.198 0 0 1 1.594-.327 6.98 6.98 0 0 1 1.949.173zM37.846 49.174c.333.069.71.25 1.13.585.746.594 1.497 1.654 1.905 2.99.408 1.335.379 2.635.092 3.545-.287.91-.731 1.34-1.205 1.484-.473.145-1.085.036-1.831-.558-.746-.594-1.496-1.655-1.904-2.99-.407-1.336-.378-2.637-.092-3.546.287-.91.732-1.342 1.206-1.486.118-.036.245-.057.38-.058.102 0 .207.011.319.034z"
        />
    </g>
</svg>
`,delete:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M39.063 42.14 22.288 28.12 7.96 44.603l11.338 9.854h9.059zm-3.498 12.317h25.941v5.465h-44.25L4.377 48.726a5.465 5.465 0 0 1-.542-7.711L34.311 5.958a5.465 5.465 0 0 1 7.712-.538l16.496 14.343a5.465 5.465 0 0 1 .541 7.709z"
          style="stroke-width:2.73262"/>
</svg>
`,union:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.233 7.917c-5.5 0-10.519 2.077-14.328 5.482a21.443 21.443 0 0 0-4.138-.404c-11.88 0-21.544 9.664-21.544 21.544s9.664 21.544 21.544 21.544c5.5 0 10.519-2.077 14.328-5.482 1.34.263 2.722.404 4.138.404 11.88 0 21.544-9.664 21.544-21.544S53.113 7.917 41.233 7.917zm-9.969 6.791a21.61 21.61 0 0 1 5.598 3.499l-2.01 2.33a18.557 18.557 0 0 0-4.8-2.999Zm-7.927 2.765 2.557 1.714a18.558 18.558 0 0 0-2.396 5.128l-2.955-.86a21.614 21.614 0 0 1 2.794-5.982zm15.86 3.08a21.413 21.413 0 0 1 3.46 5.628l-2.839 1.188a18.357 18.357 0 0 0-2.963-4.817zm-19.334 6.142 3.053.399a18.348 18.348 0 0 0 .144 5.654l-3.027.552a21.407 21.407 0 0 1-.17-6.605Zm23.834 2.63a21.81 21.81 0 0 1 .548 3.263c.1 1.1.115 2.207.044 3.31l-3.07-.195c.12-1.888-.056-3.8-.511-5.64zm-19.918 6.172a18.37 18.37 0 0 0 2.64 5.003l-2.466 1.84a21.427 21.427 0 0 1-3.083-5.84Zm17.042 3.016 3.004.666a21.486 21.486 0 0 1-2.404 6.15l-2.66-1.547a18.434 18.434 0 0 0 2.06-5.27zm-12.535 4.124a18.554 18.554 0 0 0 4.6 3.302l-1.392 2.744a21.611 21.611 0 0 1-5.363-3.85Z"/>
</svg>
`,difference:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="m41.478 7.967-.033 3.069c1.887.02 3.772.337 5.561.933l.97-2.913a21.337 21.337 0 0 0-6.498-1.09Zm-3.294.215a21.567 21.567 0 0 0-6.298 1.915l1.332 2.766a18.518 18.518 0 0 1 5.401-1.641zm12.836 2.155-1.402 2.73a18.497 18.497 0 0 1 4.572 3.312l2.16-2.179a21.548 21.548 0 0 0-5.331-3.863ZM22.783 13.06c-11.848 0-21.486 9.638-21.486 21.486 0 11.849 9.638 21.486 21.486 21.486a21.37 21.37 0 0 0 14.288-5.466c.003 0 .006 0 .009.002.04-.036.078-.075.117-.11l.077-.072a21.285 21.285 0 0 0 1.51-1.532 22.128 22.128 0 0 0 .867-1.025 19.557 19.557 0 0 1-.88-.095c-.196-.025-.389-.058-.582-.09-.097-.015-.194-.028-.29-.045a18.378 18.378 0 0 1-1.576-.359l-.118-.03c-7.753-2.172-13.422-9.271-13.422-17.728a18.34 18.34 0 0 1 5.867-13.478c.1-.093.199-.185.3-.276.153-.136.31-.268.467-.4.097-.08.193-.163.291-.242.255-.203.514-.402.78-.592a21.534 21.534 0 0 0-1.76-.592l-.018-.005c-.176-.05-.355-.095-.533-.141-.132-.035-.263-.073-.397-.105-.213-.051-.43-.095-.646-.14-.077-.016-.153-.035-.231-.05H26.9a21.37 21.37 0 0 0-4.118-.4Zm35.728 3.64-2.472 1.82a18.424 18.424 0 0 1 2.61 5.004l2.907-.986a21.474 21.474 0 0 0-3.045-5.839Zm3.864 9.034-3.022.534c.328 1.86.37 3.772.118 5.642l3.042.409a21.448 21.448 0 0 0-.138-6.585zm-3.496 8.943a18.539 18.539 0 0 1-2.416 5.104l2.543 1.72a21.586 21.586 0 0 0 2.815-5.952zM54.703 42a18.288 18.288 0 0 1-4.428 3.492l1.505 2.675a21.348 21.348 0 0 0 5.173-4.08zm-6.995 4.69a18.512 18.512 0 0 1-5.526 1.158l.163 3.065a21.56 21.56 0 0 0 6.444-1.35z"/>
</svg>
`,line_simplification:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.947 25.554c-2.176 3.77-.867 8.656 2.903 10.832 2.126 1.229 4.607 1.346 6.757.539l8.252 12.152a7.79 7.79 0 0 0-.701 1.005c-2.176 3.77-.867 8.656 2.903 10.833 3.77 2.177 8.655.867 10.832-2.903 2.1-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.404-.181 7.955 7.955 0 0 0-6.086-.432l-8.348-12.292c.19-.252.369-.512.53-.79 1.457-2.526 1.339-5.537-.03-7.907l8.202-8.256c3.494 1.335 7.562.025 9.575-3.229l13.899 2.913c.266 2.435 1.634 4.721 3.899 6.03 3.77 2.176 8.655.866 10.832-2.904 2.101-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.403-.181c-3.71-1.87-8.328-.556-10.429 3.083-.084.147-.155.297-.228.446l-13.5-2.83c-.053-2.55-1.329-5.023-3.58-6.499a2.211 2.211 0 0 0-.358-.259 2.211 2.211 0 0 0-.405-.181c-3.708-1.87-8.326-.556-10.428 3.083-1.61 2.79-1.307 6.19.486 8.652l-7.84 7.892a2.211 2.211 0 0 0-.094-.036c-3.71-1.87-8.328-.556-10.429 3.084zm3.83 2.211a3.473 3.473 0 0 1 4.79-1.282 3.472 3.472 0 0 1 1.284 4.789 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.79ZM23.656 8.173a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.789 1.284 3.475 3.475 0 0 1-1.284-4.791zm-.666 44.12a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791zm29.166-37.88a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791z"/>
    <path fill="currentColor"
          d="M12.9 13.516c-.63.177-.685.37-.88.95l-1.069 3.18 2.995 1.006.844-2.506 2.074-.882-1.236-2.908zm19.209 5.25 4.378 4.554 2.277-2.19-4.379-4.554zm8.132 3.106 1.441 2.812 5.623-2.882-1.441-2.812zM5.448 46.082l3.144.304.608-6.29-3.145-.303zm4.623 3.728 5.762 2.592 1.297-2.88-5.762-2.593z"/>
</svg>
`,lasso:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <ellipse cx="4.907" cy="-32.051" fill="none" stroke="currentColor" stroke-dasharray="13.7543, 6.87718"
             stroke-width="5.489" rx="20.4" ry="13.713" transform="matrix(-.71127 .70292 -.86047 -.5095 0 0)"/>
    <path fill="currentColor"
          d="M34.597 25.275a1.934 1.934 0 0 0-2.04 2.165l2.922 31.37c.188 1.523 1.989 2.235 3.165 1.249l6.169-5.004 2.765 4.79c1.59 2.756 4.115 3.431 6.87 1.841 2.756-1.59 3.433-4.114 1.841-6.87l-2.755-4.773 7.31-2.803c1.443-.525 1.728-2.44.503-3.365L35.64 25.66a1.93 1.93 0 0 0-1.042-.383z"/>
</svg>
`,snapping:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor" fill-rule="evenodd"
          d="M19.435 3.417c-4.478 0-8.96 1.693-12.343 5.076-6.766 6.766-6.766 17.913 0 24.679h.006c2.754 2.749 5.563 5.561 8.357 8.357 1.857 1.859 3.696 3.696 5.553 5.553l.949.949 1.892 1.898 9.496-9.49-1.898-1.898-6.502-6.502c-2.796-2.797-5.6-5.606-8.363-8.362-1.65-1.653-1.652-4.042 0-5.694 1.653-1.653 4.047-1.653 5.7 0l8.357 8.362 6.502 6.502 1.898 1.893 9.49-9.49-1.893-1.893-6.507-6.502-8.357-8.362c-3.384-3.383-7.86-5.076-12.337-5.076Zm0 2.68c3.789 0 7.577 1.432 10.439 4.294l8.357 8.362-5.694 5.694-8.357-8.362a6.7 6.7 0 0 0-9.496 0 6.697 6.697 0 0 0 0 9.49c2.76 2.755 5.566 5.564 8.363 8.362l-5.694 5.694c-2.795-2.796-5.601-5.607-8.357-8.357H8.99c-5.724-5.724-5.724-15.16 0-20.883 2.861-2.862 6.655-4.294 10.444-4.294ZM57.709 29.03a4.266 4.266 0 0 0-4.268 4.268c0 1.594.881 2.973 2.176 3.707-.714 4.997-1.424 10.107-2.176 15.037-.934 0-1.792.309-2.495.818l-7.115-5.07a4.25 4.25 0 0 0 .115-.965 4.27 4.27 0 1 0-4.268 4.268 4.23 4.23 0 0 0 2.732-1.012l6.973 4.965a4.22 4.22 0 0 0-.215 1.269 4.27 4.27 0 0 0 4.273 4.268 4.266 4.266 0 0 0 4.268-4.268 4.247 4.247 0 0 0-1.657-3.356l2.208-15.446c2.095-.273 3.722-2.045 3.722-4.215a4.27 4.27 0 0 0-4.273-4.268z"
    />
</svg>
`,pin:`\uFEFF<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M42.012 2.106a4.092 4.092 0 0 0-5.741.735 4.092 4.092 0 0 0 .572 5.607L23.964 23.45a8.185 8.185 0 0 0-10.458 2.142l5.18 4.005 5.454 4.218L7.87 59.22a1.124 7.304 37.712 0 0 1.54 1.19l20.494-22.138 5.454 4.217 5.18 4.005a8.185 8.185 0 0 0-.558-10.66l11.277-16.24a4.092 4.092 0 0 0 5.572-.858 4.092 4.092 0 0 0-.735-5.74z"/>
</svg>
`,snap_guides:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor"
          stroke-width="3.8"
          d="m2.155 32.345 42.35-29.82M18.963 60.919l42.35-29.82M31.443 2.332l29.82 42.35M2.207 19.515l29.82 42.35"/>
</svg>
`,measurements:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.717 38.645a2.675 2.668 79.7 0 0-.307 3.769L16.754 60.55a2.675 2.668 79.7 0 0 3.76.312l41.769-35.508a2.675 2.668 79.7 0 0 .307-3.769L47.246 3.45a2.675 2.668 79.7 0 0-3.76-.312zm5.486 2.352 37.702-32.05 11.892 14.056-2.717 2.31-4.458-5.269-2.033 1.729 4.457 5.269-3.11 2.643-4.457-5.268-2.034 1.728 4.458 5.27-3.106 2.64-4.458-5.27-2.033 1.73 4.457 5.268-3.11 2.644-6.194-7.32-2.033 1.728 6.193 7.32-3.11 2.645-4.457-5.269-2.034 1.729 4.458 5.268-3.106 2.64-4.458-5.268-2.033 1.73 4.457 5.268-3.11 2.643-4.457-5.268-2.034 1.729 4.458 5.268-2.098 1.783z"/>
</svg>
`,auto_trace:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M16.862 2.13 7.297 21.17a2.091 2.091 0 0 0-.193 1.288l4.107 24.166-7.618 13.15 3.619 2.096 7.997-13.804a2.091 2.091 0 0 0 .252-1.397l-4.119-24.235 9.256-18.428Zm40.876.255-1.25 2.49 2.668 1.341 1.25-2.49zm-2.593 5.16-2.68 5.337 2.668 1.341 2.682-5.338zm-4.022 8.007-2.682 5.338 2.67 1.34 2.681-5.337zm-18.67 5.83.055 6.984-11.118.087.056 7.242 11.12-.088.054 6.985 10.521-10.688zm18.927 2.817-2.945.5 1.001 5.89 2.945-.5zm1.502 8.835-2.945.5 1.001 5.89 2.945-.5zm1.502 8.834-2.945.5.74 4.355-.24.413 2.585 1.499.51-.881a1.494 1.494 0 0 0 .18-1zm-3.943 7.854-2.994 5.17 2.584 1.496 2.994-5.169zm-4.492 7.754-1.497 2.584 2.584 1.497 1.498-2.584z"/>
</svg>
`,geofencing:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M31.226 17.87c-4.69 0-8.532 3.832-8.532 8.508 0 1.812.58 3.495 1.558 4.88l5.932 10.255c.831 1.085 1.383.879 2.074-.058l6.543-11.135c.132-.24.236-.493.327-.753a8.396 8.396 0 0 0 .628-3.19c0-4.675-3.841-8.506-8.53-8.506zm0 3.987a4.5 4.5 0 0 1 4.532 4.52 4.5 4.5 0 0 1-4.532 4.521 4.5 4.5 0 0 1-4.534-4.52 4.5 4.5 0 0 1 4.533-4.52z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="5" d="M8.97 53.509 4.423 19.145 35.698 4.199l23.88 25.127L43.06 59.801Z"/>
</svg>
`,zoom_to_features:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.585 1.585V13.75h5.17v1.52H8.58v-1.52h5.17V1.585Zm3.041 3.041h6.083v6.083H4.626Zm9.429 2.13V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0v1.597a1.521 1.521 0 0 0-.325.152l-15.686 9.758a1.52 1.52 0 0 0-.199 2.437l23.512 20.553a1.52 1.52 0 0 0 2.477-.78l4.212-17.037v.352h1.825v-3.65H55.42v1.524a1.52 1.52 0 0 0-.222-.296L43.002 8.741a1.521 1.521 0 0 0-.182-.16h2.259V6.754Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm3.042 2.432v3.65h1.825v-3.65Zm-13.752 2.549 10.757 11.137-3.57 14.446-20.087-17.559Zm13.752 2.926v3.65h1.825v-3.65ZM6.755 17.096v3.65H8.58v-3.65zm0 5.475v3.65h1.628a1.52 1.52 0 0 0 1.02.909l12.683 3.406 7.905 12.694c.168.27.417.481.712.602l13.39 4.576a1.52 1.52 0 0 0 1.157-2.814l-12.936-4.389L24.35 28.42a1.52 1.52 0 0 0-.896-.664L10.19 24.193a1.52 1.52 0 0 0-1.61.557v-2.178zm48.665 3.042v3.65h1.825v-3.65ZM6.755 28.046v3.65H8.58v-3.65zm48.665 3.042v3.65h1.825v-3.65ZM6.755 33.52v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65ZM6.755 38.996v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65zm-35.382.913c-3.454 0-6.287 2.833-6.287 6.287 0 3.076 2.248 5.654 5.179 6.183h-1.225v1.825h3.65V55.42h-.206c2.712-.5 4.777-2.796 5.055-5.59l.002-.002a1.52 1.52 0 0 0 0-1.18c-.314-3.168-2.922-5.698-6.168-5.698zM6.755 44.47v3.65H8.58v-3.65zm13.283 1.521a3.223 3.223 0 0 1 3.246 3.246 3.223 3.223 0 0 1-3.246 3.246 3.223 3.223 0 0 1-3.246-3.246 3.223 3.223 0 0 1 3.246-3.246zm35.382 1.52v2.738h-5.17v12.166h12.165V50.25h-5.17v-2.737ZM6.755 49.946v3.65H8.58v-3.65zm46.536 3.346h6.083v6.083H53.29ZM6.755 55.42v1.825h3.65V55.42H7.668Zm5.475 0v1.825h3.65V55.42zm10.95 0v1.825h3.65V55.42zm5.474 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42z"/>
</svg>
`,click_to_edit:`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M7.839 34.833c-7.104-9.763-5.332-23.33 4.2-30.266C21.572-2.369 35.03.123 42.13 9.882L56.166 29.17c7.098 9.755 5.329 23.325-4.204 30.262-9.533 6.936-22.989 4.444-30.09-5.315L7.841 34.836Zm5.063-25.476c-6.079 5.766-7.006 15.598-1.634 22.98l.778 1.07 12.002-8.732zm3.43-2.495L27.476 22.18l12.002-8.733-.781-1.073c-5.37-7.38-15.01-9.522-22.367-5.512m25.643 10.014L14.54 36.836l10.762 14.79c5.818 7.997 16.653 9.842 24.163 4.378 7.51-5.465 9.088-16.342 3.267-24.342z"/>
</svg>
`},Mf=["mode_start","mode_started","mode_end","mode_ended"],Oe=t=>Object.keys(t),Jn=t=>Object.values(t),Zt=(t,n)=>n.includes(t);function bf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Or={exports:{}},_f=Or.exports,Qo;function xf(){return Qo||(Qo=1,function(t){(function(n,e){t.exports?t.exports=e():n.log=e()})(_f,function(){var n=function(){},e="undefined",r=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(A,P){var C=A[P];if(typeof C.bind=="function")return C.bind(A);try{return Function.prototype.bind.call(C,A)}catch{return function(){return Function.prototype.apply.apply(C,[A,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(A){return A==="debug"&&(A="log"),typeof console===e?!1:A==="trace"&&r?u:console[A]!==void 0?a(console,A):console.log!==void 0?a(console,"log"):n}function c(){for(var A=this.getLevel(),P=0;P<i.length;P++){var C=i[P];this[C]=P<A?n:this.methodFactory(C,A,this.name)}if(this.log=this.debug,typeof console===e&&A<this.levels.SILENT)return"No console available for logging"}function h(A){return function(){typeof console!==e&&(c.call(this),this[A].apply(this,arguments))}}function d(A,P,C){return l(A)||h.apply(this,arguments)}function v(A,P){var C=this,g,D,F,G="loglevel";typeof A=="string"?G+=":"+A:typeof A=="symbol"&&(G=void 0);function N(y){var E=(i[y]||"silent").toUpperCase();if(!(typeof window===e||!G)){try{window.localStorage[G]=E;return}catch{}try{window.document.cookie=encodeURIComponent(G)+"="+E+";"}catch{}}}function H(){var y;if(!(typeof window===e||!G)){try{y=window.localStorage[G]}catch{}if(typeof y===e)try{var E=window.document.cookie,S=encodeURIComponent(G),k=E.indexOf(S+"=");k!==-1&&(y=/^([^;]+)/.exec(E.slice(k+S.length+1))[1])}catch{}return C.levels[y]===void 0&&(y=void 0),y}}function f(){if(!(typeof window===e||!G)){try{window.localStorage.removeItem(G)}catch{}try{window.document.cookie=encodeURIComponent(G)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function p(y){var E=y;if(typeof E=="string"&&C.levels[E.toUpperCase()]!==void 0&&(E=C.levels[E.toUpperCase()]),typeof E=="number"&&E>=0&&E<=C.levels.SILENT)return E;throw new TypeError("log.setLevel() called with invalid level: "+y)}C.name=A,C.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},C.methodFactory=P||d,C.getLevel=function(){return F??D??g},C.setLevel=function(y,E){return F=p(y),E!==!1&&N(F),c.call(C)},C.setDefaultLevel=function(y){D=p(y),H()||C.setLevel(y,!1)},C.resetLevel=function(){F=null,f(),c.call(C)},C.enableAll=function(y){C.setLevel(C.levels.TRACE,y)},C.disableAll=function(y){C.setLevel(C.levels.SILENT,y)},C.rebuild=function(){if(o!==C&&(g=p(o.getLevel())),c.call(C),o===C)for(var y in s)s[y].rebuild()},g=p(o?o.getLevel():"WARN");var m=H();m!=null&&(F=p(m)),c.call(C)}o=new v,o.getLogger=function(P){if(typeof P!="symbol"&&typeof P!="string"||P==="")throw new TypeError("You must supply a name when creating a logger.");var C=s[P];return C||(C=s[P]=new v(P,o.methodFactory)),C};var M=typeof window!==e?window.log:void 0;return o.noConflict=function(){return typeof window!==e&&window.log===o&&(window.log=M),o},o.getLoggers=function(){return s},o.default=o,o})}(Or)),Or.exports}var Sf=xf();const B=bf(Sf);class Gr{isMarkerInstanceAvailable(){return this.markerInstance?!0:(B.error("Marker instance is not available"),!1)}}var we=63710088e-1,ea={centimeters:we*100,centimetres:we*100,degrees:360/(2*Math.PI),feet:we*3.28084,inches:we*39.37,kilometers:we/1e3,kilometres:we/1e3,meters:we,metres:we,miles:we/1609.344,millimeters:we*1e3,millimetres:we*1e3,nauticalmiles:we/1852,radians:1,yards:we*1.0936};function at(t,n,e={}){const r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=n||{},r.geometry=t,r}function Rt(t,n,e={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!sa(t[0])||!sa(t[1]))throw new Error("coordinates must contain numbers");return at({type:"Point",coordinates:t},n,e)}function Xt(t,n,e={}){for(const i of t){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<i[i.length-1].length;s++)if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}return at({type:"Polygon",coordinates:t},n,e)}function qn(t,n,e={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return at({type:"LineString",coordinates:t},n,e)}function Ee(t,n={}){const e={type:"FeatureCollection"};return n.id&&(e.id=n.id),n.bbox&&(e.bbox=n.bbox),e.features=t,e}function Af(t,n,e={}){return at({type:"MultiLineString",coordinates:t},n,e)}function ta(t,n,e={}){return at({type:"MultiPolygon",coordinates:t},n,e)}function na(t,n="kilometers"){const e=ea[n];if(!e)throw new Error(n+" units is invalid");return t*e}function ra(t,n="kilometers"){const e=ea[n];if(!e)throw new Error(n+" units is invalid");return t/e}function dn(t){return t%(2*Math.PI)*180/Math.PI}function me(t){return t%360*Math.PI/180}function ia(t,n="kilometers",e="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return na(ra(t,n),e)}function sa(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Xi(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Bt(t,n,e){if(t!==null)for(var r,i,s,o,a,u,l,c=0,h=0,d,v=t.type,M=v==="FeatureCollection",A=v==="Feature",P=M?t.features.length:1,C=0;C<P;C++){l=M?t.features[C].geometry:A?t.geometry:t,d=l?l.type==="GeometryCollection":!1,a=d?l.geometries.length:1;for(var g=0;g<a;g++){var D=0,F=0;if(o=d?l.geometries[g]:l,o!==null){u=o.coordinates;var G=o.type;switch(c=e&&(G==="Polygon"||G==="MultiPolygon")?1:0,G){case null:break;case"Point":if(n(u,h,C,D,F)===!1)return!1;h++,D++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(n(u[r],h,C,D,F)===!1)return!1;h++,G==="MultiPoint"&&D++}G==="LineString"&&D++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-c;i++){if(n(u[r][i],h,C,D,F)===!1)return!1;h++}G==="MultiLineString"&&D++,G==="Polygon"&&F++}G==="Polygon"&&D++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(F=0,i=0;i<u[r].length;i++){for(s=0;s<u[r][i].length-c;s++){if(n(u[r][i][s],h,C,D,F)===!1)return!1;h++}F++}D++}break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(Bt(o.geometries[r],n,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Nt(t,n){if(t.type==="Feature")n(t,0);else if(t.type==="FeatureCollection")for(var e=0;e<t.features.length&&n(t.features[e],e)!==!1;e++);}function Lf(t,n,e){var r=e;return Nt(t,function(i,s){s===0&&e===void 0?r=i:r=n(r,i,s)}),r}function Vn(t,n){var e,r,i,s,o,a,u,l,c,h,d=0,v=t.type==="FeatureCollection",M=t.type==="Feature",A=v?t.features.length:1;for(e=0;e<A;e++){for(a=v?t.features[e].geometry:M?t.geometry:t,l=v?t.features[e].properties:M?t.properties:{},c=v?t.features[e].bbox:M?t.bbox:void 0,h=v?t.features[e].id:M?t.id:void 0,u=a?a.type==="GeometryCollection":!1,o=u?a.geometries.length:1,i=0;i<o;i++){if(s=u?a.geometries[i]:a,s===null){if(n(null,d,l,c,h)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(s,d,l,c,h)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<s.geometries.length;r++)if(n(s.geometries[r],d,l,c,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}function Cf(t,n,e){var r=e;return Vn(t,function(i,s,o,a,u){r=n(r,i,s,o,a,u)}),r}function Ut(t,n){Vn(t,function(e,r,i,s,o){var a=e===null?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return n(at(e,i,{bbox:s,id:o}),r,0)===!1?!1:void 0}var u;switch(a){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var l=0;l<e.coordinates.length;l++){var c=e.coordinates[l],h={type:u,coordinates:c};if(n(at(h,i),r,l)===!1)return!1}})}function yt(t,n={}){if(t.bbox!=null&&n.recompute!==!0)return t.bbox;const e=[1/0,1/0,-1/0,-1/0];return Bt(t,r=>{e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}var oa=yt;function de(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ue(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Yn(t){return t.type==="Feature"?t.geometry:t}function aa(t,n){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function kf(t,n,e,r={}){const i=de(t),s=me(i[0]),o=me(i[1]),a=me(e),u=ra(n,r.units),l=Math.asin(Math.sin(o)*Math.cos(u)+Math.cos(o)*Math.sin(u)*Math.cos(a)),c=s+Math.atan2(Math.sin(a)*Math.sin(u)*Math.cos(o),Math.cos(u)-Math.sin(o)*Math.sin(l)),h=dn(c),d=dn(l);return Rt([h,d],r.properties)}function Tf(t,n,e={}){const r=e.steps||64,i=e.properties?e.properties:!Array.isArray(t)&&t.type==="Feature"&&t.properties?t.properties:{},s=[];for(let o=0;o<r;o++)s.push(kf(t,n,o*-360/r,e).geometry.coordinates);return s.push(s[0]),Xt([s],i)}var Pf=Tf;function lt(t,n,e={}){var r=de(t),i=de(n),s=me(i[1]-r[1]),o=me(i[0]-r[0]),a=me(r[1]),u=me(i[1]),l=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(a)*Math.cos(u);return na(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),e.units)}var If=lt;function Ki(t,n={}){const e=Yn(t);switch(!n.properties&&t.type==="Feature"&&(n.properties=t.properties),e.type){case"Polygon":return Ff(e,n);case"MultiPolygon":return Df(e,n);default:throw new Error("invalid poly")}}function Ff(t,n={}){const r=Yn(t).coordinates,i=n.properties?n.properties:t.type==="Feature"?t.properties:{};return la(r,i)}function Df(t,n={}){const r=Yn(t).coordinates,i=n.properties?n.properties:t.type==="Feature"?t.properties:{},s=[];return r.forEach(o=>{s.push(la(o,i))}),Ee(s)}function la(t,n){return t.length>1?Af(t,n):qn(t[0],n)}var ua=typeof global=="object"&&global&&global.Object===Object&&global,Of=typeof self=="object"&&self&&self.Object===Object&&self,Qe=ua||Of||Function("return this")(),Ve=Qe.Symbol,ca=Object.prototype,Gf=ca.hasOwnProperty,Rf=ca.toString,Wn=Ve?Ve.toStringTag:void 0;function Bf(t){var n=Gf.call(t,Wn),e=t[Wn];try{t[Wn]=void 0;var r=!0}catch{}var i=Rf.call(t);return r&&(n?t[Wn]=e:delete t[Wn]),i}var Nf=Object.prototype,Uf=Nf.toString;function Hf(t){return Uf.call(t)}var zf="[object Null]",Jf="[object Undefined]",fa=Ve?Ve.toStringTag:void 0;function Kt(t){return t==null?t===void 0?Jf:zf:fa&&fa in Object(t)?Bf(t):Hf(t)}function ut(t){return t!=null&&typeof t=="object"}var qf="[object Symbol]";function pn(t){return typeof t=="symbol"||ut(t)&&Kt(t)==qf}function gn(t,n){for(var e=-1,r=t==null?0:t.length,i=Array(r);++e<r;)i[e]=n(t[e],e,t);return i}var Ae=Array.isArray,ha=Ve?Ve.prototype:void 0,da=ha?ha.toString:void 0;function pa(t){if(typeof t=="string")return t;if(Ae(t))return gn(t,pa)+"";if(pn(t))return da?da.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}var Vf=/\s/;function Yf(t){for(var n=t.length;n--&&Vf.test(t.charAt(n)););return n}var Wf=/^\s+/;function $f(t){return t&&t.slice(0,Yf(t)+1).replace(Wf,"")}function He(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}var ga=NaN,jf=/^[-+]0x[0-9a-f]+$/i,Zf=/^0b[01]+$/i,Xf=/^0o[0-7]+$/i,Kf=parseInt;function ma(t){if(typeof t=="number")return t;if(pn(t))return ga;if(He(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=He(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=$f(t);var e=Zf.test(t);return e||Xf.test(t)?Kf(t.slice(2),e?2:8):jf.test(t)?ga:+t}function Rr(t){return t}var Qf="[object AsyncFunction]",eh="[object Function]",th="[object GeneratorFunction]",nh="[object Proxy]";function Qi(t){if(!He(t))return!1;var n=Kt(t);return n==eh||n==th||n==Qf||n==nh}var es=Qe["__core-js_shared__"],va=function(){var t=/[^.]+$/.exec(es&&es.keys&&es.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function rh(t){return!!va&&va in t}var ih=Function.prototype,sh=ih.toString;function Qt(t){if(t!=null){try{return sh.call(t)}catch{}try{return t+""}catch{}}return""}var oh=/[\\^$.*+?()[\]{}|]/g,ah=/^\[object .+?Constructor\]$/,lh=Function.prototype,uh=Object.prototype,ch=lh.toString,fh=uh.hasOwnProperty,hh=RegExp("^"+ch.call(fh).replace(oh,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function dh(t){if(!He(t)||rh(t))return!1;var n=Qi(t)?hh:ah;return n.test(Qt(t))}function ph(t,n){return t==null?void 0:t[n]}function en(t,n){var e=ph(t,n);return dh(e)?e:void 0}var ts=en(Qe,"WeakMap"),ya=Object.create,gh=function(){function t(){}return function(n){if(!He(n))return{};if(ya)return ya(n);t.prototype=n;var e=new t;return t.prototype=void 0,e}}();function mh(t,n,e){switch(e.length){case 0:return t.call(n);case 1:return t.call(n,e[0]);case 2:return t.call(n,e[0],e[1]);case 3:return t.call(n,e[0],e[1],e[2])}return t.apply(n,e)}function vh(){}function yh(t,n){var e=-1,r=t.length;for(n||(n=Array(r));++e<r;)n[e]=t[e];return n}var wh=800,Eh=16,Mh=Date.now;function bh(t){var n=0,e=0;return function(){var r=Mh(),i=Eh-(r-e);if(e=r,i>0){if(++n>=wh)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}function _h(t){return function(){return t}}var Br=function(){try{var t=en(Object,"defineProperty");return t({},"",{}),t}catch{}}(),xh=Br?function(t,n){return Br(t,"toString",{configurable:!0,enumerable:!1,value:_h(n),writable:!0})}:Rr,Sh=bh(xh);function Ah(t,n){for(var e=-1,r=t==null?0:t.length;++e<r&&n(t[e],e,t)!==!1;);return t}function Lh(t,n,e,r){for(var i=t.length,s=e+-1;++s<i;)if(n(t[s],s,t))return s;return-1}function Ch(t){return t!==t}function kh(t,n,e){for(var r=e-1,i=t.length;++r<i;)if(t[r]===n)return r;return-1}function Th(t,n,e){return n===n?kh(t,n,e):Lh(t,Ch,e)}function wa(t,n){var e=t==null?0:t.length;return!!e&&Th(t,n,0)>-1}var Ph=9007199254740991,Ih=/^(?:0|[1-9]\d*)$/;function ns(t,n){var e=typeof t;return n=n??Ph,!!n&&(e=="number"||e!="symbol"&&Ih.test(t))&&t>-1&&t%1==0&&t<n}function Nr(t,n,e){n=="__proto__"&&Br?Br(t,n,{configurable:!0,enumerable:!0,value:e,writable:!0}):t[n]=e}function $n(t,n){return t===n||t!==t&&n!==n}var Fh=Object.prototype,Dh=Fh.hasOwnProperty;function Ea(t,n,e){var r=t[n];(!(Dh.call(t,n)&&$n(r,e))||e===void 0&&!(n in t))&&Nr(t,n,e)}function Oh(t,n,e,r){var i=!e;e||(e={});for(var s=-1,o=n.length;++s<o;){var a=n[s],u=void 0;u===void 0&&(u=t[a]),i?Nr(e,a,u):Ea(e,a,u)}return e}var Ma=Math.max;function Gh(t,n,e){return n=Ma(n===void 0?t.length-1:n,0),function(){for(var r=arguments,i=-1,s=Ma(r.length-n,0),o=Array(s);++i<s;)o[i]=r[n+i];i=-1;for(var a=Array(n+1);++i<n;)a[i]=r[i];return a[n]=e(o),mh(t,this,a)}}function rs(t,n){return Sh(Gh(t,n,Rr),t+"")}var Rh=9007199254740991;function is(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Rh}function mn(t){return t!=null&&is(t.length)&&!Qi(t)}function ss(t,n,e){if(!He(e))return!1;var r=typeof n;return(r=="number"?mn(e)&&ns(n,e.length):r=="string"&&n in e)?$n(e[n],t):!1}function ba(t){return rs(function(n,e){var r=-1,i=e.length,s=i>1?e[i-1]:void 0,o=i>2?e[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&ss(e[0],e[1],o)&&(s=i<3?void 0:s,i=1),n=Object(n);++r<i;){var a=e[r];a&&t(n,a,r,s)}return n})}var Bh=Object.prototype;function os(t){var n=t&&t.constructor,e=typeof n=="function"&&n.prototype||Bh;return t===e}function Nh(t,n){for(var e=-1,r=Array(t);++e<t;)r[e]=n(e);return r}var Uh="[object Arguments]";function _a(t){return ut(t)&&Kt(t)==Uh}var xa=Object.prototype,Hh=xa.hasOwnProperty,zh=xa.propertyIsEnumerable,jn=_a(function(){return arguments}())?_a:function(t){return ut(t)&&Hh.call(t,"callee")&&!zh.call(t,"callee")};function Jh(){return!1}var Sa=typeof $=="object"&&$&&!$.nodeType&&$,Aa=Sa&&typeof module=="object"&&module&&!module.nodeType&&module,qh=Aa&&Aa.exports===Sa,La=qh?Qe.Buffer:void 0,Vh=La?La.isBuffer:void 0,Zn=Vh||Jh,Yh="[object Arguments]",Wh="[object Array]",$h="[object Boolean]",jh="[object Date]",Zh="[object Error]",Xh="[object Function]",Kh="[object Map]",Qh="[object Number]",ed="[object Object]",td="[object RegExp]",nd="[object Set]",rd="[object String]",id="[object WeakMap]",sd="[object ArrayBuffer]",od="[object DataView]",ad="[object Float32Array]",ld="[object Float64Array]",ud="[object Int8Array]",cd="[object Int16Array]",fd="[object Int32Array]",hd="[object Uint8Array]",dd="[object Uint8ClampedArray]",pd="[object Uint16Array]",gd="[object Uint32Array]",le={};le[ad]=le[ld]=le[ud]=le[cd]=le[fd]=le[hd]=le[dd]=le[pd]=le[gd]=!0,le[Yh]=le[Wh]=le[sd]=le[$h]=le[od]=le[jh]=le[Zh]=le[Xh]=le[Kh]=le[Qh]=le[ed]=le[td]=le[nd]=le[rd]=le[id]=!1;function md(t){return ut(t)&&is(t.length)&&!!le[Kt(t)]}function Ur(t){return function(n){return t(n)}}var Ca=typeof $=="object"&&$&&!$.nodeType&&$,Xn=Ca&&typeof module=="object"&&module&&!module.nodeType&&module,vd=Xn&&Xn.exports===Ca,as=vd&&ua.process,vn=function(){try{var t=Xn&&Xn.require&&Xn.require("util").types;return t||as&&as.binding&&as.binding("util")}catch{}}(),ka=vn&&vn.isTypedArray,ls=ka?Ur(ka):md,yd=Object.prototype,wd=yd.hasOwnProperty;function Ta(t,n){var e=Ae(t),r=!e&&jn(t),i=!e&&!r&&Zn(t),s=!e&&!r&&!i&&ls(t),o=e||r||i||s,a=o?Nh(t.length,String):[],u=a.length;for(var l in t)(n||wd.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ns(l,u)))&&a.push(l);return a}function Pa(t,n){return function(e){return t(n(e))}}var Ed=Pa(Object.keys,Object),Md=Object.prototype,bd=Md.hasOwnProperty;function _d(t){if(!os(t))return Ed(t);var n=[];for(var e in Object(t))bd.call(t,e)&&e!="constructor"&&n.push(e);return n}function Hr(t){return mn(t)?Ta(t):_d(t)}function xd(t){var n=[];if(t!=null)for(var e in Object(t))n.push(e);return n}var Sd=Object.prototype,Ad=Sd.hasOwnProperty;function Ld(t){if(!He(t))return xd(t);var n=os(t),e=[];for(var r in t)r=="constructor"&&(n||!Ad.call(t,r))||e.push(r);return e}function Ia(t){return mn(t)?Ta(t,!0):Ld(t)}var Cd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kd=/^\w*$/;function us(t,n){if(Ae(t))return!1;var e=typeof t;return e=="number"||e=="symbol"||e=="boolean"||t==null||pn(t)?!0:kd.test(t)||!Cd.test(t)||n!=null&&t in Object(n)}var Kn=en(Object,"create");function Td(){this.__data__=Kn?Kn(null):{},this.size=0}function Pd(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n}var Id="__lodash_hash_undefined__",Fd=Object.prototype,Dd=Fd.hasOwnProperty;function Od(t){var n=this.__data__;if(Kn){var e=n[t];return e===Id?void 0:e}return Dd.call(n,t)?n[t]:void 0}var Gd=Object.prototype,Rd=Gd.hasOwnProperty;function Bd(t){var n=this.__data__;return Kn?n[t]!==void 0:Rd.call(n,t)}var Nd="__lodash_hash_undefined__";function Ud(t,n){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=Kn&&n===void 0?Nd:n,this}function tn(t){var n=-1,e=t==null?0:t.length;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}tn.prototype.clear=Td,tn.prototype.delete=Pd,tn.prototype.get=Od,tn.prototype.has=Bd,tn.prototype.set=Ud;function Hd(){this.__data__=[],this.size=0}function zr(t,n){for(var e=t.length;e--;)if($n(t[e][0],n))return e;return-1}var zd=Array.prototype,Jd=zd.splice;function qd(t){var n=this.__data__,e=zr(n,t);if(e<0)return!1;var r=n.length-1;return e==r?n.pop():Jd.call(n,e,1),--this.size,!0}function Vd(t){var n=this.__data__,e=zr(n,t);return e<0?void 0:n[e][1]}function Yd(t){return zr(this.__data__,t)>-1}function Wd(t,n){var e=this.__data__,r=zr(e,t);return r<0?(++this.size,e.push([t,n])):e[r][1]=n,this}function wt(t){var n=-1,e=t==null?0:t.length;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}wt.prototype.clear=Hd,wt.prototype.delete=qd,wt.prototype.get=Vd,wt.prototype.has=Yd,wt.prototype.set=Wd;var Qn=en(Qe,"Map");function $d(){this.size=0,this.__data__={hash:new tn,map:new(Qn||wt),string:new tn}}function jd(t){var n=typeof t;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null}function Jr(t,n){var e=t.__data__;return jd(n)?e[typeof n=="string"?"string":"hash"]:e.map}function Zd(t){var n=Jr(this,t).delete(t);return this.size-=n?1:0,n}function Xd(t){return Jr(this,t).get(t)}function Kd(t){return Jr(this,t).has(t)}function Qd(t,n){var e=Jr(this,t),r=e.size;return e.set(t,n),this.size+=e.size==r?0:1,this}function Et(t){var n=-1,e=t==null?0:t.length;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}Et.prototype.clear=$d,Et.prototype.delete=Zd,Et.prototype.get=Xd,Et.prototype.has=Kd,Et.prototype.set=Qd;var ep="Expected a function";function cs(t,n){if(typeof t!="function"||n!=null&&typeof n!="function")throw new TypeError(ep);var e=function(){var r=arguments,i=n?n.apply(this,r):r[0],s=e.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return e.cache=s.set(i,o)||s,o};return e.cache=new(cs.Cache||Et),e}cs.Cache=Et;var tp=500;function np(t){var n=cs(t,function(r){return e.size===tp&&e.clear(),r}),e=n.cache;return n}var rp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ip=/\\(\\)?/g,sp=np(function(t){var n=[];return t.charCodeAt(0)===46&&n.push(""),t.replace(rp,function(e,r,i,s){n.push(i?s.replace(ip,"$1"):r||e)}),n});function op(t){return t==null?"":pa(t)}function Fa(t,n){return Ae(t)?t:us(t,n)?[t]:sp(op(t))}function qr(t){if(typeof t=="string"||pn(t))return t;var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}function fs(t,n){n=Fa(n,t);for(var e=0,r=n.length;t!=null&&e<r;)t=t[qr(n[e++])];return e&&e==r?t:void 0}function nn(t,n,e){var r=t==null?void 0:fs(t,n);return r===void 0?e:r}function Da(t,n){for(var e=-1,r=n.length,i=t.length;++e<r;)t[i+e]=n[e];return t}var Oa=Ve?Ve.isConcatSpreadable:void 0;function ap(t){return Ae(t)||jn(t)||!!(Oa&&t&&t[Oa])}function lp(t,n,e,r,i){var s=-1,o=t.length;for(e||(e=ap),i||(i=[]);++s<o;){var a=t[s];e(a)?Da(i,a):i[i.length]=a}return i}var Ga=Pa(Object.getPrototypeOf,Object),up="[object Object]",cp=Function.prototype,fp=Object.prototype,Ra=cp.toString,hp=fp.hasOwnProperty,dp=Ra.call(Object);function pp(t){if(!ut(t)||Kt(t)!=up)return!1;var n=Ga(t);if(n===null)return!0;var e=hp.call(n,"constructor")&&n.constructor;return typeof e=="function"&&e instanceof e&&Ra.call(e)==dp}function gp(){this.__data__=new wt,this.size=0}function mp(t){var n=this.__data__,e=n.delete(t);return this.size=n.size,e}function vp(t){return this.__data__.get(t)}function yp(t){return this.__data__.has(t)}var wp=200;function Ep(t,n){var e=this.__data__;if(e instanceof wt){var r=e.__data__;if(!Qn||r.length<wp-1)return r.push([t,n]),this.size=++e.size,this;e=this.__data__=new Et(r)}return e.set(t,n),this.size=e.size,this}function et(t){var n=this.__data__=new wt(t);this.size=n.size}et.prototype.clear=gp,et.prototype.delete=mp,et.prototype.get=vp,et.prototype.has=yp,et.prototype.set=Ep;var Ba=typeof $=="object"&&$&&!$.nodeType&&$,Na=Ba&&typeof module=="object"&&module&&!module.nodeType&&module,Mp=Na&&Na.exports===Ba,Ua=Mp?Qe.Buffer:void 0,Ha=Ua?Ua.allocUnsafe:void 0;function za(t,n){if(n)return t.slice();var e=t.length,r=Ha?Ha(e):new t.constructor(e);return t.copy(r),r}function bp(t,n){for(var e=-1,r=t==null?0:t.length,i=0,s=[];++e<r;){var o=t[e];n(o,e,t)&&(s[i++]=o)}return s}function _p(){return[]}var xp=Object.prototype,Sp=xp.propertyIsEnumerable,Ja=Object.getOwnPropertySymbols,Ap=Ja?function(t){return t==null?[]:(t=Object(t),bp(Ja(t),function(n){return Sp.call(t,n)}))}:_p;function Lp(t,n,e){var r=n(t);return Ae(t)?r:Da(r,e(t))}function hs(t){return Lp(t,Hr,Ap)}var ds=en(Qe,"DataView"),ps=en(Qe,"Promise"),yn=en(Qe,"Set"),qa="[object Map]",Cp="[object Object]",Va="[object Promise]",Ya="[object Set]",Wa="[object WeakMap]",$a="[object DataView]",kp=Qt(ds),Tp=Qt(Qn),Pp=Qt(ps),Ip=Qt(yn),Fp=Qt(ts),tt=Kt;(ds&&tt(new ds(new ArrayBuffer(1)))!=$a||Qn&&tt(new Qn)!=qa||ps&&tt(ps.resolve())!=Va||yn&&tt(new yn)!=Ya||ts&&tt(new ts)!=Wa)&&(tt=function(t){var n=Kt(t),e=n==Cp?t.constructor:void 0,r=e?Qt(e):"";if(r)switch(r){case kp:return $a;case Tp:return qa;case Pp:return Va;case Ip:return Ya;case Fp:return Wa}return n});var Dp=Object.prototype,Op=Dp.hasOwnProperty;function Gp(t){var n=t.length,e=new t.constructor(n);return n&&typeof t[0]=="string"&&Op.call(t,"index")&&(e.index=t.index,e.input=t.input),e}var Vr=Qe.Uint8Array;function gs(t){var n=new t.constructor(t.byteLength);return new Vr(n).set(new Vr(t)),n}function Rp(t,n){var e=gs(t.buffer);return new t.constructor(e,t.byteOffset,t.byteLength)}var Bp=/\w*$/;function Np(t){var n=new t.constructor(t.source,Bp.exec(t));return n.lastIndex=t.lastIndex,n}var ja=Ve?Ve.prototype:void 0,Za=ja?ja.valueOf:void 0;function Up(t){return Za?Object(Za.call(t)):{}}function Xa(t,n){var e=n?gs(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}var Hp="[object Boolean]",zp="[object Date]",Jp="[object Map]",qp="[object Number]",Vp="[object RegExp]",Yp="[object Set]",Wp="[object String]",$p="[object Symbol]",jp="[object ArrayBuffer]",Zp="[object DataView]",Xp="[object Float32Array]",Kp="[object Float64Array]",Qp="[object Int8Array]",eg="[object Int16Array]",tg="[object Int32Array]",ng="[object Uint8Array]",rg="[object Uint8ClampedArray]",ig="[object Uint16Array]",sg="[object Uint32Array]";function og(t,n,e){var r=t.constructor;switch(n){case jp:return gs(t);case Hp:case zp:return new r(+t);case Zp:return Rp(t);case Xp:case Kp:case Qp:case eg:case tg:case ng:case rg:case ig:case sg:return Xa(t,e);case Jp:return new r;case qp:case Wp:return new r(t);case Vp:return Np(t);case Yp:return new r;case $p:return Up(t)}}function Ka(t){return typeof t.constructor=="function"&&!os(t)?gh(Ga(t)):{}}var ag="[object Map]";function lg(t){return ut(t)&&tt(t)==ag}var Qa=vn&&vn.isMap,ug=Qa?Ur(Qa):lg,cg="[object Set]";function fg(t){return ut(t)&&tt(t)==cg}var el=vn&&vn.isSet,hg=el?Ur(el):fg,dg=1,tl="[object Arguments]",pg="[object Array]",gg="[object Boolean]",mg="[object Date]",vg="[object Error]",nl="[object Function]",yg="[object GeneratorFunction]",wg="[object Map]",Eg="[object Number]",rl="[object Object]",Mg="[object RegExp]",bg="[object Set]",_g="[object String]",xg="[object Symbol]",Sg="[object WeakMap]",Ag="[object ArrayBuffer]",Lg="[object DataView]",Cg="[object Float32Array]",kg="[object Float64Array]",Tg="[object Int8Array]",Pg="[object Int16Array]",Ig="[object Int32Array]",Fg="[object Uint8Array]",Dg="[object Uint8ClampedArray]",Og="[object Uint16Array]",Gg="[object Uint32Array]",ae={};ae[tl]=ae[pg]=ae[Ag]=ae[Lg]=ae[gg]=ae[mg]=ae[Cg]=ae[kg]=ae[Tg]=ae[Pg]=ae[Ig]=ae[wg]=ae[Eg]=ae[rl]=ae[Mg]=ae[bg]=ae[_g]=ae[xg]=ae[Fg]=ae[Dg]=ae[Og]=ae[Gg]=!0,ae[vg]=ae[nl]=ae[Sg]=!1;function Yr(t,n,e,r,i,s){var o,a=n&dg;if(o!==void 0)return o;if(!He(t))return t;var u=Ae(t);if(u)o=Gp(t);else{var l=tt(t),c=l==nl||l==yg;if(Zn(t))return za(t,a);if(l==rl||l==tl||c&&!i)o=c?{}:Ka(t);else{if(!ae[l])return i?t:{};o=og(t,l,a)}}s||(s=new et);var h=s.get(t);if(h)return h;s.set(t,o),hg(t)?t.forEach(function(M){o.add(Yr(M,n,e,M,t,s))}):ug(t)&&t.forEach(function(M,A){o.set(A,Yr(M,n,e,A,t,s))});var d=hs,v=u?void 0:d(t);return Ah(v||t,function(M,A){v&&(A=M,M=t[A]),Ea(o,A,Yr(M,n,e,A,t,s))}),o}var Rg=1,Bg=4;function Ye(t){return Yr(t,Rg|Bg)}var Ng="__lodash_hash_undefined__";function Ug(t){return this.__data__.set(t,Ng),this}function Hg(t){return this.__data__.has(t)}function wn(t){var n=-1,e=t==null?0:t.length;for(this.__data__=new Et;++n<e;)this.add(t[n])}wn.prototype.add=wn.prototype.push=Ug,wn.prototype.has=Hg;function zg(t,n){for(var e=-1,r=t==null?0:t.length;++e<r;)if(n(t[e],e,t))return!0;return!1}function Wr(t,n){return t.has(n)}var Jg=1,qg=2;function il(t,n,e,r,i,s){var o=e&Jg,a=t.length,u=n.length;if(a!=u&&!(o&&u>a))return!1;var l=s.get(t),c=s.get(n);if(l&&c)return l==n&&c==t;var h=-1,d=!0,v=e&qg?new wn:void 0;for(s.set(t,n),s.set(n,t);++h<a;){var M=t[h],A=n[h];if(r)var P=o?r(A,M,h,n,t,s):r(M,A,h,t,n,s);if(P!==void 0){if(P)continue;d=!1;break}if(v){if(!zg(n,function(C,g){if(!Wr(v,g)&&(M===C||i(M,C,e,r,s)))return v.push(g)})){d=!1;break}}else if(!(M===A||i(M,A,e,r,s))){d=!1;break}}return s.delete(t),s.delete(n),d}function Vg(t){var n=-1,e=Array(t.size);return t.forEach(function(r,i){e[++n]=[i,r]}),e}function ms(t){var n=-1,e=Array(t.size);return t.forEach(function(r){e[++n]=r}),e}var Yg=1,Wg=2,$g="[object Boolean]",jg="[object Date]",Zg="[object Error]",Xg="[object Map]",Kg="[object Number]",Qg="[object RegExp]",e0="[object Set]",t0="[object String]",n0="[object Symbol]",r0="[object ArrayBuffer]",i0="[object DataView]",sl=Ve?Ve.prototype:void 0,vs=sl?sl.valueOf:void 0;function s0(t,n,e,r,i,s,o){switch(e){case i0:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case r0:return!(t.byteLength!=n.byteLength||!s(new Vr(t),new Vr(n)));case $g:case jg:case Kg:return $n(+t,+n);case Zg:return t.name==n.name&&t.message==n.message;case Qg:case t0:return t==n+"";case Xg:var a=Vg;case e0:var u=r&Yg;if(a||(a=ms),t.size!=n.size&&!u)return!1;var l=o.get(t);if(l)return l==n;r|=Wg,o.set(t,n);var c=il(a(t),a(n),r,i,s,o);return o.delete(t),c;case n0:if(vs)return vs.call(t)==vs.call(n)}return!1}var o0=1,a0=Object.prototype,l0=a0.hasOwnProperty;function u0(t,n,e,r,i,s){var o=e&o0,a=hs(t),u=a.length,l=hs(n),c=l.length;if(u!=c&&!o)return!1;for(var h=u;h--;){var d=a[h];if(!(o?d in n:l0.call(n,d)))return!1}var v=s.get(t),M=s.get(n);if(v&&M)return v==n&&M==t;var A=!0;s.set(t,n),s.set(n,t);for(var P=o;++h<u;){d=a[h];var C=t[d],g=n[d];if(r)var D=o?r(g,C,d,n,t,s):r(C,g,d,t,n,s);if(!(D===void 0?C===g||i(C,g,e,r,s):D)){A=!1;break}P||(P=d=="constructor")}if(A&&!P){var F=t.constructor,G=n.constructor;F!=G&&"constructor"in t&&"constructor"in n&&!(typeof F=="function"&&F instanceof F&&typeof G=="function"&&G instanceof G)&&(A=!1)}return s.delete(t),s.delete(n),A}var c0=1,ol="[object Arguments]",al="[object Array]",$r="[object Object]",f0=Object.prototype,ll=f0.hasOwnProperty;function h0(t,n,e,r,i,s){var o=Ae(t),a=Ae(n),u=o?al:tt(t),l=a?al:tt(n);u=u==ol?$r:u,l=l==ol?$r:l;var c=u==$r,h=l==$r,d=u==l;if(d&&Zn(t)){if(!Zn(n))return!1;o=!0,c=!1}if(d&&!c)return s||(s=new et),o||ls(t)?il(t,n,e,r,i,s):s0(t,n,u,e,r,i,s);if(!(e&c0)){var v=c&&ll.call(t,"__wrapped__"),M=h&&ll.call(n,"__wrapped__");if(v||M){var A=v?t.value():t,P=M?n.value():n;return s||(s=new et),i(A,P,e,r,s)}}return d?(s||(s=new et),u0(t,n,e,r,i,s)):!1}function jr(t,n,e,r,i){return t===n?!0:t==null||n==null||!ut(t)&&!ut(n)?t!==t&&n!==n:h0(t,n,e,r,jr,i)}var d0=1,p0=2;function g0(t,n,e,r){var i=e.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=e[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=e[i];var a=o[0],u=t[a],l=o[1];if(o[2]){if(u===void 0&&!(a in t))return!1}else{var c=new et,h;if(!(h===void 0?jr(l,u,d0|p0,r,c):h))return!1}}return!0}function ul(t){return t===t&&!He(t)}function m0(t){for(var n=Hr(t),e=n.length;e--;){var r=n[e],i=t[r];n[e]=[r,i,ul(i)]}return n}function cl(t,n){return function(e){return e==null?!1:e[t]===n&&(n!==void 0||t in Object(e))}}function v0(t){var n=m0(t);return n.length==1&&n[0][2]?cl(n[0][0],n[0][1]):function(e){return e===t||g0(e,t,n)}}function y0(t,n){return t!=null&&n in Object(t)}function w0(t,n,e){n=Fa(n,t);for(var r=-1,i=n.length,s=!1;++r<i;){var o=qr(n[r]);if(!(s=t!=null&&e(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&is(i)&&ns(o,i)&&(Ae(t)||jn(t)))}function E0(t,n){return t!=null&&w0(t,n,y0)}var M0=1,b0=2;function _0(t,n){return us(t)&&ul(n)?cl(qr(t),n):function(e){var r=nn(e,t);return r===void 0&&r===n?E0(e,t):jr(n,r,M0|b0)}}function x0(t){return function(n){return n==null?void 0:n[t]}}function S0(t){return function(n){return fs(n,t)}}function A0(t){return us(t)?x0(qr(t)):S0(t)}function fl(t){return typeof t=="function"?t:t==null?Rr:typeof t=="object"?Ae(t)?_0(t[0],t[1]):v0(t):A0(t)}function L0(t,n,e,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];n(r,o,e(o),t)}return r}function C0(t){return function(n,e,r){for(var i=-1,s=Object(n),o=r(n),a=o.length;a--;){var u=o[++i];if(e(s[u],u,s)===!1)break}return n}}var hl=C0();function k0(t,n){return t&&hl(t,n,Hr)}function T0(t,n){return function(e,r){if(e==null)return e;if(!mn(e))return t(e,r);for(var i=e.length,s=-1,o=Object(e);++s<i&&r(o[s],s,o)!==!1;);return e}}var dl=T0(k0);function P0(t,n,e,r){return dl(t,function(i,s,o){n(r,i,e(i),o)}),r}function I0(t,n){return function(e,r){var i=Ae(e)?L0:P0,s=n?n():{};return i(e,t,fl(r),s)}}var ys=function(){return Qe.Date.now()},F0="Expected a function",D0=Math.max,O0=Math.min;function ws(t,n,e){var r,i,s,o,a,u,l=0,c=!1,h=!1,d=!0;if(typeof t!="function")throw new TypeError(F0);n=ma(n)||0,He(e)&&(c=!!e.leading,h="maxWait"in e,s=h?D0(ma(e.maxWait)||0,n):s,d="trailing"in e?!!e.trailing:d);function v(N){var H=r,f=i;return r=i=void 0,l=N,o=t.apply(f,H),o}function M(N){return l=N,a=setTimeout(C,n),c?v(N):o}function A(N){var H=N-u,f=N-l,p=n-H;return h?O0(p,s-f):p}function P(N){var H=N-u,f=N-l;return u===void 0||H>=n||H<0||h&&f>=s}function C(){var N=ys();if(P(N))return g(N);a=setTimeout(C,A(N))}function g(N){return a=void 0,d&&r?v(N):(r=i=void 0,o)}function D(){a!==void 0&&clearTimeout(a),l=0,r=u=i=a=void 0}function F(){return a===void 0?o:g(ys())}function G(){var N=ys(),H=P(N);if(r=arguments,i=this,u=N,H){if(a===void 0)return M(u);if(h)return clearTimeout(a),a=setTimeout(C,n),v(u)}return a===void 0&&(a=setTimeout(C,n)),o}return G.cancel=D,G.flush=F,G}function Es(t,n,e){(e!==void 0&&!$n(t[n],e)||e===void 0&&!(n in t))&&Nr(t,n,e)}function pl(t){return ut(t)&&mn(t)}function Ms(t,n){if(!(n==="constructor"&&typeof t[n]=="function")&&n!="__proto__")return t[n]}function G0(t){return Oh(t,Ia(t))}function R0(t,n,e,r,i,s,o){var a=Ms(t,e),u=Ms(n,e),l=o.get(u);if(l){Es(t,e,l);return}var c=s?s(a,u,e+"",t,n,o):void 0,h=c===void 0;if(h){var d=Ae(u),v=!d&&Zn(u),M=!d&&!v&&ls(u);c=u,d||v||M?Ae(a)?c=a:pl(a)?c=yh(a):v?(h=!1,c=za(u,!0)):M?(h=!1,c=Xa(u,!0)):c=[]:pp(u)||jn(u)?(c=a,jn(a)?c=G0(a):(!He(a)||Qi(a))&&(c=Ka(u))):h=!1}h&&(o.set(u,c),i(c,u,r,s,o),o.delete(u)),Es(t,e,c)}function bs(t,n,e,r,i){t!==n&&hl(n,function(s,o){if(i||(i=new et),He(s))R0(t,n,o,e,bs,r,i);else{var a=r?r(Ms(t,o),s,o+"",t,n,i):void 0;a===void 0&&(a=s),Es(t,o,a)}},Ia)}var B0=ba(function(t,n,e,r){bs(t,n,e,r)});function N0(t,n,e){for(var r=-1,i=t==null?0:t.length;++r<i;)if(e(n,t[r]))return!0;return!1}function U0(t,n){var e=-1,r=mn(t)?Array(t.length):[];return dl(t,function(i,s,o){r[++e]=n(i,s,o)}),r}function H0(t,n){return gn(n,function(e){return t[e]})}function z0(t){return t==null?[]:H0(t,Hr(t))}var J0=Math.min;function q0(t,n,e){for(var r=wa,i=t[0].length,s=t.length,o=s,a=Array(s),u=1/0,l=[];o--;){var c=t[o];u=J0(c.length,u),a[o]=i>=120&&c.length>=120?new wn(o&&c):void 0}c=t[0];var h=-1,d=a[0];e:for(;++h<i&&l.length<u;){var v=c[h],M=v;if(v=v!==0?v:0,!(d?Wr(d,M):r(l,M))){for(o=s;--o;){var A=a[o];if(!(A?Wr(A,M):r(t[o],M)))continue e}d&&d.push(M),l.push(v)}}return l}function V0(t){return pl(t)?t:[]}var Y0=rs(function(t){var n=gn(t,V0);return n.length&&n[0]===t[0]?q0(n):[]});function er(t,n){return jr(t,n)}var W0=I0(function(t,n,e){Nr(t,e,n)}),$0=ba(function(t,n,e){bs(t,n,e)});function j0(t,n){var e=t.length;for(t.sort(n);e--;)t[e]=t[e].value;return t}function Z0(t,n){if(t!==n){var e=t!==void 0,r=t===null,i=t===t,s=pn(t),o=n!==void 0,a=n===null,u=n===n,l=pn(n);if(!a&&!l&&!s&&t>n||s&&o&&u&&!a&&!l||r&&o&&u||!e&&u||!i)return 1;if(!r&&!s&&!l&&t<n||l&&e&&i&&!r&&!s||a&&e&&i||!o&&i||!u)return-1}return 0}function X0(t,n,e){for(var r=-1,i=t.criteria,s=n.criteria,o=i.length,a=e.length;++r<o;){var u=Z0(i[r],s[r]);if(u){if(r>=a)return u;var l=e[r];return u*(l=="desc"?-1:1)}}return t.index-n.index}function K0(t,n,e){n.length?n=gn(n,function(s){return Ae(s)?function(o){return fs(o,s.length===1?s[0]:s)}:s}):n=[Rr];var r=-1;n=gn(n,Ur(fl));var i=U0(t,function(s,o,a){var u=gn(n,function(l){return l(s)});return{criteria:u,index:++r,value:s}});return j0(i,function(s,o){return X0(s,o,e)})}var gl=rs(function(t,n){if(t==null)return[];var e=n.length;return e>1&&ss(t,n[0],n[1])?n=[]:e>2&&ss(n[0],n[1],n[2])&&(n=[n[0]]),K0(t,lp(n),[])}),Q0="Expected a function";function ml(t,n,e){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(Q0);return He(e)&&(r="leading"in e?!!e.leading:r,i="trailing"in e?!!e.trailing:i),ws(t,n,{leading:r,maxWait:n,trailing:i})}var em=1/0,tm=yn&&1/ms(new yn([,-0]))[1]==em?function(t){return new yn(t)}:vh,nm=200;function rm(t,n,e){var r=-1,i=wa,s=t.length,o=!0,a=[],u=a;if(e)o=!1,i=N0;else if(s>=nm){var l=tm(t);if(l)return ms(l);o=!1,i=Wr,u=new wn}else u=a;e:for(;++r<s;){var c=t[r],h=c;if(c=e||c!==0?c:0,o&&h===h){for(var d=u.length;d--;)if(u[d]===h)continue e;a.push(c)}else i(u,h,e)||(u!==a&&u.push(h),a.push(c))}return a}function _s(t,n){return n=typeof n=="function"?n:void 0,t&&t.length?rm(t,void 0,n):[]}const tr=(t,n)=>t[0]===n[0]&&t[1]===n[1],vl=t=>t.type==="Feature"&&t.geometry.type==="LineString",yl=t=>t.type==="Feature"&&t.geometry.type==="Polygon",wl=t=>t.type==="Feature"&&t.geometry.type==="MultiPolygon",El=(t,n)=>({lng:n[0]-t[0],lat:n[1]-t[1]}),Zr=t=>Array.isArray(t)&&t.length>=2&&t.length<=3&&t.every(n=>typeof n=="number"),nr=(t,n,e=!1)=>{let r=0;const i=["features","geometries","geometry","coordinates"],s=(o,a,u=!1)=>{Zr(o)?(n({coordinate:o,path:a},r),r+=1):Array.isArray(o)?o.forEach((l,c)=>{u&&e&&c===o.length-1&&Zr(l)||s(l,[...a,c],u)}):typeof o=="object"&&o!==null&&Oe(o).forEach(l=>{const c=o[l];if(i.includes(l)&&c){const h="type"in o&&o.type,d=h==="Polygon"||h==="MultiPolygon";s(c,[...a,l],d)}})};s(t,[])},Ml=(t,n)=>{let e={coordinate:[0,0],path:[]},r=-1;try{nr(t,(i,s)=>{if(n[0]===i.coordinate[0]&&n[1]===i.coordinate[1])throw r=s,e=i,new Error("stop")})}catch{if(e)return{index:r,coordinate:e.coordinate,path:e.path}}return null},bl=(t,n)=>{let e=0;const r=["features","geometries","geometry","coordinates"],i=(s,o,a,u)=>{Zr(s)&&Zr(o)?(n({start:{coordinate:[...s],path:a},end:{coordinate:[...o],path:u}},e),e+=1):Array.isArray(s)?s.forEach((l,c)=>{i(l,s[c+1],[...a,c],[...a,c+1])}):typeof s=="object"&&s!==null&&Oe(s).forEach(l=>{const c=s[l];r.includes(l)&&c&&i(c,void 0,[...a,l],[])})};i(t,void 0,[],[])},Xr=(t,n)=>{let e={absCoordIndex:-1,featureIndex:-1,multiFeatureIndex:-1,geometryIndex:-1};try{Bt(t,(r,i,s,o,a)=>{if(r[0]===n[0]&&r[1]===n[1])throw e={absCoordIndex:i,featureIndex:s,multiFeatureIndex:o,geometryIndex:a},new Error("found")})}catch{}return e},En=(t,n)=>{const[e,r]=t,[i,s]=n,o=Math.min(e,i),a=Math.min(r,s),u=Math.max(e,i),l=Math.max(r,s);return[o,a,u,l]},xs=(t,n)=>{const e=En(t,n),r=[e[0],e[1]],i=[e[2],e[3]],s=r[0],o=r[1],a=i[0],u=i[1];return{type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[s,o],[a,o],[a,u],[s,u],[s,o]]]}}},_l=t=>[t.geometry.coordinates[0],t.geometry.coordinates[1]],Ss=t=>{const n=oa(t);return[[n[0],n[1]],[n[2],n[3]]]},xl=t=>[t[0][0],t[0][1],t[1][0],t[1][1]],im=(t,n)=>{const[e,r,i,s]=t,[o,a]=n;return o>=e&&o<=i&&a>=r&&a<=s},sm=(t,n)=>{const e=xl(t);return im(e,n)},As=t=>{let n=0;return Bt(t,()=>{n+=1},!0),n},om=t=>{const n=[];return Bt(t,e=>{n.push([e[0],e[1]])},!0),n},Sl=t=>{const n=om(t);return n.some(e=>!er(n[0],e))},Al=t=>{let n=null;try{nr(t,e=>{throw n=e.coordinate,new Error("found")})}catch{return n}return null},Kr=(t,n)=>Math.sqrt((t[0]-n[0])**2+(t[1]-n[1])**2),am=(t,n,e)=>{const[r,i]=[t[0],t[1]],[s,o]=[n[0],n[1]],[a,u]=[e[0],e[1]],l=s-r,c=o-i,h=a-r,d=u-i,v=h*l+d*c,M=l*l+c*c;let A=v/M;return A=Math.max(0,Math.min(1,A)),[r+A*l,i+A*c]},lm=(t,n)=>{const{absCoordIndex:e}=Xr(t,n);return e!==-1?(t.geometry.coordinates.splice(e,1),!0):!1},um=(t,n)=>{const e=Xr(t,n);if(e.absCoordIndex!==-1){const r=[e.geometryIndex],i=nn(t.geometry.coordinates,r),s=i.findIndex(o=>er(o,n));return i.length<=4?(t.geometry.coordinates.splice(e.geometryIndex,1),!0):(i.splice(s,1),s===0&&(i[i.length-1]=[...i[0]]),!0)}return!1},cm=(t,n)=>{const e=Xr(t,n);if(e.absCoordIndex!==-1){const r=[e.multiFeatureIndex,e.geometryIndex],i=nn(t.geometry.coordinates,r),s=i.findIndex(o=>er(o,n));if(i.length<=4){r.pop();const o=nn(t.geometry.coordinates,e.multiFeatureIndex);return o.splice(e.geometryIndex,1),o.length===0&&t.geometry.coordinates.splice(e.multiFeatureIndex,1),!0}return i.splice(s,1),s===0&&(i[i.length-1]=[...i[0]]),!0}return!1},fm=(t,n)=>vl(t)?lm(t,n):yl(t)?um(t,n):wl(t)?cm(t,n):!1,hm=(t,n="marker")=>({type:"Feature",properties:{shape:n},geometry:{type:"Point",coordinates:t}}),Ls=({center:t,radius:n,steps:e=80})=>{const r=Pf(t,n,{steps:e,units:"meters"});return r.geometry.coordinates[0][0]=[...r.geometry.coordinates[0][0]],r};function Ll(t,n={}){let e=0,r=0,i=0;return Bt(t,function(s){e+=s[0],r+=s[1],i++},!0),Rt([e/i,r/i],n.properties)}var Cl=Ll;const dm=["circle","rectangle"];class rr{constructor(n){w(this,"gm");w(this,"id","no-id");w(this,"parent",null);w(this,"shape");w(this,"markers");w(this,"shapeProperties",{center:null});w(this,"source");w(this,"orders",this.getEmptyOrders());this.gm=n.gm,this.id=n.id,this.source=n.source,this.parent=n.parent,this.markers=new Map,this.shape=n.geoJsonShapeFeature.properties.shape,this.order=this.getFreeOrder(),this.addGeoJson(n.geoJsonShapeFeature)}get order(){const n=this.source.id;if(this.orders[n]!==null)return this.orders[n];throw new Error(`Null order for feature id: ${this.id}`)}set order(n){const e=this.source.id;this.orders[e]=n}getEmptyOrders(){return Object.fromEntries(Jn(O).map(n=>[n,null]))}get temporary(){return this.source.id===O.temporary}get sourceName(){return this.source.id}getFreeOrder(){return this.getSourceGeoJson().features.length}getGeoJson(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const n=this.getSourceGeoJson().features[this.order]||null;if(this.id!==(n==null?void 0:n.id))throw B.error(`Feature not found: ${this.id} !== ${n==null?void 0:n.id}`,n,this.getSourceGeoJson()),new Error("Feature not found");return n}getShapeProperty(n){return this.shapeProperties[n]}setShapeProperty(n,e){this.shapeProperties[n]=e}getSourceGeoJson(){return this.source.getGeoJson()}addGeoJson(n){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);const e=this.getSourceGeoJson();e.features[this.order]&&B.error("FeatureData.addGeoJson, not an empty feature",this.id,e);const r={...n,id:this.id,properties:{...n.properties,[sn]:this.id}};e.features[this.order]=r,this.updateGeoJsonCenter(r),this.gm.features.updateSourceData({diff:{add:[r]},sourceName:this.sourceName})}removeGeoJson(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const n=this.getSourceGeoJson();delete n.features[this.order],this.gm.features.updateSourceData({diff:{remove:[this.id]},sourceName:this.sourceName}),this.order=null}removeMarkers(){this.markers.forEach(n=>{n.instance instanceof Gr?n.instance.remove():this.gm.features.delete(n.instance)}),this.markers=new Map}updateGeoJsonGeometry(n){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const e=this.getSourceGeoJson();e.features[this.order].geometry=n;const r={update:[e.features[this.order]]};this.gm.features.updateSourceData({diff:r,sourceName:this.sourceName})}updateGeoJsonProperties(n){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const e=this.getSourceGeoJson();e.features[this.order].properties={...e.features[this.order].properties,...n};const r={update:[e.features[this.order]]};this.gm.features.updateSourceData({diff:r,sourceName:this.sourceName})}updateGeoJsonCenter(n){if(this.shape==="circle"){const e=_l(Cl(n));this.setShapeProperty("center",e)}}convertToPolygon(){return this.isConvertableToPolygon()?(this.shape="polygon",this.shapeProperties.center=null,!0):!1}isConvertableToPolygon(){return dm.includes(this.shape)}fixOrder(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`)}isFeatureAvailable(){return this.order!==null}changeSource({sourceName:n,atomic:e}){e?this.gm.features.withAtomicSourcesUpdate(()=>this.actualChangeSource({sourceName:n,atomic:e})):this.actualChangeSource({sourceName:n,atomic:e})}actualChangeSource({sourceName:n,atomic:e}){if(this.source.id===n){B.error(`FeatureData.changeSource: feature "${this.id}" already has the source "${n}"`);return}const r=this.gm.features.sources[n];if(!r){B.error(`FeatureData.changeSource: missing source "${n}"`);return}const i=this.getGeoJson();this.removeGeoJson(),this.source=r,this.order=this.getFreeOrder(),this.addGeoJson(i),this.markers.forEach(s=>{s.instance instanceof rr&&s.instance.changeSource({sourceName:n,atomic:e})})}delete(){this.removeGeoJson(),this.removeMarkers(),this.id="no-id",this.orders=this.getEmptyOrders()}}const pm=["on","off"],kl=t=>Mt(t)&&t.type==="control"&&pm.includes(t.action),Mt=t=>!!(t&&typeof t=="object"&&"level"in t&&"type"in t&&"action"in t),Qr=t=>Mt(t)&&Zt(t.action,Mf),Y="gm";class ei{constructor(n){w(this,"gm");this.gm=n}trackExclusiveModes(n){if(n.action!=="mode_start")return;const{sectionName:e,modeName:r}=this.getControlIds(n)||{},i=this.getControl(n);i!=null&&i.settings.exclusive&&this.gm.control.eachControlWithOptions(s=>{const o=s.control.type,a=s.control.targetMode;o===e&&a===r||s.controlOptions.active&&s.control.settings.exclusive&&this.gm.options.disableMode(o,a)})}trackRelatedModes(n){Qr(n)&&this.gm.control.eachControlWithOptions(e=>{var i;const r=e.control;(i=r.settings.enabledBy)!=null&&i.includes(n.mode)&&(n.action==="mode_start"?this.gm.options.enableMode(r.type,r.targetMode):n.action==="mode_end"?this.gm.options.disableMode(r.type,r.targetMode):B.error("Unknown mode action",n.action))})}getControl(n){const{modeName:e,sectionName:r}=this.getControlIds(n)||{};return e&&r?this.gm.control.getControl({actionType:r,modeName:e}):null}getControlOptions(n){const{modeName:e,sectionName:r}=this.getControlIds(n)||{};return e&&r?this.gm.options.getControlOptions({actionType:r,modeName:e}):null}getControlIds(n){let e=null,r=null;return n.action==="mode_start"?(e=n.type,r=n.mode):kl(n)&&(e=n.section,r=n.target),e&&r?{sectionName:e,modeName:r}:null}}class Tl{isInstanceAvailable(){return this.sourceInstance?!0:(B.error("Source instance is not available"),!1)}}const gm=["intersection_violation","containment_violation"],ti=t=>Mt(t)&&t.type==="helper",mm=t=>ti(t)&&t.mode==="geofencing"&&Zt(t.action,gm),vm=["draw","edit","helper"];class Cs{constructor(n){w(this,"gm");w(this,"options",[]);w(this,"actions",[]);w(this,"flags",{featureCreateAllowed:!0,featureUpdateAllowed:!0});w(this,"internalMapEventHandlers",{[`${Y}:helper`]:this.handleHelperEvent.bind(this)});this.gm=n}startAction(){this.gm.events.bus.attachEvents(this.internalMapEventHandlers),this.gm.events.bus.attachEvents(this.mapEventHandlers),this.onStartAction()}endAction(){this.onEndAction(),this.gm.events.bus.detachEvents(this.mapEventHandlers),this.gm.events.bus.detachEvents(this.internalMapEventHandlers)}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}getOptionValue(n){const e=this.options.find(r=>r.name===n);if(!e)throw new Error(`Option ${n} not found`);if(e.type==="toggle")return e.value;if(e.type==="select")return e.value.value;throw new Error(`Unknown option type: ${JSON.stringify(e)}`)}applyOptionValue(n,e){const r=this.options.find(i=>i.name===n);if(!r){B.error("Option not found",n,e);return}if(r.type==="toggle"&&typeof e=="boolean")r.value=e;else if(r.type==="select"){const i=r.choices.find(s=>s.value===e);i&&(r.value=i)}else B.error("Can't apply option value",n,e,r)}handleHelperEvent(n){return mm(n)?this.handleGeofencingViolationEvent(n):{next:!0}}handleGeofencingViolationEvent(n){return n.actionType==="draw"?this.flags.featureCreateAllowed=!1:n.actionType==="edit"&&(this.flags.featureUpdateAllowed=!1),{next:!0}}fireBeforeFeatureCreate({geoJsonFeatures:n,forceMode:e=void 0}){this.flags.featureCreateAllowed=!0;const r={level:"system",type:this.actionType,mode:e||this.mode,action:"before_create",geoJsonFeatures:n};this.gm.events.fire(`${Y}:${this.actionType}`,r)}fireBeforeFeatureUpdate({features:n,geoJsonFeatures:e,forceMode:r=void 0}){this.flags.featureUpdateAllowed=!0;const i={level:"system",type:this.actionType,mode:r||this.mode,action:"before_update",features:n,geoJsonFeatures:e};this.gm.events.fire(`${Y}:${this.actionType}`,i)}}const ks=t=>Mt(t)&&t.type==="draw",Pl=t=>Mt(t)&&t.type==="draw"&&"variant"in t&&t.variant==="line_drawer",ir=["marker","circle","circle_marker","text_marker","line","rectangle","polygon"],Il=["freehand","custom_shape"],Ts=[...ir,...Il];class bt extends Cs{constructor(){super(...arguments);w(this,"actionType","draw");w(this,"shape",null);w(this,"featureData",null)}saveFeature(){if(this.featureData){const e=this.featureData.getGeoJson();this.removeTmpFeature(),this.gm.features.createFeature({sourceName:O.main,shapeGeoJson:e})}else B.error("BaseDraw.saveFeature: no featureData to save")}removeTmpFeature(){this.featureData&&(this.featureData.temporary||B.error("Not a temporary feature to remove",this.featureData),this.gm.features.delete(this.featureData),this.featureData=null)}fireMarkerPointerStartEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,r={level:"system",variant:null,type:"draw",mode:this.shape,action:"start",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${Y}:draw`,r)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,r={level:"system",variant:null,type:"draw",mode:this.shape,action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${Y}:draw`,r)}fireMarkerPointerFinishEvent(){if(!this.shape)return;const e={level:"system",variant:null,type:"draw",mode:this.shape,action:"finish"};this.gm.events.fire(`${Y}:draw`,e)}forwardLineDrawerEvent(e){if(!Pl(e)||!this.shape)return{next:!0};if(e.action==="start"||e.action==="update"){const r={level:"system",type:"draw",mode:this.shape,variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${Y}:draw`,r)}else if(e.action==="finish"||e.action==="cancel"){const r={level:"system",type:"draw",mode:this.shape,variant:null,action:e.action};this.gm.events.fire(`${Y}:draw`,r)}return{next:!0}}}const _t=11102230246251565e-32,_e=134217729,ym=(3+8*_t)*_t;function Ps(t,n,e,r,i){let s,o,a,u,l=n[0],c=r[0],h=0,d=0;c>l==c>-l?(s=l,l=n[++h]):(s=c,c=r[++d]);let v=0;if(h<t&&d<e)for(c>l==c>-l?(o=l+s,a=s-(o-l),l=n[++h]):(o=c+s,a=s-(o-c),c=r[++d]),s=o,a!==0&&(i[v++]=a);h<t&&d<e;)c>l==c>-l?(o=s+l,u=o-s,a=s-(o-u)+(l-u),l=n[++h]):(o=s+c,u=o-s,a=s-(o-u)+(c-u),c=r[++d]),s=o,a!==0&&(i[v++]=a);for(;h<t;)o=s+l,u=o-s,a=s-(o-u)+(l-u),l=n[++h],s=o,a!==0&&(i[v++]=a);for(;d<e;)o=s+c,u=o-s,a=s-(o-u)+(c-u),c=r[++d],s=o,a!==0&&(i[v++]=a);return(s!==0||v===0)&&(i[v++]=s),v}function wm(t,n){let e=n[0];for(let r=1;r<t;r++)e+=n[r];return e}function sr(t){return new Float64Array(t)}const Em=(3+16*_t)*_t,Mm=(2+12*_t)*_t,bm=(9+64*_t)*_t*_t,Mn=sr(4),Fl=sr(8),Dl=sr(12),Ol=sr(16),Le=sr(4);function _m(t,n,e,r,i,s,o){let a,u,l,c,h,d,v,M,A,P,C,g,D,F,G,N,H,f;const p=t-i,m=e-i,y=n-s,E=r-s;F=p*E,d=_e*p,v=d-(d-p),M=p-v,d=_e*E,A=d-(d-E),P=E-A,G=M*P-(F-v*A-M*A-v*P),N=y*m,d=_e*y,v=d-(d-y),M=y-v,d=_e*m,A=d-(d-m),P=m-A,H=M*P-(N-v*A-M*A-v*P),C=G-H,h=G-C,Mn[0]=G-(C+h)+(h-H),g=F+C,h=g-F,D=F-(g-h)+(C-h),C=D-N,h=D-C,Mn[1]=D-(C+h)+(h-N),f=g+C,h=f-g,Mn[2]=g-(f-h)+(C-h),Mn[3]=f;let S=wm(4,Mn),k=Mm*o;if(S>=k||-S>=k||(h=t-p,a=t-(p+h)+(h-i),h=e-m,l=e-(m+h)+(h-i),h=n-y,u=n-(y+h)+(h-s),h=r-E,c=r-(E+h)+(h-s),a===0&&u===0&&l===0&&c===0)||(k=bm*o+ym*Math.abs(S),S+=p*c+E*a-(y*l+m*u),S>=k||-S>=k))return S;F=a*E,d=_e*a,v=d-(d-a),M=a-v,d=_e*E,A=d-(d-E),P=E-A,G=M*P-(F-v*A-M*A-v*P),N=u*m,d=_e*u,v=d-(d-u),M=u-v,d=_e*m,A=d-(d-m),P=m-A,H=M*P-(N-v*A-M*A-v*P),C=G-H,h=G-C,Le[0]=G-(C+h)+(h-H),g=F+C,h=g-F,D=F-(g-h)+(C-h),C=D-N,h=D-C,Le[1]=D-(C+h)+(h-N),f=g+C,h=f-g,Le[2]=g-(f-h)+(C-h),Le[3]=f;const b=Ps(4,Mn,4,Le,Fl);F=p*c,d=_e*p,v=d-(d-p),M=p-v,d=_e*c,A=d-(d-c),P=c-A,G=M*P-(F-v*A-M*A-v*P),N=y*l,d=_e*y,v=d-(d-y),M=y-v,d=_e*l,A=d-(d-l),P=l-A,H=M*P-(N-v*A-M*A-v*P),C=G-H,h=G-C,Le[0]=G-(C+h)+(h-H),g=F+C,h=g-F,D=F-(g-h)+(C-h),C=D-N,h=D-C,Le[1]=D-(C+h)+(h-N),f=g+C,h=f-g,Le[2]=g-(f-h)+(C-h),Le[3]=f;const _=Ps(b,Fl,4,Le,Dl);F=a*c,d=_e*a,v=d-(d-a),M=a-v,d=_e*c,A=d-(d-c),P=c-A,G=M*P-(F-v*A-M*A-v*P),N=u*l,d=_e*u,v=d-(d-u),M=u-v,d=_e*l,A=d-(d-l),P=l-A,H=M*P-(N-v*A-M*A-v*P),C=G-H,h=G-C,Le[0]=G-(C+h)+(h-H),g=F+C,h=g-F,D=F-(g-h)+(C-h),C=D-N,h=D-C,Le[1]=D-(C+h)+(h-N),f=g+C,h=f-g,Le[2]=g-(f-h)+(C-h),Le[3]=f;const T=Ps(_,Dl,4,Le,Ol);return Ol[T-1]}function xm(t,n,e,r,i,s){const o=(n-s)*(e-i),a=(t-i)*(r-s),u=o-a,l=Math.abs(o+a);return Math.abs(u)>=Em*l?u:-_m(t,n,e,r,i,s,l)}function Sm(t,n){var e,r,i=0,s,o,a,u,l,c,h,d=t[0],v=t[1],M=n.length;for(e=0;e<M;e++){r=0;var A=n[e],P=A.length-1;if(c=A[0],c[0]!==A[P][0]&&c[1]!==A[P][1])throw new Error("First and last coordinates in a ring must be the same");for(o=c[0]-d,a=c[1]-v,r;r<P;r++){if(h=A[r+1],u=h[0]-d,l=h[1]-v,a===0&&l===0){if(u<=0&&o>=0||o<=0&&u>=0)return 0}else if(l>=0&&a<=0||l<=0&&a>=0){if(s=xm(o,u,a,l,0,0),s===0)return 0;(s>0&&l>0&&a<=0||s<0&&l<=0&&a>0)&&i++}c=h,a=l,o=u}}return i%2!==0}function rn(t,n,e={}){if(!t)throw new Error("point is required");if(!n)throw new Error("polygon is required");const r=de(t),i=Yn(n),s=i.type,o=n.bbox;let a=i.coordinates;if(o&&Am(r,o)===!1)return!1;s==="Polygon"&&(a=[a]);let u=!1;for(var l=0;l<a.length;++l){const c=Sm(r,a[l]);if(c===0)return!e.ignoreBoundary;c&&(u=!0)}return u}function Am(t,n){return n[0]<=t[0]&&n[1]<=t[1]&&n[2]>=t[0]&&n[3]>=t[1]}class Gl{constructor(n=[],e=Lm){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:r}=this,i=e[n];for(;n>0;){const s=n-1>>1,o=e[s];if(r(i,o)>=0)break;e[n]=o,n=s}e[n]=i}_down(n){const{data:e,compare:r}=this,i=this.length>>1,s=e[n];for(;n<i;){let o=(n<<1)+1,a=e[o];const u=o+1;if(u<this.length&&r(e[u],a)<0&&(o=u,a=e[u]),r(a,s)>=0)break;e[n]=a,n=o}e[n]=s}}function Lm(t,n){return t<n?-1:t>n?1:0}function Rl(t,n){return t.p.x>n.p.x?1:t.p.x<n.p.x?-1:t.p.y!==n.p.y?t.p.y>n.p.y?1:-1:1}function Cm(t,n){return t.rightSweepEvent.p.x>n.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<n.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==n.rightSweepEvent.p.y?t.rightSweepEvent.p.y<n.rightSweepEvent.p.y?1:-1:1}class Bl{constructor(n,e,r,i){this.p={x:n[0],y:n[1]},this.featureId=e,this.ringId=r,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(n){return this.p.x===n.p.x&&this.p.y===n.p.y}}function km(t,n){if(t.type==="FeatureCollection"){const e=t.features;for(let r=0;r<e.length;r++)Nl(e[r],n)}else Nl(t,n)}let ni=0,ri=0,ii=0;function Nl(t,n){const e=t.type==="Feature"?t.geometry:t;let r=e.coordinates;(e.type==="Polygon"||e.type==="MultiLineString")&&(r=[r]),e.type==="LineString"&&(r=[[r]]);for(let i=0;i<r.length;i++)for(let s=0;s<r[i].length;s++){let o=r[i][s][0],a=null;ri=ri+1;for(let u=0;u<r[i][s].length-1;u++){a=r[i][s][u+1];const l=new Bl(o,ni,ri,ii),c=new Bl(a,ni,ri,ii+1);l.otherEvent=c,c.otherEvent=l,Rl(l,c)>0?(c.isLeftEndpoint=!0,l.isLeftEndpoint=!1):(l.isLeftEndpoint=!0,c.isLeftEndpoint=!1),n.push(l),n.push(c),o=a,ii=ii+1}}ni=ni+1}let Tm=class{constructor(n){this.leftSweepEvent=n,this.rightSweepEvent=n.otherEvent}};function Pm(t,n){if(t===null||n===null||t.leftSweepEvent.ringId===n.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(n.leftSweepEvent)||t.rightSweepEvent.isSamePoint(n.leftSweepEvent)||t.rightSweepEvent.isSamePoint(n.rightSweepEvent)||t.leftSweepEvent.isSamePoint(n.leftSweepEvent)||t.leftSweepEvent.isSamePoint(n.rightSweepEvent)))return!1;const e=t.leftSweepEvent.p.x,r=t.leftSweepEvent.p.y,i=t.rightSweepEvent.p.x,s=t.rightSweepEvent.p.y,o=n.leftSweepEvent.p.x,a=n.leftSweepEvent.p.y,u=n.rightSweepEvent.p.x,l=n.rightSweepEvent.p.y,c=(l-a)*(i-e)-(u-o)*(s-r),h=(u-o)*(r-a)-(l-a)*(e-o),d=(i-e)*(r-a)-(s-r)*(e-o);if(c===0)return!1;const v=h/c,M=d/c;if(v>=0&&v<=1&&M>=0&&M<=1){const A=e+v*(i-e),P=r+v*(s-r);return[A,P]}return!1}function Im(t,n){n=n||!1;const e=[],r=new Gl([],Cm);for(;t.length;){const i=t.pop();if(i.isLeftEndpoint){const s=new Tm(i);for(let o=0;o<r.data.length;o++){const a=r.data[o];if(n&&a.leftSweepEvent.featureId===i.featureId)continue;const u=Pm(s,a);u!==!1&&e.push(u)}r.push(s)}else i.isLeftEndpoint===!1&&r.pop()}return e}function Fm(t,n){const e=new Gl([],Rl);return km(t,e),Im(e,n)}var Dm=Fm;function or(t,n,e={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:i=!0}=e;let s=[];t.type==="FeatureCollection"?s=s.concat(t.features):t.type==="Feature"?s.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&s.push(at(t)),n.type==="FeatureCollection"?s=s.concat(n.features):n.type==="Feature"?s.push(n):(n.type==="LineString"||n.type==="Polygon"||n.type==="MultiLineString"||n.type==="MultiPolygon")&&s.push(at(n));const o=Dm(Ee(s),i);let a=[];if(r){const u={};o.forEach(l=>{const c=l.join(",");u[c]||(u[c]=!0,a.push(l))})}else a=o;return Ee(a.map(u=>Rt(u)))}var Om=or;function si(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Ul(t);case"FeatureCollection":return Gm(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Is(t);default:throw new Error("unknown GeoJSON type")}}function Ul(t){const n={type:"Feature"};return Object.keys(t).forEach(e=>{switch(e){case"type":case"properties":case"geometry":return;default:n[e]=t[e]}}),n.properties=Hl(t.properties),t.geometry==null?n.geometry=null:n.geometry=Is(t.geometry),n}function Hl(t){const n={};return t&&Object.keys(t).forEach(e=>{const r=t[e];typeof r=="object"?r===null?n[e]=null:Array.isArray(r)?n[e]=r.map(i=>i):n[e]=Hl(r):n[e]=r}),n}function Gm(t){const n={type:"FeatureCollection"};return Object.keys(t).forEach(e=>{switch(e){case"type":case"features":return;default:n[e]=t[e]}}),n.features=t.features.map(e=>Ul(e)),n}function Is(t){const n={type:t.type};return t.bbox&&(n.bbox=t.bbox),t.type==="GeometryCollection"?(n.geometries=t.geometries.map(e=>Is(e)),n):(n.coordinates=zl(t.coordinates),n)}function zl(t){const n=t;return typeof n[0]!="object"?n.slice():n.map(e=>zl(e))}var Jl=si;function Fs(t){const n=Ue(t);let e=0,r=1,i,s;for(;r<n.length;)i=s||n[0],s=n[r],e+=(s[0]-i[0])*(s[1]+i[1]),r++;return e>0}function Rm(t,n={}){var e,r;if(n=n||{},!Xi(n))throw new Error("options is invalid");const i=(e=n.mutate)!=null?e:!1,s=(r=n.reverse)!=null?r:!1;if(!t)throw new Error("<geojson> is required");if(typeof s!="boolean")throw new Error("<reverse> must be a boolean");if(typeof i!="boolean")throw new Error("<mutate> must be a boolean");!i&&t.type!=="Point"&&t.type!=="MultiPoint"&&(t=si(t));const o=[];switch(t.type){case"GeometryCollection":return Vn(t,function(a){oi(a,s)}),t;case"FeatureCollection":return Nt(t,function(a){const u=oi(a,s);Nt(u,function(l){o.push(l)})}),Ee(o)}return oi(t,s)}function oi(t,n){switch(t.type==="Feature"?t.geometry.type:t.type){case"GeometryCollection":return Vn(t,function(r){oi(r,n)}),t;case"LineString":return ql(Ue(t),n),t;case"Polygon":return Vl(Ue(t),n),t;case"MultiLineString":return Ue(t).forEach(function(r){ql(r,n)}),t;case"MultiPolygon":return Ue(t).forEach(function(r){Vl(r,n)}),t;case"Point":case"MultiPoint":return t}}function ql(t,n){Fs(t)===n&&t.reverse()}function Vl(t,n){Fs(t[0])!==n&&t[0].reverse();for(let e=1;e<t.length;e++)Fs(t[e])===n&&t[e].reverse()}var Bm=Rm;const Nm=["Point","MultiPoint"],Um=["LineString","MultiLineString","Polygon","MultiPolygon"],Yl=t=>Nm.includes(t.geometry.type),Ds=t=>Um.includes(t.geometry.type),Hm=(t,n)=>(nr(t,e=>{const r=e.coordinate;r[0]+=n.lng,r[1]+=n.lat}),t),zm=(t,n)=>{const e=Ye(t.getGeoJson());return Hm(e,n),e},Jm=(t,n)=>{try{nr(t,e=>{if(!rn(e.coordinate,n))throw new Error("stop")})}catch{return!1}return!0},Wl=(t,n)=>{const e=Jm(t,n);return Yl(t)?e:e&&Ds(t)?!Om(t,n,{ignoreSelfIntersections:!0}).features.length:!1},Os=t=>{const n=t.getGeoJson();return typeof n!="object"?null:Al(n)},qm=t=>{if(Ds(t)){const n=Bm(t,{mutate:!1});if(n.type==="Feature"&&Ds(n))return{...n,properties:t.properties||{}}}return Yl(t)?t:null},$l=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"],Vm=["load"];function ai(t){return $l.includes(t)}function Ym(t){return Vm.includes(t)}const jl=t=>!!(t&&typeof t=="object"&&"once"in t&&typeof t.once=="function"),pe=(t,n={warning:!1})=>{if(!t)return n.warning&&B.warn("Empty event",t),!1;const e=typeof t=="object"&&"lngLat"in t&&"point"in t&&"type"in t&&"originalEvent"in t&&typeof t.type=="string"&&$l.includes(t.type);return!e&&n.warning&&B.warn("Not a pointer event",t),e},O={main:`${Y}_main`,temporary:`${Y}_temporary`,standby:`${Y}_standby`},sn="_gmid";class Wm{constructor(n){w(this,"gm");w(this,"featureCounter",0);w(this,"featureStore",new Map);w(this,"featureStoreAllowedSources",[O.main,O.temporary]);w(this,"autoUpdatesEnabled",!0);w(this,"diffUpdatesEnabled",!0);w(this,"sources");w(this,"defaultSourceName",O.main);w(this,"updateStorage");w(this,"delayedSourceUpdateMethods");w(this,"layers");this.gm=n,this.sources=Object.fromEntries(Jn(O).map(e=>[e,null])),this.updateStorage=Object.fromEntries(Jn(O).map(e=>[e,{add:[],remove:[],update:[]}])),this.delayedSourceUpdateMethods=Object.fromEntries(Jn(O).map(e=>[e,{throttled:this.getDelayedSourceUpdateMethod({sourceName:e,type:"throttled"}),debounced:this.getDelayedSourceUpdateMethod({sourceName:e,type:"debounced"})}])),this.layers=[]}init(){if(Object.values(this.sources).some(n=>n!==null)){B.warn("features.init(): features are already initialized");return}Oe(this.sources).forEach(n=>{this.sources[n]=this.createSource(n)}),this.layers=this.createLayers()}get forEach(){return this.filteredForEach(n=>!n.temporary)}get tmpForEach(){return this.filteredForEach(n=>n.temporary)}getNewFeatureId(){return this.featureCounter+=1,`feature-${this.featureCounter}`}filteredForEach(n){return e=>{this.featureStore.forEach((r,i,s)=>{n(r)&&e(r,i,s)})}}has(n,e){const r=this.featureStore.get(e);return!!r&&(r==null?void 0:r.source)===this.sources[n]}get(n,e){const r=this.featureStore.get(e)||null;return(r==null?void 0:r.source)===this.sources[n]?r:null}add(n){if(this.featureStore.has(n.id)){B.error(`features.add: feature with the id "${n.id}" already exists`);return}this.featureStoreAllowedSources.includes(n.source.id)&&this.featureStore.set(n.id,n)}setDefaultSourceName(n){this.defaultSourceName=n}getDelayedSourceUpdateMethod({sourceName:n,type:e}){if(e==="throttled")return ml(()=>this.updateSourceByStorage(n),2*this.gm.options.settings.throttlingDelay,{leading:!1,trailing:!0});if(e==="debounced")return ws(()=>this.updateSourceByStorage(n),2*this.gm.options.settings.throttlingDelay,{leading:!0,trailing:!1});throw new Error("Features: getDelayedSourceUpdateMethod: invalid type")}updateSourceByStorage(n){const e=this.sources[n],r=this.updateStorage[n],i=Object.values(r).some(s=>s.length);e&&i&&(e.updateData(r),this.resetDiffStorage(n))}resetDiffStorage(n){const e=this.updateStorage[n];e.add=[],e.remove=[],e.update=[]}withAtomicSourcesUpdate(n){try{return this.autoUpdatesEnabled=!1,n()}finally{Jn(O).forEach(e=>{this.updateSourceByStorage(e)}),this.autoUpdatesEnabled=!0}}updateSourceData({diff:n,sourceName:e}){this.gm.features.diffUpdatesEnabled?this.updateSourceDataWithDiff({diff:n,sourceName:e}):this.setSourceData({diff:n,sourceName:e})}updateSourceDataWithDiff({diff:n,sourceName:e}){const r=this.updateStorage[e];n.add&&(r.add=r.add.concat(n.add)),n.update&&(r.update=r.update.concat(n.update)),n.remove&&(r.remove=r.remove.concat(n.remove)),this.gm.features.autoUpdatesEnabled&&(this.delayedSourceUpdateMethods[e].throttled(),this.delayedSourceUpdateMethods[e].debounced())}setSourceData({sourceName:n}){B.warn("Review this Features.setSourceData() method");const e=this.getSourceGeoJson(n);e.features=e.features.filter(r=>!!r),this.setSourceGeoJson({geoJson:e,sourceName:n})}createSource(n){const e=this.gm.mapAdapter.addSource(n,{type:"FeatureCollection",features:[]});if(e)return e;throw new Error(`Features: failed to create the source: "${n}"`)}delete(n){let e;n instanceof rr?e=n:e=this.featureStore.get(n)||null,e?(e.removeMarkers(),e.removeGeoJson(),this.featureStore.delete(e.id)):B.error(`features.delete: feature "${n}" not found`)}getFeatureByMouseEvent({event:n,sourceNames:e}){if(!pe(n,{warning:!0}))return null;const r=[n.point.x,n.point.y],i=this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:r,sourceNames:e});return i.length?i[0]:null}getFeaturesByGeoJsonBounds({geoJson:n,sourceNames:e}){const r=Ss(n),i=this.gm.mapAdapter.coordBoundsToScreenBounds(r);return this.getFeaturesByScreenBounds({bounds:i,sourceNames:e})}getFeaturesByScreenBounds({bounds:n,sourceNames:e}){return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:n,sourceNames:e})}createFeature({featureId:n,shapeGeoJson:e,parent:r,sourceName:i,imported:s}){const o=this.sources[i];if(!o)return B.error("Features.createFeature Missing source for feature creation"),null;const a=n||e.properties[sn]||this.getNewFeatureId();if(this.featureStore.get(a))return B.error(`Features.createFeature: feature with the id "${a}" already exists`,this.featureStore.get(a)),null;const u=new rr({gm:this.gm,id:a,parent:r||null,source:o,geoJsonShapeFeature:Ye(e)});return this.add(u),!u.temporary&&!s&&this.fireFeatureCreatedEvent(u),this.featureCounter+=1,u}importGeoJson(n){const e="features"in n?n.features:[n],r={stats:{total:0,success:0,failed:0},addedFeatures:[]};return e.forEach(i=>{let s=null;r.stats.total+=1;const o=qm(i);o&&(s=this.importGeoJsonFeature(o)),s?(r.addedFeatures.push(s),r.stats.success+=1):r.stats.failed+=1}),r}importGeoJsonFeature(n){const e=this.defaultSourceName,r=this.getFeatureShapeByGeoJson(n);if(!r)return B.error("features.addGeoJsonFeature: unknown shape",r),null;const i=n.id||`${e}-feature-${this.featureCounter}`;return this.createFeature({featureId:n.id,shapeGeoJson:{...n,properties:{...n.properties,[sn]:i,shape:r}},sourceName:e,imported:!0})}getAll(){return this.exportGeoJson()}exportGeoJson(){return this.asGeoJsonFeatureCollection({sourceNames:[O.main,O.standby]})}getSourceGeoJson(n){const e=this.sources[n];if(!e)throw new Error(`getSourceGeoJson: missing source "${n}"`);return e.getGeoJson()}setSourceGeoJson({geoJson:n,sourceName:e}){const r=this.sources[e];if(!r)throw new Error(`setSourceGeoJson: missing source "${e}"`);r.setGeoJson(n)}asGeoJsonFeatureCollection({shapeTypes:n,sourceNames:e}){const r={type:"FeatureCollection",features:[]};return e.forEach(i=>{const s=this.sources[i];s&&s.getGeoJson().features.filter(a=>!!a).forEach(a=>{(n===void 0||n.includes(a.properties.shape))&&r.features.push(a)})}),r}convertSourceToGm(n){const e=[],r=n.getGeoJson();return("features"in r?r.features:[r]).forEach(o=>{const a=this.addGeoJsonFeature({shapeGeoJson:o,defaultSource:!0});a&&e.push(a)}),this.gm.mapAdapter.getSource(n.id).remove({removeLayers:!0}),e}addGeoJsonFeature({shapeGeoJson:n,sourceName:e,defaultSource:r}){let i;if(r?(i=this.defaultSourceName,e&&B.warn("features.addGeoJsonFeature: default source is set, sourceName is ignored")):i=e||null,!i)return B.error("features.addGeoJsonFeature: missing sourceName"),null;const s=this.getFeatureShapeByGeoJson(n);return s?this.createFeature({featureId:n.id,shapeGeoJson:{...n,properties:{...n.properties,shape:s}},sourceName:i}):(B.error("features.addGeoJsonFeature: unknown shape",s),null)}createLayers(){const n=[];return Oe(this.gm.options.layerStyles).forEach(e=>{Oe(this.gm.options.layerStyles[e]).forEach(r=>{this.gm.options.layerStyles[e][r].forEach(s=>{const o=this.createGenericLayer({layerId:`${r}-${e}-${s.type}-layer`,partialStyle:s,shape:e,sourceName:r});o&&n.push(o)})})}),n}createGenericLayer({layerId:n,sourceName:e,partialStyle:r,shape:i}){const s={...r,id:n,source:e,filter:["in",["get","shape"],["literal",[i]]]};return this.gm.mapAdapter.addLayer(s)}getFeatureShapeByGeoJson(n){const e={Point:"marker",LineString:"line",Polygon:"polygon",MultiPolygon:"polygon"},r=n.properties;return r!=null&&r.shape&&ir.includes(r==null?void 0:r.shape)?r==null?void 0:r.shape:e[n.geometry.type]||null}createMarkerFeature({parentFeature:n,coordinate:e,type:r,sourceName:i}){return this.createFeature({sourceName:i,parent:n,shapeGeoJson:{type:"Feature",geometry:{type:"Point",coordinates:e},properties:{shape:`${r}_marker`}}})}updateMarkerFeaturePosition(n,e){n.updateGeoJsonGeometry({type:"Point",coordinates:e})}fireFeatureCreatedEvent(n){if(Zt(n.shape,ir)){const e={level:"system",type:"draw",mode:n.shape,action:"feature_created",featureData:n};this.gm.events.fire(`${Y}:draw`,e)}}}const Gs=t=>[{type:"circle",paint:{"circle-radius":t.circleMarkerRadius,"circle-color":t.fillColor,"circle-opacity":t.fillOpacity,"circle-stroke-color":t.lineColor,"circle-stroke-width":t.lineWidth,"circle-stroke-opacity":t.lineOpacity}}],bn=t=>[{type:"circle",paint:{"circle-radius":7,"circle-color":"#ffffff","circle-opacity":1,"circle-stroke-color":t.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],Rs=t=>[{type:"line",paint:{"line-color":t.lineColor,"line-opacity":t.lineOpacity,"line-width":t.lineWidth}}],Bs=()=>[{type:"symbol",layout:{"icon-image":"default-marker","icon-size":.18,"icon-allow-overlap":!0,"icon-anchor":"bottom"}}],xt=t=>[{type:"fill",paint:{"fill-color":t.fillColor,"fill-opacity":t.fillOpacity}},{type:"line",paint:{"line-color":t.lineColor,"line-opacity":t.lineOpacity,"line-width":t.lineWidth}}],Ns=t=>[{type:"circle",paint:{"circle-radius":6,"circle-color":"#ffffff","circle-opacity":.6,"circle-stroke-color":t.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],Us=()=>[{type:"line",paint:{"line-color":"#00979f","line-width":1.8,"line-dasharray":[2,1]}}],Hs=()=>[{type:"symbol",layout:{"text-field":["get","text"],"text-justify":"center"},paint:{"text-color":"black","text-halo-color":"#fff","text-halo-width":2}}],ce={[O.main]:{lineColor:"#278cda",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10},[O.temporary]:{lineColor:"#ff5600",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10},[O.standby]:{lineColor:"#787878",lineOpacity:.8,lineWidth:3,fillColor:"#a5a5a5",fillOpacity:.4,circleMarkerRadius:10}},$m={line:{[O.main]:Rs(ce[O.main]),[O.temporary]:Rs(ce[O.temporary]),[O.standby]:Rs(ce[O.standby])},circle:{[O.main]:xt(ce[O.main]),[O.temporary]:xt(ce[O.temporary]),[O.standby]:xt(ce[O.standby])},rectangle:{[O.main]:xt(ce[O.main]),[O.temporary]:xt(ce[O.temporary]),[O.standby]:xt(ce[O.standby])},polygon:{[O.main]:xt(ce[O.main]),[O.temporary]:xt(ce[O.temporary]),[O.standby]:xt(ce[O.standby])},marker:{[O.temporary]:Bs(),[O.main]:Bs(),[O.standby]:Bs()},circle_marker:{[O.main]:Gs(ce[O.main]),[O.temporary]:Gs(ce[O.temporary]),[O.standby]:Gs(ce[O.standby])},text_marker:{[O.main]:Hs(),[O.temporary]:Hs(),[O.standby]:Hs()},dom_marker:{[O.main]:[],[O.temporary]:[],[O.standby]:[]},center_marker:{[O.main]:bn(ce[O.main]),[O.temporary]:bn(ce[O.temporary]),[O.standby]:bn(ce[O.standby])},vertex_marker:{[O.main]:bn(ce[O.main]),[O.temporary]:bn(ce[O.temporary]),[O.standby]:bn(ce[O.standby])},edge_marker:{[O.main]:Ns(ce[O.main]),[O.temporary]:Ns(ce[O.temporary]),[O.standby]:Ns(ce[O.standby])},snap_guide:{[O.main]:Us(),[O.temporary]:Us(),[O.standby]:Us()}},li={type:"Feature",properties:{shape:"polygon"},geometry:{type:"MultiPolygon",coordinates:[[[[4,51.2],[5.4,52.4],[6.8,51.2],[4,51.2]]]]}},Zl={type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[-.47,51.67],[1.43,51.67],[1.43,53.32],[-.47,53.32],[-.47,51.67]]]}},jm={settings:{throttlingDelay:10,controlsPosition:"top-left"},layerStyles:$m,controls:{draw:{marker:{title:"Marker",icon:te.marker,uiEnabled:!0,active:!1},circle_marker:{title:"Circle Marker",icon:te.circle_marker,uiEnabled:!0,active:!1},text_marker:{title:"Text Marker",icon:te.text_marker,uiEnabled:!0,active:!1},circle:{title:"Circle",icon:te.circle,uiEnabled:!0,active:!1},line:{title:"Line",icon:te.line,uiEnabled:!0,active:!1},rectangle:{title:"Rectangle",icon:te.rectangle,uiEnabled:!0,active:!1},polygon:{title:"Polygon",icon:te.polygon,uiEnabled:!0,active:!1},freehand:{title:"Freehand",icon:te.freehand,uiEnabled:!1,active:!1},custom_shape:{title:"Custom shape",icon:te.custom_shape,uiEnabled:!1,active:!1,options:[{type:"select",label:"Shape",name:"shape",value:{title:"Triangle",value:JSON.stringify(li)},choices:[{title:"Triangle",value:JSON.stringify(li)},{title:"Rectangle",value:JSON.stringify(Zl)}]}]}},edit:{drag:{title:"Drag",icon:te.drag,uiEnabled:!0,active:!1},change:{title:"Change",icon:te.change,uiEnabled:!0,active:!1},rotate:{title:"Rotate",icon:te.rotate,uiEnabled:!0,active:!1},scale:{title:"Scale",icon:te.scale,uiEnabled:!1,active:!1},copy:{title:"Copy",icon:te.copy,uiEnabled:!1,active:!1},cut:{title:"Cut",icon:te.cut,uiEnabled:!0,active:!1},split:{title:"Split",icon:te.split,uiEnabled:!1,active:!1},union:{title:"Union",icon:te.union,uiEnabled:!1,active:!1},difference:{title:"Difference",icon:te.difference,uiEnabled:!1,active:!1},line_simplification:{title:"Line simplification",icon:te.line_simplification,uiEnabled:!1,active:!1},lasso:{title:"Lasso select",icon:te.lasso,uiEnabled:!1,active:!1},delete:{title:"Delete",icon:te.delete,uiEnabled:!0,active:!1}},helper:{shape_markers:{title:"Shape markers",icon:null,uiEnabled:!0,active:!1},snapping:{title:"Snapping",icon:te.snapping,uiEnabled:!0,active:!1},pin:{title:"Pin",icon:te.pin,uiEnabled:!1,active:!1},snap_guides:{title:"Snap guides",icon:te.snap_guides,uiEnabled:!1,active:!1},measurements:{title:"Measurements",icon:te.measurements,uiEnabled:!1,active:!1},auto_trace:{title:"Auto trace line",icon:te.auto_trace,uiEnabled:!1,active:!1},geofencing:{title:"Geofencing",icon:te.geofencing,uiEnabled:!1,active:!1},zoom_to_features:{title:"Zoom to features",icon:te.zoom_to_features,uiEnabled:!0,active:!1},click_to_edit:{title:"Click to edit",icon:te.click_to_edit,uiEnabled:!1,active:!1}}}};JSON.stringify(li),JSON.stringify(li),JSON.stringify(Zl);const Xl=()=>Ye(jm),Kl=!1;var zs=Array.isArray,Zm=Array.prototype.indexOf,Js=Array.from,Ql=Object.defineProperty,ar=Object.getOwnPropertyDescriptor,eu=Object.getOwnPropertyDescriptors,Xm=Object.prototype,Km=Array.prototype,qs=Object.getPrototypeOf;const _n=()=>{};function Qm(t){return t()}function Vs(t){for(var n=0;n<t.length;n++)t[n]()}const nt=2,tu=4,ui=8,Ys=16,St=32,lr=64,ci=128,We=256,fi=512,Ce=1024,At=2048,xn=4096,Lt=8192,hi=16384,e1=32768,Ws=65536,t1=1<<19,nu=1<<20,on=Symbol("$state"),n1=Symbol("");let di=[];function r1(){var t=di;di=[],Vs(t)}function i1(t){di.length===0&&queueMicrotask(r1),di.push(t)}function ru(t){return t===this.v}function iu(t,n){return t!=t?n==n:t!==n||t!==null&&typeof t=="object"||typeof t=="function"}function su(t){return!iu(t,this.v)}function s1(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function o1(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function a1(t){throw new Error("https://svelte.dev/e/effect_orphan")}function l1(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function u1(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function c1(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function f1(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function h1(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let ur=!1,d1=!1;function p1(){ur=!0}const $s=1,js=2,ou=4,g1=8,m1=16,v1=1,y1=2,Ge=Symbol();function Zs(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let ne=null;function au(t){ne=t}function Xs(t){return w1().get(t)}function Sn(t,n=!1,e){ne={p:ne,c:null,e:null,m:!1,s:t,x:null,l:null},ur&&!n&&(ne.l={s:null,u:null,r1:[],r2:ze(!1)})}function An(t){const n=ne;if(n!==null){const o=n.e;if(o!==null){var e=oe,r=ie;n.e=null;try{for(var i=0;i<o.length;i++){var s=o[i];qt(s.effect),Jt(s.reaction),Ai(s.fn)}}finally{qt(e),Jt(r)}}ne=n.p,n.m=!0}return{}}function pi(){return!ur||ne!==null&&ne.l===null}function w1(t){return ne===null&&Zs(),ne.c??(ne.c=new Map(E1(ne)||void 0))}function E1(t){let n=t.p;for(;n!==null;){const e=n.c;if(e!==null)return e;n=n.p}return null}function ze(t,n){var e={f:0,v:t,reactions:null,equals:ru,rv:0,wv:0};return e}function lu(t){return uu(ze(t))}function Ks(t,n=!1){var r;const e=ze(t);return n||(e.equals=su),ur&&ne!==null&&ne.l!==null&&((r=ne.l).s??(r.s=[])).push(e),e}function M1(t,n=!1){return uu(Ks(t,n))}function uu(t){return ie!==null&&!rt&&(ie.f&nt)!==0&&(ft===null?C1([t]):ft.push(t)),t}function Me(t,n){return ie!==null&&!rt&&pi()&&(ie.f&(nt|Ys))!==0&&(ft===null||!ft.includes(t))&&h1(),Qs(t,n)}function Qs(t,n){return t.equals(n)||(t.v,t.v=n,t.wv=bu(),cu(t,At),pi()&&oe!==null&&(oe.f&Ce)!==0&&(oe.f&(St|lr))===0&&(Ct===null?k1([t]):Ct.push(t))),n}function cu(t,n){var e=t.reactions;if(e!==null)for(var r=pi(),i=e.length,s=0;s<i;s++){var o=e[s],a=o.f;(a&At)===0&&(!r&&o===oe||(ht(o,n),(a&(Ce|We))!==0&&((a&nt)!==0?cu(o,xn):Si(o))))}}function eo(t){var n=nt|At,e=ie!==null&&(ie.f&nt)!==0?ie:null;return oe===null||e!==null&&(e.f&We)!==0?n|=We:oe.f|=nu,{ctx:ne,deps:null,effects:null,equals:ru,f:n,fn:t,reactions:null,rv:0,v:null,wv:0,parent:e??oe}}function fu(t){const n=eo(t);return n.equals=su,n}function hu(t){var n=t.effects;if(n!==null){t.effects=null;for(var e=0;e<n.length;e+=1)Tt(n[e])}}function b1(t){for(var n=t.parent;n!==null;){if((n.f&nt)===0)return n;n=n.parent}return null}function _1(t){var n,e=oe;qt(b1(t));try{hu(t),n=xu(t)}finally{qt(e)}return n}function du(t){var n=_1(t),e=(Vt||(t.f&We)!==0)&&t.deps!==null?xn:Ce;ht(t,e),t.equals(n)||(t.v=n,t.wv=bu())}let x1=!1;function ct(t,n=null,e){if(typeof t!="object"||t===null||on in t)return t;const r=qs(t);if(r!==Xm&&r!==Km)return t;var i=new Map,s=zs(t),o=ze(0);s&&i.set("length",ze(t.length));var a;return new Proxy(t,{defineProperty(u,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&u1();var h=i.get(l);return h===void 0?(h=ze(c.value),i.set(l,h)):Me(h,ct(c.value,a)),!0},deleteProperty(u,l){var c=i.get(l);if(c===void 0)l in u&&i.set(l,ze(Ge));else{if(s&&typeof l=="string"){var h=i.get("length"),d=Number(l);Number.isInteger(d)&&d<h.v&&Me(h,d)}Me(c,Ge),pu(o)}return!0},get(u,l,c){var M;if(l===on)return t;var h=i.get(l),d=l in u;if(h===void 0&&(!d||(M=ar(u,l))!=null&&M.writable)&&(h=ze(ct(d?u[l]:Ge,a)),i.set(l,h)),h!==void 0){var v=ee(h);return v===Ge?void 0:v}return Reflect.get(u,l,c)},getOwnPropertyDescriptor(u,l){var c=Reflect.getOwnPropertyDescriptor(u,l);if(c&&"value"in c){var h=i.get(l);h&&(c.value=ee(h))}else if(c===void 0){var d=i.get(l),v=d==null?void 0:d.v;if(d!==void 0&&v!==Ge)return{enumerable:!0,configurable:!0,value:v,writable:!0}}return c},has(u,l){var v;if(l===on)return!0;var c=i.get(l),h=c!==void 0&&c.v!==Ge||Reflect.has(u,l);if(c!==void 0||oe!==null&&(!h||(v=ar(u,l))!=null&&v.writable)){c===void 0&&(c=ze(h?ct(u[l],a):Ge),i.set(l,c));var d=ee(c);if(d===Ge)return!1}return h},set(u,l,c,h){var D;var d=i.get(l),v=l in u;if(s&&l==="length")for(var M=c;M<d.v;M+=1){var A=i.get(M+"");A!==void 0?Me(A,Ge):M in u&&(A=ze(Ge),i.set(M+"",A))}d===void 0?(!v||(D=ar(u,l))!=null&&D.writable)&&(d=ze(void 0),Me(d,ct(c,a)),i.set(l,d)):(v=d.v!==Ge,Me(d,ct(c,a)));var P=Reflect.getOwnPropertyDescriptor(u,l);if(P!=null&&P.set&&P.set.call(h,c),!v){if(s&&typeof l=="string"){var C=i.get("length"),g=Number(l);Number.isInteger(g)&&g>=C.v&&Me(C,g+1)}pu(o)}return!0},ownKeys(u){ee(o);var l=Reflect.ownKeys(u).filter(d=>{var v=i.get(d);return v===void 0||v.v!==Ge});for(var[c,h]of i)h.v!==Ge&&!(c in u)&&l.push(c);return l},setPrototypeOf(){c1()}})}function pu(t,n=1){Me(t,t.v+n)}function gu(t){return t!==null&&typeof t=="object"&&on in t?t[on]:t}function S1(t,n){return Object.is(gu(t),gu(n))}var mu,vu,yu,wu;function A1(){if(mu===void 0){mu=window,vu=/Firefox/.test(navigator.userAgent);var t=Element.prototype,n=Node.prototype;yu=ar(n,"firstChild").get,wu=ar(n,"nextSibling").get,t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__styles=null,t.__e=void 0,Text.prototype.__t=void 0}}function gi(t=""){return document.createTextNode(t)}function cr(t){return yu.call(t)}function mi(t){return wu.call(t)}function Ht(t,n){return cr(t)}function zt(t,n){{var e=cr(t);return e instanceof Comment&&e.data===""?mi(e):e}}function vi(t,n=1,e=!1){let r=t;for(;n--;)r=mi(r);return r}function L1(t){t.textContent=""}let yi=!1,to=!1,wi=null,Ei=!1,no=!1;function Eu(t){no=t}let Mi=[],Ww=[],ie=null,rt=!1;function Jt(t){ie=t}let oe=null;function qt(t){oe=t}let ft=null;function C1(t){ft=t}let ke=null,Je=0,Ct=null;function k1(t){Ct=t}let Mu=1,bi=0,Vt=!1;function bu(){return++Mu}function fr(t){var h;var n=t.f;if((n&At)!==0)return!0;if((n&xn)!==0){var e=t.deps,r=(n&We)!==0;if(e!==null){var i,s,o=(n&fi)!==0,a=r&&oe!==null&&!Vt,u=e.length;if(o||a){var l=t,c=l.parent;for(i=0;i<u;i++)s=e[i],(o||!((h=s==null?void 0:s.reactions)!=null&&h.includes(l)))&&(s.reactions??(s.reactions=[])).push(l);o&&(l.f^=fi),a&&c!==null&&(c.f&We)===0&&(l.f^=We)}for(i=0;i<u;i++)if(s=e[i],fr(s)&&du(s),s.wv>t.wv)return!0}(!r||oe!==null&&!Vt)&&ht(t,Ce)}return!1}function T1(t,n){for(var e=n;e!==null;){if((e.f&ci)!==0)try{e.fn(t);return}catch{e.f^=ci}e=e.parent}throw yi=!1,t}function P1(t){return(t.f&hi)===0&&(t.parent===null||(t.parent.f&ci)===0)}function _i(t,n,e,r){if(yi){if(e===null&&(yi=!1),P1(n))throw t;return}e!==null&&(yi=!0);{T1(t,n);return}}function _u(t,n,e=!0){var r=t.reactions;if(r!==null)for(var i=0;i<r.length;i++){var s=r[i];(s.f&nt)!==0?_u(s,n,!1):n===s&&(e?ht(s,At):(s.f&Ce)!==0&&ht(s,xn),Si(s))}}function xu(t){var v;var n=ke,e=Je,r=Ct,i=ie,s=Vt,o=ft,a=ne,u=rt,l=t.f;ke=null,Je=0,Ct=null,Vt=(l&We)!==0&&(rt||!Ei||ie===null),ie=(l&(St|lr))===0?t:null,ft=null,au(t.ctx),rt=!1,bi++;try{var c=(0,t.fn)(),h=t.deps;if(ke!==null){var d;if(xi(t,Je),h!==null&&Je>0)for(h.length=Je+ke.length,d=0;d<ke.length;d++)h[Je+d]=ke[d];else t.deps=h=ke;if(!Vt)for(d=Je;d<h.length;d++)((v=h[d]).reactions??(v.reactions=[])).push(t)}else h!==null&&Je<h.length&&(xi(t,Je),h.length=Je);if(pi()&&Ct!==null&&!rt&&h!==null&&(t.f&(nt|xn|At))===0)for(d=0;d<Ct.length;d++)_u(Ct[d],t);return i!==null&&bi++,c}finally{ke=n,Je=e,Ct=r,ie=i,Vt=s,ft=o,au(a),rt=u}}function I1(t,n){let e=n.reactions;if(e!==null){var r=Zm.call(e,t);if(r!==-1){var i=e.length-1;i===0?e=n.reactions=null:(e[r]=e[i],e.pop())}}e===null&&(n.f&nt)!==0&&(ke===null||!ke.includes(n))&&(ht(n,xn),(n.f&(We|fi))===0&&(n.f^=fi),hu(n),xi(n,0))}function xi(t,n){var e=t.deps;if(e!==null)for(var r=n;r<e.length;r++)I1(t,e[r])}function ro(t){var n=t.f;if((n&hi)===0){ht(t,Ce);var e=oe,r=ne,i=Ei;oe=t,Ei=!0;try{(n&Ys)!==0?J1(t):Cu(t),Lu(t);var s=xu(t);t.teardown=typeof s=="function"?s:null,t.wv=Mu;var o=t.deps,a;Kl&&d1&&t.f&At}catch(u){_i(u,t,e,r||t.ctx)}finally{Ei=i,oe=e}}}function F1(){try{l1()}catch(t){if(wi!==null)_i(t,wi,null);else throw t}}function D1(){try{for(var t=0;Mi.length>0;){t++>1e3&&F1();var n=Mi,e=n.length;Mi=[];for(var r=0;r<e;r++){var i=n[r];(i.f&Ce)===0&&(i.f^=Ce);var s=G1(i);O1(s)}}}finally{to=!1,wi=null}}function O1(t){var n=t.length;if(n!==0)for(var e=0;e<n;e++){var r=t[e];if((r.f&(hi|Lt))===0)try{fr(r)&&(ro(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?ku(r):r.fn=null))}catch(i){_i(i,r,null,r.ctx)}}}function Si(t){to||(to=!0,queueMicrotask(D1));for(var n=wi=t;n.parent!==null;){n=n.parent;var e=n.f;if((e&(lr|St))!==0){if((e&Ce)===0)return;n.f^=Ce}}Mi.push(n)}function G1(t){for(var n=[],e=t.first;e!==null;){var r=e.f,i=(r&St)!==0,s=i&&(r&Ce)!==0;if(!s&&(r&Lt)===0){if((r&tu)!==0)n.push(e);else if(i)e.f^=Ce;else{var o=ie;try{ie=e,fr(e)&&ro(e)}catch(l){_i(l,e,null,e.ctx)}finally{ie=o}}var a=e.first;if(a!==null){e=a;continue}}var u=e.parent;for(e=e.next;e===null&&u!==null;)e=u.next,u=u.parent}return n}function ee(t){var n=t.f,e=(n&nt)!==0;if(ie!==null&&!rt){ft!==null&&ft.includes(t)&&f1();var r=ie.deps;t.rv<bi&&(t.rv=bi,ke===null&&r!==null&&r[Je]===t?Je++:ke===null?ke=[t]:(!Vt||!ke.includes(t))&&ke.push(t))}else if(e&&t.deps===null&&t.effects===null){var i=t,s=i.parent;s!==null&&(s.f&We)===0&&(i.f^=We)}return e&&(i=t,fr(i)&&du(i)),t.v}function hr(t){var n=rt;try{return rt=!0,t()}finally{rt=n}}const R1=-7169;function ht(t,n){t.f=t.f&R1|n}function B1(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(on in t)io(t);else if(!Array.isArray(t))for(let n in t){const e=t[n];typeof e=="object"&&e&&on in e&&io(e)}}}function io(t,n=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!n.has(t)){n.add(t),t instanceof Date&&t.getTime();for(let r in t)try{io(t[r],n)}catch{}const e=qs(t);if(e!==Object.prototype&&e!==Array.prototype&&e!==Map.prototype&&e!==Set.prototype&&e!==Date.prototype){const r=eu(e);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function Su(t){oe===null&&ie===null&&a1(),ie!==null&&(ie.f&We)!==0&&oe===null&&o1(),no&&s1()}function N1(t,n){var e=n.last;e===null?n.last=n.first=t:(e.next=t,t.prev=e,n.last=t)}function Ln(t,n,e,r=!0){var i=(t&lr)!==0,s=oe,o={ctx:ne,deps:null,nodes_start:null,nodes_end:null,f:t|At,first:null,fn:n,last:null,next:null,parent:i?null:s,prev:null,teardown:null,transitions:null,wv:0};if(e)try{ro(o),o.f|=e1}catch(l){throw Tt(o),l}else n!==null&&Si(o);var a=e&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(nu|ci))===0;if(!a&&!i&&r&&(s!==null&&N1(o,s),ie!==null&&(ie.f&nt)!==0)){var u=ie;(u.effects??(u.effects=[])).push(o)}return o}function U1(t){const n=Ln(ui,null,!1);return ht(n,Ce),n.teardown=t,n}function so(t){Su();var n=oe!==null&&(oe.f&St)!==0&&ne!==null&&!ne.m;if(n){var e=ne;(e.e??(e.e=[])).push({fn:t,effect:oe,reaction:ie})}else{var r=Ai(t);return r}}function H1(t){return Su(),Au(t)}function z1(t){const n=Ln(lr,t,!0);return(e={})=>new Promise(r=>{e.outro?Ci(n,()=>{Tt(n),r(void 0)}):(Tt(n),r(void 0))})}function Ai(t){return Ln(tu,t,!1)}function Au(t){return Ln(ui,t,!0)}function kt(t,n=[],e=eo){const r=n.map(e);return Li(()=>t(...r.map(ee)))}function Li(t,n=0){return Ln(ui|Ys|n,t,!0)}function Cn(t,n=!0){return Ln(ui|St,t,!0,n)}function Lu(t){var n=t.teardown;if(n!==null){const e=no,r=ie;Eu(!0),Jt(null);try{n.call(null)}finally{Eu(e),Jt(r)}}}function Cu(t,n=!1){var e=t.first;for(t.first=t.last=null;e!==null;){var r=e.next;Tt(e,n),e=r}}function J1(t){for(var n=t.first;n!==null;){var e=n.next;(n.f&St)===0&&Tt(n),n=e}}function Tt(t,n=!0){var e=!1;if((n||(t.f&t1)!==0)&&t.nodes_start!==null){for(var r=t.nodes_start,i=t.nodes_end;r!==null;){var s=r===i?null:mi(r);r.remove(),r=s}e=!0}Cu(t,n&&!e),xi(t,0),ht(t,hi);var o=t.transitions;if(o!==null)for(const u of o)u.stop();Lu(t);var a=t.parent;a!==null&&a.first!==null&&ku(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=null}function ku(t){var n=t.parent,e=t.prev,r=t.next;e!==null&&(e.next=r),r!==null&&(r.prev=e),n!==null&&(n.first===t&&(n.first=r),n.last===t&&(n.last=e))}function Ci(t,n){var e=[];oo(t,e,!0),Tu(e,()=>{Tt(t),n&&n()})}function Tu(t,n){var e=t.length;if(e>0){var r=()=>--e||n();for(var i of t)i.out(r)}else n()}function oo(t,n,e){if((t.f&Lt)===0){if(t.f^=Lt,t.transitions!==null)for(const o of t.transitions)(o.is_global||e)&&n.push(o);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&Ws)!==0||(r.f&St)!==0;oo(r,n,s?e:!1),r=i}}}function ki(t){Pu(t,!0)}function Pu(t,n){if((t.f&Lt)!==0){t.f^=Lt,(t.f&Ce)===0&&(t.f^=Ce),fr(t)&&(ht(t,At),Si(t));for(var e=t.first;e!==null;){var r=e.next,i=(e.f&Ws)!==0||(e.f&St)!==0;Pu(e,i?n:!1),e=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||n)&&s.in()}}const q1=["touchstart","touchmove"];function V1(t){return q1.includes(t)}let Iu=!1;function Y1(){Iu||(Iu=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var n;if(!t.defaultPrevented)for(const e of t.target.elements)(n=e.__on_r)==null||n.call(e)})},{capture:!0}))}function W1(t){var n=ie,e=oe;Jt(null),qt(null);try{return t()}finally{Jt(n),qt(e)}}function Fu(t,n,e,r=e){t.addEventListener(n,()=>W1(e));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),Y1()}const Du=new Set,ao=new Set;function lo(t){for(var n=0;n<t.length;n++)Du.add(t[n]);for(var e of ao)e(t)}function Ti(t){var g;var n=this,e=n.ownerDocument,r=t.type,i=((g=t.composedPath)==null?void 0:g.call(t))||[],s=i[0]||t.target,o=0,a=t.__root;if(a){var u=i.indexOf(a);if(u!==-1&&(n===document||n===window)){t.__root=n;return}var l=i.indexOf(n);if(l===-1)return;u<=l&&(o=u)}if(s=i[o]||t.target,s!==n){Ql(t,"currentTarget",{configurable:!0,get(){return s||e}});var c=ie,h=oe;Jt(null),qt(null);try{for(var d,v=[];s!==null;){var M=s.assignedSlot||s.parentNode||s.host||null;try{var A=s["__"+r];if(A!==void 0&&(!s.disabled||t.target===s))if(zs(A)){var[P,...C]=A;P.apply(s,[t,...C])}else A.call(s,t)}catch(D){d?v.push(D):d=D}if(t.cancelBubble||M===n||M===null)break;s=M}if(d){for(let D of v)queueMicrotask(()=>{throw D});throw d}}finally{t.__root=n,delete t.currentTarget,Jt(c),qt(h)}}}function Ou(t){var n=document.createElement("template");return n.innerHTML=t,n.content}function dr(t,n){var e=oe;e.nodes_start===null&&(e.nodes_start=t,e.nodes_end=n)}function it(t,n){var e=(n&v1)!==0,r=(n&y1)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=Ou(s?t:"<!>"+t),e||(i=cr(i)));var o=r||vu?document.importNode(i,!0):i.cloneNode(!0);if(e){var a=cr(o),u=o.lastChild;dr(a,u)}else dr(o,o);return o}}function Gu(t=""){{var n=gi(t+"");return dr(n,n),n}}function kn(){var t=document.createDocumentFragment(),n=document.createComment(""),e=gi();return t.append(n,e),dr(n,e),t}function ge(t,n){t!==null&&t.before(n)}function Tn(t,n){var e=n==null?"":typeof n=="object"?n+"":n;e!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=e,t.nodeValue=e+"")}function $1(t,n){return j1(t,n)}const Pn=new Map;function j1(t,{target:n,anchor:e,props:r={},events:i,context:s,intro:o=!0}){A1();var a=new Set,u=h=>{for(var d=0;d<h.length;d++){var v=h[d];if(!a.has(v)){a.add(v);var M=V1(v);n.addEventListener(v,Ti,{passive:M});var A=Pn.get(v);A===void 0?(document.addEventListener(v,Ti,{passive:M}),Pn.set(v,1)):Pn.set(v,A+1)}}};u(Js(Du)),ao.add(u);var l=void 0,c=z1(()=>{var h=e??n.appendChild(gi());return Cn(()=>{if(s){Sn({});var d=ne;d.c=s}i&&(r.$$events=i),l=t(h,r)||{},s&&An()}),()=>{var M;for(var d of a){n.removeEventListener(d,Ti);var v=Pn.get(d);--v===0?(document.removeEventListener(d,Ti),Pn.delete(d)):Pn.set(d,v)}ao.delete(u),h!==e&&((M=h.parentNode)==null||M.removeChild(h))}});return uo.set(l,c),l}let uo=new WeakMap;function Z1(t,n){const e=uo.get(t);return e?(uo.delete(t),e(n)):Promise.resolve()}function dt(t,n,[e,r]=[0,0]){var i=t,s=null,o=null,a=Ge,u=e>0?Ws:0,l=!1;const c=(d,v=!0)=>{l=!0,h(v,d)},h=(d,v)=>{a!==(a=d)&&(a?(s?ki(s):v&&(s=Cn(()=>v(i))),o&&Ci(o,()=>{o=null})):(o?ki(o):v&&(o=Cn(()=>v(i,[e+1,r]))),s&&Ci(s,()=>{s=null})))};Li(()=>{l=!1,n(c),l||h(null,null)},u)}function pr(t,n){return n}function X1(t,n,e,r){for(var i=[],s=n.length,o=0;o<s;o++)oo(n[o].e,i,!0);var a=s>0&&i.length===0&&e!==null;if(a){var u=e.parentNode;L1(u),u.append(e),r.clear(),Yt(t,n[0].prev,n[s-1].next)}Tu(i,()=>{for(var l=0;l<s;l++){var c=n[l];a||(r.delete(c.k),Yt(t,c.prev,c.next)),Tt(c.e,!a)}})}function gr(t,n,e,r,i,s=null){var o=t,a={flags:n,items:new Map,first:null},u=(n&ou)!==0;if(u){var l=t;o=l.appendChild(gi())}var c=null,h=!1,d=fu(()=>{var v=e();return zs(v)?v:v==null?[]:Js(v)});Li(()=>{var v=ee(d),M=v.length;h&&M===0||(h=M===0,K1(v,a,o,i,n,r,e),s!==null&&(M===0?c?ki(c):c=Cn(()=>s(o)):c!==null&&Ci(c,()=>{c=null})),ee(d))})}function K1(t,n,e,r,i,s,o){var k,b,_,T;var a=(i&g1)!==0,u=(i&($s|js))!==0,l=t.length,c=n.items,h=n.first,d=h,v,M=null,A,P=[],C=[],g,D,F,G;if(a)for(G=0;G<l;G+=1)g=t[G],D=s(g,G),F=c.get(D),F!==void 0&&((k=F.a)==null||k.measure(),(A??(A=new Set)).add(F));for(G=0;G<l;G+=1){if(g=t[G],D=s(g,G),F=c.get(D),F===void 0){var N=d?d.e.nodes_start:e;M=ev(N,n,M,M===null?n.first:M.next,g,D,G,r,i,o),c.set(D,M),P=[],C=[],d=M.next;continue}if(u&&Q1(F,g,G,i),(F.e.f&Lt)!==0&&(ki(F.e),a&&((b=F.a)==null||b.unfix(),(A??(A=new Set)).delete(F))),F!==d){if(v!==void 0&&v.has(F)){if(P.length<C.length){var H=C[0],f;M=H.prev;var p=P[0],m=P[P.length-1];for(f=0;f<P.length;f+=1)Ru(P[f],H,e);for(f=0;f<C.length;f+=1)v.delete(C[f]);Yt(n,p.prev,m.next),Yt(n,M,p),Yt(n,m,H),d=H,M=m,G-=1,P=[],C=[]}else v.delete(F),Ru(F,d,e),Yt(n,F.prev,F.next),Yt(n,F,M===null?n.first:M.next),Yt(n,M,F),M=F;continue}for(P=[],C=[];d!==null&&d.k!==D;)(d.e.f&Lt)===0&&(v??(v=new Set)).add(d),C.push(d),d=d.next;if(d===null)continue;F=d}P.push(F),M=F,d=F.next}if(d!==null||v!==void 0){for(var y=v===void 0?[]:Js(v);d!==null;)(d.e.f&Lt)===0&&y.push(d),d=d.next;var E=y.length;if(E>0){var S=(i&ou)!==0&&l===0?e:null;if(a){for(G=0;G<E;G+=1)(_=y[G].a)==null||_.measure();for(G=0;G<E;G+=1)(T=y[G].a)==null||T.fix()}X1(n,y,S,c)}}a&&i1(()=>{var L;if(A!==void 0)for(F of A)(L=F.a)==null||L.apply()}),oe.first=n.first&&n.first.e,oe.last=M&&M.e}function Q1(t,n,e,r){(r&$s)!==0&&Qs(t.v,n),(r&js)!==0?Qs(t.i,e):t.i=e}function ev(t,n,e,r,i,s,o,a,u,l){var c=(u&$s)!==0,h=(u&m1)===0,d=c?h?Ks(i):ze(i):i,v=(u&js)===0?o:ze(o),M={i:v,v:d,k:s,a:null,e:null,prev:e,next:r};try{return M.e=Cn(()=>a(t,d,v,l),x1),M.e.prev=e&&e.e,M.e.next=r&&r.e,e===null?n.first=M:(e.next=M,e.e.next=M.e),r!==null&&(r.prev=M,r.e.prev=M.e),M}finally{}}function Ru(t,n,e){for(var r=t.next?t.next.e.nodes_start:e,i=n?n.e.nodes_start:e,s=t.e.nodes_start;s!==r;){var o=mi(s);i.before(s),s=o}}function Yt(t,n,e){n===null?t.first=e:(n.next=e,n.e.next=e&&e.e),e!==null&&(e.prev=n,e.e.prev=n&&n.e)}function tv(t,n,e,r,i){var s=t,o="",a;Li(()=>{o!==(o=n()??"")&&(a!==void 0&&(Tt(a),a=void 0),o!==""&&(a=Cn(()=>{var u=o+"",l=Ou(u);dr(cr(l),l.lastChild),s.before(l)})))})}const Bu=[...` 	
\r\f\v\uFEFF`];function nv(t,n,e){var r=t==null?"":""+t;if(n&&(r=r?r+" "+n:n),e){for(var i in e)if(e[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||Bu.includes(r[o-1]))&&(a===r.length||Bu.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function co(t,n,e,r,i,s){var o=t.__className;if(o!==e){var a=nv(e,r,s);a==null?t.removeAttribute("class"):t.className=a,t.__className=e}else if(s)for(var u in s){var l=!!s[u];(i==null||l!==!!i[u])&&t.classList.toggle(u,l)}return s}function an(t,n,e,r){var i=t.__attributes??(t.__attributes={});i[n]!==(i[n]=e)&&(n==="style"&&"__styles"in t&&(t.__styles={}),n==="loading"&&(t[n1]=e),e==null?t.removeAttribute(n):typeof e!="string"&&rv(t).includes(n)?t[n]=e:t.setAttribute(n,e))}var Nu=new Map;function rv(t){var n=Nu.get(t.nodeName);if(n)return n;Nu.set(t.nodeName,n=[]);for(var e,r=t,i=Element.prototype;i!==r;){e=eu(r);for(var s in e)e[s].set&&n.push(s);r=qs(r)}return n}function iv(t,n,e=n){Fu(t,"change",r=>{var i=r?t.defaultChecked:t.checked;e(i)}),hr(n)==null&&e(t.checked),Au(()=>{var r=n();t.checked=!!r})}function Uu(t,n,e){if(t.multiple)return av(t,n);for(var r of t.options){var i=mr(r);if(S1(i,n)){r.selected=!0;return}}(!e||n!==void 0)&&(t.selectedIndex=-1)}function sv(t,n){Ai(()=>{var e=new MutationObserver(()=>{var r=t.__value;Uu(t,r)});return e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{e.disconnect()}})}function ov(t,n,e=n){var r=!0;Fu(t,"change",i=>{var s=i?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(s),mr);else{var a=t.querySelector(s)??t.querySelector("option:not([disabled])");o=a&&mr(a)}e(o)}),Ai(()=>{var i=n();if(Uu(t,i,r),r&&i===void 0){var s=t.querySelector(":checked");s!==null&&(i=mr(s),e(i))}t.__value=i,r=!1}),sv(t)}function av(t,n){for(var e of t.options)e.selected=~n.indexOf(mr(e))}function mr(t){return"__value"in t?t.__value:t.value}function lv(t=!1){const n=ne,e=n.l.u;if(!e)return;let r=()=>B1(n.s);if(t){let i=0,s={};const o=eo(()=>{let a=!1;const u=n.s;for(const l in u)u[l]!==s[l]&&(s[l]=u[l],a=!0);return a&&i++,i});r=()=>ee(o)}e.b.length&&H1(()=>{Hu(n,r),Vs(e.b)}),so(()=>{const i=hr(()=>e.m.map(Qm));return()=>{for(const s of i)typeof s=="function"&&s()}}),e.a.length&&so(()=>{Hu(n,r),Vs(e.a)})}function Hu(t,n){if(t.l.s)for(const e of t.l.s)ee(e);n()}let fo=Symbol();function uv(t,n,e){const r=e[n]??(e[n]={store:null,source:Ks(void 0),unsubscribe:_n});if(r.store!==t&&!(fo in e))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=_n;else{var i=!0;r.unsubscribe=Ju(t,s=>{i?r.source.v=s:Me(r.source,s)}),i=!1}return t&&fo in e?pv(t):ee(r.source)}function cv(){const t={};function n(){U1(()=>{for(var e in t)t[e].unsubscribe();Ql(t,fo,{enumerable:!1,value:!0})})}return[t,n]}function zu(t){ne===null&&Zs(),ur&&ne.l!==null?hv(ne).m.push(t):so(()=>{const n=hr(t);if(typeof n=="function")return n})}function fv(t){ne===null&&Zs(),zu(()=>()=>hr(t))}function hv(t){var n=t.l;return n.u??(n.u={a:[],b:[],m:[]})}function Ju(t,n,e){if(t==null)return n(void 0),_n;const r=hr(()=>t.subscribe(n,e));return r.unsubscribe?()=>r.unsubscribe():r}const In=[];function dv(t,n=_n){let e=null;const r=new Set;function i(a){if(iu(t,a)&&(t=a,e)){const u=!In.length;for(const l of r)l[1](),In.push(l,t);if(u){for(let l=0;l<In.length;l+=2)In[l][0](In[l+1]);In.length=0}}}function s(a){i(a(t))}function o(a,u=_n){const l=[a,u];return r.add(l),r.size===1&&(e=n(i,s)||_n),a(t),()=>{r.delete(l),r.size===0&&e&&(e(),e=null)}}return{set:i,update:s,subscribe:o}}function pv(t){let n;return Ju(t,e=>n=e)(),n}const gv={controls:Ye(Xo),options:Xl().controls},ho=dv(gv),mv="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(mv),p1();const qu=(t,n,e)=>{var r,i;if(!n.actionInstance||!n.actionOption){B.error("Can't apply option value",n.actionInstance,n.actionOption);return}if(((r=n.actionOption)==null?void 0:r.type)==="toggle"){const s=t.target;Me(e,ct(s.checked))}else if(((i=n.actionOption)==null?void 0:i.type)==="select"){const s=t.target;Me(e,ct(s.value))}n.actionInstance.applyOptionValue(n.actionOption.name,ee(e))};var vv=it("<option> </option>"),yv=it('<label class="svelte-1892xbw"> </label> <select class="svelte-1892xbw"></select>',1),wv=it('<label class="svelte-1892xbw"><input type="checkbox" class="svelte-1892xbw"> </label>'),Ev=it("<span>Unknown type</span>"),Mv=it('<div class="action-option svelte-1892xbw"><!></div>');function bv(t,n){Sn(n,!0);let e=lu("");zu(()=>{n.actionOption&&(n.actionOption.type==="select"?Me(e,ct(n.actionOption.value.value)):n.actionOption.type==="toggle"&&Me(e,ct(n.actionOption.value)))});var r=kn(),i=zt(r);{var s=o=>{var a=Mv(),u=Ht(a);{var l=h=>{var d=yv(),v=zt(d),M=Ht(v),A=vi(v,2);A.__change=[qu,n,e],gr(A,21,()=>n.actionOption.choices,pr,(P,C)=>{var g=vv(),D={},F=Ht(g);kt(()=>{D!==(D=ee(C).value)&&(g.value=(g.__value=ee(C).value)==null?"":ee(C).value),Tn(F,ee(C).title)}),ge(P,g)}),kt(()=>{an(v,"for",n.actionOption.name),Tn(M,n.actionOption.label),an(A,"id",n.actionOption.name)}),ov(A,()=>ee(e),P=>Me(e,P)),ge(h,d)},c=(h,d)=>{{var v=A=>{var P=wv(),C=Ht(P);C.__change=[qu,n,e];var g=vi(C);kt(D=>{an(P,"for",n.actionOption.name),an(C,"id",D),Tn(g,` ${n.actionOption.label??""}`)},[()=>String(n.actionOption.name)]),iv(C,()=>ee(e),D=>Me(e,D)),ge(A,P)},M=A=>{var P=Ev();ge(A,P)};dt(h,A=>{n.actionOption.type==="toggle"&&typeof ee(e)=="boolean"?A(v):A(M,!1)},d)}};dt(u,h=>{n.actionOption.type==="select"?h(l):h(c,!1)})}ge(o,a)};dt(i,o=>{n.actionOption&&o(s)})}ge(t,r),An()}lo(["change"]);const _v=(t,n)=>{if(t.preventDefault(),!n.actionInstance||!n.subAction){B.error("Can't run a SubAction",n.actionInstance,n.subAction);return}n.subAction.method()};var xv=it('<button type="submit" class="sub-action svelte-1x28ief"> </button>');function Sv(t,n){Sn(n,!0);var e=kn(),r=zt(e);{var i=s=>{var o=xv();o.__click=[_v,n];var a=Ht(o);kt(()=>{an(o,"title",n.subAction.label),Tn(a,n.subAction.label)}),ge(s,o)};dt(r,s=>{n.subAction&&s(i)})}ge(t,e),An()}lo(["click"]);var Av=it("<!> <!>",1);function Lv(t,n){Sn(n,!0);const e=Xs("gm"),r=n.control.type,i=n.control.targetMode;let s=lu(null);r&&i&&Me(s,ct(e.actionInstances[`${r}__${i}`]||null));var o=kn(),a=zt(o);{var u=l=>{var c=Av(),h=zt(c);gr(h,17,()=>ee(s).options,pr,(v,M)=>{bv(v,{get actionInstance(){return ee(s)},get actionOption(){return ee(M)}})});var d=vi(h,2);gr(d,17,()=>ee(s).actions,pr,(v,M)=>{Sv(v,{get actionInstance(){return ee(s)},get subAction(){return ee(M)}})}),ge(l,c)};dt(a,l=>{ee(s)&&l(u)})}ge(t,o),An()}/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */const{entries:Vu,setPrototypeOf:Yu,isFrozen:Cv,getPrototypeOf:kv,getOwnPropertyDescriptor:Tv}=Object;let{freeze:Te,seal:$e,create:Wu}=Object,{apply:po,construct:go}=typeof Reflect<"u"&&Reflect;Te||(Te=function(n){return n}),$e||($e=function(n){return n}),po||(po=function(n,e,r){return n.apply(e,r)}),go||(go=function(n,e){return new n(...e)});const Pi=Ie(Array.prototype.forEach),Pv=Ie(Array.prototype.lastIndexOf),$u=Ie(Array.prototype.pop),vr=Ie(Array.prototype.push),Iv=Ie(Array.prototype.splice),Ii=Ie(String.prototype.toLowerCase),mo=Ie(String.prototype.toString),ju=Ie(String.prototype.match),yr=Ie(String.prototype.replace),Fv=Ie(String.prototype.indexOf),Dv=Ie(String.prototype.trim),st=Ie(Object.prototype.hasOwnProperty),Pe=Ie(RegExp.prototype.test),wr=Ov(TypeError);function Ie(t){return function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return po(t,n,r)}}function Ov(t){return function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return go(t,e)}}function Q(t,n){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ii;Yu&&Yu(t,null);let r=n.length;for(;r--;){let i=n[r];if(typeof i=="string"){const s=e(i);s!==i&&(Cv(n)||(n[r]=s),i=s)}t[i]=!0}return t}function Gv(t){for(let n=0;n<t.length;n++)st(t,n)||(t[n]=null);return t}function ln(t){const n=Wu(null);for(const[e,r]of Vu(t))st(t,e)&&(Array.isArray(r)?n[e]=Gv(r):r&&typeof r=="object"&&r.constructor===Object?n[e]=ln(r):n[e]=r);return n}function Er(t,n){for(;t!==null;){const r=Tv(t,n);if(r){if(r.get)return Ie(r.get);if(typeof r.value=="function")return Ie(r.value)}t=kv(t)}function e(){return null}return e}const Zu=Te(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),vo=Te(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),yo=Te(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Rv=Te(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),wo=Te(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Bv=Te(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Xu=Te(["#text"]),Ku=Te(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Eo=Te(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Qu=Te(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Fi=Te(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Nv=$e(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Uv=$e(/<%[\w\W]*|[\w\W]*%>/gm),Hv=$e(/\$\{[\w\W]*/gm),zv=$e(/^data-[\-\w.\u00B7-\uFFFF]+$/),Jv=$e(/^aria-[\-\w]+$/),ec=$e(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),qv=$e(/^(?:\w+script|data):/i),Vv=$e(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),tc=$e(/^html$/i),Yv=$e(/^[a-z][.\w]*(-[.\w]+)+$/i);var nc=Object.freeze({__proto__:null,ARIA_ATTR:Jv,ATTR_WHITESPACE:Vv,CUSTOM_ELEMENT:Yv,DATA_ATTR:zv,DOCTYPE_NAME:tc,ERB_EXPR:Uv,IS_ALLOWED_URI:ec,IS_SCRIPT_OR_DATA:qv,MUSTACHE_EXPR:Nv,TMPLIT_EXPR:Hv});const Mr={element:1,text:3,progressingInstruction:7,comment:8,document:9},Wv=function(){return typeof window>"u"?null:window},$v=function(n,e){if(typeof n!="object"||typeof n.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";e&&e.hasAttribute(i)&&(r=e.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return n.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},rc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ic(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wv();const n=W=>ic(W);if(n.version="3.2.4",n.removed=[],!t||!t.document||t.document.nodeType!==Mr.document||!t.Element)return n.isSupported=!1,n;let{document:e}=t;const r=e,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:u,NodeFilter:l,NamedNodeMap:c=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:h,DOMParser:d,trustedTypes:v}=t,M=u.prototype,A=Er(M,"cloneNode"),P=Er(M,"remove"),C=Er(M,"nextSibling"),g=Er(M,"childNodes"),D=Er(M,"parentNode");if(typeof o=="function"){const W=e.createElement("template");W.content&&W.content.ownerDocument&&(e=W.content.ownerDocument)}let F,G="";const{implementation:N,createNodeIterator:H,createDocumentFragment:f,getElementsByTagName:p}=e,{importNode:m}=r;let y=rc();n.isSupported=typeof Vu=="function"&&typeof D=="function"&&N&&N.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:E,ERB_EXPR:S,TMPLIT_EXPR:k,DATA_ATTR:b,ARIA_ATTR:_,IS_SCRIPT_OR_DATA:T,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:I}=nc;let{IS_ALLOWED_URI:J}=nc,U=null;const K=Q({},[...Zu,...vo,...yo,...wo,...Xu]);let V=null;const X=Q({},[...Ku,...Eo,...Qu,...Fi]);let z=Object.seal(Wu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,re=null,Ft=!0,Dt=!0,$t=!1,Fe=!0,Be=!1,ve=!0,ue=!1,se=!1,Jo=!1,Bn=!1,Ji=!1,qi=!1,ef=!0,tf=!1;const cw="user-content-";let qo=!0,Pr=!1,Nn={},Un=null;const nf=Q({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let rf=null;const sf=Q({},["audio","video","img","source","image","track"]);let Vo=null;const of=Q({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Vi="http://www.w3.org/1998/Math/MathML",Yi="http://www.w3.org/2000/svg",Ot="http://www.w3.org/1999/xhtml";let Hn=Ot,Yo=!1,Wo=null;const fw=Q({},[Vi,Yi,Ot],mo);let Wi=Q({},["mi","mo","mn","ms","mtext"]),$i=Q({},["annotation-xml"]);const hw=Q({},["title","style","font","a","script"]);let Ir=null;const dw=["application/xhtml+xml","text/html"],pw="text/html";let ye=null,zn=null;const gw=e.createElement("form"),af=function(x){return x instanceof RegExp||x instanceof Function},$o=function(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(zn&&zn===x)){if((!x||typeof x!="object")&&(x={}),x=ln(x),Ir=dw.indexOf(x.PARSER_MEDIA_TYPE)===-1?pw:x.PARSER_MEDIA_TYPE,ye=Ir==="application/xhtml+xml"?mo:Ii,U=st(x,"ALLOWED_TAGS")?Q({},x.ALLOWED_TAGS,ye):K,V=st(x,"ALLOWED_ATTR")?Q({},x.ALLOWED_ATTR,ye):X,Wo=st(x,"ALLOWED_NAMESPACES")?Q({},x.ALLOWED_NAMESPACES,mo):fw,Vo=st(x,"ADD_URI_SAFE_ATTR")?Q(ln(of),x.ADD_URI_SAFE_ATTR,ye):of,rf=st(x,"ADD_DATA_URI_TAGS")?Q(ln(sf),x.ADD_DATA_URI_TAGS,ye):sf,Un=st(x,"FORBID_CONTENTS")?Q({},x.FORBID_CONTENTS,ye):nf,Z=st(x,"FORBID_TAGS")?Q({},x.FORBID_TAGS,ye):{},re=st(x,"FORBID_ATTR")?Q({},x.FORBID_ATTR,ye):{},Nn=st(x,"USE_PROFILES")?x.USE_PROFILES:!1,Ft=x.ALLOW_ARIA_ATTR!==!1,Dt=x.ALLOW_DATA_ATTR!==!1,$t=x.ALLOW_UNKNOWN_PROTOCOLS||!1,Fe=x.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Be=x.SAFE_FOR_TEMPLATES||!1,ve=x.SAFE_FOR_XML!==!1,ue=x.WHOLE_DOCUMENT||!1,Bn=x.RETURN_DOM||!1,Ji=x.RETURN_DOM_FRAGMENT||!1,qi=x.RETURN_TRUSTED_TYPE||!1,Jo=x.FORCE_BODY||!1,ef=x.SANITIZE_DOM!==!1,tf=x.SANITIZE_NAMED_PROPS||!1,qo=x.KEEP_CONTENT!==!1,Pr=x.IN_PLACE||!1,J=x.ALLOWED_URI_REGEXP||ec,Hn=x.NAMESPACE||Ot,Wi=x.MATHML_TEXT_INTEGRATION_POINTS||Wi,$i=x.HTML_INTEGRATION_POINTS||$i,z=x.CUSTOM_ELEMENT_HANDLING||{},x.CUSTOM_ELEMENT_HANDLING&&af(x.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(z.tagNameCheck=x.CUSTOM_ELEMENT_HANDLING.tagNameCheck),x.CUSTOM_ELEMENT_HANDLING&&af(x.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(z.attributeNameCheck=x.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),x.CUSTOM_ELEMENT_HANDLING&&typeof x.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(z.allowCustomizedBuiltInElements=x.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Be&&(Dt=!1),Ji&&(Bn=!0),Nn&&(U=Q({},Xu),V=[],Nn.html===!0&&(Q(U,Zu),Q(V,Ku)),Nn.svg===!0&&(Q(U,vo),Q(V,Eo),Q(V,Fi)),Nn.svgFilters===!0&&(Q(U,yo),Q(V,Eo),Q(V,Fi)),Nn.mathMl===!0&&(Q(U,wo),Q(V,Qu),Q(V,Fi))),x.ADD_TAGS&&(U===K&&(U=ln(U)),Q(U,x.ADD_TAGS,ye)),x.ADD_ATTR&&(V===X&&(V=ln(V)),Q(V,x.ADD_ATTR,ye)),x.ADD_URI_SAFE_ATTR&&Q(Vo,x.ADD_URI_SAFE_ATTR,ye),x.FORBID_CONTENTS&&(Un===nf&&(Un=ln(Un)),Q(Un,x.FORBID_CONTENTS,ye)),qo&&(U["#text"]=!0),ue&&Q(U,["html","head","body"]),U.table&&(Q(U,["tbody"]),delete Z.tbody),x.TRUSTED_TYPES_POLICY){if(typeof x.TRUSTED_TYPES_POLICY.createHTML!="function")throw wr('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof x.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw wr('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');F=x.TRUSTED_TYPES_POLICY,G=F.createHTML("")}else F===void 0&&(F=$v(v,i)),F!==null&&typeof G=="string"&&(G=F.createHTML(""));Te&&Te(x),zn=x}},lf=Q({},[...vo,...yo,...Rv]),uf=Q({},[...wo,...Bv]),mw=function(x){let R=D(x);(!R||!R.tagName)&&(R={namespaceURI:Hn,tagName:"template"});const q=Ii(x.tagName),fe=Ii(R.tagName);return Wo[x.namespaceURI]?x.namespaceURI===Yi?R.namespaceURI===Ot?q==="svg":R.namespaceURI===Vi?q==="svg"&&(fe==="annotation-xml"||Wi[fe]):!!lf[q]:x.namespaceURI===Vi?R.namespaceURI===Ot?q==="math":R.namespaceURI===Yi?q==="math"&&$i[fe]:!!uf[q]:x.namespaceURI===Ot?R.namespaceURI===Yi&&!$i[fe]||R.namespaceURI===Vi&&!Wi[fe]?!1:!uf[q]&&(hw[q]||!lf[q]):!!(Ir==="application/xhtml+xml"&&Wo[x.namespaceURI]):!1},mt=function(x){vr(n.removed,{element:x});try{D(x).removeChild(x)}catch{P(x)}},ji=function(x,R){try{vr(n.removed,{attribute:R.getAttributeNode(x),from:R})}catch{vr(n.removed,{attribute:null,from:R})}if(R.removeAttribute(x),x==="is")if(Bn||Ji)try{mt(R)}catch{}else try{R.setAttribute(x,"")}catch{}},cf=function(x){let R=null,q=null;if(Jo)x="<remove></remove>"+x;else{const be=ju(x,/^[\r\n\t ]+/);q=be&&be[0]}Ir==="application/xhtml+xml"&&Hn===Ot&&(x='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+x+"</body></html>");const fe=F?F.createHTML(x):x;if(Hn===Ot)try{R=new d().parseFromString(fe,Ir)}catch{}if(!R||!R.documentElement){R=N.createDocument(Hn,"template",null);try{R.documentElement.innerHTML=Yo?G:fe}catch{}}const xe=R.body||R.documentElement;return x&&q&&xe.insertBefore(e.createTextNode(q),xe.childNodes[0]||null),Hn===Ot?p.call(R,ue?"html":"body")[0]:ue?R.documentElement:xe},ff=function(x){return H.call(x.ownerDocument||x,x,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT|l.SHOW_PROCESSING_INSTRUCTION|l.SHOW_CDATA_SECTION,null)},jo=function(x){return x instanceof h&&(typeof x.nodeName!="string"||typeof x.textContent!="string"||typeof x.removeChild!="function"||!(x.attributes instanceof c)||typeof x.removeAttribute!="function"||typeof x.setAttribute!="function"||typeof x.namespaceURI!="string"||typeof x.insertBefore!="function"||typeof x.hasChildNodes!="function")},hf=function(x){return typeof a=="function"&&x instanceof a};function Gt(W,x,R){Pi(W,q=>{q.call(n,x,R,zn)})}const df=function(x){let R=null;if(Gt(y.beforeSanitizeElements,x,null),jo(x))return mt(x),!0;const q=ye(x.nodeName);if(Gt(y.uponSanitizeElement,x,{tagName:q,allowedTags:U}),x.hasChildNodes()&&!hf(x.firstElementChild)&&Pe(/<[/\w]/g,x.innerHTML)&&Pe(/<[/\w]/g,x.textContent)||x.nodeType===Mr.progressingInstruction||ve&&x.nodeType===Mr.comment&&Pe(/<[/\w]/g,x.data))return mt(x),!0;if(!U[q]||Z[q]){if(!Z[q]&&gf(q)&&(z.tagNameCheck instanceof RegExp&&Pe(z.tagNameCheck,q)||z.tagNameCheck instanceof Function&&z.tagNameCheck(q)))return!1;if(qo&&!Un[q]){const fe=D(x)||x.parentNode,xe=g(x)||x.childNodes;if(xe&&fe){const be=xe.length;for(let Ne=be-1;Ne>=0;--Ne){const vt=A(xe[Ne],!0);vt.__removalCount=(x.__removalCount||0)+1,fe.insertBefore(vt,C(x))}}}return mt(x),!0}return x instanceof u&&!mw(x)||(q==="noscript"||q==="noembed"||q==="noframes")&&Pe(/<\/no(script|embed|frames)/i,x.innerHTML)?(mt(x),!0):(Be&&x.nodeType===Mr.text&&(R=x.textContent,Pi([E,S,k],fe=>{R=yr(R,fe," ")}),x.textContent!==R&&(vr(n.removed,{element:x.cloneNode()}),x.textContent=R)),Gt(y.afterSanitizeElements,x,null),!1)},pf=function(x,R,q){if(ef&&(R==="id"||R==="name")&&(q in e||q in gw))return!1;if(!(Dt&&!re[R]&&Pe(b,R))){if(!(Ft&&Pe(_,R))){if(!V[R]||re[R]){if(!(gf(x)&&(z.tagNameCheck instanceof RegExp&&Pe(z.tagNameCheck,x)||z.tagNameCheck instanceof Function&&z.tagNameCheck(x))&&(z.attributeNameCheck instanceof RegExp&&Pe(z.attributeNameCheck,R)||z.attributeNameCheck instanceof Function&&z.attributeNameCheck(R))||R==="is"&&z.allowCustomizedBuiltInElements&&(z.tagNameCheck instanceof RegExp&&Pe(z.tagNameCheck,q)||z.tagNameCheck instanceof Function&&z.tagNameCheck(q))))return!1}else if(!Vo[R]){if(!Pe(J,yr(q,L,""))){if(!((R==="src"||R==="xlink:href"||R==="href")&&x!=="script"&&Fv(q,"data:")===0&&rf[x])){if(!($t&&!Pe(T,yr(q,L,"")))){if(q)return!1}}}}}}return!0},gf=function(x){return x!=="annotation-xml"&&ju(x,I)},mf=function(x){Gt(y.beforeSanitizeAttributes,x,null);const{attributes:R}=x;if(!R||jo(x))return;const q={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:V,forceKeepAttr:void 0};let fe=R.length;for(;fe--;){const xe=R[fe],{name:be,namespaceURI:Ne,value:vt}=xe,Fr=ye(be);let De=be==="value"?vt:Dv(vt);if(q.attrName=Fr,q.attrValue=De,q.keepAttr=!0,q.forceKeepAttr=void 0,Gt(y.uponSanitizeAttribute,x,q),De=q.attrValue,tf&&(Fr==="id"||Fr==="name")&&(ji(be,x),De=cw+De),ve&&Pe(/((--!?|])>)|<\/(style|title)/i,De)){ji(be,x);continue}if(q.forceKeepAttr||(ji(be,x),!q.keepAttr))continue;if(!Fe&&Pe(/\/>/i,De)){ji(be,x);continue}Be&&Pi([E,S,k],yf=>{De=yr(De,yf," ")});const vf=ye(x.nodeName);if(pf(vf,Fr,De)){if(F&&typeof v=="object"&&typeof v.getAttributeType=="function"&&!Ne)switch(v.getAttributeType(vf,Fr)){case"TrustedHTML":{De=F.createHTML(De);break}case"TrustedScriptURL":{De=F.createScriptURL(De);break}}try{Ne?x.setAttributeNS(Ne,be,De):x.setAttribute(be,De),jo(x)?mt(x):$u(n.removed)}catch{}}}Gt(y.afterSanitizeAttributes,x,null)},vw=function W(x){let R=null;const q=ff(x);for(Gt(y.beforeSanitizeShadowDOM,x,null);R=q.nextNode();)Gt(y.uponSanitizeShadowNode,R,null),df(R),mf(R),R.content instanceof s&&W(R.content);Gt(y.afterSanitizeShadowDOM,x,null)};return n.sanitize=function(W){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},R=null,q=null,fe=null,xe=null;if(Yo=!W,Yo&&(W="<!-->"),typeof W!="string"&&!hf(W))if(typeof W.toString=="function"){if(W=W.toString(),typeof W!="string")throw wr("dirty is not a string, aborting")}else throw wr("toString is not a function");if(!n.isSupported)return W;if(se||$o(x),n.removed=[],typeof W=="string"&&(Pr=!1),Pr){if(W.nodeName){const vt=ye(W.nodeName);if(!U[vt]||Z[vt])throw wr("root node is forbidden and cannot be sanitized in-place")}}else if(W instanceof a)R=cf("<!---->"),q=R.ownerDocument.importNode(W,!0),q.nodeType===Mr.element&&q.nodeName==="BODY"||q.nodeName==="HTML"?R=q:R.appendChild(q);else{if(!Bn&&!Be&&!ue&&W.indexOf("<")===-1)return F&&qi?F.createHTML(W):W;if(R=cf(W),!R)return Bn?null:qi?G:""}R&&Jo&&mt(R.firstChild);const be=ff(Pr?W:R);for(;fe=be.nextNode();)df(fe),mf(fe),fe.content instanceof s&&vw(fe.content);if(Pr)return W;if(Bn){if(Ji)for(xe=f.call(R.ownerDocument);R.firstChild;)xe.appendChild(R.firstChild);else xe=R;return(V.shadowroot||V.shadowrootmode)&&(xe=m.call(r,xe,!0)),xe}let Ne=ue?R.outerHTML:R.innerHTML;return ue&&U["!doctype"]&&R.ownerDocument&&R.ownerDocument.doctype&&R.ownerDocument.doctype.name&&Pe(tc,R.ownerDocument.doctype.name)&&(Ne="<!DOCTYPE "+R.ownerDocument.doctype.name+`>
`+Ne),Be&&Pi([E,S,k],vt=>{Ne=yr(Ne,vt," ")}),F&&qi?F.createHTML(Ne):Ne},n.setConfig=function(){let W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$o(W),se=!0},n.clearConfig=function(){zn=null,se=!1},n.isValidAttribute=function(W,x,R){zn||$o({});const q=ye(W),fe=ye(x);return pf(q,fe,R)},n.addHook=function(W,x){typeof x=="function"&&vr(y[W],x)},n.removeHook=function(W,x){if(x!==void 0){const R=Pv(y[W],x);return R===-1?void 0:Iv(y[W],R,1)[0]}return $u(y[W])},n.removeHooks=function(W){y[W]=[]},n.removeAllHooks=function(){y=rc()},n}var jv=ic();const Zv=(t,n,e)=>{n.control&&n.controlOptions?e.options.toggleMode(n.control.type,n.control.targetMode):B.error("Control or controlOptions not defined",n.control,n.controlOptions)};var Xv=it("<div><!></div>"),Kv=it('<div class="control-container svelte-1rd72r"><button type="button"><!></button> <!></div>');function Qv(t,n){var u;Sn(n,!0);const e=(u=n.controlOptions)!=null&&u.icon?jv.sanitize(n.controlOptions.icon.trim()):null,r=Xs("gm"),i=r.control.getDefaultPosition();var s=kn(),o=zt(s);{var a=l=>{var c=Kv(),h=Ht(c);let d;h.__click=[Zv,n,r];var v=Ht(h);{var M=g=>{var D=kn(),F=zt(D);tv(F,()=>e),ge(g,D)},A=(g,D)=>{{var F=N=>{var H=Gu();kt(f=>Tn(H,f),[()=>n.controlOptions.title.slice(0,2)]),ge(N,H)},G=N=>{var H=Gu();kt(()=>Tn(H,n.control.targetMode)),ge(N,H)};dt(g,N=>{n.controlOptions.title?N(F):N(G,!1)},D)}};dt(v,g=>{n.controlOptions.icon?g(M):g(A,!1)})}var P=vi(h,2);{var C=g=>{var D=Xv();let F;var G=Ht(D);Lv(G,{get control(){return n.control}}),kt((N,H)=>F=co(D,1,"control-menu svelte-1rd72r",null,F,{"menu-right":N,"menu-left":H}),[()=>i.endsWith("left"),()=>i.endsWith("right")]),ge(g,D)};dt(P,g=>{n.controlOptions.active&&g(C)})}kt(()=>{an(h,"id",`id_${n.control.type}_${n.control.targetMode}`),d=co(h,1,`gm-control-button ${n.control.type}-${n.control.targetMode}`,"svelte-1rd72r",d,{active:n.controlOptions.active}),an(h,"title",n.controlOptions.title)}),ge(l,c)};dt(o,l=>{n.control&&n.controlOptions&&n.controlOptions.uiEnabled&&l(a)})}ge(t,s),An()}lo(["click"]);var ey=it("<div></div>"),ty=it('<div class="gm-reactive-controls svelte-16ufo3a"></div>');function ny(t,n){Sn(n,!1);const[e,r]=cv();let s=uv(ho,"$controlsStore",e),o=s.controls,a=M1(s.options);const l=`${Xs("gm").mapAdapter.mapType}gl`,c=ho.subscribe(v=>{o=v.controls,Me(a,v.options)});fv(c);const h=(v,M)=>{const A=o==null?void 0:o[v];return(A==null?void 0:A[M])||null};lv();var d=ty();gr(d,5,()=>Object.entries(ee(a)),pr,(v,M)=>{let A=()=>ee(M)[0],P=()=>ee(M)[1];var C=ey();gr(C,5,()=>Object.entries(P()),pr,(g,D)=>{let F=()=>ee(D)[0],G=()=>ee(D)[1];var N=kn();const H=fu(()=>h(A(),F()));var f=zt(N);{var p=m=>{Qv(m,{get control(){return ee(H)},get controlOptions(){return G()}})};dt(f,m=>{ee(H)&&m(p)})}ge(g,N)}),kt(()=>co(C,1,`${l}-ctrl ${l}-ctrl-group group-${A()}`,"svelte-16ufo3a")),ge(v,C)}),ge(t,d),An(),r()}class ry{constructor(n){w(this,"gm");this.gm=n}}class iy extends ry{constructor(){super(...arguments);w(this,"controls",Ye(Xo));w(this,"reactiveControls",null);w(this,"container");w(this,"mapEventHandlers",{[`${Y}:draw`]:this.handleModeEvent.bind(this),[`${Y}:edit`]:this.handleModeEvent.bind(this),[`${Y}:helper`]:this.handleModeEvent.bind(this)})}onAdd(){if(this.createControls(),this.gm.events.bus.attachEvents(this.mapEventHandlers),!this.container)throw new Error("Controls container is not initialized");return this.container}createControls(e=void 0){if(this.controlsAdded()){B.warn("Can't add controls: controls already added");return}this.container=e||this.createHtmlContainer(),this.createReactivePanel()}onRemove(){this.gm.events.bus.detachEvents(this.mapEventHandlers),this.reactiveControls&&(Z1(this.reactiveControls),this.reactiveControls=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=void 0}handleModeEvent(e){return Qr(e)?(["mode_started","mode_ended"].includes(e.action)&&this.updateReactivePanel(),{next:!0}):{next:!0}}controlsAdded(){return!!this.reactiveControls}createReactivePanel(){if(!this.container){B.error("Can't create reactive panel: container is not initialized");return}this.syncModeStates();const e=new Map;e.set("gm",this.gm),this.reactiveControls=$1(ny,{target:this.container,context:e}),this.updateReactivePanel()}updateReactivePanel(){ho.update(()=>({controls:this.controls,options:this.gm.options.controls}))}createHtmlContainer(){const e=document.createElement("div");return e.classList.add("geoman-controls"),e}syncModeStates(){this.eachControlWithOptions(({control:e})=>{this.gm.options.syncModeState(e.type,e.targetMode)})}eachControlWithOptions(e){return Oe(this.controls).forEach(r=>{const i=this.controls[r];return Object.keys(i).forEach(s=>{const o=s,a=this.getControl({actionType:r,modeName:o}),u=this.gm.options.getControlOptions({actionType:r,modeName:o});a&&u?e({control:a,controlOptions:u}):B.error("Can't find control/controlOptions for",r,o)})})}getControl({actionType:e,modeName:r}){return e&&r&&this.controls[e][r]||null}getDefaultPosition(){return this.gm.options.settings.controlsPosition}}const sy=`_${Y}`;class oy{constructor(n){w(this,"gm");w(this,"globalEventsListener",null);this.gm=n}get map(){return this.gm.mapAdapter.getMapInstance()}processEvent(n,e){this.fireToMap("system",n.split(":")[1],{...e,level:"user"}),e.action==="mode_start"||e.action==="mode_end"?this.forwardModeToggledEvent(e):e.action==="feature_created"?this.forwardFeatureCreated(e):e.action==="feature_removed"?this.forwardFeatureRemoved(e):e.action==="feature_updated"?this.forwardFeatureUpdated(e):e.action==="feature_edit_start"?this.forwardFeatureEditStart(e):e.action==="feature_edit_end"?this.forwardFeatureEditEnd(e):(e.action==="loaded"||e.action==="unloaded")&&this.forwardGeomanLoaded(e)}forwardModeToggledEvent(n){const e=n.action==="mode_start";let r;if(n.type==="draw"){const i="globaldrawmodetoggled";r={enabled:e,shape:n.mode,map:this.map},this.fireToMap("converted",i,r),r={shape:n.mode,map:this.map},this.fireToMap("converted",e?"drawstart":"drawend",r)}else if(n.type==="edit"){const i=this.getConvertedEditModeName(n.mode);r={enabled:e,map:this.map},this.fireToMap("converted",`global${i}modetoggled`,r)}else n.type==="helper"&&(r={enabled:e,map:this.map},this.fireToMap("converted",`global${n.mode}modetoggled`,r))}forwardFeatureCreated(n){const e={shape:n.mode,feature:n.featureData,map:this.map};this.fireToMap("converted","create",e)}forwardFeatureRemoved(n){const e={shape:n.mode,feature:n.featureData,map:this.map};this.fireToMap("converted","remove",e)}forwardFeatureUpdated(n){const e=["lasso"],r={map:this.map};n.sourceFeatures.length===1&&!e.includes(n.mode)?r.originalFeature=n.sourceFeatures[0]:r.originalFeatures=n.sourceFeatures,n.targetFeatures.length===1&&!e.includes(n.mode)?(r.feature=n.targetFeatures[0],r.shape=r.feature.shape):r.features=n.targetFeatures;const i=this.getConvertedEditModeName(n.mode);this.fireToMap("converted",`${i}`,r)}forwardFeatureEditStart(n){const e=this.getConvertedEditModeName(n.mode),r={shape:n.feature.shape,feature:n.feature,map:this.map};this.fireToMap("converted",`${e}start`,r)}forwardFeatureEditEnd(n){const e=this.getConvertedEditModeName(n.mode),r={shape:n.feature.shape,feature:n.feature,map:this.map};this.fireToMap("converted",`${e}end`,r)}forwardGeomanLoaded(n){this.fireToMap("converted",`${n.action}`,{map:this.map,[Y]:this.gm})}fireToMap(n,e,r){const s=`${n==="system"?sy:Y}:${e}`;this.globalEventsListener&&this.globalEventsListener({type:n,name:s,payload:r}),this.gm.mapAdapter.fire(s,r)}getConvertedEditModeName(n){return n==="change"?"edit":n}}class ay{constructor(n){w(this,"gm");w(this,"forwarder");w(this,"mapEventHandlers",{});w(this,"gmEventHandlers",{});this.gm=n,this.forwarder=new oy(n)}fireEvent(n,e){const r=this.gmEventHandlers[n];if(!r)return;const{controlHandler:i}=r;i(e),this.forwarder.processEvent(n,e)}attachEvents(n){Oe(n).forEach(e=>{const r=n[e];r&&this.on(e,r)})}detachEvents(n){Oe(n).forEach(e=>{const r=n[e];r&&this.off(e,r)})}on(n,e){n.startsWith(Y)?this.onGmEvent(n,e):this.onMapEvent(n,e)}onGmEvent(n,e){var r;this.gmEventHandlers[n]||(this.gmEventHandlers[n]=this.createEventSection(n)),(r=this.gmEventHandlers[n])==null||r.handlers.unshift(e)}onMapEvent(n,e){var r;if(!this.mapEventHandlers[n]){const i=this.createEventSection(n);this.gm.mapAdapter.on(n,i.controlHandler),this.mapEventHandlers[n]=i}(r=this.mapEventHandlers[n])==null||r.handlers.unshift(e)}off(n,e){n.startsWith(`${Y}`)?this.offGmEvent(n,e):this.offMapEvent(n,e)}offGmEvent(n,e){var s;const r=((s=this.gmEventHandlers[n])==null?void 0:s.handlers)||[],i=r.findIndex(o=>e===o);i===-1?B.warn("MapEvents: handler not found",n,e):(r.splice(i,1),r.length===0&&delete this.gmEventHandlers[n])}offMapEvent(n,e){var s,o;const r=((s=this.mapEventHandlers[n])==null?void 0:s.handlers)||[],i=r.findIndex(a=>e===a);if(i===-1)B.warn("MapEvents: handler not found",n,e);else if(r.splice(i,1),r.length===0){const a=(o=this.mapEventHandlers[n])==null?void 0:o.controlHandler;a&&this.gm.mapAdapter.off(n,a),delete this.mapEventHandlers[n]}}createEventSection(n){return{handlers:[],controlHandler:e=>{let r;if(Mt(e)&&n.startsWith(`${Y}`)?r=this.gmEventHandlers[n]:r=this.mapEventHandlers[n],!r){B.debug(`No handlers for eventName: "${n}"`);return}r.handlers.some(i=>{let s;return Mt(e),s=i(e),s&&typeof s=="object"&&"next"in s?!s.next:(B.error('EventsBus: handler should return an object with a "next" property'),!1)})}}}}class ly extends ei{constructor(e,r){super(e);w(this,"mapEventHandlers",{[`${Y}:control`]:this.handleControlEvent.bind(this)});r.attachEvents(this.mapEventHandlers)}handleControlEvent(e){return kl(e)?(this.getControl(e)||B.error("Control not found, event payload",e),{next:!0}):{next:!0}}}class sc extends bt{constructor(){super(...arguments);w(this,"mode","circle");w(this,"shape","circle");w(this,"circleCenterPoint",null);w(this,"circleCenterLngLat",null);w(this,"mapEventHandlers",{mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)})}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.gm.markerPointer.disable(),this.fireFinishEvent()}createFeature(){const e=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(this.circleCenterLngLat||[0,0]),sourceName:O.temporary});return e&&this.circleCenterLngLat&&e.setShapeProperty("center",this.circleCenterLngLat),e}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}createMarker(){const e=document.createElement("div");e.innerHTML=Ko;const r=e.firstChild;return r.style.color="#278cda",r.style.width="28px",r.style.height="28px",r.style.pointerEvents="none",this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"center",element:r},[0,0])}getControlMarkerData(){const e=this.gm.markerPointer.marker;return e?{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}}:null}fireStartEvent(e,r){const i={level:"system",type:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:r};this.gm.events.fire(`${Y}:draw`,i)}fireUpdateEvent(e,r){const i={level:"system",type:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:r};this.gm.events.fire(`${Y}:draw`,i)}fireFinishEvent(){const e={level:"system",type:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${Y}:draw`,e)}}class uy extends sc{constructor(){super(...arguments);w(this,"mode","circle_marker");w(this,"shape","circle_marker")}onStartAction(){this.gm.markerPointer.enable({customMarker:this.createMarker()})}onEndAction(){this.fireMarkerPointerFinishEvent(),super.onEndAction()}onMouseMove(){return this.fireMarkerPointerUpdateEvent(),{next:!0}}onMouseClick(e){var i;const r=((i=this.gm.markerPointer.marker)==null?void 0:i.getLngLat())||e.lngLat.toArray();return this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(),this.circleCenterLngLat=r,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.updateFeaturePosition(this.circleCenterLngLat),this.saveFeature()),{next:!1}}updateFeaturePosition(e){if(!this.featureData)return;const r=this.getFeatureGeoJson(e);this.featureData.updateGeoJsonGeometry(r.geometry)}}const cy=()=>"ontouchstart"in window||navigator.maxTouchPoints>0||matchMedia("(hover: none)").matches?!0:"msMaxTouchPoints"in navigator&&typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0,Fn=(t,n,e=10)=>{const r={...t};return Oe(t).forEach(i=>{const s=t[i];typeof s=="function"?r[i]=ml(s.bind(n),e,{leading:!0,trailing:!1}):B.error("convertToThrottled: item is not a function",t[i])}),r},fy=(t,n,e=10)=>{const r={...t};return Oe(t).forEach(i=>{const s=t[i];typeof s=="function"?r[i]=ws(s.bind(n),e,{leading:!1,trailing:!0}):B.error("convertToDebounced: item is not a function",t[i])}),r};class hy extends sc{constructor(){super(...arguments);w(this,"mode","circle");w(this,"shape","circle");w(this,"throttledMethods",Fn({updateFeatureGeoJson:this.updateFeatureGeoJson},this,this.gm.options.settings.throttlingDelay))}onMouseClick(e){var i;if(!pe(e))return{next:!0};const r=((i=this.gm.markerPointer.marker)==null?void 0:i.getLngLat())||e.lngLat.toArray();if(this.circleCenterPoint&&this.circleCenterLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,r)]}),this.flags.featureCreateAllowed&&(this.saveCircleFeature(r),this.circleCenterLngLat=null,this.circleCenterPoint=null,this.fireFinishEvent());else if(this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed){this.circleCenterLngLat=r,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.featureData=this.createFeature();const s=this.getControlMarkerData();this.featureData&&s&&this.fireStartEvent(this.featureData,s)}return{next:!1}}onMouseMove(){if(this.circleCenterLngLat&&this.gm.markerPointer.marker){const e=this.gm.markerPointer.marker.getLngLat();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,e)]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeatureGeoJson(e)}return this.circleCenterPoint||this.fireMarkerPointerUpdateEvent(),{next:!1}}updateFeatureGeoJson(e){if(this.featureData&&this.circleCenterLngLat){const r=this.getCircleGeoJson(this.circleCenterLngLat,e);this.featureData.updateGeoJsonGeometry(r.geometry);const i=this.getControlMarkerData();i&&this.fireUpdateEvent(this.featureData,i)}}saveCircleFeature(e){var r;if(this.circleCenterLngLat&&this.featureData){const i=((r=this.gm.markerPointer.marker)==null?void 0:r.getLngLat())||e;this.updateFeatureGeoJson(i),this.featureData.setShapeProperty("center",this.circleCenterLngLat),this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()}}isFeatureGeoJsonValid(){return this.featureData?Sl(this.featureData.getGeoJson()):!1}getCircleGeoJson(e,r){const i=this.gm.mapAdapter.getDistance(e,r);return{...Ls({center:e,radius:i}),properties:{shape:this.shape}}}}function dy(t,n,{ignoreSelfIntersections:e=!0}={ignoreSelfIntersections:!0}){let r=!0;return Ut(t,i=>{Ut(n,s=>{if(r===!1)return!1;r=py(i.geometry,s.geometry,e)})}),r}function py(t,n,e){switch(t.type){case"Point":switch(n.type){case"Point":return!yy(t.coordinates,n.coordinates);case"LineString":return!oc(n,t);case"Polygon":return!rn(t,n)}break;case"LineString":switch(n.type){case"Point":return!oc(t,n);case"LineString":return!gy(t,n,e);case"Polygon":return!ac(n,t,e)}break;case"Polygon":switch(n.type){case"Point":return!rn(n,t);case"LineString":return!ac(t,n,e);case"Polygon":return!my(n,t,e)}}return!1}function oc(t,n){for(let e=0;e<t.coordinates.length-1;e++)if(vy(t.coordinates[e],t.coordinates[e+1],n.coordinates))return!0;return!1}function gy(t,n,e){return or(t,n,{ignoreSelfIntersections:e}).features.length>0}function ac(t,n,e){for(const i of n.coordinates)if(rn(i,t))return!0;return or(n,Ki(t),{ignoreSelfIntersections:e}).features.length>0}function my(t,n,e){for(const i of t.coordinates[0])if(rn(i,n))return!0;for(const i of n.coordinates[0])if(rn(i,t))return!0;return or(Ki(t),Ki(n),{ignoreSelfIntersections:e}).features.length>0}function vy(t,n,e){const r=e[0]-t[0],i=e[1]-t[1],s=n[0]-t[0],o=n[1]-t[1];return r*o-i*s!==0?!1:Math.abs(s)>=Math.abs(o)?s>0?t[0]<=e[0]&&e[0]<=n[0]:n[0]<=e[0]&&e[0]<=t[0]:o>0?t[1]<=e[1]&&e[1]<=n[1]:n[1]<=e[1]&&e[1]<=t[1]}function yy(t,n){return t[0]===n[0]&&t[1]===n[1]}function wy(t,n,e={}){let r;return e.final?r=lc(de(n),de(t)):r=lc(de(t),de(n)),r>180?-(360-r):r}function lc(t,n){const e=me(t[1]),r=me(n[1]);let i=me(n[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);const s=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(e/2+Math.PI/4)),o=Math.atan2(i,s);return(dn(o)+360)%360}function Ey(t,n,e={}){const r=de(t),i=de(n);i[0]+=i[0]-r[0]>180?-360:r[0]-i[0]>180?360:0;const s=My(r,i);return ia(s,"meters",e.units)}function My(t,n,e){e=e===void 0?we:Number(e);const r=e,i=t[1]*Math.PI/180,s=n[1]*Math.PI/180,o=s-i;let a=Math.abs(n[0]-t[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);const u=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),l=Math.abs(u)>1e-11?o/u:Math.cos(i);return Math.sqrt(o*o+l*l*a*a)*r}function by(t,n,e,r={}){const i=n<0;let s=ia(Math.abs(n),r.units,"meters");i&&(s=-Math.abs(s));const o=de(t),a=_y(o,s,e);return a[0]+=a[0]-o[0]>180?-360:o[0]-a[0]>180?360:0,Rt(a,r.properties)}function _y(t,n,e,r){r=r===void 0?we:Number(r);const i=n/r,s=t[0]*Math.PI/180,o=me(t[1]),a=me(e),u=i*Math.cos(a);let l=o+u;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);const c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),h=Math.abs(c)>1e-11?u/c:Math.cos(o),d=i*Math.sin(a)/h;return[((s+d)*180/Math.PI+540)%360-180,l*180/Math.PI]}const Mo=["drag","change","rotate","scale","copy","cut","split","union","difference","line_simplification","lasso","delete"];class br extends Cs{constructor(){super(...arguments);w(this,"actionType","edit");w(this,"featureData",null);w(this,"cursorExcludedLayerIds",["rectangle-line","polygon-line","circle-line"]);w(this,"layerEventHandlersData",[])}startAction(){this.setEventsForLayers("mouseenter",this.setCursorToPointer.bind(this)),this.setEventsForLayers("mouseleave",this.setCursorToEmpty.bind(this)),super.startAction()}endAction(){this.clearEventsForLayers(),super.endAction()}setCursorToPointer(){this.gm.mapAdapter.setCursor("pointer")}setCursorToEmpty(){this.gm.mapAdapter.setCursor("")}setEventsForLayers(e,r){this.gm.features.layers.map(s=>s.id).filter(s=>!this.cursorExcludedLayerIds.some(o=>s.includes(o))).forEach(s=>{this.gm.mapAdapter.on(e,s,r),this.layerEventHandlersData.push({eventName:e,layerId:s,callback:r})})}clearEventsForLayers(){this.layerEventHandlersData.forEach(({eventName:e,layerId:r,callback:i})=>{this.gm.mapAdapter.off(e,r,i)}),this.layerEventHandlersData=[]}updateFeatureGeoJson({featureData:e,featureGeoJson:r,forceMode:i=void 0}){return this.flags.featureUpdateAllowed?(e.shape==="circle"&&r.properties.center&&e.setShapeProperty("center",r.properties.center),e.updateGeoJsonGeometry(r.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:[e],forceMode:i}),!0):!1}fireFeatureUpdatedEvent({sourceFeatures:e,targetFeatures:r,markerData:i=void 0,forceMode:s=void 0}){const o={level:"system",type:"edit",action:"feature_updated",mode:s||this.mode,sourceFeatures:e,targetFeatures:r,markerData:i||null};this.gm.events.fire(`${Y}:edit`,o)}fireFeatureEditStartEvent({feature:e,forceMode:r=void 0}){const i={level:"system",type:"edit",action:"feature_edit_start",mode:r||this.mode,feature:e};this.gm.events.fire(`${Y}:edit`,i)}fireFeatureEditEndEvent({feature:e,forceMode:r=void 0}){const i={level:"system",type:"edit",action:"feature_edit_end",mode:r||this.mode,feature:e};this.gm.events.fire(`${Y}:edit`,i)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker)return;const e=this.gm.markerPointer.marker,r={level:"system",variant:null,type:"draw",mode:this.getLineDrawerMode(),action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:null};this.gm.events.fire(`${Y}:draw`,r)}forwardLineDrawerEvent(e){if(!Pl(e)||!["cut","split"].includes(this.mode))return{next:!0};if(e.action==="start"||e.action==="update"){const r={level:"system",type:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${Y}:draw`,r)}else if(e.action==="finish"||e.action==="cancel"){const r={level:"system",type:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action};this.gm.events.fire(`${Y}:draw`,r)}return{next:!0}}fireFeatureRemovedEvent(e){if(Zt(e.shape,ir)){const r={level:"system",type:"edit",mode:e.shape,action:"feature_removed",featureData:e};this.gm.events.fire(`${Y}:edit`,r)}}getLineDrawerMode(){return this.mode==="cut"?"polygon":(this.mode==="split","line")}}const bo=["shape_markers","pin","snapping","snap_guides","measurements","auto_trace","geofencing","zoom_to_features","click_to_edit"];class un extends Cs{constructor(){super(...arguments);w(this,"actionType","helper")}}const Dn=t=>Mt(t)&&t.type==="edit",uc=t=>vm.includes(t),cc=t=>Ts.includes(t),fc=t=>Mo.includes(t),hc=t=>bo.includes(t),dc=t=>cc(t)||fc(t)||hc(t),_o=(t,n)=>(t%n+n)%n;class pc extends un{constructor(){super(...arguments);w(this,"mode","snap_guides");w(this,"features",new Map);w(this,"mapEventHandlers",{})}onStartAction(){}onEndAction(){this.removeSnapGuides()}updateSnapGuides(e,r,i=!1){var o;const s=new Set(this.features.keys());e&&r&&this.getSnapGuidesLines(e,r,i).forEach(u=>{const l=JSON.stringify(u);if(this.features.has(l)){s.delete(l);return}const c=[this.createGuideLine(u,{orthogonal:!1}),this.createGuideLine(u,{orthogonal:!0})].filter(h=>h!==null);c.length&&this.features.set(l,c)}),s.forEach(a=>this.removeSnapGuide(a)),(o=this.snappingHelper)==null||o.setCustomSnappingCoordinates(this.mode,this.getGuideLinesIntersections())}removeSnapGuides(){this.features.forEach(e=>{e.forEach(r=>{var i;(i=this.snappingHelper)==null||i.removeCustomSnappingFeature(r.featureData),this.gm.features.delete(r.featureData)})}),this.features.clear()}removeSnapGuide(e){const r=this.features.get(e);r==null||r.forEach(i=>{var s;(s=this.snappingHelper)==null||s.removeCustomSnappingFeature(i.featureData),this.gm.features.delete(i.featureData)}),this.features.delete(e)}getGuideLinesIntersections(){const e=[],r=Array.from(this.features.values()).flat().map(i=>i.lineLngLats).map(i=>i.map(s=>this.gm.mapAdapter.project(s)));for(let i=0;i<r.length;i+=1)for(let s=i+1;s<r.length;s+=1)if(r[i].length===2||r[s].length===2){const o=this.getLinesIntersection(r[i],r[s]);if(o){const a=this.gm.mapAdapter.unproject(o);sm(this.gm.globalLngLatBounds,a)&&e.push(a)}}return _s(e,er)}getSnapGuidesLines(e,r,i=!1){const s=[],o=Ml(e,r);if(!o)return B.error("getSnapGuidesCoordsForLine: position not found"),[];const a=o.path.slice(0,-1),u=Ye(nn(e,a,[]));u.length>2&&tr(u[0],u.at(-1))&&u.pop();const l=o.path.at(-1),c=_o(l+1,u.length),h=_o(l-1,u.length);if(u.length===1){const d=u[h];return s.push([d,[d[0]+.1,d[1]]]),s}return l===u.length-1?(s.push([u[0],u[1]]),i?s.push([u[l],u[l-1]]):u.length>2&&s.push([u[l-1],u[l-2]]),s):(s.push([u[h],u[l]]),h!==c&&s.push([u[c],u[l]]),s)}createGuideLine(e,{orthogonal:r}){if(tr(e[0],e[1]))return null;const i=this.getGuideLineLngLats(e,{orthogonal:r});if(!i)return null;const s=this.createGuideLineFeature(i);return s?{lineLngLats:[i[0],i[1]],featureData:s}:null}getGuideLineLngLats(e,{orthogonal:r}){const i=this.gm.mapAdapter.project(e[0]),s=this.gm.mapAdapter.project(e[1]);let o=[i,s];r&&(o=this.rotateLine90Degrees(o));const a=this.getLineBoundsCoordinates(o);return a?a.map(u=>this.gm.mapAdapter.unproject(u)):null}createGuideLineFeature(e){var i;const r=this.gm.features.createFeature({shapeGeoJson:this.getLineGeoJson(e),sourceName:O.temporary});return r?((i=this.snappingHelper)==null||i.addCustomSnappingFeature(r),r):null}getLineGeoJson(e){return{type:"Feature",properties:{shape:"snap_guide"},geometry:{type:"LineString",coordinates:e}}}rotateLine90Degrees(e){const[r,i]=e,s=[i[0]-r[0],i[1]-r[1]],o=[-s[1],s[0]],a=[o[0]+r[0],o[1]+r[1]];return[r,a]}getLineBoundsCoordinates(e){const r=this.getGlobalPlanarBounds(),s=[{coordIndex:0,boundsLine:[r.leftTop,r.rightTop]},{coordIndex:1,boundsLine:[r.rightTop,r.rightBottom]},{coordIndex:0,boundsLine:[r.leftBottom,r.rightBottom]},{coordIndex:1,boundsLine:[r.leftTop,r.leftBottom]}].map(o=>{const{coordIndex:a,boundsLine:u}=o,l=this.getLinesIntersection(e,o.boundsLine);return l&&l[a]>=u[0][a]&&l[a]<=u[1][a]?l:null}).filter(o=>o!==null);return s.length!==2?null:s}getGlobalPlanarBounds(){const e=xl(this.gm.globalLngLatBounds),r=this.gm.mapAdapter.project([e[0],e[3]]),i=this.gm.mapAdapter.project([e[2],e[3]]),s=this.gm.mapAdapter.project([e[2],e[1]]),o=this.gm.mapAdapter.project([e[0],e[1]]);return{leftTop:r,rightTop:i,rightBottom:s,leftBottom:o}}getLinesIntersection(e,r){const[i,s]=e[0],[o,a]=e[1],[u,l]=r[0],[c,h]=r[1],d=(i-o)*(l-h)-(s-a)*(u-c);return d===0?null:[((i*a-s*o)*(u-c)-(i-o)*(u*h-l*c))/d,((i*a-s*o)*(l-h)-(s-a)*(u*h-l*c))/d]}}const xy={dom:`<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21">
    <circle cx="10.5" cy="10.5" r="9.213" fill="#fff" stroke="#278cda" stroke-width="2.303"/>
</svg>
`},gc=(t,n=void 0)=>{const e=document.createElement("div");e.classList.add("marker-wrapper"),e.style.lineHeight="0",e.innerHTML=xy[t];const r=e.firstChild;return n&&Object.assign(r.style,n),e};function Sy(t,n={}){var e,r,i,s=n.properties,o=(e=n.autoComplete)!=null?e:!0,a=(r=n.orderCoords)!=null?r:!0,u=(i=n.mutate)!=null?i:!1;switch(u||(t=si(t)),t.type){case"FeatureCollection":var l=[];return t.features.forEach(function(c){l.push(Ue(mc(c,{},o,a)))}),ta(l,s);default:return mc(t,s,o,a)}}function mc(t,n,e,r){n=n||(t.type==="Feature"?t.properties:{});var i=Yn(t),s=i.coordinates,o=i.type;if(!s.length)throw new Error("line must contain coordinates");switch(o){case"LineString":return e&&(s=vc(s)),Xt([s],n);case"MultiLineString":var a=[],u=0;return s.forEach(function(l){if(e&&(l=vc(l)),r){var c=Ay(yt(qn(l)));c>u?(a.unshift(l),u=c):a.push(l)}else a.push(l)}),Xt(a,n);default:throw new Error("geometry type "+o+" is not supported")}}function vc(t){var n=t[0],e=n[0],r=n[1],i=t[t.length-1],s=i[0],o=i[1];return(e!==s||r!==o)&&t.push(n),t}function Ay(t){var n=t[0],e=t[1],r=t[2],i=t[3];return Math.abs(n-r)*Math.abs(e-i)}var xo=Sy;class So extends bt{constructor(e,r={snappingMarkers:"none",targetShape:"line"}){super(e);w(this,"mode","line");w(this,"snappingKey","line_drawer");w(this,"drawOptions");w(this,"shapeLngLats",[]);w(this,"throttledMethods",Fn({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay));w(this,"mapEventHandlers",{[`${Y}:helper`]:this.handleGmHelperEvent.bind(this),click:this.onMouseClick.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this)});w(this,"drawerEventHandlers",{firstMarkerClick:null,lastMarkerClick:null,nMarkerClick:null});this.drawOptions=r}get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return e instanceof pc?e:null}get autoTraceEnabled(){var e;return((e=this.gm.options.controls.helper.auto_trace)==null?void 0:e.active)||!1}get autoTraceHelperInstance(){return this.autoTraceEnabled&&Object.values(this.gm.actionInstances).find(e=>e instanceof un&&e.mode==="auto_trace")||null}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){var e;this.gm.markerPointer.disable(),this.endShape(),(e=this.snapGuidesInstance)==null||e.removeSnapGuides()}handleGmHelperEvent(e){return ti(e)?(e.mode==="snap_guides"&&e.action==="mode_start"&&this.updateSnapGuides(),{next:!0}):(B.error("LineDrawer.handleGmHelperEvent: invalid event",e),{next:!0})}updateSnapGuides(){var e;if(this.snapGuidesInstance){const r=(e=this.featureData)==null?void 0:e.getGeoJson();r&&r.geometry.coordinates.pop(),this.snapGuidesInstance.updateSnapGuides(r||null,this.shapeLngLats.at(-1)||null,!0)}}on(e,r){this.drawerEventHandlers[e]=r}onMouseClick(e){var i;if(!pe(e,{warning:!0}))return{next:!0};const r=((i=this.gm.markerPointer.marker)==null?void 0:i.getLngLat())||e.lngLat.toArray();if(this.featureData){const s=this.getClickedMarkerInfo(e);this.handleNextVertex(r,s)}else this.isFeatureAllowed(hm(r))&&this.startShape(r);return this.updateSnapGuides(),{next:!0}}handleNextVertex(e,r){var o,a,u,l,c,h;if(!this.featureData){B.error("LineDrawer.handleNextVertex: no featureData");return}const i=this.featureData.markers.size,s=this.getMarkerClickEventData(r.index);r.index<i-1&&this.addPoint(e,r),r.index!==-1&&(r.index===0?(a=(o=this.drawerEventHandlers).firstMarkerClick)==null||a.call(o,s):r.index>0&&r.index===i-1&&((l=(u=this.drawerEventHandlers).lastMarkerClick)==null||l.call(u,s)),r.index>=0&&((h=(c=this.drawerEventHandlers).nMarkerClick)==null||h.call(c,s)))}getMarkerClickEventData(e){const r=this.getFeatureGeoJson({withControlMarker:!1});return{markerIndex:e,shapeCoordinates:this.getShapeCoordinates({withControlMarker:!1}),geoJson:r,bounds:Ss(r)}}onMouseMove(e){return pe(e,{warning:!0})?(this.featureData&&this.shapeLngLats.length&&this.updateFeatureSource(),{next:!0}):{next:!0}}startShape(e){this.shapeLngLats=[e],this.featureData=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson({withControlMarker:!0}),sourceName:O.temporary});const r={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",0]}};this.featureData&&(this.featureData.markers.set(r.position.path.join("."),r),this.setSnapping(),this.fireStartEvent(this.featureData,r)),this.gm.mapAdapter.disableMapInteractions(["doubleClickZoom"])}endShape(){this.removeSnapping(),this.removeTmpFeature(),this.shapeLngLats=[],this.gm.mapAdapter.enableMapInteractions(["doubleClickZoom"]),this.fireStopEvent()}setSnapping(){if(!this.snappingHelper)return;const e=this.drawOptions.snappingMarkers;e==="none"?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[]):e==="all"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,this.shapeLngLats):e==="first"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[0]]):e==="last"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[this.shapeLngLats.length-1]]):B.error("LineDrawer.setSnapping: invalid data",e,this.shapeLngLats)}removeSnapping(){this.snappingHelper&&this.snappingHelper.clearCustomSnappingCoordinates(this.snappingKey)}getClickedMarkerInfo(e){if(!this.featureData)return{index:-1,path:null};let r=0,i=null;try{this.featureData.markers.forEach((s,o)=>{if(s.instance instanceof Gr){const a=s.instance.getElement()||null,u=e.originalEvent.target,l=u instanceof Element?u:null;if(a&&a.contains(l))throw i=o,new Error("stop")}r+=1})}catch{if(i)return{index:r,path:i}}return{index:-1,path:null}}addPoint(e,r){const i=this.featureData;if(!i){B.error("LineDrawer.addPoint: no featureData");return}const s=this.getAddedLngLats(e,r),o=this.getFeatureGeoJsonWithType({withControlMarker:!0,coordinates:this.shapeLngLats.concat(s)});this.isFeatureAllowed(o)&&(s.forEach(a=>{this.shapeLngLats.push(a);const u=this.addMarker(a,i);this.fireUpdateEvent(i,u)}),this.updateFeatureSource())}isFeatureAllowed(e){return this.gm.getActiveDrawModes().length?(this.fireBeforeFeatureCreate({geoJsonFeatures:[e]}),this.flags.featureCreateAllowed):!0}getAddedLngLats(e,r){if(!this.featureData)return B.error("LineDrawer.getCurrentLngLats: no featureData"),[];const s=this.getMarkerInfoLngLat(r)||e,o=this.getAutoTracePath(s);return[...(o==null?void 0:o.slice(1,-1))||[],s]}getAutoTracePath(e){const r=this.shapeLngLats.at(-1);return this.autoTraceEnabled&&this.autoTraceHelperInstance&&r&&this.autoTraceHelperInstance.getShortestPath(r,e)||null}getMarkerInfoLngLat(e){if(this.featureData&&e.path){const r=this.featureData.markers.get(e.path);if(r&&r.type==="dom")return r.instance.getLngLat();B.error("LineDrawer.addPoint: no markerData",e)}return null}addMarker(e,r){const i={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",this.shapeLngLats.length]}};return r.markers.set(i.position.path.join("."),{type:"dom",instance:i.instance,position:{coordinate:e,path:[]}}),i}createMarker(e){return this.gm.mapAdapter.createDomMarker({element:gc("dom",{pointerEvents:"auto",cursor:"pointer"}),anchor:"center"},e)}updateFeatureSource(){if(this.featureData&&(this.featureData.updateGeoJsonGeometry(this.getFeatureGeoJson({withControlMarker:!0}).geometry),this.gm.markerPointer.marker)){const e={type:"dom",instance:this.gm.markerPointer.marker,position:{coordinate:this.gm.markerPointer.marker.getLngLat(),path:["geometry","coordinates",this.shapeLngLats.length]}};this.fireUpdateEvent(this.featureData,e)}}getFeatureGeoJson({withControlMarker:e,coordinates:r=void 0}){return{type:"Feature",properties:{shape:"line"},geometry:{type:"LineString",coordinates:r||this.getShapeCoordinates({withControlMarker:e})}}}getFeatureGeoJsonWithType({withControlMarker:e,coordinates:r=void 0}){const i=this.getFeatureGeoJson({withControlMarker:e,coordinates:r});return this.drawOptions.targetShape==="polygon"&&i.geometry.coordinates.length>3?xo(i,{properties:i.properties}):i}getShapeCoordinates({withControlMarker:e}){const r=[...this.shapeLngLats];return e&&this.gm.markerPointer.marker&&r.push(this.gm.markerPointer.marker.getLngLat()),r}fireStartEvent(e,r){this.gm.events.fire(`${Y}:draw`,{level:"system",type:"draw",mode:"line",variant:"line_drawer",action:"start",featureData:e,markerData:r})}fireUpdateEvent(e,r){this.gm.events.fire(`${Y}:draw`,{level:"system",type:"draw",mode:"line",variant:"line_drawer",action:"update",featureData:e,markerData:r})}fireStopEvent(){this.gm.events.fire(`${Y}:draw`,{level:"system",type:"draw",mode:"line",action:"finish",variant:"line_drawer"})}}class Ly extends bt{constructor(){super(...arguments);w(this,"mode","line");w(this,"shape","line");w(this,"lineDrawer",new So(this.gm,{snappingMarkers:"first",targetShape:"line"}));w(this,"mapEventHandlers",{[`${Y}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("nMarkerClick",this.lineFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return pe(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}lineFinished(e){this.lineDrawer.endShape();let r=e.shapeCoordinates;return e.markerIndex>0&&(r=r.slice(0,e.markerIndex+1)),r.length<2?null:this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(r),sourceName:O.main})}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"LineString",coordinates:e}}}}class Cy extends bt{constructor(){super(...arguments);w(this,"mode","marker");w(this,"shape","marker");w(this,"mapEventHandlers",{click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){const e=this.createMarker();this.gm.markerPointer.enable({customMarker:e}),this.fireMarkerPointerStartEvent()}onEndAction(){this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseClick(e){return pe(e)&&(this.featureData=this.createFeature(e),this.featureData&&this.saveFeature()),{next:!1}}onMouseMove(e){return!pe(e)||!this.gm.markerPointer.marker?{next:!0}:(this.fireMarkerPointerUpdateEvent(),{next:!0})}createMarker(){const e=document.createElement("div");return e.style.backgroundImage=`url("${jt}")`,e.style.width="36px",e.style.height="36px",e.style.backgroundSize="cover",e.style.pointerEvents="none",this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"bottom",element:e},[0,0])}createFeature(e){var s;const r=((s=this.gm.markerPointer.marker)==null?void 0:s.getLngLat())||e.lngLat.toArray(),i=this.getFeatureGeoJson(r);return i&&(this.fireBeforeFeatureCreate({geoJsonFeatures:[i]}),this.flags.featureCreateAllowed)?this.gm.features.createFeature({shapeGeoJson:i,sourceName:O.temporary}):null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}}function ky(t){var n={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return Nt(t,e=>{var r;switch((r=e.geometry)==null?void 0:r.type){case"Point":n.MultiPoint.coordinates.push(e.geometry.coordinates),n.MultiPoint.properties.push(e.properties);break;case"MultiPoint":n.MultiPoint.coordinates.push(...e.geometry.coordinates),n.MultiPoint.properties.push(e.properties);break;case"LineString":n.MultiLineString.coordinates.push(e.geometry.coordinates),n.MultiLineString.properties.push(e.properties);break;case"MultiLineString":n.MultiLineString.coordinates.push(...e.geometry.coordinates),n.MultiLineString.properties.push(e.properties);break;case"Polygon":n.MultiPolygon.coordinates.push(e.geometry.coordinates),n.MultiPolygon.properties.push(e.properties);break;case"MultiPolygon":n.MultiPolygon.coordinates.push(...e.geometry.coordinates),n.MultiPolygon.properties.push(e.properties);break}}),Ee(Object.keys(n).filter(function(e){return n[e].coordinates.length}).sort().map(function(e){var r={type:e,coordinates:n[e].coordinates},i={collectedProperties:n[e].properties};return at(r,i)}))}var Ty=ky;function Py(t,n,e,r,i){yc(t,n,e||0,r||t.length-1,i||Iy)}function yc(t,n,e,r,i){for(;r>e;){if(r-e>600){var s=r-e+1,o=n-e+1,a=Math.log(s),u=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*u*(s-u)/s)*(o-s/2<0?-1:1),c=Math.max(e,Math.floor(n-o*u/s+l)),h=Math.min(r,Math.floor(n+(s-o)*u/s+l));yc(t,n,c,h,i)}var d=t[n],v=e,M=r;for(_r(t,e,n),i(t[r],d)>0&&_r(t,e,r);v<M;){for(_r(t,v,M),v++,M--;i(t[v],d)<0;)v++;for(;i(t[M],d)>0;)M--}i(t[e],d)===0?_r(t,e,M):(M++,_r(t,M,r)),M<=n&&(e=M+1),n<=M&&(r=M-1)}}function _r(t,n,e){var r=t[n];t[n]=t[e],t[e]=r}function Iy(t,n){return t<n?-1:t>n?1:0}class je{constructor(n=9){this._maxEntries=Math.max(4,n),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(n){let e=this.data;const r=[];if(!Oi(n,e))return r;const i=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],u=e.leaf?i(a):a;Oi(n,u)&&(e.leaf?r.push(a):Lo(n,u)?this._all(a,r):s.push(a))}e=s.pop()}return r}collides(n){let e=this.data;if(!Oi(n,e))return!1;const r=[];for(;e;){for(let i=0;i<e.children.length;i++){const s=e.children[i],o=e.leaf?this.toBBox(s):s;if(Oi(n,o)){if(e.leaf||Lo(n,o))return!0;r.push(s)}}e=r.pop()}return!1}load(n){if(!(n&&n.length))return this;if(n.length<this._minEntries){for(let r=0;r<n.length;r++)this.insert(n[r]);return this}let e=this._build(n.slice(),0,n.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(n){return n&&this._insert(n,this.data.height-1),this}clear(){return this.data=Gn([]),this}remove(n,e){if(!n)return this;let r=this.data;const i=this.toBBox(n),s=[],o=[];let a,u,l;for(;r||s.length;){if(r||(r=s.pop(),u=s[s.length-1],a=o.pop(),l=!0),r.leaf){const c=Fy(n,r.children,e);if(c!==-1)return r.children.splice(c,1),s.push(r),this._condense(s),this}!l&&!r.leaf&&Lo(r,i)?(s.push(r),o.push(a),a=0,u=r,r=r.children[0]):u?(a++,r=u.children[a],l=!1):r=null}return this}toBBox(n){return n}compareMinX(n,e){return n.minX-e.minX}compareMinY(n,e){return n.minY-e.minY}toJSON(){return this.data}fromJSON(n){return this.data=n,this}_all(n,e){const r=[];for(;n;)n.leaf?e.push(...n.children):r.push(...n.children),n=r.pop();return e}_build(n,e,r,i){const s=r-e+1;let o=this._maxEntries,a;if(s<=o)return a=Gn(n.slice(e,r+1)),On(a,this.toBBox),a;i||(i=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,i-1))),a=Gn([]),a.leaf=!1,a.height=i;const u=Math.ceil(s/o),l=u*Math.ceil(Math.sqrt(o));wc(n,e,r,l,this.compareMinX);for(let c=e;c<=r;c+=l){const h=Math.min(c+l-1,r);wc(n,c,h,u,this.compareMinY);for(let d=c;d<=h;d+=u){const v=Math.min(d+u-1,h);a.children.push(this._build(n,d,v,i-1))}}return On(a,this.toBBox),a}_chooseSubtree(n,e,r,i){for(;i.push(e),!(e.leaf||i.length-1===r);){let s=1/0,o=1/0,a;for(let u=0;u<e.children.length;u++){const l=e.children[u],c=Ao(l),h=Gy(n,l)-c;h<o?(o=h,s=c<s?c:s,a=l):h===o&&c<s&&(s=c,a=l)}e=a||e.children[0]}return e}_insert(n,e,r){const i=r?n:this.toBBox(n),s=[],o=this._chooseSubtree(i,this.data,e,s);for(o.children.push(n),Sr(o,i);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(i,s,e)}_split(n,e){const r=n[e],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);const o=this._chooseSplitIndex(r,s,i),a=Gn(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,On(r,this.toBBox),On(a,this.toBBox),e?n[e-1].children.push(a):this._splitRoot(r,a)}_splitRoot(n,e){this.data=Gn([n,e]),this.data.height=n.height+1,this.data.leaf=!1,On(this.data,this.toBBox)}_chooseSplitIndex(n,e,r){let i,s=1/0,o=1/0;for(let a=e;a<=r-e;a++){const u=xr(n,0,a,this.toBBox),l=xr(n,a,r,this.toBBox),c=Ry(u,l),h=Ao(u)+Ao(l);c<s?(s=c,i=a,o=h<o?h:o):c===s&&h<o&&(o=h,i=a)}return i||r-e}_chooseSplitAxis(n,e,r){const i=n.leaf?this.compareMinX:Dy,s=n.leaf?this.compareMinY:Oy,o=this._allDistMargin(n,e,r,i),a=this._allDistMargin(n,e,r,s);o<a&&n.children.sort(i)}_allDistMargin(n,e,r,i){n.children.sort(i);const s=this.toBBox,o=xr(n,0,e,s),a=xr(n,r-e,r,s);let u=Di(o)+Di(a);for(let l=e;l<r-e;l++){const c=n.children[l];Sr(o,n.leaf?s(c):c),u+=Di(o)}for(let l=r-e-1;l>=e;l--){const c=n.children[l];Sr(a,n.leaf?s(c):c),u+=Di(a)}return u}_adjustParentBBoxes(n,e,r){for(let i=r;i>=0;i--)Sr(e[i],n)}_condense(n){for(let e=n.length-1,r;e>=0;e--)n[e].children.length===0?e>0?(r=n[e-1].children,r.splice(r.indexOf(n[e]),1)):this.clear():On(n[e],this.toBBox)}}function Fy(t,n,e){if(!e)return n.indexOf(t);for(let r=0;r<n.length;r++)if(e(t,n[r]))return r;return-1}function On(t,n){xr(t,0,t.children.length,n,t)}function xr(t,n,e,r,i){i||(i=Gn(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=n;s<e;s++){const o=t.children[s];Sr(i,t.leaf?r(o):o)}return i}function Sr(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function Dy(t,n){return t.minX-n.minX}function Oy(t,n){return t.minY-n.minY}function Ao(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Di(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Gy(t,n){return(Math.max(n.maxX,t.maxX)-Math.min(n.minX,t.minX))*(Math.max(n.maxY,t.maxY)-Math.min(n.minY,t.minY))}function Ry(t,n){const e=Math.max(t.minX,n.minX),r=Math.max(t.minY,n.minY),i=Math.min(t.maxX,n.maxX),s=Math.min(t.maxY,n.maxY);return Math.max(0,i-e)*Math.max(0,s-r)}function Lo(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function Oi(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function Gn(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wc(t,n,e,r,i){const s=[n,e];for(;s.length;){if(e=s.pop(),n=s.pop(),e-n<=r)continue;const o=n+Math.ceil((e-n)/r/2)*r;Py(t,o,n,e,i),s.push(n,o,o,e)}}function By(t){return Cf(t,(n,e)=>n+Ny(e),0)}function Ny(t){let n=0,e;switch(t.type){case"Polygon":return Ec(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=Ec(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function Ec(t){let n=0;if(t&&t.length>0){n+=Math.abs(Mc(t[0]));for(let e=1;e<t.length;e++)n-=Math.abs(Mc(t[e]))}return n}var Uy=we*we/2,Co=Math.PI/180;function Mc(t){const n=t.length-1;if(n<=2)return 0;let e=0,r=0;for(;r<n;){const i=t[r],s=t[r+1===n?0:r+1],o=t[r+2>=n?(r+2)%n:r+2],a=i[0]*Co,u=s[1]*Co,l=o[0]*Co;e+=(l-a)*Math.sin(u),r++}return e*Uy}function Hy(t,n,e){if(t.geometry.type!=="Polygon")throw new Error("The input feature must be a Polygon");e===void 0&&(e=1);var r=t.geometry.coordinates,i=[],s={};if(e){for(var o=[],a=0;a<r.length;a++)for(var u=0;u<r[a].length-1;u++)o.push(P(a,u));var l=new je;l.load(o)}for(var c=0;c<r.length;c++)for(var h=0;h<r[c].length-1;h++)if(e){var d=l.search(P(c,h));d.forEach(function(C){var g=C.ring,D=C.edge;A(c,h,g,D)})}else for(var v=0;v<r.length;v++)for(var M=0;M<r[v].length-1;M++)A(c,h,v,M);return n||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function A(C,g,D,F){var G=r[C][g],N=r[C][g+1],H=r[D][F],f=r[D][F+1],p=zy(G,N,H,f);if(p!==null){var m,y;if(N[0]!==G[0]?m=(p[0]-G[0])/(N[0]-G[0]):m=(p[1]-G[1])/(N[1]-G[1]),f[0]!==H[0]?y=(p[0]-H[0])/(f[0]-H[0]):y=(p[1]-H[1])/(f[1]-H[1]),!(m>=1||m<=0||y>=1||y<=0)){var E=p,S=!s[E];S&&(s[E]=!0),n?i.push(n(p,C,g,G,N,m,D,F,H,f,y,S)):i.push(p)}}}function P(C,g){var D=r[C][g],F=r[C][g+1],G,N,H,f;return D[0]<F[0]?(G=D[0],N=F[0]):(G=F[0],N=D[0]),D[1]<F[1]?(H=D[1],f=F[1]):(H=F[1],f=D[1]),{minX:G,minY:H,maxX:N,maxY:f,ring:C,edge:g}}}function zy(t,n,e,r){if(Ar(t,e)||Ar(t,r)||Ar(n,e)||Ar(r,e))return null;var i=t[0],s=t[1],o=n[0],a=n[1],u=e[0],l=e[1],c=r[0],h=r[1],d=(i-o)*(l-h)-(s-a)*(u-c);if(d===0)return null;var v=((i*a-s*o)*(u-c)-(i-o)*(u*h-l*c))/d,M=((i*a-s*o)*(l-h)-(s-a)*(u*h-l*c))/d;return[v,M]}function Ar(t,n){if(!t||!n||t.length!==n.length)return!1;for(var e=0,r=t.length;e<r;e++)if(t[e]instanceof Array&&n[e]instanceof Array){if(!Ar(t[e],n[e]))return!1}else if(t[e]!==n[e])return!1;return!0}function Jy(t){if(t.type!="Feature")throw new Error("The input must a geojson object of type Feature");if(t.geometry===void 0||t.geometry==null)throw new Error("The input must a geojson object with a non-empty geometry");if(t.geometry.type!="Polygon")throw new Error("The input must be a geojson Polygon");for(var n=t.geometry.coordinates.length,e=[],g=0;g<n;g++){var r=t.geometry.coordinates[g];Lr(r[0],r[r.length-1])||r.push(r[0]);for(var i=0;i<r.length-1;i++)e.push(r[i])}if(!Vy(e))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var s=e.length,o=Hy(t,function(X,z,Z,re,Ft,Dt,$t,Fe,Be,ve,ue,se){return[X,z,Z,re,Ft,Dt,$t,Fe,Be,ve,ue,se]}),a=o.length;if(a==0){for(var H=[],g=0;g<n;g++)H.push(Xt([t.geometry.coordinates[g]],{parent:-1,winding:qy(t.geometry.coordinates[g])}));var I=Ee(H);return J(),U(),I}for(var u=[],l=[],g=0;g<n;g++){u.push([]);for(var i=0;i<t.geometry.coordinates[g].length-1;i++)u[g].push([new bc(t.geometry.coordinates[g][Rn(i+1,t.geometry.coordinates[g].length-1)],1,[g,i],[g,Rn(i+1,t.geometry.coordinates[g].length-1)],void 0)]),l.push(new _c(t.geometry.coordinates[g][i],[g,Rn(i-1,t.geometry.coordinates[g].length-1)],[g,i],void 0,void 0,!1,!0))}for(var g=0;g<a;g++)u[o[g][1]][o[g][2]].push(new bc(o[g][0],o[g][5],[o[g][1],o[g][2]],[o[g][6],o[g][7]],void 0)),o[g][11]&&l.push(new _c(o[g][0],[o[g][1],o[g][2]],[o[g][6],o[g][7]],void 0,void 0,!0,!0));for(var c=l.length,g=0;g<u.length;g++)for(var i=0;i<u[g].length;i++)u[g][i].sort(function(z,Z){return z.param<Z.param?-1:1});for(var h=[],g=0;g<c;g++)h.push({minX:l[g].coord[0],minY:l[g].coord[1],maxX:l[g].coord[0],maxY:l[g].coord[1],index:g});var d=new je;d.load(h);for(var g=0;g<u.length;g++)for(var i=0;i<u[g].length;i++)for(var v=0;v<u[g][i].length;v++){var M;v==u[g][i].length-1?M=u[g][Rn(i+1,t.geometry.coordinates[g].length-1)][0].coord:M=u[g][i][v+1].coord;var A=d.search({minX:M[0],minY:M[1],maxX:M[0],maxY:M[1]})[0];u[g][i][v].nxtIsectAlongEdgeIn=A.index}for(var g=0;g<u.length;g++)for(var i=0;i<u[g].length;i++)for(var v=0;v<u[g][i].length;v++){var M=u[g][i][v].coord,A=d.search({minX:M[0],minY:M[1],maxX:M[0],maxY:M[1]})[0],P=A.index;P<s?l[P].nxtIsectAlongRingAndEdge2=u[g][i][v].nxtIsectAlongEdgeIn:Lr(l[P].ringAndEdge1,u[g][i][v].ringAndEdgeIn)?l[P].nxtIsectAlongRingAndEdge1=u[g][i][v].nxtIsectAlongEdgeIn:l[P].nxtIsectAlongRingAndEdge2=u[g][i][v].nxtIsectAlongEdgeIn}for(var C=[],g=0,i=0;i<n;i++){for(var D=g,v=0;v<t.geometry.coordinates[i].length-1;v++)l[g].coord[0]<l[D].coord[0]&&(D=g),g++;for(var F=l[D].nxtIsectAlongRingAndEdge2,v=0;v<l.length;v++)if(l[v].nxtIsectAlongRingAndEdge1==D||l[v].nxtIsectAlongRingAndEdge2==D){var G=v;break}var N=Gi([l[G].coord,l[D].coord,l[F].coord],!0)?1:-1;C.push({isect:D,parent:-1,winding:N})}C.sort(function(V,X){return l[V.isect].coord>l[X.isect].coord?-1:1});for(var H=[];C.length>0;){var f=C.pop(),p=f.isect,m=f.parent,y=f.winding,E=H.length,S=[l[p].coord],k=p;if(l[p].ringAndEdge1Walkable)var b=l[p].ringAndEdge1,_=l[p].nxtIsectAlongRingAndEdge1;else var b=l[p].ringAndEdge2,_=l[p].nxtIsectAlongRingAndEdge2;for(;!Lr(l[p].coord,l[_].coord);){S.push(l[_].coord);for(var T=void 0,g=0;g<C.length;g++)if(C[g].isect==_){T=g;break}if(T!=null&&C.splice(T,1),Lr(b,l[_].ringAndEdge1)){if(b=l[_].ringAndEdge2,l[_].ringAndEdge2Walkable=!1,l[_].ringAndEdge1Walkable){var L={isect:_};Gi([l[k].coord,l[_].coord,l[l[_].nxtIsectAlongRingAndEdge2].coord],y==1)?(L.parent=m,L.winding=-y):(L.parent=E,L.winding=y),C.push(L)}k=_,_=l[_].nxtIsectAlongRingAndEdge2}else{if(b=l[_].ringAndEdge1,l[_].ringAndEdge1Walkable=!1,l[_].ringAndEdge2Walkable){var L={isect:_};Gi([l[k].coord,l[_].coord,l[l[_].nxtIsectAlongRingAndEdge1].coord],y==1)?(L.parent=m,L.winding=-y):(L.parent=E,L.winding=y),C.push(L)}k=_,_=l[_].nxtIsectAlongRingAndEdge1}}S.push(l[_].coord),H.push(Xt([S],{index:E,parent:m,winding:y,netWinding:void 0}))}var I=Ee(H);J(),U();function J(){for(var V=[],X=0;X<I.features.length;X++)I.features[X].properties.parent==-1&&V.push(X);if(V.length>1)for(var X=0;X<V.length;X++){for(var z=-1,Z=1/0,re=0;re<I.features.length;re++)V[X]!=re&&rn(I.features[V[X]].geometry.coordinates[0][0],I.features[re],{ignoreBoundary:!0})&&By(I.features[re])<Z&&(z=re);I.features[V[X]].properties.parent=z}}function U(){for(var V=0;V<I.features.length;V++)if(I.features[V].properties.parent==-1){var X=I.features[V].properties.winding;I.features[V].properties.netWinding=X,K(V,X)}}function K(V,X){for(var z=0;z<I.features.length;z++)if(I.features[z].properties.parent==V){var Z=X+I.features[z].properties.winding;I.features[z].properties.netWinding=Z,K(z,Z)}}return I}var bc=function(t,n,e,r,i){this.coord=t,this.param=n,this.ringAndEdgeIn=e,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=i},_c=function(t,n,e,r,i,s,o){this.coord=t,this.ringAndEdge1=n,this.ringAndEdge2=e,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=s,this.ringAndEdge2Walkable=o};function Gi(t,n){if(typeof n>"u"&&(n=!0),t.length!=3)throw new Error("This function requires an array of three points [x,y]");var e=(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0]);return e>=0==n}function qy(t){for(var n=0,e=0;e<t.length-1;e++)t[e][0]<t[n][0]&&(n=e);if(Gi([t[Rn(n-1,t.length-1)],t[n],t[Rn(n+1,t.length-1)]],!0))var r=1;else var r=-1;return r}function Lr(t,n){if(!t||!n||t.length!=n.length)return!1;for(var e=0,r=t.length;e<r;e++)if(t[e]instanceof Array&&n[e]instanceof Array){if(!Lr(t[e],n[e]))return!1}else if(t[e]!=n[e])return!1;return!0}function Rn(t,n){return(t%n+n)%n}function Vy(t){for(var n={},e=1,r=0,i=t.length;r<i;++r){if(Object.prototype.hasOwnProperty.call(n,t[r])){e=0;break}n[t[r]]=1}return e}function Yy(t){var n=[];return Ut(t,function(e){e.geometry.type==="Polygon"&&Nt(Jy(e),function(r){n.push(Xt(r.geometry.coordinates,e.properties))})}),Ee(n)}var Wy=Yy;class $y extends bt{constructor(){super(...arguments);w(this,"mode","polygon");w(this,"shape","polygon");w(this,"lineDrawer",new So(this.gm,{snappingMarkers:"first",targetShape:"polygon"}));w(this,"mapEventHandlers",{[`${Y}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onEndAction(){this.lineDrawer.endAction()}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.polygonFinished.bind(this))}onMouseMove(e){return pe(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}polygonFinished(e){if(this.lineDrawer.endShape(),e.shapeCoordinates.length<3)return;const r=this.fixShapeGeoJson(xo(e.geoJson));r&&this.gm.features.createFeature({shapeGeoJson:{...r,properties:{...r.properties,shape:this.shape}},sourceName:O.main})}fixShapeGeoJson(e){try{return Jl(Ty(Wy(e))).features[0]}catch{return null}}}class jy extends bt{constructor(){super(...arguments);w(this,"mode","rectangle");w(this,"shape","rectangle");w(this,"startLngLat",null);w(this,"mapEventHandlers",{mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)});w(this,"throttledMethods",Fn({updateFeaturePosition:this.updateFeaturePosition},this,this.gm.options.settings.throttlingDelay))}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.startLngLat=null,this.gm.markerPointer.disable(),this.fireFinishEvent()}onMouseClick(e){var i;if(!pe(e,{warning:!0}))return{next:!1};const r=((i=this.gm.markerPointer.marker)==null?void 0:i.getLngLat())||e.lngLat.toArray();if(this.startLngLat){const s=this.getFeatureGeoJson(En(this.startLngLat,r));this.fireBeforeFeatureCreate({geoJsonFeatures:[s]}),this.flags.featureCreateAllowed&&this.finishShape(r)}else{const s=this.getFeatureGeoJson(En(r,r));if(this.fireBeforeFeatureCreate({geoJsonFeatures:[s]}),this.flags.featureCreateAllowed){const o=this.startShape(r);if(o){const a=this.getControlMarkerData(["geometry","coordinates",4]);this.fireStartEvent(o,a)}}}return{next:!1}}onMouseMove(e){var o;if(!pe(e,{warning:!0}))return{next:!1};if(!this.startLngLat)return this.fireMarkerPointerUpdateEvent(),{next:!1};const r=((o=this.gm.markerPointer.marker)==null?void 0:o.getLngLat())||e.lngLat.toArray(),i=En(this.startLngLat,r),s=this.getFeatureGeoJson(i);return this.fireBeforeFeatureCreate({geoJsonFeatures:[s]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeaturePosition(i),{next:!1}}startShape(e){this.startLngLat=e;const r=En(this.startLngLat,this.startLngLat);return this.featureData=this.createFeature(r),this.featureData}finishShape(e){if(this.startLngLat){const r=En(this.startLngLat,e);this.throttledMethods.updateFeaturePosition(r)}this.featureData&&(this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()),this.startLngLat=null,this.fireFinishEvent()}createFeature(e){return this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:O.temporary})}isFeatureGeoJsonValid(){return this.featureData?Sl(this.featureData.getGeoJson()):!1}getFeatureGeoJson(e){return{...xs([e[0],e[2]],[e[2],e[3]]),properties:{shape:this.shape}}}updateFeaturePosition(e){if(!this.featureData)return;const r=xs([e[0],e[1]],[e[2],e[3]]);this.featureData.updateGeoJsonGeometry(r.geometry);const i=this.getControlMarkerData(["geometry","coordinates",4]);this.fireUpdateEvent(this.featureData,i)}getControlMarkerData(e){const r=this.gm.markerPointer.marker;return r?{type:"dom",instance:r,position:{coordinate:r.getLngLat(),path:e}}:null}fireStartEvent(e,r){const i={level:"system",type:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:r};this.gm.events.fire(`${Y}:draw`,i)}fireUpdateEvent(e,r){const i={level:"system",type:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:r};this.gm.events.fire(`${Y}:draw`,i)}fireFinishEvent(){const e={level:"system",type:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${Y}:draw`,e)}}class Zy extends bt{constructor(){super(...arguments);w(this,"mode","text_marker");w(this,"shape","text_marker");w(this,"textarea",null);w(this,"mapEventHandlers",{click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0})}onEndAction(){this.removeTextarea(),this.removeTmpFeature(),this.featureData=null,this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseMove(e){return pe(e,{warning:!0})?(this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}onMouseClick(e){var r;if(!pe(e,{warning:!0}))return{next:!0};if(this.textarea)this.endShape(),this.gm.markerPointer.enable({invisibleMarker:!0,lngLat:e.lngLat.toArray()}),this.fireMarkerPointerUpdateEvent();else{const i=((r=this.gm.markerPointer.marker)==null?void 0:r.getLngLat())||e.lngLat.toArray();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(i)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(i),this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent())}return{next:!1}}createFeature(e){const r=this.gm.mapAdapter.project(e);return this.createTextarea(r),this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:O.temporary})}endShape(){var r;const e=((r=this.textarea)==null?void 0:r.value)||"";this.removeTextarea(),e.trim()?(this.updateFeatureSource(e),this.saveFeature()):this.removeTmpFeature()}createTextarea(e){this.textarea=document.createElement("textarea"),this.textarea.style.position="absolute",this.textarea.style.left=`${e[0]}px`,this.textarea.style.top=`${e[1]}px`,this.textarea.style.opacity="0.7",this.gm.mapAdapter.getContainer().appendChild(this.textarea),this.textarea.focus()}removeTextarea(){var e;(e=this.textarea)==null||e.remove(),this.textarea=null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape,text:""},geometry:{type:"Point",coordinates:e}}}updateFeatureSource(e){this.featureData&&this.featureData.updateGeoJsonProperties({shape:this.shape,text:e})}}const ko={marker:Cy,circle:hy,circle_marker:uy,text_marker:Zy,line:Ly,rectangle:jy,polygon:$y,freehand:null,custom_shape:null},Xy=(t,n)=>ko[n]?new ko[n](t):(B.error(`Draw "${n}" is not available`),null);class Ky extends ei{constructor(e,r){super(e);w(this,"mapEventHandlers",{[`${Y}:draw`]:this.handleDrawEvent.bind(this)});r.attachEvents(this.mapEventHandlers)}handleDrawEvent(e){if(!ks(e))return{next:!0};const r=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(r,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(r)),{next:!0}}start(e,r){const i=Xy(this.gm,r.mode);i&&(e in this.gm.actionInstances&&B.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=i,i.startAction())}end(e){const r=this.gm.actionInstances[e];r instanceof bt?(r.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for draw event "${e}":`,r)}}class To extends br{constructor(){super(...arguments);w(this,"mode","drag");w(this,"isDragging",!1);w(this,"previousLngLat",null);w(this,"pointBasedShapes",["marker","circle_marker","text_marker"]);w(this,"throttledMethods",Fn({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay));w(this,"mapEventHandlers",{[`${Y}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this),touchmove:this.throttledMethods.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this)});w(this,"getUpdatedGeoJsonHandlers",{marker:this.moveSource.bind(this),circle:this.moveCircle.bind(this),circle_marker:this.moveSource.bind(this),text_marker:this.moveSource.bind(this),line:this.moveSource.bind(this),rectangle:this.moveSource.bind(this),polygon:this.moveSource.bind(this)})}onMouseDown(e){var r;return this.featureData=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[O.main]}),this.featureData&&this.getUpdatedGeoJsonHandlers[this.featureData.shape]?(this.featureData.changeSource({sourceName:O.temporary,atomic:!0}),this.gm.mapAdapter.setDragPan(!1),this.isDragging=!0,(r=this.snappingHelper)==null||r.addExcludedFeature(this.featureData),this.isPointBasedShape()&&this.alignShapeCenterWithControlMarker(this.featureData,e),this.fireFeatureEditStartEvent({feature:this.featureData,forceMode:"drag"}),{next:!1}):{next:!0}}onMouseUp(){var e;return this.featureData?((e=this.snappingHelper)==null||e.clearExcludedFeatures(),this.featureData.changeSource({sourceName:O.main,atomic:!0}),this.isDragging=!1,this.previousLngLat=null,this.gm.mapAdapter.setDragPan(!0),this.fireFeatureEditEndEvent({feature:this.featureData,forceMode:"drag"}),this.featureData=null,{next:!0}):{next:!0}}onMouseMove(e){var r;if(!this.isDragging||!pe(e,{warning:!0}))return{next:!0};if(this.featureData){const i=((r=this.gm.markerPointer.marker)==null?void 0:r.getLngLat())||e.lngLat.toArray();this.moveFeature(this.featureData,i)}return{next:!1}}isPointBasedShape(){return!!this.featureData&&this.pointBasedShapes.includes(this.featureData.shape)}alignShapeCenterWithControlMarker(e,r){var s;const i=Os(e);i&&((s=this.gm.markerPointer.marker)==null||s.setLngLat(i),this.onMouseMove(r))}moveFeature(e,r){if(!this.isDragging)return;if(!this.previousLngLat){this.previousLngLat=r;return}const i=this.getUpdatedGeoJsonHandlers[e.shape];if(i){const s=i(e,this.previousLngLat,r);if(!s){B.error("BaseDrag.moveFeature: invalid updatedGeoJson",e);return}this.fireBeforeFeatureUpdate({features:[e],geoJsonFeatures:[s],forceMode:"drag"}),this.updateFeatureGeoJson({featureData:e,featureGeoJson:s,forceMode:"drag"})&&(this.previousLngLat=r)}}moveSource(e,r,i){const s=El(r,i);return zm(e,s)}moveCircle(e,r,i){if(e.shape!=="circle")return B.error("BaseDrag.moveCircle: invalid shape type",e),null;const s=e.getShapeProperty("center");if(!s)return B.error("BaseDrag.moveCircle: missing center in the featureData",e),null;const o=e.getGeoJson(),a=El(r,i),u=Al(o);if(!u)return B.error("BaseDrag.moveCircle: missing center circleRimLngLat"),null;const l=[s[0]+a.lng,s[1]+a.lat],c=Ls({center:l,radius:this.gm.mapAdapter.getDistance(s,u)});return{type:"Feature",properties:{shape:"circle",center:l},geometry:c.geometry}}}class Qy extends To{constructor(){super(...arguments);w(this,"mode","change");w(this,"cutVertexShapeTypes",["line","polygon","rectangle"]);w(this,"markerData",null);w(this,"shapeUpdateHandlers",{marker:this.updateSingleVertex.bind(this),circle:this.updateCircle.bind(this),circle_marker:this.updateSingleVertex.bind(this),text_marker:this.updateSingleVertex.bind(this),line:this.updateSingleVertex.bind(this),rectangle:this.updateRectangle.bind(this),polygon:this.updateSingleVertex.bind(this)})}get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return e instanceof pc?e:null}onStartAction(){}onEndAction(){var e;(e=this.snapGuidesInstance)==null||e.removeSnapGuides()}handleGmEdit(e){var r;if(!Dn(e))return{next:!0};if(e.action==="marker_move"&&e.lngLatStart&&e.markerData){if(e.markerData.type==="vertex")return this.moveVertex(e),{next:!1};if(e.lngLatEnd)return this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}}return e.action==="marker_right_click"?(this.cutVertex(e),this.fireFeatureEditEndEvent({feature:e.featureData})):e.action==="edge_marker_click"?this.insertVertex(e):e.action==="marker_captured"?(e.featureData.changeSource({sourceName:O.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(this.markerData=null,(r=this.snapGuidesInstance)==null||r.removeSnapGuides(),e.featureData.changeSource({sourceName:O.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}}moveVertex(e){var o,a,u;this.markerData||(this.markerData=e.markerData||null,(o=this.snapGuidesInstance)==null||o.updateSnapGuides(e.featureData.getGeoJson(),e.lngLatStart));const r=e.featureData,i=r.shape,s=((u=(a=this.shapeUpdateHandlers)[i])==null?void 0:u.call(a,e))||null;s?(this.fireBeforeFeatureUpdate({features:[r],geoJsonFeatures:[s]}),this.updateFeatureGeoJson({featureData:r,featureGeoJson:s})):B.error("EditChange.moveVertex: invalid geojson",s,e)}cutVertex(e){const r=e.featureData;if(e.markerData.type!=="vertex"||!this.cutVertexShapeTypes.includes(r.shape))return;let i=!1;const s=r.getGeoJson(),o=e.markerData.instance;if(vl(s)){if(As(s)<=2){this.gm.features.delete(r);return}}else if(wl(s)){if(As(s)<=3){this.gm.features.delete(r);return}}else if(yl(s)&&As(s)<=3){this.gm.features.delete(r);return}const a=Os(o);a&&(i=fm(s,a)),i?(r.convertToPolygon(),r.updateGeoJsonGeometry(s.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[r],targetFeatures:[r],markerData:e.markerData})):B.error("EditChange.cutVertex: feature not updated",e)}insertVertex(e){if(e.markerData.type!=="edge")return;const r=e.featureData.getGeoJson(),i=e.markerData.segment.end.path,s=i.pop(),o=nn(r,i);typeof s=="number"&&(o.splice(s,0,[...e.markerData.position.coordinate]),e.featureData.updateGeoJsonGeometry(r.geometry),e.featureData.convertToPolygon(),this.fireFeatureUpdatedEvent({sourceFeatures:[e.featureData],targetFeatures:[e.featureData],markerData:e.markerData}))}updateSingleVertex({featureData:e,lngLatEnd:r,markerData:i}){const s=Ye(e.getGeoJson()),o=Ye(i.position.path),a=o.pop(),u=nn(s,o);return Array.isArray(u)&&typeof a=="number"?(u[a]=[...r],a===0&&e.shape==="polygon"&&(u[u.length-1]=[...r])):B.error("BaseDrag.moveSingleVertex: invalid coordinates",s,o),s}updateCircle({featureData:e,lngLatEnd:r}){if(e.shape!=="circle"||e.shapeProperties.center===null)return B.error("BaseDrag.moveCircle: invalid shape type / missing center",e),null;const i=e.shapeProperties.center,s=Ls({center:i,radius:this.gm.mapAdapter.getDistance(i,r)});return{type:"Feature",properties:{shape:"circle",center:i},geometry:s.geometry}}updateRectangle({featureData:e,lngLatStart:r,lngLatEnd:i}){const o=e.getGeoJson(),a=o.geometry.coordinates[0],{absCoordIndex:u}=Xr(o,r);if(u===-1)return B.error("EditChange.updateRectangle: start vertex not found",e),null;const l=_o(u-2,4),c=a[l];return xs(i,c)}}const xc=t=>t.length>0;function e2(t,n,{ignoreSelfIntersections:e=!0}={}){let r=!1;return Ut(t,i=>{Ut(n,s=>{if(r===!0)return!0;r=!dy(i.geometry,s.geometry,{ignoreSelfIntersections:e})})}),r}var t2=e2,n2=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Po=Math.ceil,Ze=Math.floor,Re="[BigNumber Error] ",Sc=Re+"Number primitive has more than 15 significant digits: ",ot=1e14,j=14,Ac=9007199254740991,Io=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Wt=1e7,qe=1e9;function Lc(t){var n,e,r,i=g.prototype={constructor:g,toString:null,valueOf:null},s=new g(1),o=20,a=4,u=-7,l=21,c=-1e7,h=1e7,d=!1,v=1,M=0,A={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},P="0123456789abcdefghijklmnopqrstuvwxyz",C=!0;function g(f,p){var m,y,E,S,k,b,_,T,L=this;if(!(L instanceof g))return new g(f,p);if(p==null){if(f&&f._isBigNumber===!0){L.s=f.s,!f.c||f.e>h?L.c=L.e=null:f.e<c?L.c=[L.e=0]:(L.e=f.e,L.c=f.c.slice());return}if((b=typeof f=="number")&&f*0==0){if(L.s=1/f<0?(f=-f,-1):1,f===~~f){for(S=0,k=f;k>=10;k/=10,S++);S>h?L.c=L.e=null:(L.e=S,L.c=[f]);return}T=String(f)}else{if(!n2.test(T=String(f)))return r(L,T,b);L.s=T.charCodeAt(0)==45?(T=T.slice(1),-1):1}(S=T.indexOf("."))>-1&&(T=T.replace(".","")),(k=T.search(/e/i))>0?(S<0&&(S=k),S+=+T.slice(k+1),T=T.substring(0,k)):S<0&&(S=T.length)}else{if(he(p,2,P.length,"Base"),p==10&&C)return L=new g(f),N(L,o+L.e+1,a);if(T=String(f),b=typeof f=="number"){if(f*0!=0)return r(L,T,b,p);if(L.s=1/f<0?(T=T.slice(1),-1):1,g.DEBUG&&T.replace(/^0\.0*|\./,"").length>15)throw Error(Sc+f)}else L.s=T.charCodeAt(0)===45?(T=T.slice(1),-1):1;for(m=P.slice(0,p),S=k=0,_=T.length;k<_;k++)if(m.indexOf(y=T.charAt(k))<0){if(y=="."){if(k>S){S=_;continue}}else if(!E&&(T==T.toUpperCase()&&(T=T.toLowerCase())||T==T.toLowerCase()&&(T=T.toUpperCase()))){E=!0,k=-1,S=0;continue}return r(L,String(f),b,p)}b=!1,T=e(T,p,10,L.s),(S=T.indexOf("."))>-1?T=T.replace(".",""):S=T.length}for(k=0;T.charCodeAt(k)===48;k++);for(_=T.length;T.charCodeAt(--_)===48;);if(T=T.slice(k,++_)){if(_-=k,b&&g.DEBUG&&_>15&&(f>Ac||f!==Ze(f)))throw Error(Sc+L.s*f);if((S=S-k-1)>h)L.c=L.e=null;else if(S<c)L.c=[L.e=0];else{if(L.e=S,L.c=[],k=(S+1)%j,S<0&&(k+=j),k<_){for(k&&L.c.push(+T.slice(0,k)),_-=j;k<_;)L.c.push(+T.slice(k,k+=j));k=j-(T=T.slice(k)).length}else k-=_;for(;k--;T+="0");L.c.push(+T)}}else L.c=[L.e=0]}g.clone=Lc,g.ROUND_UP=0,g.ROUND_DOWN=1,g.ROUND_CEIL=2,g.ROUND_FLOOR=3,g.ROUND_HALF_UP=4,g.ROUND_HALF_DOWN=5,g.ROUND_HALF_EVEN=6,g.ROUND_HALF_CEIL=7,g.ROUND_HALF_FLOOR=8,g.EUCLID=9,g.config=g.set=function(f){var p,m;if(f!=null)if(typeof f=="object"){if(f.hasOwnProperty(p="DECIMAL_PLACES")&&(m=f[p],he(m,0,qe,p),o=m),f.hasOwnProperty(p="ROUNDING_MODE")&&(m=f[p],he(m,0,8,p),a=m),f.hasOwnProperty(p="EXPONENTIAL_AT")&&(m=f[p],m&&m.pop?(he(m[0],-1e9,0,p),he(m[1],0,qe,p),u=m[0],l=m[1]):(he(m,-1e9,qe,p),u=-(l=m<0?-m:m))),f.hasOwnProperty(p="RANGE"))if(m=f[p],m&&m.pop)he(m[0],-1e9,-1,p),he(m[1],1,qe,p),c=m[0],h=m[1];else if(he(m,-1e9,qe,p),m)c=-(h=m<0?-m:m);else throw Error(Re+p+" cannot be zero: "+m);if(f.hasOwnProperty(p="CRYPTO"))if(m=f[p],m===!!m)if(m)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))d=m;else throw d=!m,Error(Re+"crypto unavailable");else d=m;else throw Error(Re+p+" not true or false: "+m);if(f.hasOwnProperty(p="MODULO_MODE")&&(m=f[p],he(m,0,9,p),v=m),f.hasOwnProperty(p="POW_PRECISION")&&(m=f[p],he(m,0,qe,p),M=m),f.hasOwnProperty(p="FORMAT"))if(m=f[p],typeof m=="object")A=m;else throw Error(Re+p+" not an object: "+m);if(f.hasOwnProperty(p="ALPHABET"))if(m=f[p],typeof m=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(m))C=m.slice(0,10)=="0123456789",P=m;else throw Error(Re+p+" invalid: "+m)}else throw Error(Re+"Object expected: "+f);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[u,l],RANGE:[c,h],CRYPTO:d,MODULO_MODE:v,POW_PRECISION:M,FORMAT:A,ALPHABET:P}},g.isBigNumber=function(f){if(!f||f._isBigNumber!==!0)return!1;if(!g.DEBUG)return!0;var p,m,y=f.c,E=f.e,S=f.s;e:if({}.toString.call(y)=="[object Array]"){if((S===1||S===-1)&&E>=-1e9&&E<=qe&&E===Ze(E)){if(y[0]===0){if(E===0&&y.length===1)return!0;break e}if(p=(E+1)%j,p<1&&(p+=j),String(y[0]).length==p){for(p=0;p<y.length;p++)if(m=y[p],m<0||m>=ot||m!==Ze(m))break e;if(m!==0)return!0}}}else if(y===null&&E===null&&(S===null||S===1||S===-1))return!0;throw Error(Re+"Invalid BigNumber: "+f)},g.maximum=g.max=function(){return F(arguments,-1)},g.minimum=g.min=function(){return F(arguments,1)},g.random=function(){var f=9007199254740992,p=Math.random()*f&2097151?function(){return Ze(Math.random()*f)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(m){var y,E,S,k,b,_=0,T=[],L=new g(s);if(m==null?m=o:he(m,0,qe),k=Po(m/j),d)if(crypto.getRandomValues){for(y=crypto.getRandomValues(new Uint32Array(k*=2));_<k;)b=y[_]*131072+(y[_+1]>>>11),b>=9e15?(E=crypto.getRandomValues(new Uint32Array(2)),y[_]=E[0],y[_+1]=E[1]):(T.push(b%1e14),_+=2);_=k/2}else if(crypto.randomBytes){for(y=crypto.randomBytes(k*=7);_<k;)b=(y[_]&31)*281474976710656+y[_+1]*1099511627776+y[_+2]*4294967296+y[_+3]*16777216+(y[_+4]<<16)+(y[_+5]<<8)+y[_+6],b>=9e15?crypto.randomBytes(7).copy(y,_):(T.push(b%1e14),_+=7);_=k/7}else throw d=!1,Error(Re+"crypto unavailable");if(!d)for(;_<k;)b=p(),b<9e15&&(T[_++]=b%1e14);for(k=T[--_],m%=j,k&&m&&(b=Io[j-m],T[_]=Ze(k/b)*b);T[_]===0;T.pop(),_--);if(_<0)T=[S=0];else{for(S=-1;T[0]===0;T.splice(0,1),S-=j);for(_=1,b=T[0];b>=10;b/=10,_++);_<j&&(S-=j-_)}return L.e=S,L.c=T,L}}(),g.sum=function(){for(var f=1,p=arguments,m=new g(p[0]);f<p.length;)m=m.plus(p[f++]);return m},e=function(){var f="0123456789";function p(m,y,E,S){for(var k,b=[0],_,T=0,L=m.length;T<L;){for(_=b.length;_--;b[_]*=y);for(b[0]+=S.indexOf(m.charAt(T++)),k=0;k<b.length;k++)b[k]>E-1&&(b[k+1]==null&&(b[k+1]=0),b[k+1]+=b[k]/E|0,b[k]%=E)}return b.reverse()}return function(m,y,E,S,k){var b,_,T,L,I,J,U,K,V=m.indexOf("."),X=o,z=a;for(V>=0&&(L=M,M=0,m=m.replace(".",""),K=new g(y),J=K.pow(m.length-V),M=L,K.c=p(Pt(Ke(J.c),J.e,"0"),10,E,f),K.e=K.c.length),U=p(m,y,E,k?(b=P,f):(b=f,P)),T=L=U.length;U[--L]==0;U.pop());if(!U[0])return b.charAt(0);if(V<0?--T:(J.c=U,J.e=T,J.s=S,J=n(J,K,X,z,E),U=J.c,I=J.r,T=J.e),_=T+X+1,V=U[_],L=E/2,I=I||_<0||U[_+1]!=null,I=z<4?(V!=null||I)&&(z==0||z==(J.s<0?3:2)):V>L||V==L&&(z==4||I||z==6&&U[_-1]&1||z==(J.s<0?8:7)),_<1||!U[0])m=I?Pt(b.charAt(1),-X,b.charAt(0)):b.charAt(0);else{if(U.length=_,I)for(--E;++U[--_]>E;)U[_]=0,_||(++T,U=[1].concat(U));for(L=U.length;!U[--L];);for(V=0,m="";V<=L;m+=b.charAt(U[V++]));m=Pt(m,T,b.charAt(0))}return m}}(),n=function(){function f(y,E,S){var k,b,_,T,L=0,I=y.length,J=E%Wt,U=E/Wt|0;for(y=y.slice();I--;)_=y[I]%Wt,T=y[I]/Wt|0,k=U*_+T*J,b=J*_+k%Wt*Wt+L,L=(b/S|0)+(k/Wt|0)+U*T,y[I]=b%S;return L&&(y=[L].concat(y)),y}function p(y,E,S,k){var b,_;if(S!=k)_=S>k?1:-1;else for(b=_=0;b<S;b++)if(y[b]!=E[b]){_=y[b]>E[b]?1:-1;break}return _}function m(y,E,S,k){for(var b=0;S--;)y[S]-=b,b=y[S]<E[S]?1:0,y[S]=b*k+y[S]-E[S];for(;!y[0]&&y.length>1;y.splice(0,1));}return function(y,E,S,k,b){var _,T,L,I,J,U,K,V,X,z,Z,re,Ft,Dt,$t,Fe,Be,ve=y.s==E.s?1:-1,ue=y.c,se=E.c;if(!ue||!ue[0]||!se||!se[0])return new g(!y.s||!E.s||(ue?se&&ue[0]==se[0]:!se)?NaN:ue&&ue[0]==0||!se?ve*0:ve/0);for(V=new g(ve),X=V.c=[],T=y.e-E.e,ve=S+T+1,b||(b=ot,T=Xe(y.e/j)-Xe(E.e/j),ve=ve/j|0),L=0;se[L]==(ue[L]||0);L++);if(se[L]>(ue[L]||0)&&T--,ve<0)X.push(1),I=!0;else{for(Dt=ue.length,Fe=se.length,L=0,ve+=2,J=Ze(b/(se[0]+1)),J>1&&(se=f(se,J,b),ue=f(ue,J,b),Fe=se.length,Dt=ue.length),Ft=Fe,z=ue.slice(0,Fe),Z=z.length;Z<Fe;z[Z++]=0);Be=se.slice(),Be=[0].concat(Be),$t=se[0],se[1]>=b/2&&$t++;do{if(J=0,_=p(se,z,Fe,Z),_<0){if(re=z[0],Fe!=Z&&(re=re*b+(z[1]||0)),J=Ze(re/$t),J>1)for(J>=b&&(J=b-1),U=f(se,J,b),K=U.length,Z=z.length;p(U,z,K,Z)==1;)J--,m(U,Fe<K?Be:se,K,b),K=U.length,_=1;else J==0&&(_=J=1),U=se.slice(),K=U.length;if(K<Z&&(U=[0].concat(U)),m(z,U,Z,b),Z=z.length,_==-1)for(;p(se,z,Fe,Z)<1;)J++,m(z,Fe<Z?Be:se,Z,b),Z=z.length}else _===0&&(J++,z=[0]);X[L++]=J,z[0]?z[Z++]=ue[Ft]||0:(z=[ue[Ft]],Z=1)}while((Ft++<Dt||z[0]!=null)&&ve--);I=z[0]!=null,X[0]||X.splice(0,1)}if(b==ot){for(L=1,ve=X[0];ve>=10;ve/=10,L++);N(V,S+(V.e=L+T*j-1)+1,k,I)}else V.e=T,V.r=+I;return V}}();function D(f,p,m,y){var E,S,k,b,_;if(m==null?m=a:he(m,0,8),!f.c)return f.toString();if(E=f.c[0],k=f.e,p==null)_=Ke(f.c),_=y==1||y==2&&(k<=u||k>=l)?Bi(_,k):Pt(_,k,"0");else if(f=N(new g(f),p,m),S=f.e,_=Ke(f.c),b=_.length,y==1||y==2&&(p<=S||S<=u)){for(;b<p;_+="0",b++);_=Bi(_,S)}else if(p-=k,_=Pt(_,S,"0"),S+1>b){if(--p>0)for(_+=".";p--;_+="0");}else if(p+=S-b,p>0)for(S+1==b&&(_+=".");p--;_+="0");return f.s<0&&E?"-"+_:_}function F(f,p){for(var m,y,E=1,S=new g(f[0]);E<f.length;E++)y=new g(f[E]),(!y.s||(m=cn(S,y))===p||m===0&&S.s===p)&&(S=y);return S}function G(f,p,m){for(var y=1,E=p.length;!p[--E];p.pop());for(E=p[0];E>=10;E/=10,y++);return(m=y+m*j-1)>h?f.c=f.e=null:m<c?f.c=[f.e=0]:(f.e=m,f.c=p),f}r=function(){var f=/^(-?)0([xbo])(?=\w[\w.]*$)/i,p=/^([^.]+)\.$/,m=/^\.([^.]+)$/,y=/^-?(Infinity|NaN)$/,E=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(S,k,b,_){var T,L=b?k:k.replace(E,"");if(y.test(L))S.s=isNaN(L)?null:L<0?-1:1;else{if(!b&&(L=L.replace(f,function(I,J,U){return T=(U=U.toLowerCase())=="x"?16:U=="b"?2:8,!_||_==T?J:I}),_&&(T=_,L=L.replace(p,"$1").replace(m,"0.$1")),k!=L))return new g(L,T);if(g.DEBUG)throw Error(Re+"Not a"+(_?" base "+_:"")+" number: "+k);S.s=null}S.c=S.e=null}}();function N(f,p,m,y){var E,S,k,b,_,T,L,I=f.c,J=Io;if(I){e:{for(E=1,b=I[0];b>=10;b/=10,E++);if(S=p-E,S<0)S+=j,k=p,_=I[T=0],L=Ze(_/J[E-k-1]%10);else if(T=Po((S+1)/j),T>=I.length)if(y){for(;I.length<=T;I.push(0));_=L=0,E=1,S%=j,k=S-j+1}else break e;else{for(_=b=I[T],E=1;b>=10;b/=10,E++);S%=j,k=S-j+E,L=k<0?0:Ze(_/J[E-k-1]%10)}if(y=y||p<0||I[T+1]!=null||(k<0?_:_%J[E-k-1]),y=m<4?(L||y)&&(m==0||m==(f.s<0?3:2)):L>5||L==5&&(m==4||y||m==6&&(S>0?k>0?_/J[E-k]:0:I[T-1])%10&1||m==(f.s<0?8:7)),p<1||!I[0])return I.length=0,y?(p-=f.e+1,I[0]=J[(j-p%j)%j],f.e=-p||0):I[0]=f.e=0,f;if(S==0?(I.length=T,b=1,T--):(I.length=T+1,b=J[j-S],I[T]=k>0?Ze(_/J[E-k]%J[k])*b:0),y)for(;;)if(T==0){for(S=1,k=I[0];k>=10;k/=10,S++);for(k=I[0]+=b,b=1;k>=10;k/=10,b++);S!=b&&(f.e++,I[0]==ot&&(I[0]=1));break}else{if(I[T]+=b,I[T]!=ot)break;I[T--]=0,b=1}for(S=I.length;I[--S]===0;I.pop());}f.e>h?f.c=f.e=null:f.e<c&&(f.c=[f.e=0])}return f}function H(f){var p,m=f.e;return m===null?f.toString():(p=Ke(f.c),p=m<=u||m>=l?Bi(p,m):Pt(p,m,"0"),f.s<0?"-"+p:p)}return i.absoluteValue=i.abs=function(){var f=new g(this);return f.s<0&&(f.s=1),f},i.comparedTo=function(f,p){return cn(this,new g(f,p))},i.decimalPlaces=i.dp=function(f,p){var m,y,E,S=this;if(f!=null)return he(f,0,qe),p==null?p=a:he(p,0,8),N(new g(S),f+S.e+1,p);if(!(m=S.c))return null;if(y=((E=m.length-1)-Xe(this.e/j))*j,E=m[E])for(;E%10==0;E/=10,y--);return y<0&&(y=0),y},i.dividedBy=i.div=function(f,p){return n(this,new g(f,p),o,a)},i.dividedToIntegerBy=i.idiv=function(f,p){return n(this,new g(f,p),0,1)},i.exponentiatedBy=i.pow=function(f,p){var m,y,E,S,k,b,_,T,L,I=this;if(f=new g(f),f.c&&!f.isInteger())throw Error(Re+"Exponent not an integer: "+H(f));if(p!=null&&(p=new g(p)),b=f.e>14,!I.c||!I.c[0]||I.c[0]==1&&!I.e&&I.c.length==1||!f.c||!f.c[0])return L=new g(Math.pow(+H(I),b?f.s*(2-Ri(f)):+H(f))),p?L.mod(p):L;if(_=f.s<0,p){if(p.c?!p.c[0]:!p.s)return new g(NaN);y=!_&&I.isInteger()&&p.isInteger(),y&&(I=I.mod(p))}else{if(f.e>9&&(I.e>0||I.e<-1||(I.e==0?I.c[0]>1||b&&I.c[1]>=24e7:I.c[0]<8e13||b&&I.c[0]<=9999975e7)))return S=I.s<0&&Ri(f)?-0:0,I.e>-1&&(S=1/S),new g(_?1/S:S);M&&(S=Po(M/j+2))}for(b?(m=new g(.5),_&&(f.s=1),T=Ri(f)):(E=Math.abs(+H(f)),T=E%2),L=new g(s);;){if(T){if(L=L.times(I),!L.c)break;S?L.c.length>S&&(L.c.length=S):y&&(L=L.mod(p))}if(E){if(E=Ze(E/2),E===0)break;T=E%2}else if(f=f.times(m),N(f,f.e+1,1),f.e>14)T=Ri(f);else{if(E=+H(f),E===0)break;T=E%2}I=I.times(I),S?I.c&&I.c.length>S&&(I.c.length=S):y&&(I=I.mod(p))}return y?L:(_&&(L=s.div(L)),p?L.mod(p):S?N(L,M,a,k):L)},i.integerValue=function(f){var p=new g(this);return f==null?f=a:he(f,0,8),N(p,p.e+1,f)},i.isEqualTo=i.eq=function(f,p){return cn(this,new g(f,p))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(f,p){return cn(this,new g(f,p))>0},i.isGreaterThanOrEqualTo=i.gte=function(f,p){return(p=cn(this,new g(f,p)))===1||p===0},i.isInteger=function(){return!!this.c&&Xe(this.e/j)>this.c.length-2},i.isLessThan=i.lt=function(f,p){return cn(this,new g(f,p))<0},i.isLessThanOrEqualTo=i.lte=function(f,p){return(p=cn(this,new g(f,p)))===-1||p===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(f,p){var m,y,E,S,k=this,b=k.s;if(f=new g(f,p),p=f.s,!b||!p)return new g(NaN);if(b!=p)return f.s=-p,k.plus(f);var _=k.e/j,T=f.e/j,L=k.c,I=f.c;if(!_||!T){if(!L||!I)return L?(f.s=-p,f):new g(I?k:NaN);if(!L[0]||!I[0])return I[0]?(f.s=-p,f):new g(L[0]?k:a==3?-0:0)}if(_=Xe(_),T=Xe(T),L=L.slice(),b=_-T){for((S=b<0)?(b=-b,E=L):(T=_,E=I),E.reverse(),p=b;p--;E.push(0));E.reverse()}else for(y=(S=(b=L.length)<(p=I.length))?b:p,b=p=0;p<y;p++)if(L[p]!=I[p]){S=L[p]<I[p];break}if(S&&(E=L,L=I,I=E,f.s=-f.s),p=(y=I.length)-(m=L.length),p>0)for(;p--;L[m++]=0);for(p=ot-1;y>b;){if(L[--y]<I[y]){for(m=y;m&&!L[--m];L[m]=p);--L[m],L[y]+=ot}L[y]-=I[y]}for(;L[0]==0;L.splice(0,1),--T);return L[0]?G(f,L,T):(f.s=a==3?-1:1,f.c=[f.e=0],f)},i.modulo=i.mod=function(f,p){var m,y,E=this;return f=new g(f,p),!E.c||!f.s||f.c&&!f.c[0]?new g(NaN):!f.c||E.c&&!E.c[0]?new g(E):(v==9?(y=f.s,f.s=1,m=n(E,f,0,3),f.s=y,m.s*=y):m=n(E,f,0,v),f=E.minus(m.times(f)),!f.c[0]&&v==1&&(f.s=E.s),f)},i.multipliedBy=i.times=function(f,p){var m,y,E,S,k,b,_,T,L,I,J,U,K,V,X,z=this,Z=z.c,re=(f=new g(f,p)).c;if(!Z||!re||!Z[0]||!re[0])return!z.s||!f.s||Z&&!Z[0]&&!re||re&&!re[0]&&!Z?f.c=f.e=f.s=null:(f.s*=z.s,!Z||!re?f.c=f.e=null:(f.c=[0],f.e=0)),f;for(y=Xe(z.e/j)+Xe(f.e/j),f.s*=z.s,_=Z.length,I=re.length,_<I&&(K=Z,Z=re,re=K,E=_,_=I,I=E),E=_+I,K=[];E--;K.push(0));for(V=ot,X=Wt,E=I;--E>=0;){for(m=0,J=re[E]%X,U=re[E]/X|0,k=_,S=E+k;S>E;)T=Z[--k]%X,L=Z[k]/X|0,b=U*T+L*J,T=J*T+b%X*X+K[S]+m,m=(T/V|0)+(b/X|0)+U*L,K[S--]=T%V;K[S]=m}return m?++y:K.splice(0,1),G(f,K,y)},i.negated=function(){var f=new g(this);return f.s=-f.s||null,f},i.plus=function(f,p){var m,y=this,E=y.s;if(f=new g(f,p),p=f.s,!E||!p)return new g(NaN);if(E!=p)return f.s=-p,y.minus(f);var S=y.e/j,k=f.e/j,b=y.c,_=f.c;if(!S||!k){if(!b||!_)return new g(E/0);if(!b[0]||!_[0])return _[0]?f:new g(b[0]?y:E*0)}if(S=Xe(S),k=Xe(k),b=b.slice(),E=S-k){for(E>0?(k=S,m=_):(E=-E,m=b),m.reverse();E--;m.push(0));m.reverse()}for(E=b.length,p=_.length,E-p<0&&(m=_,_=b,b=m,p=E),E=0;p;)E=(b[--p]=b[p]+_[p]+E)/ot|0,b[p]=ot===b[p]?0:b[p]%ot;return E&&(b=[E].concat(b),++k),G(f,b,k)},i.precision=i.sd=function(f,p){var m,y,E,S=this;if(f!=null&&f!==!!f)return he(f,1,qe),p==null?p=a:he(p,0,8),N(new g(S),f,p);if(!(m=S.c))return null;if(E=m.length-1,y=E*j+1,E=m[E]){for(;E%10==0;E/=10,y--);for(E=m[0];E>=10;E/=10,y++);}return f&&S.e+1>y&&(y=S.e+1),y},i.shiftedBy=function(f){return he(f,-9007199254740991,Ac),this.times("1e"+f)},i.squareRoot=i.sqrt=function(){var f,p,m,y,E,S=this,k=S.c,b=S.s,_=S.e,T=o+4,L=new g("0.5");if(b!==1||!k||!k[0])return new g(!b||b<0&&(!k||k[0])?NaN:k?S:1/0);if(b=Math.sqrt(+H(S)),b==0||b==1/0?(p=Ke(k),(p.length+_)%2==0&&(p+="0"),b=Math.sqrt(+p),_=Xe((_+1)/2)-(_<0||_%2),b==1/0?p="5e"+_:(p=b.toExponential(),p=p.slice(0,p.indexOf("e")+1)+_),m=new g(p)):m=new g(b+""),m.c[0]){for(_=m.e,b=_+T,b<3&&(b=0);;)if(E=m,m=L.times(E.plus(n(S,E,T,1))),Ke(E.c).slice(0,b)===(p=Ke(m.c)).slice(0,b))if(m.e<_&&--b,p=p.slice(b-3,b+1),p=="9999"||!y&&p=="4999"){if(!y&&(N(E,E.e+o+2,0),E.times(E).eq(S))){m=E;break}T+=4,b+=4,y=1}else{(!+p||!+p.slice(1)&&p.charAt(0)=="5")&&(N(m,m.e+o+2,1),f=!m.times(m).eq(S));break}}return N(m,m.e+o+1,a,f)},i.toExponential=function(f,p){return f!=null&&(he(f,0,qe),f++),D(this,f,p,1)},i.toFixed=function(f,p){return f!=null&&(he(f,0,qe),f=f+this.e+1),D(this,f,p)},i.toFormat=function(f,p,m){var y,E=this;if(m==null)f!=null&&p&&typeof p=="object"?(m=p,p=null):f&&typeof f=="object"?(m=f,f=p=null):m=A;else if(typeof m!="object")throw Error(Re+"Argument not an object: "+m);if(y=E.toFixed(f,p),E.c){var S,k=y.split("."),b=+m.groupSize,_=+m.secondaryGroupSize,T=m.groupSeparator||"",L=k[0],I=k[1],J=E.s<0,U=J?L.slice(1):L,K=U.length;if(_&&(S=b,b=_,_=S,K-=S),b>0&&K>0){for(S=K%b||b,L=U.substr(0,S);S<K;S+=b)L+=T+U.substr(S,b);_>0&&(L+=T+U.slice(S)),J&&(L="-"+L)}y=I?L+(m.decimalSeparator||"")+((_=+m.fractionGroupSize)?I.replace(new RegExp("\\d{"+_+"}\\B","g"),"$&"+(m.fractionGroupSeparator||"")):I):L}return(m.prefix||"")+y+(m.suffix||"")},i.toFraction=function(f){var p,m,y,E,S,k,b,_,T,L,I,J,U=this,K=U.c;if(f!=null&&(b=new g(f),!b.isInteger()&&(b.c||b.s!==1)||b.lt(s)))throw Error(Re+"Argument "+(b.isInteger()?"out of range: ":"not an integer: ")+H(b));if(!K)return new g(U);for(p=new g(s),T=m=new g(s),y=_=new g(s),J=Ke(K),S=p.e=J.length-U.e-1,p.c[0]=Io[(k=S%j)<0?j+k:k],f=!f||b.comparedTo(p)>0?S>0?p:T:b,k=h,h=1/0,b=new g(J),_.c[0]=0;L=n(b,p,0,1),E=m.plus(L.times(y)),E.comparedTo(f)!=1;)m=y,y=E,T=_.plus(L.times(E=T)),_=E,p=b.minus(L.times(E=p)),b=E;return E=n(f.minus(m),y,0,1),_=_.plus(E.times(T)),m=m.plus(E.times(y)),_.s=T.s=U.s,S=S*2,I=n(T,y,S,a).minus(U).abs().comparedTo(n(_,m,S,a).minus(U).abs())<1?[T,y]:[_,m],h=k,I},i.toNumber=function(){return+H(this)},i.toPrecision=function(f,p){return f!=null&&he(f,1,qe),D(this,f,p,2)},i.toString=function(f){var p,m=this,y=m.s,E=m.e;return E===null?y?(p="Infinity",y<0&&(p="-"+p)):p="NaN":(f==null?p=E<=u||E>=l?Bi(Ke(m.c),E):Pt(Ke(m.c),E,"0"):f===10&&C?(m=N(new g(m),o+E+1,a),p=Pt(Ke(m.c),m.e,"0")):(he(f,2,P.length,"Base"),p=e(Pt(Ke(m.c),E,"0"),10,f,y,!0)),y<0&&m.c[0]&&(p="-"+p)),p},i.valueOf=i.toJSON=function(){return H(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,t!=null&&g.set(t),g}function Xe(t){var n=t|0;return t>0||t===n?n:n-1}function Ke(t){for(var n,e,r=1,i=t.length,s=t[0]+"";r<i;){for(n=t[r++]+"",e=j-n.length;e--;n="0"+n);s+=n}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function cn(t,n){var e,r,i=t.c,s=n.c,o=t.s,a=n.s,u=t.e,l=n.e;if(!o||!a)return null;if(e=i&&!i[0],r=s&&!s[0],e||r)return e?r?0:-a:o;if(o!=a)return o;if(e=o<0,r=u==l,!i||!s)return r?0:!i^e?1:-1;if(!r)return u>l^e?1:-1;for(a=(u=i.length)<(l=s.length)?u:l,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^e?1:-1;return u==l?0:u>l^e?1:-1}function he(t,n,e,r){if(t<n||t>e||t!==Ze(t))throw Error(Re+(r||"Argument")+(typeof t=="number"?t<n||t>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function Ri(t){var n=t.c.length-1;return Xe(t.e/j)==n&&t.c[n]%2!=0}function Bi(t,n){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(n<0?"e":"e+")+n}function Pt(t,n,e){var r,i;if(n<0){for(i=e+".";++n;i+=e);t=i+t}else if(r=t.length,++n>r){for(i=e,n-=r;--n;i+=e);t+=i}else n<r&&(t=t.slice(0,n)+"."+t.slice(n));return t}var pt=Lc(),r2=class{constructor(t){w(this,"key");w(this,"left",null);w(this,"right",null);this.key=t}},Cr=class extends r2{constructor(t){super(t)}},i2=class{constructor(){w(this,"size",0);w(this,"modificationCount",0);w(this,"splayCount",0)}splay(t){const n=this.root;if(n==null)return this.compare(t,t),-1;let e=null,r=null,i=null,s=null,o=n;const a=this.compare;let u;for(;;)if(u=a(o.key,t),u>0){let l=o.left;if(l==null||(u=a(l.key,t),u>0&&(o.left=l.right,l.right=o,o=l,l=o.left,l==null)))break;e==null?r=o:e.left=o,e=o,o=l}else if(u<0){let l=o.right;if(l==null||(u=a(l.key,t),u<0&&(o.right=l.left,l.left=o,o=l,l=o.right,l==null)))break;i==null?s=o:i.right=o,i=o,o=l}else break;return i!=null&&(i.right=o.left,o.left=s),e!=null&&(e.left=o.right,o.right=r),this.root!==o&&(this.root=o,this.splayCount++),u}splayMin(t){let n=t,e=n.left;for(;e!=null;){const r=e;n.left=r.right,r.right=n,n=r,e=n.left}return n}splayMax(t){let n=t,e=n.right;for(;e!=null;){const r=e;n.right=r.left,r.left=n,n=r,e=n.right}return n}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let e=this.root;const r=e,i=e.left;if(this.size--,i==null)this.root=e.right;else{const s=e.right;e=this.splayMax(i),e.right=s,this.root=e}return this.modificationCount++,r}addNewRoot(t,n){this.size++,this.modificationCount++;const e=this.root;if(e==null){this.root=t;return}n<0?(t.left=e,t.right=e.right,e.right=null):(t.right=e,t.left=e.left,e.left=null),this.root=t}_first(){const t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){const t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,n)=>t<n?-1:t>n?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},Ni=class Dr extends i2{constructor(e,r){super();w(this,"root",null);w(this,"compare");w(this,"validKey");w(this,Xc,"[object Set]");this.compare=e??this.defaultCompare(),this.validKey=r??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const r of e)this.delete(r)}forEach(e){const r=this[Symbol.iterator]();let i;for(;i=r.next(),!i.done;)e(i.value,i.value,this)}add(e){const r=this.splay(e);return r!=0&&this.addNewRoot(new Cr(e),r),this}addAndReturn(e){const r=this.splay(e);return r!=0&&this.addNewRoot(new Cr(e),r),this.root.key}addAll(e){for(const r of e)this.add(r)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let s=i.right;for(;s!=null;)i=s,s=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let s=i.left;for(;s!=null;)i=s,s=i.left;return i.key}retainAll(e){const r=new Dr(this.compare,this.validKey),i=this.modificationCount;for(const s of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(s)&&this.splay(s)==0&&r.add(this.root.key)}r.size!=this.size&&(this.root=r.root,this.size=r.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const r=new Dr(this.compare,this.validKey);for(const i of this)e.has(i)&&r.add(i);return r}difference(e){const r=new Dr(this.compare,this.validKey);for(const i of this)e.has(i)||r.add(i);return r}union(e){const r=this.clone();return r.addAll(e),r}clone(){const e=new Dr(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function r(s,o){let a,u;do{if(a=s.left,u=s.right,a!=null){const l=new Cr(a.key);o.left=l,r(a,l)}if(u!=null){const l=new Cr(u.key);o.right=l,s=u,o=l}}while(u!=null)}const i=new Cr(e.key);return r(e,i),i}toSet(){return this.clone()}entries(){return new o2(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Kc=Symbol.iterator,Xc=Symbol.toStringTag,Kc)](){return new s2(this.wrap())}},Cc=class{constructor(t){w(this,"tree");w(this,"path",new Array);w(this,"modificationCount",null);w(this,"splayCount");this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;e!=null;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],n=t.right;if(n!=null){for(;n!=null;)this.path.push(n),n=n.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},s2=class extends Cc{getValue(t){return t.key}},o2=class extends Cc{getValue(t){return[t.key,t.key]}},kc=t=>()=>t,Fo=t=>{const n=t?(e,r)=>r.minus(e).abs().isLessThanOrEqualTo(t):kc(!1);return(e,r)=>n(e,r)?0:e.comparedTo(r)};function a2(t){const n=t?(e,r,i,s,o)=>e.exponentiatedBy(2).isLessThanOrEqualTo(s.minus(r).exponentiatedBy(2).plus(o.minus(i).exponentiatedBy(2)).times(t)):kc(!1);return(e,r,i)=>{const s=e.x,o=e.y,a=i.x,u=i.y,l=o.minus(u).times(r.x.minus(a)).minus(s.minus(a).times(r.y.minus(u)));return n(l,s,o,a,u)?0:l.comparedTo(0)}}var l2=t=>t,u2=t=>{if(t){const n=new Ni(Fo(t)),e=new Ni(Fo(t)),r=(s,o)=>o.addAndReturn(s),i=s=>({x:r(s.x,n),y:r(s.y,e)});return i({x:new pt(0),y:new pt(0)}),i}return l2},Do=t=>({set:n=>{It=Do(n)},reset:()=>Do(t),compare:Fo(t),snap:u2(t),orient:a2(t)}),It=Do(),kr=(t,n)=>t.ll.x.isLessThanOrEqualTo(n.x)&&n.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(n.y)&&n.y.isLessThanOrEqualTo(t.ur.y),Oo=(t,n)=>{if(n.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(n.ll.x)||n.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(n.ll.y))return null;const e=t.ll.x.isLessThan(n.ll.x)?n.ll.x:t.ll.x,r=t.ur.x.isLessThan(n.ur.x)?t.ur.x:n.ur.x,i=t.ll.y.isLessThan(n.ll.y)?n.ll.y:t.ll.y,s=t.ur.y.isLessThan(n.ur.y)?t.ur.y:n.ur.y;return{ll:{x:e,y:i},ur:{x:r,y:s}}},Ui=(t,n)=>t.x.times(n.y).minus(t.y.times(n.x)),Tc=(t,n)=>t.x.times(n.x).plus(t.y.times(n.y)),Hi=t=>Tc(t,t).sqrt(),c2=(t,n,e)=>{const r={x:n.x.minus(t.x),y:n.y.minus(t.y)},i={x:e.x.minus(t.x),y:e.y.minus(t.y)};return Ui(i,r).div(Hi(i)).div(Hi(r))},f2=(t,n,e)=>{const r={x:n.x.minus(t.x),y:n.y.minus(t.y)},i={x:e.x.minus(t.x),y:e.y.minus(t.y)};return Tc(i,r).div(Hi(i)).div(Hi(r))},Pc=(t,n,e)=>n.y.isZero()?null:{x:t.x.plus(n.x.div(n.y).times(e.minus(t.y))),y:e},Ic=(t,n,e)=>n.x.isZero()?null:{x:e,y:t.y.plus(n.y.div(n.x).times(e.minus(t.x)))},h2=(t,n,e,r)=>{if(n.x.isZero())return Ic(e,r,t.x);if(r.x.isZero())return Ic(t,n,e.x);if(n.y.isZero())return Pc(e,r,t.y);if(r.y.isZero())return Pc(t,n,e.y);const i=Ui(n,r);if(i.isZero())return null;const s={x:e.x.minus(t.x),y:e.y.minus(t.y)},o=Ui(s,n).div(i),a=Ui(s,r).div(i),u=t.x.plus(a.times(n.x)),l=e.x.plus(o.times(r.x)),c=t.y.plus(a.times(n.y)),h=e.y.plus(o.times(r.y)),d=u.plus(l).div(2),v=c.plus(h).div(2);return{x:d,y:v}},gt=class wf{constructor(n,e){w(this,"point");w(this,"isLeft");w(this,"segment");w(this,"otherSE");w(this,"consumedBy");n.events===void 0?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=e}static compare(n,e){const r=wf.comparePoints(n.point,e.point);return r!==0?r:(n.point!==e.point&&n.link(e),n.isLeft!==e.isLeft?n.isLeft?1:-1:zi.compare(n.segment,e.segment))}static comparePoints(n,e){return n.x.isLessThan(e.x)?-1:n.x.isGreaterThan(e.x)?1:n.y.isLessThan(e.y)?-1:n.y.isGreaterThan(e.y)?1:0}link(n){if(n.point===this.point)throw new Error("Tried to link already linked events");const e=n.point.events;for(let r=0,i=e.length;r<i;r++){const s=e[r];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){const n=this.point.events.length;for(let e=0;e<n;e++){const r=this.point.events[e];if(r.segment.consumedBy===void 0)for(let i=e+1;i<n;i++){const s=this.point.events[i];s.consumedBy===void 0&&r.otherSE.point.events===s.otherSE.point.events&&r.segment.consume(s.segment)}}}getAvailableLinkedEvents(){const n=[];for(let e=0,r=this.point.events.length;e<r;e++){const i=this.point.events[e];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&n.push(i)}return n}getLeftmostComparator(n){const e=new Map,r=i=>{const s=i.otherSE;e.set(i,{sine:c2(this.point,n.point,s.point),cosine:f2(this.point,n.point,s.point)})};return(i,s)=>{e.has(i)||r(i),e.has(s)||r(s);const{sine:o,cosine:a}=e.get(i),{sine:u,cosine:l}=e.get(s);return o.isGreaterThanOrEqualTo(0)&&u.isGreaterThanOrEqualTo(0)?a.isLessThan(l)?1:a.isGreaterThan(l)?-1:0:o.isLessThan(0)&&u.isLessThan(0)?a.isLessThan(l)?-1:a.isGreaterThan(l)?1:0:u.isLessThan(o)?-1:u.isGreaterThan(o)?1:0}}},d2=class Zo{constructor(n){w(this,"events");w(this,"poly");w(this,"_isExteriorRing");w(this,"_enclosingRing");this.events=n;for(let e=0,r=n.length;e<r;e++)n[e].segment.ringOut=this;this.poly=null}static factory(n){const e=[];for(let r=0,i=n.length;r<i;r++){const s=n[r];if(!s.isInResult()||s.ringOut)continue;let o=null,a=s.leftSE,u=s.rightSE;const l=[a],c=a.point,h=[];for(;o=a,a=u,l.push(a),a.point!==c;)for(;;){const d=a.getAvailableLinkedEvents();if(d.length===0){const A=l[0].point,P=l[l.length-1].point;throw new Error(`Unable to complete output ring starting at [${A.x}, ${A.y}]. Last matching segment found ends at [${P.x}, ${P.y}].`)}if(d.length===1){u=d[0].otherSE;break}let v=null;for(let A=0,P=h.length;A<P;A++)if(h[A].point===a.point){v=A;break}if(v!==null){const A=h.splice(v)[0],P=l.splice(A.index);P.unshift(P[0].otherSE),e.push(new Zo(P.reverse()));continue}h.push({index:l.length,point:a.point});const M=a.getLeftmostComparator(o);u=d.sort(M)[0].otherSE;break}e.push(new Zo(l))}return e}getGeom(){let n=this.events[0].point;const e=[n];for(let l=1,c=this.events.length-1;l<c;l++){const h=this.events[l].point,d=this.events[l+1].point;It.orient(h,n,d)!==0&&(e.push(h),n=h)}if(e.length===1)return null;const r=e[0],i=e[1];It.orient(r,n,i)===0&&e.shift(),e.push(e[0]);const s=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,u=[];for(let l=o;l!=a;l+=s)u.push([e[l].x.toNumber(),e[l].y.toNumber()]);return u}isExteriorRing(){if(this._isExteriorRing===void 0){const n=this.enclosingRing();this._isExteriorRing=n?!n.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var i,s;let n=this.events[0];for(let o=1,a=this.events.length;o<a;o++){const u=this.events[o];gt.compare(n,u)>0&&(n=u)}let e=n.segment.prevInResult(),r=e?e.prevInResult():null;for(;;){if(!e)return null;if(!r)return e.ringOut;if(r.ringOut!==e.ringOut)return((i=r.ringOut)==null?void 0:i.enclosingRing())!==e.ringOut?e.ringOut:(s=e.ringOut)==null?void 0:s.enclosingRing();e=r.prevInResult(),r=e?e.prevInResult():null}}},Fc=class{constructor(t){w(this,"exteriorRing");w(this,"interiorRings");this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=this.exteriorRing.getGeom();if(t===null)return null;const n=[t];for(let e=0,r=this.interiorRings.length;e<r;e++){const i=this.interiorRings[e].getGeom();i!==null&&n.push(i)}return n}},p2=class{constructor(t){w(this,"rings");w(this,"polys");this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let n=0,e=this.polys.length;n<e;n++){const r=this.polys[n].getGeom();r!==null&&t.push(r)}return t}_composePolys(t){var e;const n=[];for(let r=0,i=t.length;r<i;r++){const s=t[r];if(!s.poly)if(s.isExteriorRing())n.push(new Fc(s));else{const o=s.enclosingRing();o!=null&&o.poly||n.push(new Fc(o)),(e=o==null?void 0:o.poly)==null||e.addInterior(s)}}return n}},g2=class{constructor(t,n=zi.compare){w(this,"queue");w(this,"tree");w(this,"segments");this.queue=t,this.tree=new Ni(n),this.segments=[]}process(t){const n=t.segment,e=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(n),e;t.isLeft&&this.tree.add(n);let r=n,i=n;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(t.isLeft){let s=null;if(r){const a=r.getIntersection(n);if(a!==null&&(n.isAnEndpoint(a)||(s=a),!r.isAnEndpoint(a))){const u=this._splitSafely(r,a);for(let l=0,c=u.length;l<c;l++)e.push(u[l])}}let o=null;if(i){const a=i.getIntersection(n);if(a!==null&&(n.isAnEndpoint(a)||(o=a),!i.isAnEndpoint(a))){const u=this._splitSafely(i,a);for(let l=0,c=u.length;l<c;l++)e.push(u[l])}}if(s!==null||o!==null){let a=null;s===null?a=o:o===null?a=s:a=gt.comparePoints(s,o)<=0?s:o,this.queue.delete(n.rightSE),e.push(n.rightSE);const u=n.split(a);for(let l=0,c=u.length;l<c;l++)e.push(u[l])}e.length>0?(this.tree.delete(n),e.push(t)):(this.segments.push(n),n.prev=r)}else{if(r&&i){const s=r.getIntersection(i);if(s!==null){if(!r.isAnEndpoint(s)){const o=this._splitSafely(r,s);for(let a=0,u=o.length;a<u;a++)e.push(o[a])}if(!i.isAnEndpoint(s)){const o=this._splitSafely(i,s);for(let a=0,u=o.length;a<u;a++)e.push(o[a])}}}this.tree.delete(n)}return e}_splitSafely(t,n){this.tree.delete(t);const e=t.rightSE;this.queue.delete(e);const r=t.split(n);return r.push(e),t.consumedBy===void 0&&this.tree.add(t),r}},m2=class{constructor(){w(this,"type");w(this,"numMultiPolys")}run(t,n,e){Tr.type=t;const r=[new Oc(n,!0)];for(let l=0,c=e.length;l<c;l++)r.push(new Oc(e[l],!1));if(Tr.numMultiPolys=r.length,Tr.type==="difference"){const l=r[0];let c=1;for(;c<r.length;)Oo(r[c].bbox,l.bbox)!==null?c++:r.splice(c,1)}if(Tr.type==="intersection")for(let l=0,c=r.length;l<c;l++){const h=r[l];for(let d=l+1,v=r.length;d<v;d++)if(Oo(h.bbox,r[d].bbox)===null)return[]}const i=new Ni(gt.compare);for(let l=0,c=r.length;l<c;l++){const h=r[l].getSweepEvents();for(let d=0,v=h.length;d<v;d++)i.add(h[d])}const s=new g2(i);let o=null;for(i.size!=0&&(o=i.first(),i.delete(o));o;){const l=s.process(o);for(let c=0,h=l.length;c<h;c++){const d=l[c];d.consumedBy===void 0&&i.add(d)}i.size!=0?(o=i.first(),i.delete(o)):o=null}It.reset();const a=d2.factory(s.segments);return new p2(a).getGeom()}},Tr=new m2,Go=Tr,v2=0,zi=class Zi{constructor(n,e,r,i){w(this,"id");w(this,"leftSE");w(this,"rightSE");w(this,"rings");w(this,"windings");w(this,"ringOut");w(this,"consumedBy");w(this,"prev");w(this,"_prevInResult");w(this,"_beforeState");w(this,"_afterState");w(this,"_isInResult");this.id=++v2,this.leftSE=n,n.segment=this,n.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=n,this.rings=r,this.windings=i}static compare(n,e){const r=n.leftSE.point.x,i=e.leftSE.point.x,s=n.rightSE.point.x,o=e.rightSE.point.x;if(o.isLessThan(r))return 1;if(s.isLessThan(i))return-1;const a=n.leftSE.point.y,u=e.leftSE.point.y,l=n.rightSE.point.y,c=e.rightSE.point.y;if(r.isLessThan(i)){if(u.isLessThan(a)&&u.isLessThan(l))return 1;if(u.isGreaterThan(a)&&u.isGreaterThan(l))return-1;const h=n.comparePoint(e.leftSE.point);if(h<0)return 1;if(h>0)return-1;const d=e.comparePoint(n.rightSE.point);return d!==0?d:-1}if(r.isGreaterThan(i)){if(a.isLessThan(u)&&a.isLessThan(c))return-1;if(a.isGreaterThan(u)&&a.isGreaterThan(c))return 1;const h=e.comparePoint(n.leftSE.point);if(h!==0)return h;const d=n.comparePoint(e.rightSE.point);return d<0?1:d>0?-1:1}if(a.isLessThan(u))return-1;if(a.isGreaterThan(u))return 1;if(s.isLessThan(o)){const h=e.comparePoint(n.rightSE.point);if(h!==0)return h}if(s.isGreaterThan(o)){const h=n.comparePoint(e.rightSE.point);if(h<0)return 1;if(h>0)return-1}if(!s.eq(o)){const h=l.minus(a),d=s.minus(r),v=c.minus(u),M=o.minus(i);if(h.isGreaterThan(d)&&v.isLessThan(M))return 1;if(h.isLessThan(d)&&v.isGreaterThan(M))return-1}return s.isGreaterThan(o)?1:s.isLessThan(o)||l.isLessThan(c)?-1:l.isGreaterThan(c)?1:n.id<e.id?-1:n.id>e.id?1:0}static fromRing(n,e,r){let i,s,o;const a=gt.comparePoints(n,e);if(a<0)i=n,s=e,o=1;else if(a>0)i=e,s=n,o=-1;else throw new Error(`Tried to create degenerate segment at [${n.x}, ${n.y}]`);const u=new gt(i,!0),l=new gt(s,!1);return new Zi(u,l,[r],[o])}replaceRightSE(n){this.rightSE=n,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const n=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:n.isLessThan(e)?n:e},ur:{x:this.rightSE.point.x,y:n.isGreaterThan(e)?n:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(n){return n.x.eq(this.leftSE.point.x)&&n.y.eq(this.leftSE.point.y)||n.x.eq(this.rightSE.point.x)&&n.y.eq(this.rightSE.point.y)}comparePoint(n){return It.orient(this.leftSE.point,n,this.rightSE.point)}getIntersection(n){const e=this.bbox(),r=n.bbox(),i=Oo(e,r);if(i===null)return null;const s=this.leftSE.point,o=this.rightSE.point,a=n.leftSE.point,u=n.rightSE.point,l=kr(e,a)&&this.comparePoint(a)===0,c=kr(r,s)&&n.comparePoint(s)===0,h=kr(e,u)&&this.comparePoint(u)===0,d=kr(r,o)&&n.comparePoint(o)===0;if(c&&l)return d&&!h?o:!d&&h?u:null;if(c)return h&&s.x.eq(u.x)&&s.y.eq(u.y)?null:s;if(l)return d&&o.x.eq(a.x)&&o.y.eq(a.y)?null:a;if(d&&h)return null;if(d)return o;if(h)return u;const v=h2(s,this.vector(),a,n.vector());return v===null||!kr(i,v)?null:It.snap(v)}split(n){const e=[],r=n.events!==void 0,i=new gt(n,!0),s=new gt(n,!1),o=this.rightSE;this.replaceRightSE(s),e.push(s),e.push(i);const a=new Zi(i,o,this.rings.slice(),this.windings.slice());return gt.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),gt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),s.checkForConsuming()),e}swapEvents(){const n=this.rightSE;this.rightSE=this.leftSE,this.leftSE=n,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,r=this.windings.length;e<r;e++)this.windings[e]*=-1}consume(n){let e=this,r=n;for(;e.consumedBy;)e=e.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const i=Zi.compare(e,r);if(i!==0){if(i>0){const s=e;e=r,r=s}if(e.prev===r){const s=e;e=r,r=s}for(let s=0,o=r.rings.length;s<o;s++){const a=r.rings[s],u=r.windings[s],l=e.rings.indexOf(a);l===-1?(e.rings.push(a),e.windings.push(u)):e.windings[l]+=u}r.rings=null,r.windings=null,r.consumedBy=e,r.leftSE.consumedBy=e.leftSE,r.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const n=this.prev.consumedBy||this.prev;this._beforeState=n.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const n=this.beforeState();this._afterState={rings:n.rings.slice(0),windings:n.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,u=this.rings.length;a<u;a++){const l=this.rings[a],c=this.windings[a],h=e.indexOf(l);h===-1?(e.push(l),r.push(c)):r[h]+=c}const s=[],o=[];for(let a=0,u=e.length;a<u;a++){if(r[a]===0)continue;const l=e[a],c=l.poly;if(o.indexOf(c)===-1)if(l.isExterior)s.push(c);else{o.indexOf(c)===-1&&o.push(c);const h=s.indexOf(l.poly);h!==-1&&s.splice(h,1)}}for(let a=0,u=s.length;a<u;a++){const l=s[a].multiPoly;i.indexOf(l)===-1&&i.push(l)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const n=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Go.type){case"union":{const r=n.length===0,i=e.length===0;this._isInResult=r!==i;break}case"intersection":{let r,i;n.length<e.length?(r=n.length,i=e.length):(r=e.length,i=n.length),this._isInResult=i===Go.numMultiPolys&&r<i;break}case"xor":{const r=Math.abs(n.length-e.length);this._isInResult=r%2===1;break}case"difference":{const r=i=>i.length===1&&i[0].isSubject;this._isInResult=r(n)!==r(e);break}}return this._isInResult}},Dc=class{constructor(t,n,e){w(this,"poly");w(this,"isExterior");w(this,"segments");w(this,"bbox");if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=e,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=It.snap({x:new pt(t[0][0]),y:new pt(t[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let s=1,o=t.length;s<o;s++){if(typeof t[s][0]!="number"||typeof t[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=It.snap({x:new pt(t[s][0]),y:new pt(t[s][1])});a.x.eq(i.x)&&a.y.eq(i.y)||(this.segments.push(zi.fromRing(i,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),i=a)}(!r.x.eq(i.x)||!r.y.eq(i.y))&&this.segments.push(zi.fromRing(i,r,this))}getSweepEvents(){const t=[];for(let n=0,e=this.segments.length;n<e;n++){const r=this.segments[n];t.push(r.leftSE),t.push(r.rightSE)}return t}},y2=class{constructor(t,n){w(this,"multiPoly");w(this,"exteriorRing");w(this,"interiorRings");w(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Dc(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,r=t.length;e<r;e++){const i=new Dc(t[e],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=n}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let n=0,e=this.interiorRings.length;n<e;n++){const r=this.interiorRings[n].getSweepEvents();for(let i=0,s=r.length;i<s;i++)t.push(r[i])}return t}},Oc=class{constructor(t,n){w(this,"isSubject");w(this,"polys");w(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new pt(Number.POSITIVE_INFINITY),y:new pt(Number.POSITIVE_INFINITY)},ur:{x:new pt(Number.NEGATIVE_INFINITY),y:new pt(Number.NEGATIVE_INFINITY)}};for(let e=0,r=t.length;e<r;e++){const i=new y2(t[e],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=n}getSweepEvents(){const t=[];for(let n=0,e=this.polys.length;n<e;n++){const r=this.polys[n].getSweepEvents();for(let i=0,s=r.length;i<s;i++)t.push(r[i])}return t}},w2=(t,...n)=>Go.run("difference",t,n);It.set;function E2(t){const n=[];if(Vn(t,i=>{n.push(i.coordinates)}),n.length<2)throw new Error("Must have at least two features");const e=t.features[0].properties||{},r=w2(n[0],...n.slice(1));return r.length===0?null:r.length===1?Xt(r[0],e):ta(r,e)}var M2=E2;function Gc(t){var n=new je(t);return n.insert=function(e){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:yt(e),je.prototype.insert.call(this,e)},n.load=function(e){var r=[];return Array.isArray(e)?e.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:yt(i),r.push(i)}):Nt(e,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:yt(i),r.push(i)}),je.prototype.load.call(this,r)},n.remove=function(e,r){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:yt(e),je.prototype.remove.call(this,e,r)},n.clear=function(){return je.prototype.clear.call(this)},n.search=function(e){var r=je.prototype.search.call(this,this.toBBox(e));return Ee(r)},n.collides=function(e){return je.prototype.collides.call(this,this.toBBox(e))},n.all=function(){var e=je.prototype.all.call(this);return Ee(e)},n.toJSON=function(){return je.prototype.toJSON.call(this)},n.fromJSON=function(e){return je.prototype.fromJSON.call(this,e)},n.toBBox=function(e){var r;if(e.bbox)r=e.bbox;else if(Array.isArray(e)&&e.length===4)r=e;else if(Array.isArray(e)&&e.length===6)r=[e[0],e[1],e[3],e[4]];else if(e.type==="Feature")r=yt(e);else if(e.type==="FeatureCollection")r=yt(e);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},n}function b2(t){var n=t[0],e=t[1],r=t[2],i=t[3],s=lt(t.slice(0,2),[r,e]),o=lt(t.slice(0,2),[n,i]);if(s>=o){var a=(e+i)/2;return[n,a-(r-n)/2,r,a+(r-n)/2]}else{var u=(n+r)/2;return[u-(i-e)/2,e,u+(i-e)/2,i]}}function _2(t,n){if(n=n??{},!Xi(n))throw new Error("options is invalid");var e=n.precision,r=n.coordinates,i=n.mutate;if(e=e==null||isNaN(e)?6:e,r=r==null||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if(typeof e!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(t=JSON.parse(JSON.stringify(t)));var s=Math.pow(10,e);return Bt(t,function(o){x2(o,s,r)}),t}function x2(t,n,e){t.length>e&&t.splice(e,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*n)/n;return t}function S2(t){if(!t)throw new Error("geojson is required");const n=[];return Ut(t,e=>{A2(e,n)}),Ee(n)}function A2(t,n){let e=[];const r=t.geometry;if(r!==null){switch(r.type){case"Polygon":e=Ue(r);break;case"LineString":e=[Ue(r)]}e.forEach(i=>{L2(i,t.properties).forEach(o=>{o.id=n.length,n.push(o)})})}}function L2(t,n){const e=[];return t.reduce((r,i)=>{const s=qn([r,i],n);return s.bbox=C2(r,i),e.push(s),i}),e}function C2(t,n){const e=t[0],r=t[1],i=n[0],s=n[1],o=e<i?e:i,a=r<s?r:s,u=e>i?e:i,l=r>s?r:s;return[o,a,u,l]}var k2=Object.defineProperty,T2=Object.defineProperties,P2=Object.getOwnPropertyDescriptors,Rc=Object.getOwnPropertySymbols,I2=Object.prototype.hasOwnProperty,F2=Object.prototype.propertyIsEnumerable,Bc=(t,n,e)=>n in t?k2(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,Nc=(t,n)=>{for(var e in n||(n={}))I2.call(n,e)&&Bc(t,e,n[e]);if(Rc)for(var e of Rc(n))F2.call(n,e)&&Bc(t,e,n[e]);return t},Uc=(t,n)=>T2(t,P2(n));function D2(t,n,e={}){if(!t||!n)throw new Error("lines and pt are required arguments");const r=de(n);let i=Rt([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),s=0;return Ut(t,function(o,a,u){const l=Ue(o);for(let c=0;c<l.length-1;c++){const h=Rt(l[c]);h.properties.dist=lt(n,h,e);const d=de(h),v=Rt(l[c+1]);v.properties.dist=lt(n,v,e);const M=de(v),A=lt(h,v,e);let P,C;d[0]===r[0]&&d[1]===r[1]?[P,,C]=[d,void 0,!1]:M[0]===r[0]&&M[1]===r[1]?[P,,C]=[M,void 0,!0]:[P,,C]=R2(h.geometry.coordinates,v.geometry.coordinates,de(n));let g;P&&(g=Rt(P,{dist:lt(n,P,e),multiFeatureIndex:u,location:s+lt(h,P,e)})),g&&g.properties.dist<i.properties.dist&&(i=Uc(Nc({},g),{properties:Uc(Nc({},g.properties),{index:C?c+1:c})})),s+=A}}),i}function O2(t,n){const[e,r,i]=t,[s,o,a]=n;return e*s+r*o+i*a}function G2(t,n){const[e,r,i]=t,[s,o,a]=n;return[r*a-i*o,i*s-e*a,e*o-r*s]}function Hc(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2))}function fn(t,n){const e=O2(t,n)/(Hc(t)*Hc(n));return Math.acos(Math.min(Math.max(e,-1),1))}function Ro(t){const n=me(t[1]),e=me(t[0]);return[Math.cos(n)*Math.cos(e),Math.cos(n)*Math.sin(e),Math.sin(n)]}function hn(t){const[n,e,r]=t,i=dn(Math.asin(r));return[dn(Math.atan2(e,n)),i]}function R2(t,n,e){const r=Ro(t),i=Ro(n),s=Ro(e),[o,a,u]=s,[l,c,h]=G2(r,i),d=c*u-h*a,v=h*o-l*u,M=l*a-c*o,A=M*c-v*h,P=d*h-M*l,C=v*l-d*c,g=1/Math.sqrt(Math.pow(A,2)+Math.pow(P,2)+Math.pow(C,2)),D=[A*g,P*g,C*g],F=[-1*A*g,-1*P*g,-1*C*g],G=fn(r,i),N=fn(r,D),H=fn(i,D),f=fn(r,F),p=fn(i,F);let m;return N<f&&N<p||H<f&&H<p?m=D:m=F,fn(r,m)>G||fn(i,m)>G?lt(hn(m),hn(r))<=lt(hn(m),hn(i))?[hn(r),!0,!1]:[hn(i),!1,!0]:[hn(m),!1,!1]}function B2(t,n){if(!t)throw new Error("line is required");if(!n)throw new Error("splitter is required");var e=aa(t),r=aa(n);if(e!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=_2(n,{precision:7});switch(r){case"Point":return Bo(t,i);case"MultiPoint":return zc(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return zc(t,or(t,i,{ignoreSelfIntersections:!0}))}}function zc(t,n){var e=[],r=Gc();return Ut(n,function(i){if(e.forEach(function(a,u){a.id=u}),!e.length)e=Bo(t,i).features,e.forEach(function(a){a.bbox||(a.bbox=b2(yt(a)))}),r.load(Ee(e));else{var s=r.search(i);if(s.features.length){var o=Jc(i,s);e=e.filter(function(a){return a.id!==o.id}),r.remove(o),Nt(Bo(o,i),function(a){e.push(a),r.insert(a)})}}}),Ee(e)}function Bo(t,n){var e=[],r=Ue(t)[0],i=Ue(t)[t.geometry.coordinates.length-1];if(No(r,de(n))||No(i,de(n)))return Ee([t]);var s=Gc(),o=S2(t);s.load(o);var a=s.search(n);if(!a.features.length)return Ee([t]);var u=Jc(n,a),l=[r],c=Lf(o,function(h,d,v){var M=Ue(d)[1],A=de(n);return v===u.id?(h.push(A),e.push(qn(h)),No(A,M)?[A]:[A,M]):(h.push(M),h)},l);return c.length>1&&e.push(qn(c)),Ee(e)}function Jc(t,n){if(!n.features.length)throw new Error("lines must contain features");if(n.features.length===1)return n.features[0];var e,r=1/0;return Nt(n,function(i){var s=D2(i,t),o=s.properties.dist;o<r&&(e=i,r=o)}),e}function No(t,n){return t[0]===n[0]&&t[1]===n[1]}var N2=B2;class U2 extends br{constructor(){super(...arguments);w(this,"mode","cut");w(this,"lineDrawer",new So(this.gm,{snappingMarkers:"first",targetShape:"polygon"}));w(this,"cutShapesAllowed",["circle","line","rectangle","polygon"]);w(this,"mapEventHandlers",{[`${Y}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.cutPolygonFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return pe(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}cutPolygonFinished(e){this.lineDrawer.endShape();const r=xo(e.geoJson),i=this.getBBoxFeaturesByPolygon(r);this.cutFeaturesByPolygon(i,r)}getBBoxFeaturesByPolygon(e){const r=Ss(e),i=this.gm.mapAdapter.coordBoundsToScreenBounds(r);return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:i,sourceNames:[O.main]})}cutFeaturesByPolygon(e,r){e.forEach(i=>{if(Wl(i.getGeoJson(),r)){this.gm.features.delete(i),this.fireFeatureRemovedEvent(i);return}if(t2(i.getGeoJson(),r)&&this.cutShapesAllowed.includes(i.shape)){if(i.shape==="line"){this.cutLineFeatureByPolygon(i,r);return}this.cutPolygonFeatureByPolygon(i.id,r)}})}cutLineFeatureByPolygon(e,r){const i=e.getGeoJson(),s=N2(i,r);if(s.features.length===0)return;const o=[];if(s.features.filter(a=>!Wl(a,r)).forEach(a=>{const u=this.createLineFeature(Jl(a));u&&o.push(u)}),this.gm.features.delete(e),!xc(o)){B.error("cutLineFeatureByPolygon: resultFeatures not found",s);return}this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:o})}createLineFeature(e){const r={...e,properties:{shape:"line"}};return this.gm.features.createFeature({shapeGeoJson:r,sourceName:O.main})}cutPolygonFeatureByPolygon(e,r){const i=this.gm.features.get(O.main,e);if(!i){B.warn("cutPolygonFeatureByPolygon: featureData not found",e);return}i.convertToPolygon();const s=i.getGeoJson(),o=this.getGeoJsonDifference(s,r);o&&(i.updateGeoJsonGeometry(o.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[i],targetFeatures:[i]}))}getGeoJsonDifference(e,r){const i=Ee([e,r]),s=M2(i);return s?s.type==="Feature"?s:(s.type==="FeatureCollection"&&B.error("getGeoJsonDifference: FeatureCollection detected (not supported)",s),null):null}}class H2 extends br{constructor(){super(...arguments);w(this,"mode","delete");w(this,"mapEventHandlers",{click:this.onMouseClick.bind(this)})}onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0}),this.gm.markerPointer.pauseSnapping()}onEndAction(){this.gm.markerPointer.resumeSnapping(),this.gm.markerPointer.disable()}onMouseClick(e){if(!pe(e,{warning:!0}))return{next:!1};const r=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[O.main]});return r&&(this.gm.features.delete(r),this.fireFeatureRemovedEvent(r)),{next:!1}}}class z2 extends To{constructor(){super(...arguments);w(this,"mode","drag")}onStartAction(){}onEndAction(){}handleGmEdit(e){return Dn(e)?e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(this.previousLngLat||(this.previousLngLat=e.lngLatStart),this.moveFeature(e.featureData,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(this.isDragging=!0,e.featureData.changeSource({sourceName:O.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(this.previousLngLat=null,this.isDragging=!1,e.featureData.changeSource({sourceName:O.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}):(B.error("EditDrag.handleGmEdit: not an edit event",e),{next:!0})}}function qc(t,n,e={}){if(e.final===!0)return J2(t,n);const r=de(t),i=de(n),s=me(r[0]),o=me(i[0]),a=me(r[1]),u=me(i[1]),l=Math.sin(o-s)*Math.cos(u),c=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(o-s);return dn(Math.atan2(l,c))}function J2(t,n){let e=qc(n,t);return e=(e+180)%360,e}var Vc=qc;function q2(t,n,e){if(e=e||{},!Xi(e))throw new Error("options is invalid");const r=e.pivot,i=e.mutate;if(!t)throw new Error("geojson is required");if(n==null||isNaN(n))throw new Error("angle is required");if(n===0)return t;const s=r??Ll(t);return(i===!1||i===void 0)&&(t=si(t)),Bt(t,function(o){const u=wy(s,o)+n,l=Ey(s,o),c=Ue(by(s,l,u));o[0]=c[0],o[1]=c[1]}),t}var V2=q2;class Y2 extends To{constructor(){super(...arguments);w(this,"mode","rotate");w(this,"convertFeaturesTypes",["rectangle"])}onStartAction(){}onEndAction(){}handleGmEdit(e){var r;return Dn(e)?e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(((r=e.markerData)==null?void 0:r.type)==="vertex"?this.moveVertex(e):this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(e.featureData.changeSource({sourceName:O.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(e.featureData.changeSource({sourceName:O.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}):(B.error("EditChange.handleGmEdit: not an edit event",e),{next:!1})}moveVertex(e){this.rotateFeature(e.featureData,e)}rotateFeature(e,r){const i=Ye(e.getGeoJson()),s=_l(Cl(i)),o=this.calculateRotationAngle(s,r.lngLatStart,r.lngLatEnd);i.geometry=V2(i,o,{pivot:s}).geometry,this.fireBeforeFeatureUpdate({features:[e],geoJsonFeatures:[i]}),this.updateFeatureGeoJson({featureData:e,featureGeoJson:i})&&e.convertToPolygon()}calculateRotationAngle(e,r,i){const s=Vc(e,r);return(Vc(e,i)-s+360)%360}}const Uo={drag:z2,change:Qy,rotate:Y2,scale:null,copy:null,cut:U2,split:null,union:null,difference:null,line_simplification:null,lasso:null,delete:H2},W2=(t,n)=>Uo[n]?new Uo[n](t):(B.error(`Edit "${n}" is not available`),null);class $2 extends ei{constructor(e,r){super(e);w(this,"mapEventHandlers",{[`${Y}:edit`]:this.handleEditEvent.bind(this)});r.attachEvents(this.mapEventHandlers)}handleEditEvent(e){if(!Dn(e))return{next:!0};const r=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(r,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(r)),{next:!0}}start(e,r){if(r.action!=="mode_start")return;const i=W2(this.gm,r.mode);i&&(e in this.gm.actionInstances&&B.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=i,i.startAction())}end(e){const r=this.gm.actionInstances[e];r instanceof br?(r.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}": `,r)}}const j2=(t,n)=>{let e=null;try{t.forEach(r=>{if(n(r))throw e=r,new Error("found")})}catch{}return e};class Z2 extends un{constructor(){super(...arguments);w(this,"mode","shape_markers");w(this,"pinEnabled",((Qc=this.gm.options.controls.helper.pin)==null?void 0:Qc.active)||!1);w(this,"previousPosition",null);w(this,"activeMarker",null);w(this,"activeFeatureData",null);w(this,"sharedMarkers",[]);w(this,"allowedShapes",["circle","line","rectangle","polygon"]);w(this,"edgeMarkersAllowed",!1);w(this,"edgeMarkerAllowedShapes",["line","rectangle","polygon"]);w(this,"shapeMarkerAllowedModes",["drag","change","cut","split"]);w(this,"mapEventHandlers",{[`${Y}:draw`]:this.handleGmDraw.bind(this),[`${Y}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this),mousemove:this.onMouseMove.bind(this),touchmove:this.onMouseMove.bind(this),contextmenu:this.onMouseRightButtonClick.bind(this)});w(this,"throttledMethods",Fn({sendMarkerMoveEvent:this.sendMarkerMoveEvent,sendMarkerRightClickEvent:this.sendMarkerRightClickEvent},this,this.gm.options.settings.throttlingDelay));w(this,"debouncedMethods",fy({refreshMarkers:this.refreshMarkers},this,this.gm.options.settings.throttlingDelay*10))}onStartAction(){this.isShapeMarkerAllowed()&&this.gm.markerPointer.enable({invisibleMarker:!0}),this.edgeMarkersAllowed=this.gm.getActiveEditModes().includes("change"),this.addMarkers()}onEndAction(){this.gm.markerPointer.disable(),this.removeMarkers()}setPin(e){this.pinEnabled=e}onMouseDown(e){var s;const r=["mousedown","touchstart"];if(!pe(e,{warning:!0})||!r.includes(e.type))return{next:!0};if(e.type==="mousedown"&&e.originalEvent.button!==0)return{next:!0};const i=this.getFeatureMarkerByMouseEvent(e);return this.activeMarker=i||null,this.activeFeatureData=(i==null?void 0:i.instance.parent)||null,this.activeMarker&&this.activeFeatureData?(this.previousPosition=Os(this.activeMarker.instance),this.gm.mapAdapter.setDragPan(!1),this.activeMarker.type==="edge"&&this.sendMarkerEvent("edge_marker_click",this.activeFeatureData,this.activeMarker),this.pinEnabled?(this.sharedMarkers=this.getSharedMarkers(this.activeMarker.position.coordinate),this.sharedMarkers.forEach(o=>{var a;return(a=this.snappingHelper)==null?void 0:a.addExcludedFeature(o.featureData)})):(s=this.snappingHelper)==null||s.addExcludedFeature(this.activeFeatureData),this.sendMarkerEvent("marker_captured",this.activeFeatureData,this.activeMarker),{next:!1}):{next:!0}}onMouseUp(){var r;if(!this.activeMarker)return{next:!0};const e={featureData:this.activeFeatureData,markerData:this.activeMarker};return this.activeMarker=null,this.activeFeatureData=null,this.sharedMarkers=[],(r=this.snappingHelper)==null||r.clearExcludedFeatures(),this.previousPosition=null,this.gm.mapAdapter.setDragPan(!0),e.featureData&&e.markerData?(this.sendMarkerEvent("marker_released",e.featureData,e.markerData),{next:!1}):(B.debug("ShapeMarkersHelper.onMouseUp: no active marker or featureData",e),{next:!0})}onMouseMove(e){return!this.activeMarker||!pe(e,{warning:!0})?{next:!0}:(this.throttledMethods.sendMarkerMoveEvent(e),{next:!1})}onMouseRightButtonClick(e){const r=this.getFeatureMarkerByMouseEvent(e);return r&&r.instance.parent?(this.throttledMethods.sendMarkerRightClickEvent(r.instance.parent,r),{next:!1}):{next:!0}}isShapeMarkerAllowed(){return Y0(this.shapeMarkerAllowedModes,this.gm.getActiveEditModes()).length>0}convertToVertexMarker(e){if(e.type==="edge"&&e.instance.parent){const r=e.position,i=e.instance.parent;this.removeMarker(e);const s=this.createMarker({type:"vertex",positionData:r,parentFeature:i}),o=i.getGeoJson(),a=Ml(o,r.coordinate);if(a){const u=a.path.join("."),l=i.markers.get(u);return l&&this.removeMarker(l),i.markers.set(u,s),s}}return B.error("ShapeMarkersHelper.convertToVertexMarker: invalid marker type",e),e}getSharedMarkers(e){const r=[];return this.gm.features.forEach(i=>{i.markers.forEach(s=>{s.type==="vertex"&&tr(s.position.coordinate,e)&&r.push({featureData:i,markerData:s})})}),r}getFeatureMarkerByMouseEvent(e){var i;const r=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[O.main]});if((i=r==null?void 0:r.parent)!=null&&i.markers){const s=j2(r.parent.markers,o=>o.instance===r);if((s==null?void 0:s.type)!=="dom")return s}return null}addMarkers(){this.gm.features.forEach(e=>{if(!e||!this.allowedShapes.includes(e.shape))return;this.addCenterMarker(e);const r=this.getAllShapeSegments(e);r.forEach((i,s)=>{if(this.isMarkerIndexAllowed(e.shape,s,r.length)){const a=this.createOrUpdateVertexMarker(i.segment.start,e);if(e.markers.set(a.markerKey,a.markerData),e.shape==="line"&&s===r.length-1){const u=this.createOrUpdateVertexMarker(i.segment.end,e);e.markers.set(u.markerKey,u.markerData)}}if(this.isEdgeMarkerAllowed(e)){const a=this.createOrUpdateEdgeMarker(i,e);e.markers.set(a.markerKey,a.markerData)}})})}addCenterMarker(e){if(e.shapeProperties.center){const r=this.createMarker({type:"center",positionData:{path:[],coordinate:e.shapeProperties.center},parentFeature:e});e.markers.set("center",r)}}getAllShapeSegments(e){const r=e.getGeoJson(),i=[];return bl(r,(s,o)=>{i.push({segment:s,middle:this.getSegmentMiddlePosition(s),edgeMarkerKey:this.getEdgeMarkerKey(o)})}),i}isEdgeMarkerAllowed(e){return this.edgeMarkersAllowed&&this.edgeMarkerAllowedShapes.includes(e.shape)}isMarkerIndexAllowed(e,r,i){const s=Math.floor(i/4);return e==="circle"?(r+s/2)%s===0:!0}getEdgeMarkerKey(e){return`edge.${e}`}getSegmentMiddlePosition(e){const r=this.gm.mapAdapter.project(e.start.coordinate),i=this.gm.mapAdapter.project(e.end.coordinate),s=[(r[0]+i[0])/2,(r[1]+i[1])/2],o=e.start.path.slice(0,e.start.path.length-1).concat([-1]);return{coordinate:this.gm.mapAdapter.unproject(s),path:o}}removeMarkers(){this.gm.features.forEach((e,r)=>{const i=this.gm.features.get(O.main,r);i&&(i.markers.forEach(s=>{s.type!=="dom"?this.gm.features.delete(s.instance):B.error("Non a FeatureData marker",s)}),i.markers=new Map)})}removeMarker(e){if(e.type==="dom"){B.error("Wrong marker type",e);return}const r=e.instance.parent;if(!r){B.error("Missing parent feature data",e);return}try{r.markers.forEach((i,s)=>{if(i===e)throw this.gm.features.delete(i.instance),r.markers.delete(s),new Error("break")})}catch{}}createMarker({type:e,segment:r,positionData:i,parentFeature:s}){const o=i.coordinate,a=this.gm.features.createMarkerFeature({sourceName:s.sourceName,parentFeature:s,type:e,coordinate:o});if(!a)throw new Error(`Missine feature data for the "${e}" marker`);if(e==="edge"&&r)return{type:e,instance:a,position:Ye(i),segment:r};if(e==="vertex"||e==="center")return{type:e,instance:a,position:Ye(i)};throw new Error(`Invalid marker type "${e}" with segment: ${r}`)}handleGmDraw(e){return ks(e)?(e.action==="feature_created"&&this.debouncedMethods.refreshMarkers(),{next:!0}):(B.error("ShapeMarkersHelper.handleGmDraw: not a draw event",e),{next:!0})}refreshMarkers(){this.removeMarkers(),this.addMarkers()}handleGmEdit(e){return Dn(e)?(e.action==="feature_updated"&&this.gm.features.withAtomicSourcesUpdate(()=>{this.handleShapeUpdate(e)}),{next:!0}):(B.error("ShapeMarkersHelper.handleGmEdit: not an edit event",e),{next:!0})}handleShapeUpdate(e){var o;const r=e.targetFeatures[0];if(!r){B.error("ShapeMarkersHelper.handleShapeUpdate: no featureData",e);return}((o=this.activeMarker)==null?void 0:o.type)==="edge"&&(this.activeMarker=this.convertToVertexMarker(this.activeMarker));const i=this.getAllShapeSegments(r),s=new Set(r.markers.keys());i.forEach((a,u)=>{if(this.isMarkerIndexAllowed(r.shape,u,i.length)){const c=this.createOrUpdateVertexMarker(a.segment.start,r);if(s.delete(c.markerKey),r.shape==="line"&&u===i.length-1){const h=this.createOrUpdateVertexMarker(a.segment.end,r);s.delete(h.markerKey)}}if(this.isEdgeMarkerAllowed(r)){const c=this.createOrUpdateEdgeMarker(a,r);s.delete(c.markerKey)}}),this.updateCenterMarkerPosition(r),s.delete("center"),s.forEach(a=>{const u=r.markers.get(a);u&&u.type!=="dom"?this.gm.features.delete(u.instance):B.error("Non a FeatureData marker"),r.markers.delete(a)})}createOrUpdateVertexMarker(e,r){const i=e.path.join(".");let s=r.markers.get(i)||null;if(s&&(s==null?void 0:s.type)!=="vertex")throw new Error(`Invalid marker type "${s==null?void 0:s.type}" for edge marker`);return s?(tr(s.position.coordinate,e.coordinate)||this.gm.features.updateMarkerFeaturePosition(s.instance,e.coordinate),s.position=e):(s=this.createMarker({type:"vertex",positionData:e,parentFeature:r}),r.markers.set(i,s)),{markerKey:i,markerData:s}}createOrUpdateEdgeMarker(e,r){let i=r.markers.get(e.edgeMarkerKey)||null;if(i&&(i==null?void 0:i.type)!=="edge")throw new Error(`Invalid marker type "${i==null?void 0:i.type}" for edge marker`);return i?(tr(i.position.coordinate,e.middle.coordinate)||i.instance.updateGeoJsonGeometry({type:"Point",coordinates:e.middle.coordinate}),i.position=e.middle,i.segment=e.segment):(i=this.createMarker({type:"edge",positionData:e.middle,segment:e.segment,parentFeature:r}),r.markers.set(e.edgeMarkerKey,i)),{markerKey:e.edgeMarkerKey,markerData:i}}updateCenterMarkerPosition(e){const r=e.markers.get("center")||null;r&&r.type!=="dom"&&e.shapeProperties.center&&(r.instance.updateGeoJsonGeometry({type:"Point",coordinates:e.shapeProperties.center}),r.position.coordinate=e.shapeProperties.center)}sendMarkerEvent(e,r,i){const s={level:"system",type:"edit",mode:"change",action:e,featureData:r,markerData:i};this.gm.events.fire(`${Y}:edit`,s)}sendMarkerRightClickEvent(e,r){const i={level:"system",type:"edit",mode:"change",action:"marker_right_click",featureData:e,markerData:r};this.gm.events.fire(`${Y}:edit`,i)}sendMarkerMoveEvent(e){var i;const r=((i=this.gm.markerPointer.marker)==null?void 0:i.getLngLat())||e.lngLat.toArray();this.activeMarker&&this.activeFeatureData&&(this.pinEnabled?this.sharedMarkers:[{markerData:this.activeMarker,featureData:this.activeFeatureData}]).forEach(o=>{if(this.previousPosition){const a={level:"system",type:"edit",mode:"drag",action:"marker_move",featureData:o.featureData,markerData:o.markerData,lngLatStart:this.previousPosition,lngLatEnd:r};this.gm.events.fire(`${Y}:edit`,a)}}),this.previousPosition=r}}class X2 extends un{constructor(){super(...arguments);w(this,"mode","snapping");w(this,"tolerance",18);w(this,"excludedFeature",new Set);w(this,"customSnappingLngLats",new Map);w(this,"customSnappingFeatures",new Set);w(this,"lineSnappingShapes",["circle","line","rectangle","polygon","snap_guide"]);w(this,"mapEventHandlers",{});w(this,"shapeSnappingHandlers",{marker:this.getPointsSnapping.bind(this),circle:this.getLineSnapping.bind(this),circle_marker:this.getPointsSnapping.bind(this),text_marker:this.getPointsSnapping.bind(this),line:this.getLineSnapping.bind(this),rectangle:this.getLineSnapping.bind(this),polygon:this.getLineSnapping.bind(this),snap_guide:this.getLineSnapping.bind(this)})}onStartAction(){this.gm.markerPointer.setSnapping(!0)}onEndAction(){this.gm.markerPointer.setSnapping(!1)}addExcludedFeature(e){this.excludedFeature.add(e)}clearExcludedFeatures(){this.excludedFeature.clear()}addCustomSnappingFeature(e){this.customSnappingFeatures.add(e)}removeCustomSnappingFeature(e){this.customSnappingFeatures.delete(e)}clearCustomSnappingFeature(){this.customSnappingFeatures.clear()}setCustomSnappingCoordinates(e,r){this.customSnappingLngLats.set(e,r)}clearCustomSnappingCoordinates(e){this.customSnappingLngLats.delete(e)}getSnappedLngLat(e,r){let i=this.getCustomLngLatsSnapping(r);if(i)return i;const s=this.getFeaturesInPointBounds(r).filter(o=>!this.excludedFeature.has(o));return i=this.getFeaturePointsSnapping(s,e,r),i||(i=this.getFeatureLinesSnapping(s,e,r),i)?i:e}getCustomLngLatsSnapping(e){const r={distance:1/0,lngLat:null};return this.customSnappingLngLats.forEach(i=>{i.forEach(s=>{const o=this.gm.mapAdapter.project(s),a=Kr(e,o);a<this.tolerance&&a<r.distance&&(r.distance=a,r.lngLat=s)})}),r.lngLat}getFeaturePointsSnapping(e,r,i){let s=e.map(o=>({shape:o.shape,...this.getPointsSnapping(o,r,i)})).filter(o=>o.distance<this.tolerance);return s.length?(s=gl(s,["distance"]),s[0].lngLat):null}getFeatureLinesSnapping(e,r,i){let s=e.filter(o=>this.lineSnappingShapes.includes(o.shape)).map(o=>{const a=this.shapeSnappingHandlers[o.shape];return a?{shape:o.shape,...a(o,r,i)}:null}).filter(o=>o!==null&&o.distance<this.tolerance);return s.length?(s=gl(s,["distance"]),s[0].lngLat):null}getFeaturesInPointBounds(e){const r=[[e[0]-this.tolerance,e[1]-this.tolerance],[e[0]+this.tolerance,e[1]+this.tolerance]];return this.gm.features.getFeaturesByScreenBounds({bounds:r,sourceNames:[O.main,O.temporary]}).filter(i=>i.temporary?this.customSnappingFeatures.has(i):!0)||[]}getPointsSnapping(e,r,i){const s=e.getGeoJson(),o={distance:1/0,coord:null};return nr(s,a=>{const u=this.gm.mapAdapter.project(a.coordinate),l=Kr(i,u);l<this.tolerance&&l<o.distance&&(o.distance=l,o.coord=a.coordinate)},!0),{lngLat:o.coord?o.coord:r,distance:o.distance}}getLineSnapping(e,r,i){const s=e.getGeoJson();return this.getNearestLinePointData(s,r,i)}getNearestLinePointData(e,r,i){const s={lngLat:r,distance:1/0},o=this.gm.mapAdapter.getEuclideanNearestLngLat(e,r),a=this.gm.mapAdapter.project(o);return s.distance=Kr(a,i),s.distance<this.tolerance&&(s.lngLat=o),s}}class K2 extends un{constructor(){super(...arguments);w(this,"mode","zoom_to_features");w(this,"mapEventHandlers",{})}onStartAction(){this.fitMapToFeatures(),setTimeout(()=>{this.gm.options.disableMode("helper","zoom_to_features")})}onEndAction(){}fitMapToFeatures(){const e=this.gm.features.asGeoJsonFeatureCollection({sourceNames:[O.main,O.standby]}),r=oa(e),i=[[r[0],r[1]],[r[2],r[3]]];try{this.gm.mapAdapter.fitBounds(i,{padding:20})}catch{B.warn("Wrong bounds for zooming to features",i,e)}}}const Ho={shape_markers:Z2,pin:null,snapping:X2,snap_guides:null,measurements:null,auto_trace:null,geofencing:null,zoom_to_features:K2,click_to_edit:null},Q2=(t,n)=>Ho[n]?new Ho[n](t):(B.error(`Helper "${n}" is not available`),null);class ew extends ei{constructor(e,r){super(e);w(this,"mapEventHandlers",{[`${Y}:helper`]:this.handleHelperEvent.bind(this)});r.attachEvents(this.mapEventHandlers)}handleHelperEvent(e){if(!ti(e))return{next:!0};const r=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(r,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(r)),{next:!0}}start(e,r){const i=Q2(this.gm,r.mode);i&&(e in this.gm.actionInstances&&B.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=i,i.startAction())}end(e){const r=this.gm.actionInstances[e];r instanceof un?(r.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}":`,r)}}class tw{constructor(n){w(this,"gm");w(this,"bus");w(this,"listeners",{});this.gm=n,this.bus=new ay(this.gm),this.listeners={draw:new Ky(this.gm,this.bus),edit:new $2(this.gm,this.bus),helper:new ew(this.gm,this.bus),control:new ly(this.gm,this.bus)}}fire(n,e){this.listeners[e.type]||B.error(`Can't find event listener for "${e.type}" event type`),this.bus.fireEvent(n,e)}}class Yc{getEuclideanNearestLngLat(n,e){const r=this.project(e);let i=[0,0],s=1/0;return bl(n,o=>{const a=this.project(o.start.coordinate),u=this.project(o.end.coordinate),l=am(a,u,r),c=Kr(r,l);c<s&&(s=c,i=[l[0],l[1]])}),this.unproject(i)}getDistance(n,e){return If(n,e,{units:"meters"})}}class Wc{isInstanceAvailable(){return this.layerInstance?!0:(B.error("layerInstance is not available"),!1)}}class zo extends Wc{constructor({gm:e,layerId:r,options:i}){super();w(this,"gm");w(this,"layerInstance",null);w(this,"mapInstance");this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,i?this.layerInstance=this.createLayer(i):this.layerInstance=this.mapInstance.getLayer(r)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.id}get source(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.source}createLayer(e){return this.mapInstance.addLayer(e),this.mapInstance.getLayer(e.id)||null}remove(){this.isInstanceAvailable()&&this.mapInstance.removeLayer(this.id),this.layerInstance=null}}class nw extends Gr{constructor({mapInstance:e,options:r,lngLat:i}){super();w(this,"markerInstance");this.markerInstance=new Se.Marker(r).setLngLat(i).addTo(e)}getElement(){var e;return this.isMarkerInstanceAvailable()&&((e=this.markerInstance)==null?void 0:e.getElement())||null}setLngLat(e){var r;this.isMarkerInstanceAvailable()&&((r=this.markerInstance)==null||r.setLngLat(e))}getLngLat(){var e;return this.isMarkerInstanceAvailable()?((e=this.markerInstance)==null?void 0:e.getLngLat().toArray())||[0,0]:[0,0]}remove(){var e;(e=this.markerInstance)==null||e.remove()}}class $c{isInstanceAvailable(){return this.popupInstance?!0:(B.error("Popup instance is not available"),!1)}}class rw extends $c{constructor({mapInstance:e,options:r,lngLat:i}){super();w(this,"popupInstance");this.popupInstance=new Se.Popup(r).addTo(e),i&&this.setLngLat(i)}getLngLat(){return this.isInstanceAvailable()?this.popupInstance.getLngLat().toArray()||[0,0]:[0,0]}setLngLat(e){this.isInstanceAvailable()&&this.popupInstance.setLngLat(e)}setHtml(e){this.isInstanceAvailable()&&this.popupInstance.setHTML(e)}remove(){this.isInstanceAvailable()&&this.popupInstance.remove()}}class jc extends Tl{constructor({gm:e,geoJson:r,sourceId:i}){super();w(this,"gm");w(this,"mapInstance");w(this,"sourceInstance");this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,r?this.sourceInstance=this.createSource({geoJson:r,sourceId:i}):this.sourceInstance=this.mapInstance.getSource(i)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.id}createSource({geoJson:e,sourceId:r}){return this.mapInstance.addSource(r,{type:"geojson",data:e}),this.mapInstance.getSource(r)||null}getGeoJson(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.serialize().data}setGeoJson(e){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.setData(e)}updateData(e){if(!this.isInstanceAvailable())return;const r=this.convertGeoJsonDiffToMlDiff(e);this.sourceInstance.updateData(r)}convertGeoJsonDiffToMlDiff(e){return{add:e.add,update:e.update.map(this.convertFeatureToMlUpdateDiff.bind(this)),remove:e.remove}}convertFeatureToMlUpdateDiff(e){const r=Object.entries(e.properties||{}).map(i=>({key:i[0],value:i[1]}));return{id:e.id,newGeometry:e.geometry,addOrUpdateProperties:r}}remove({removeLayers:e}){this.isInstanceAvailable()&&(e&&this.gm.mapAdapter.eachLayer(r=>{r.source===this.sourceInstance.id&&this.gm.mapAdapter.removeLayer(r.id)}),this.mapInstance.removeSource(this.sourceInstance.id))}}class iw extends Yc{constructor(e,r){super();w(this,"gm");w(this,"mapType","maplibre");w(this,"mapInstance");this.gm=r,this.mapInstance=e}getMapInstance(){return this.mapInstance}isLoaded(){return this.mapInstance.loaded()}getContainer(){return this.mapInstance.getContainer()}getCanvas(){return this.mapInstance.getCanvas()}addControl(e){this.mapInstance.addControl(e)}removeControl(e){this.mapInstance.removeControl(e)}async loadImage({id:e,image:r}){const i=await this.mapInstance.loadImage(r);this.mapInstance.addImage(e,i.data)}getBounds(){return this.mapInstance.getBounds().toArray()}fitBounds(e,r){this.mapInstance.fitBounds(e,r)}setCursor(e){this.mapInstance.getCanvas().style.cursor=e}disableMapInteractions(e){e.forEach(r=>{this.mapInstance[r].disable()})}enableMapInteractions(e){e.forEach(r=>{this.mapInstance[r].enable()})}setDragPan(e){e?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()}queryFeaturesByScreenCoordinates({queryCoordinates:e=void 0,sourceNames:r}){return _s(this.mapInstance.queryRenderedFeatures(e).map(s=>({featureId:s.properties[sn],featureSourceName:s.source})),er).map(({featureId:s,featureSourceName:o})=>s===void 0||!r.includes(o)?null:this.gm.features.get(o,s)||null).filter(s=>!!s)}queryGeoJsonFeatures({queryCoordinates:e=void 0,sourceNames:r}){const i=(o,a)=>(o==null?void 0:o.id)===(a==null?void 0:a.id);return _s(this.mapInstance.queryRenderedFeatures(e).map(o=>{const a=this.convertToGeoJsonImportFeature(o);return a?{id:o.properties[sn],sourceName:o.source,geoJson:a}:null}),i).filter(o=>!!o&&o.id!==void 0&&o.geoJson&&r.includes(o.sourceName))}convertToGeoJsonImportFeature(e){const r=e.properties[sn];return r===void 0||e.geometry.type==="GeometryCollection"?null:{id:r,type:"Feature",properties:e.properties,geometry:e.geometry}}addSource(e,r){return new jc({gm:this.gm,sourceId:e,geoJson:r})}getSource(e){return new jc({gm:this.gm,sourceId:e})}addLayer(e){const r=e.id;return new zo({gm:this.gm,layerId:r,options:e})}getLayer(e){return new zo({gm:this.gm,layerId:e})}removeLayer(e){const r=this.getLayer(e);r&&r.remove()}eachLayer(e){this.mapInstance.getStyle().layers.forEach(r=>{e(new zo({gm:this.gm,layerId:r.id}))})}createDomMarker(e,r){return new nw({mapInstance:this.mapInstance,options:e,lngLat:r})}createPopup(e,r){return new rw({mapInstance:this.mapInstance,options:e,lngLat:r})}project(e){const r=this.mapInstance.project(e);return[r.x,r.y]}unproject(e){const r=this.mapInstance.unproject(e);return[r.lng,r.lat]}coordBoundsToScreenBounds(e){const r=new Se.LngLatBounds(e),i=this.project(r.getSouthWest().toArray()),s=this.project(r.getNorthEast().toArray());return[i,s]}fire(e,r){this.mapInstance.fire(e,r)}on(e,r,i){if(typeof r=="string"&&i&&ai(e))this.mapInstance.on(e,r,i);else if(typeof r=="function")this.mapInstance.on(e,r);else throw new Error("Invalid arguments passed to 'on' method")}once(e,r,i){if(typeof r=="string"&&i&&ai(e))this.mapInstance.once(e,r,i);else if(typeof r=="function")this.mapInstance.once(e,r);else throw new Error("Invalid arguments passed to 'once' method.")}off(e,r,i){if(typeof r=="string"&&i&&ai(e))this.mapInstance.off(e,r,i);else if(typeof r=="function")this.mapInstance.off(e,r);else throw new Error("Invalid arguments passed to 'off' method")}}const sw=async(t,n)=>new iw(n,t),ow=(t,n)=>{if(Array.isArray(t)&&Array.isArray(n)){const e=W0(t,"type");return n.forEach(r=>{e[r.type]?$0(e[r.type],r):e[r.type]=Ye(r)}),z0(e)}};class aw{constructor(n,e={}){w(this,"gm");w(this,"settings");w(this,"controls");w(this,"layerStyles");this.gm=n;const r=B0(Xl(),e,ow);this.settings=r.settings,this.controls=r.controls,this.layerStyles=r.layerStyles}enableMode(n,e){const r=this.isModeEnabled(n,e),i=this.isModeAvailable(n,e);if(i||B.warn(`Unable to enable mode, "${n}:${e}" is not available`),r||!i)return;const o=this.controls[n][e];o?(o.active=!0,this.fireModeEvent(n,e,"mode_start"),this.fireControlEvent(n,e,"on"),this.fireModeEvent(n,e,"mode_started")):B.error("Can't find control section for",n,e)}disableMode(n,e){const r=this.isModeEnabled(n,e),i=this.isModeAvailable(n,e);if(!r||!i)return;const o=this.controls[n][e];o?(o.active=!1,this.fireModeEvent(n,e,"mode_end"),this.fireControlEvent(n,e,"off"),this.fireModeEvent(n,e,"mode_ended")):B.error("Can't find control section for",n,e)}syncModeState(n,e){const i=this.controls[n][e],s=this.isModeAvailable(n,e);i&&(s?i.active?this.enableMode(n,e):this.disableMode(n,e):(i.active=!1,i.uiEnabled=!1))}toggleMode(n,e){this.isModeEnabled(n,e)?this.disableMode(n,e):this.enableMode(n,e)}isModeEnabled(n,e){return!!Object.entries(this.gm.actionInstances).find(([r,i])=>r===`${n}__${e}`&&i)}isModeAvailable(n,e){return n==="draw"&&Zt(e,Ts)?!!ko[e]:n==="edit"&&Zt(e,Mo)?!!Uo[e]:n==="helper"&&Zt(e,bo)?!!Ho[e]:!1}getControlOptions({actionType:n,modeName:e}){return n&&e&&this.controls[n][e]||null}fireModeEvent(n,e,r){const i={level:"system",type:n,mode:e,action:r};Qr(i)&&(ks(i)?this.gm.events.fire(`${Y}:${n}`,i):Dn(i)?this.gm.events.fire(`${Y}:${n}`,i):ti(i)&&this.gm.events.fire(`${Y}:${n}`,i))}fireControlEvent(n,e,r){const i={level:"system",type:"control",section:n,target:e,action:r};this.gm.events.fire(`${Y}:control`,i)}}class lw{constructor(n){w(this,"gm");w(this,"marker",null);w(this,"tmpMarker",null);w(this,"snapping",!1);w(this,"oldSnapping");this.gm=n,this.initEventHandlers()}initEventHandlers(){this.throttledMethods=Fn({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay),this.mapEventHandlers={mousemove:this.throttledMethods.onMouseMove.bind(this)}}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}setSnapping(n){if(n&&!this.snappingHelper){B.error("MarkerPointer: snapping is not available");return}this.snapping=n}pauseSnapping(){this.oldSnapping!==void 0&&B.error("MarkerPointer: snapping is already paused"),this.oldSnapping=this.snapping,this.setSnapping(!1)}resumeSnapping(){this.oldSnapping===void 0?(B.error("MarkerPointer: resumeSnapping is called before pauseSnapping"),this.setSnapping(!0)):(this.setSnapping(this.oldSnapping),this.oldSnapping=void 0)}enable({lngLat:n,customMarker:e,invisibleMarker:r}={lngLat:[0,0],customMarker:void 0,invisibleMarker:!1}){if(!cy()){if(e&&r)throw new Error("MarkerPointer: customMarker and invisibleMarker can't be used together");if(this.marker)throw new Error("MarkerPointer: marker is already enabled");this.gm.events.bus.attachEvents(this.mapEventHandlers),r?this.marker=this.createInvisibleMarker(n||[0,0]):this.marker=e||this.createMarker(n||[0,0]),this.gm.getActiveDrawModes().length&&this.gm.mapAdapter.setCursor("crosshair")}}disable(){this.marker&&(this.gm.events.bus.detachEvents(this.mapEventHandlers),this.marker.remove(),this.marker=null),this.gm.mapAdapter.setCursor("")}createMarker(n=[0,0]){return this.gm.mapAdapter.createDomMarker({anchor:"center",element:gc("dom",{pointerEvents:"none"})},n)}createInvisibleMarker(n=[0,0]){const e=document.createElement("div");return e.style.width="0px",e.style.height="0px",this.gm.mapAdapter.createDomMarker({anchor:"center",element:e},n)}onMouseMove(n){if(pe(n,{warning:!0})&&this.marker)if(this.snapping&&this.snappingHelper){const e=[n.point.x,n.point.y],r=this.snappingHelper.getSnappedLngLat(n.lngLat.toArray(),e);this.marker.setLngLat(r)}else this.marker.setLngLat(n.lngLat.toArray());return{next:!0}}syncTmpMarker(n){this.tmpMarker||(this.tmpMarker=this.createMarker(n)),this.tmpMarker.setLngLat(n)}}class Zc{constructor(n,e={}){w(this,"mapAdapterInstance",null);w(this,"globalLngLatBounds",this.getGlobalLngLatBounds());w(this,"features");w(this,"loaded",!1);w(this,"options");w(this,"events");w(this,"control");w(this,"actionInstances",{});w(this,"markerPointer");const r=Object.assign(n,{gm:this});this.options=new aw(this,e),this.events=new tw(this),this.features=new Wm(this),this.control=new iy(this),this.markerPointer=new lw(this),jl(n)&&n.once("load",async()=>{this.mapAdapterInstance=await sw(this,r),this.features.init(),await this.addControls()})}get mapAdapter(){if(this.mapAdapterInstance)return this.mapAdapterInstance;throw B.trace("Map adapter is not initialized"),new Error("Map adapter is not initialized")}addControls(n=void 0){return new Promise(e=>{(async()=>{B.debug("handleCreateControls"),n?this.control.createControls(n):this.mapAdapter.addControl(this.control),await this.onMapLoad(),e()})().then()})}removeControl(){return new Promise(n=>{this.disableAllModes(),this.mapAdapter.removeControl(this.control),n()})}async onMapLoad(){this.loaded||(await this.mapAdapter.loadImage({id:"default-marker",image:jt}),this.events.fire(`${Y}:control`,{level:"system",type:"control",action:"loaded"}),this.loaded=!0)}disableAllModes(){Oe(this.actionInstances).forEach(n=>{const[e,r]=n.split("__");uc(e)&&dc(r)&&this.options.disableMode(e,r)})}getActiveDrawModes(){return Oe(this.actionInstances).map(n=>{const e=this.actionInstances[n];return e instanceof bt?e.mode:null}).filter(n=>n!==null)}getActiveEditModes(){return Oe(this.actionInstances).map(n=>{const e=this.actionInstances[n];return e instanceof br?e.mode:null}).filter(n=>n!==null)}getActiveHelperModes(){return Oe(this.actionInstances).map(n=>{const e=this.actionInstances[n];return e instanceof un?e.mode:null}).filter(n=>n!==null)}getGlobalLngLatBounds(){return[[-179.99999,-85.051129],[179.99999,85.051129]]}setGlobalEventsListener(n=null){this.events.bus.forwarder.globalEventsListener=n}enableMode(n,e){this.options.enableMode(n,e)}disableMode(n,e){this.options.disableMode(n,e)}toggleMode(n,e){this.options.toggleMode(n,e)}isModeEnabled(n,e){return this.options.isModeEnabled(n,e)}enableDraw(n){this.options.enableMode("draw",n)}disableDraw(){this.getActiveDrawModes().forEach(n=>this.options.disableMode("draw",n))}toggleDraw(n){this.options.toggleMode("draw",n)}drawEnabled(n){return this.options.isModeEnabled("draw",n)}enableGlobalDragMode(){this.options.enableMode("edit","drag")}disableGlobalDragMode(){this.options.disableMode("edit","drag")}toggleGlobalDragMode(){this.options.toggleMode("edit","drag")}globalDragModeEnabled(){return this.options.isModeEnabled("edit","drag")}enableGlobalEditMode(){this.options.enableMode("edit","change")}disableGlobalEditMode(){this.options.disableMode("edit","change")}toggleGlobalEditMode(){this.options.toggleMode("edit","change")}globalEditModeEnabled(){return this.options.isModeEnabled("edit","change")}enableGlobalRotateMode(){this.options.enableMode("edit","rotate")}disableGlobalRotateMode(){this.options.disableMode("edit","rotate")}toggleGlobalRotateMode(){this.options.toggleMode("edit","rotate")}globalRotateModeEnabled(){return this.options.isModeEnabled("edit","rotate")}enableGlobalScaleMode(){this.options.enableMode("edit","scale")}disableGlobalScaleMode(){this.options.disableMode("edit","scale")}toggleGlobalScaleMode(){this.options.toggleMode("edit","scale")}globalScaleModeEnabled(){return this.options.isModeEnabled("edit","scale")}enableGlobalCopyMode(){this.options.enableMode("edit","copy")}disableGlobalCopyMode(){this.options.disableMode("edit","copy")}toggleGlobalCopyMode(){this.options.toggleMode("edit","copy")}globalCopyModeEnabled(){return this.options.isModeEnabled("edit","copy")}enableGlobalCutMode(){this.options.enableMode("edit","cut")}disableGlobalCutMode(){this.options.disableMode("edit","cut")}toggleGlobalCutMode(){this.options.toggleMode("edit","cut")}globalCutModeEnabled(){return this.options.isModeEnabled("edit","cut")}enableGlobalSplitMode(){this.options.enableMode("edit","split")}disableGlobalSplitMode(){this.options.disableMode("edit","split")}toggleGlobalSplitMode(){this.options.toggleMode("edit","split")}globalSplitModeEnabled(){return this.options.isModeEnabled("edit","split")}enableGlobalUnionMode(){this.options.enableMode("edit","union")}disableGlobalUnionMode(){this.options.disableMode("edit","union")}toggleGlobalUnionMode(){this.options.toggleMode("edit","union")}globalUnionModeEnabled(){return this.options.isModeEnabled("edit","union")}enableGlobalDifferenceMode(){this.options.enableMode("edit","difference")}disableGlobalDifferenceMode(){this.options.disableMode("edit","difference")}toggleGlobalDifferenceMode(){this.options.toggleMode("edit","difference")}globalDifferenceModeEnabled(){return this.options.isModeEnabled("edit","difference")}enableGlobalLineSimplificationMode(){this.options.enableMode("edit","line_simplification")}disableGlobalLineSimplificationMode(){this.options.disableMode("edit","line_simplification")}toggleGlobalLineSimplificationMode(){this.options.toggleMode("edit","line_simplification")}globalLineSimplificationModeEnabled(){return this.options.isModeEnabled("edit","line_simplification")}enableGlobalLassoMode(){this.options.enableMode("edit","lasso")}disableGlobalLassoMode(){this.options.disableMode("edit","lasso")}toggleGlobalLassoMode(){this.options.toggleMode("edit","lasso")}globalLassoModeEnabled(){return this.options.isModeEnabled("edit","lasso")}enableGlobalRemovalMode(){this.options.enableMode("edit","delete")}disableGlobalRemovalMode(){this.options.disableMode("edit","delete")}toggleGlobalRemovalMode(){this.options.toggleMode("edit","delete")}globalRemovalModeEnabled(){return this.options.isModeEnabled("edit","delete")}}const uw=async(t,n)=>{const r=new Zc(t,n);return await Promise.race([new Promise(i=>{r.mapAdapter.once(`${Y}:loaded`,i)}),new Promise((i,s)=>{setTimeout(()=>s(new Error(`Timeout ${6e4/1e3} seconds: can't init geoman`)),6e4)})]),r};$.BaseDomMarker=Gr,$.BaseLayer=Wc,$.BaseMapAdapter=Yc,$.BasePopup=$c,$.BaseSource=Tl,$.FEATURE_ID_PROPERTY=sn,$.FeatureData=rr,$.Geoman=Zc,$.createGeomanInstance=uw,$.drawModes=Ts,$.editModes=Mo,$.extraDrawModes=Il,$.hasMapOnceMethod=jl,$.helperModes=bo,$.isActionType=uc,$.isBaseMapEventName=Ym,$.isDrawModeName=cc,$.isEditModeName=fc,$.isGmEvent=Mt,$.isGmModeEvent=Qr,$.isHelperModeName=hc,$.isMapPointerEvent=pe,$.isModeName=dc,$.isNonEmptyArray=xc,$.isPointerEventName=ai,$.shapeNames=ir,Object.defineProperty($,Symbol.toStringTag,{value:"Module"})});
