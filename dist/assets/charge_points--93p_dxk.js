(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))N(L);new MutationObserver(L=>{for(const q of L)if(q.type==="childList")for(const x of q.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&N(x)}).observe(document,{childList:!0,subtree:!0});function D(L){const q={};return L.integrity&&(q.integrity=L.integrity),L.referrerPolicy&&(q.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?q.credentials="include":L.crossOrigin==="anonymous"?q.credentials="omit":q.credentials="same-origin",q}function N(L){if(L.ep)return;L.ep=!0;const q=D(L);fetch(L.href,q)}})();window.PUBLIC_PATH="/karten_vite/";const $s="/karten_vite/",Fu="api";function pg(O){return O&&O.__esModule&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O}var ih={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.5.0/LICENSE.txt
 */var fg=ih.exports,zp;function mg(){return zp||(zp=1,function(O,C){(function(D,N){O.exports=N()})(fg,function(){var D={},N={};function L(x,c,me){if(N[x]=me,x==="index"){var Ze="var sharedModule = {}; ("+N.shared+")(sharedModule); ("+N.worker+")(sharedModule);",Ue={};return N.shared(Ue),N.index(D,Ue),typeof window<"u"&&D.setWorkerUrl(window.URL.createObjectURL(new Blob([Ze],{type:"text/javascript"}))),D}}L("shared",["exports"],function(x){function c(n,t,r,s){return new(r||(r=Promise))(function(l,d){function p(v){try{_(s.next(v))}catch(w){d(w)}}function m(v){try{_(s.throw(v))}catch(w){d(w)}}function _(v){var w;v.done?l(v.value):(w=v.value,w instanceof r?w:new r(function(S){S(w)})).then(p,m)}_((s=s.apply(n,t||[])).next())})}function me(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ze,Ue;function He(){if(Ue)return Ze;function n(t,r){this.x=t,this.y=r}return Ue=1,Ze=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,s=t.y-this.y;return r*r+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),s=Math.sin(t),l=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=l,this},_rotateAround:function(t,r){var s=Math.cos(t),l=Math.sin(t),d=r.y+l*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-l*(this.y-r.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t},Ze}typeof SuppressedError=="function"&&SuppressedError;var Le,ne,Re=me(He()),st=function(){if(ne)return Le;function n(t,r,s,l){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=s,this.p2y=l}return ne=1,Le=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,l=0;l<8;l++){var d=this.sampleCurveX(s)-t;if(Math.abs(d)<r)return s;var p=this.sampleCurveDerivativeX(s);if(Math.abs(p)<1e-6)break;s-=d/p}var m=0,_=1;for(s=t,l=0;l<20&&(d=this.sampleCurveX(s),!(Math.abs(d-t)<r));l++)t>d?m=s:_=s,s=.5*(_-m)+m;return s},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Le}(),ft=me(st);let zt,Dt;function Tt(){return zt==null&&(zt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),zt}function Ce(){if(Dt==null&&(Dt=!1,Tt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const l=4*s;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){Dt=!0;break}}}return Dt||!1}var be=1e-6,ke=typeof Float32Array<"u"?Float32Array:Array;function he(){var n=new ke(9);return ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ge(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ae(){var n=new ke(3);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Oe(n){return Math.hypot(n[0],n[1],n[2])}function Ye(n,t,r){var s=new ke(3);return s[0]=n,s[1]=t,s[2]=r,s}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var rt,ut=Oe;function St(n,t,r){var s=t[0],l=t[1],d=t[2],p=t[3];return n[0]=r[0]*s+r[4]*l+r[8]*d+r[12]*p,n[1]=r[1]*s+r[5]*l+r[9]*d+r[13]*p,n[2]=r[2]*s+r[6]*l+r[10]*d+r[14]*p,n[3]=r[3]*s+r[7]*l+r[11]*d+r[15]*p,n}function Mi(){var n=new ke(4);return ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ht(){var n=new ke(2);return ke!=Float32Array&&(n[0]=0,n[1]=0),n}function Ti(n,t){var r=new ke(2);return r[0]=n,r[1]=t,r}Ae(),rt=new ke(4),ke!=Float32Array&&(rt[0]=0,rt[1]=0,rt[2]=0,rt[3]=0),Ae(),Ye(1,0,0),Ye(0,1,0),Mi(),Mi(),he(),Ht();const yt=8192;function xr(n,t,r){return t*(yt/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function wr(n,t){return(n%t+t)%t}function $r(n,t,r){return n*(1-r)+t*r}function Vi(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function mn(n,t,r,s){const l=new ft(n,t,r,s);return d=>l.solve(d)}const pr=mn(.25,.1,.25,1);function xt(n,t,r){return Math.min(r,Math.max(t,n))}function fr(n,t,r){const s=r-t,l=((n-t)%s+s)%s+t;return l===t?r:l}function Bt(n,...t){for(const r of t)for(const s in r)n[s]=r[s];return n}let ni=1;function rr(n,t,r){const s={};for(const l in n)s[l]=t.call(this,n[l],l,n);return s}function qr(n,t,r){const s={};for(const l in n)t.call(this,n[l],l,n)&&(s[l]=n[l]);return s}function nr(n){return Array.isArray(n)?n.map(nr):typeof n=="object"&&n?rr(n,nr):n}const Ki={};function Zi(n){Ki[n]||(typeof console<"u"&&console.warn(n),Ki[n]=!0)}function Gt(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Dr(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let an=null;function Tr(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const es="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ts(n,t,r,s,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(n,{timestamp:0});try{const p=d==null?void 0:d.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const m=p.startsWith("BGR"),_=new Uint8ClampedArray(s*l*4);if(yield d.copyTo(_,function(v,w,S,I,A){const k=4*Math.max(1,0),B=(Math.max(0,S)-S)*I*4+k,Z=4*I,X=Math.max(0,w),ae=Math.max(0,S);return{rect:{x:X,y:ae,width:Math.min(v.width,w+I)-X,height:Math.min(v.height,S+A)-ae},layout:[{offset:B,stride:Z}]}}(n,t,r,s,l)),m)for(let v=0;v<_.length;v+=4){const w=_[v];_[v]=_[v+2],_[v+2]=w}return _}finally{d.close()}})}let mr,Br;function gn(n,t,r,s){return n.addEventListener(t,r,s),{unsubscribe:()=>{n.removeEventListener(t,r,s)}}}function _n(n){return n*Math.PI/180}function Hr(n){return n/Math.PI*180}const Ln={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Rn={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Wr="AbortError";function Cr(){return new Error(Wr)}const Fr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Li(n){return Fr.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const yn="global-dispatcher";class gr extends Error{constructor(t,r,s,l){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=l}}const sr=()=>Dr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Mr=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const s=Li(n.url);if(s)return s(n,t);if(Dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:yn},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(sr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,l){return c(this,void 0,void 0,function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:sr(),signal:l.signal});let p,m;s.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{p=yield fetch(d)}catch(v){throw new gr(0,v.message,s.url,new Blob)}if(!p.ok){const v=yield p.blob();throw new gr(p.status,p.statusText,s.url,v)}m=s.type==="arrayBuffer"||s.type==="image"?p.arrayBuffer():s.type==="json"?p.json():p.text();const _=yield m;if(l.signal.aborted)throw Cr();return{data:_,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})}(n,t);if(Dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:yn},t)}var r;return function(s,l){return new Promise((d,p)=>{var m;const _=new XMLHttpRequest;_.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(_.responseType="arraybuffer");for(const v in s.headers)_.setRequestHeader(v,s.headers[v]);s.type==="json"&&(_.responseType="text",!((m=s.headers)===null||m===void 0)&&m.Accept||_.setRequestHeader("Accept","application/json")),_.withCredentials=s.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if(!l.signal.aborted)if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(s.type==="json")try{v=JSON.parse(_.response)}catch(w){return void p(w)}d({data:v,cacheControl:_.getResponseHeader("Cache-Control"),expires:_.getResponseHeader("Expires")})}else{const v=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});p(new gr(_.status,_.statusText,s.url,v))}},l.signal.addEventListener("abort",()=>{_.abort(),p(Cr())}),_.send(s.body)})}(n,t)};function ue(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function F(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function j(n,t,r){if(r&&r[n]){const s=r[n].indexOf(t);s!==-1&&r[n].splice(s,1)}}class G{constructor(t,r={}){Bt(this,r),this.type=t}}class Y extends G{constructor(t,r={}){super("error",Bt({error:t},r))}}class oe{on(t,r){return this._listeners=this._listeners||{},F(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return j(t,r,this._listeners),j(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},F(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new G(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const m of l)m.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const m of d)j(s,m,this._oneTimeListeners),m.call(this,t);const p=this._eventedParent;p&&(Bt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(t))}else t instanceof Y&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var U={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ye=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ce(n,t){const r={};for(const s in n)s!=="ref"&&(r[s]=n[s]);return ye.forEach(s=>{s in t&&(r[s]=t[s])}),r}function fe(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!fe(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!fe(n[r],t[r]))return!1;return!0}return n===t}function xe(n,t){n.push(t)}function pe(n,t,r){xe(r,{command:"addSource",args:[n,t[n]]})}function De(n,t,r){xe(t,{command:"removeSource",args:[n]}),r[n]=!0}function qe(n,t,r,s){De(n,r,s),pe(n,t,r)}function Xe(n,t,r){let s;for(s in n[r])if(Object.prototype.hasOwnProperty.call(n[r],s)&&s!=="data"&&!fe(n[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!fe(n[r][s],t[r][s]))return!1;return!0}function at(n,t,r,s,l,d){n=n||{},t=t||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(fe(n[p],t[p])||r.push({command:d,args:[s,p,t[p],l]}));for(const p in t)Object.prototype.hasOwnProperty.call(t,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(fe(n[p],t[p])||r.push({command:d,args:[s,p,t[p],l]}))}function gt(n){return n.id}function pt(n,t){return n[t.id]=t,n}class Me{constructor(t,r,s,l){this.message=(t?`${t}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ft(n,...t){for(const r of t)for(const s in r)n[s]=r[s];return n}class Ct extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Mt{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(t){return new Mt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const dt={kind:"null"},Be={kind:"number"},lt={kind:"string"},_t={kind:"boolean"},si={kind:"color"},Vt={kind:"projectionDefinition"},ar={kind:"object"},bt={kind:"value"},Dn={kind:"collator"},is={kind:"formatted"},vn={kind:"padding"},Pr={kind:"colorArray"},Kr={kind:"numberArray"},bn={kind:"resolvedImage"},fi={kind:"variableAnchorOffsetCollection"};function _r(n,t){return{kind:"array",itemType:n,N:t}}function Jt(n){if(n.kind==="array"){const t=Jt(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const on=[dt,Be,lt,_t,si,Vt,is,ar,_r(bt),vn,Kr,Pr,bn,fi];function Bn(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Bn(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of on)if(!Bn(r,t))return null}}return`Expected ${Jt(n)} but found ${Jt(t)} instead.`}function Hs(n,t){return t.some(r=>r.kind===n.kind)}function or(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Xr(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Ea=.96422,Ws=.82521,Aa=4/29,Fn=6/29,ka=3*Fn*Fn,bs=Fn*Fn*Fn,ko=Math.PI/180,rs=180/Math.PI;function Ks(n){return(n%=360)<0&&(n+=360),n}function xs([n,t,r,s]){let l,d;const p=Xs((.2225045*(n=xn(n))+.7168786*(t=xn(t))+.0606169*(r=xn(r)))/1);n===t&&t===r?l=d=p:(l=Xs((.4360747*n+.3850649*t+.1430804*r)/Ea),d=Xs((.0139322*n+.0971045*t+.7141733*r)/Ws));const m=116*p-16;return[m<0?0:m,500*(l-p),200*(p-d),s]}function xn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Xs(n){return n>bs?Math.pow(n,1/3):n/ka+Aa}function za([n,t,r,s]){let l=(n+16)/116,d=isNaN(t)?l:l+t/500,p=isNaN(r)?l:l-r/200;return l=1*ws(l),d=Ea*ws(d),p=Ws*ws(p),[wn(3.1338561*d-1.6168667*l-.4906146*p),wn(-.9787684*d+1.9161415*l+.033454*p),wn(.0719453*d-.2289914*l+1.4052427*p),s]}function wn(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function ws(n){return n>Fn?n*n*n:ka*(n-Aa)}const zo=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function ns(n,t){return zo(n,t)?n[t]:void 0}function On(n){return parseInt(n.padEnd(2,n),16)/255}function jn(n,t){return yi(t?n/100:n,0,1)}function yi(n,t,r){return Math.min(Math.max(t,n),r)}function Lt(n){return!n.some(Number.isNaN)}const Nn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ai(n,t,r){return n+r*(t-n)}function Tn(n,t,r){return n.map((s,l)=>ai(s,t[l],r))}class Pt{constructor(t,r,s,l=1,d=!0){this.r=t,this.g=r,this.b=s,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,s,l]))}static parse(t){if(t instanceof Pt)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=ns(Nn,s);if(l){const[p,m,_]=l;return[p/255,m/255,_/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const p=s.length<6?1:2;let m=1;return[On(s.slice(m,m+=p)),On(s.slice(m,m+=p)),On(s.slice(m,m+=p)),On(s.slice(m,m+p)||"ff")]}if(s.startsWith("rgb")){const p=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,_,v,w,S,I,A,k,B,Z,X,ae]=p,Q=[w||" ",A||" ",Z].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const E=[v,I,B].join(""),V=E==="%%%"?100:E===""?255:0;if(V){const ee=[yi(+_/V,0,1),yi(+S/V,0,1),yi(+k/V,0,1),X?jn(+X,ae):1];if(Lt(ee))return ee}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[p,m,_,v,w,S,I,A,k]=d,B=[_||" ",w||" ",I].join("");if(B==="  "||B==="  /"||B===",,"||B===",,,"){const Z=[+m,yi(+v,0,100),yi(+S,0,100),A?jn(+A,k):1];if(Lt(Z))return function([X,ae,Q,E]){function V(ee){const ve=(ee+X/30)%12,je=ae*Math.min(Q,1-Q);return Q-je*Math.max(-1,Math.min(ve-3,9-ve,1))}return X=Ks(X),ae/=100,Q/=100,[V(0),V(8),V(4),E]}(Z)}}}(t);return r?new Pt(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[t/d,r/d,s/d,l])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,l,d]=xs(t),p=Math.sqrt(s*s+l*l);return[Math.round(1e4*p)?Ks(Math.atan2(l,s)*rs):NaN,p,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xs(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,l]=this.rgb;return`rgba(${[t,r,s].map(d=>Math.round(255*d)).join(",")},${l})`}static interpolate(t,r,s,l="rgb"){switch(l){case"rgb":{const[d,p,m,_]=Tn(t.rgb,r.rgb,s);return new Pt(d,p,m,_,!1)}case"hcl":{const[d,p,m,_]=t.hcl,[v,w,S,I]=r.hcl;let A,k;if(isNaN(d)||isNaN(v))isNaN(d)?isNaN(v)?A=NaN:(A=v,m!==1&&m!==0||(k=w)):(A=d,S!==1&&S!==0||(k=p));else{let Q=v-d;v>d&&Q>180?Q-=360:v<d&&d-v>180&&(Q+=360),A=d+s*Q}const[B,Z,X,ae]=function([Q,E,V,ee]){return Q=isNaN(Q)?0:Q*ko,za([V,Math.cos(Q)*E,Math.sin(Q)*E,ee])}([A,k??ai(p,w,s),ai(m,S,s),ai(_,I,s)]);return new Pt(B,Z,X,ae,!1)}case"lab":{const[d,p,m,_]=za(Tn(t.lab,r.lab,s));return new Pt(d,p,m,_,!1)}}}}Pt.black=new Pt(0,0,0,1),Pt.white=new Pt(1,1,1,1),Pt.transparent=new Pt(0,0,0,0),Pt.red=new Pt(1,0,0,1);class ss{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const as=["bottom","center","top"];class Vn{constructor(t,r,s,l,d,p){this.text=t,this.image=r,this.scale=s,this.fontStack=l,this.textColor=d,this.verticalAlign=p}}class vi{constructor(t){this.sections=t}static fromString(t){return new vi([new Vn(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof vi?t:vi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Pi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pi)return t;if(typeof t=="number")return new Pi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Pi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){return new Pi(Tn(t.values,r.values,s))}}class mi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof mi)return t;if(typeof t=="number")return new mi([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new mi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){return new mi(Tn(t.values,r.values,s))}}class bi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof bi)return t;if(typeof t=="string"){const s=Pt.parse(t);return s?new bi([s]):void 0}if(!Array.isArray(t))return;const r=[];for(const s of t){if(typeof s!="string")return;const l=Pt.parse(s);if(!l)return;r.push(l)}return new bi(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s,l="rgb"){const d=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let p=0;p<t.values.length;p++)d.push(Pt.interpolate(t.values[p],r.values[p],s,l));return new bi(d)}}class Wt extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const ln=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Xi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],l=t[r+1];if(typeof s!="string"||!ln.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Xi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){const l=t.values,d=r.values;if(l.length!==d.length)throw new Wt(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const p=[];for(let m=0;m<l.length;m+=2){if(l[m]!==d[m])throw new Wt(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${l[m]}, to[${m}]: ${d[m]}`);p.push(l[m]);const[_,v]=l[m+1],[w,S]=d[m+1];p.push([ai(_,w,s),ai(v,S,s)])}return new Xi(p)}}class lr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new lr({name:t,available:!1}):null}}class Yi{constructor(t,r,s){this.from=t,this.to=r,this.transition=s}static interpolate(t,r,s){return new Yi(t,r,s)}static parse(t){return t instanceof Yi?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Yi(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Yi(t.from,t.to,t.transition):typeof t=="string"?new Yi(t,t,1):void 0}}function Zn(n,t,r,s){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,t,r,s]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ot(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Yi||n instanceof Pt||n instanceof ss||n instanceof vi||n instanceof Pi||n instanceof mi||n instanceof bi||n instanceof Xi||n instanceof lr)return!0;if(Array.isArray(n)){for(const t of n)if(!Ot(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Ot(n[t]))return!1;return!0}return!1}function ei(n){if(n===null)return dt;if(typeof n=="string")return lt;if(typeof n=="boolean")return _t;if(typeof n=="number")return Be;if(n instanceof Pt)return si;if(n instanceof Yi)return Vt;if(n instanceof ss)return Dn;if(n instanceof vi)return is;if(n instanceof Pi)return vn;if(n instanceof mi)return Kr;if(n instanceof bi)return Pr;if(n instanceof Xi)return fi;if(n instanceof lr)return bn;if(Array.isArray(n)){const t=n.length;let r;for(const s of n){const l=ei(s);if(r){if(r===l)continue;r=bt;break}r=l}return _r(r||bt,t)}return ar}function It(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Pt||n instanceof Yi||n instanceof vi||n instanceof Pi||n instanceof mi||n instanceof bi||n instanceof Xi||n instanceof lr?n.toString():JSON.stringify(n)}class mt{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ot(t[1]))return r.error("invalid value");const s=t[1];let l=ei(s);const d=r.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new mt(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Un={string:lt,number:Be,boolean:_t,object:ar};class ${constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,l=1;const d=t[0];if(d==="array"){let m,_;if(t.length>2){const v=t[1];if(typeof v!="string"||!(v in Un)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=Un[v],l++}else m=bt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);_=t[2],l++}s=_r(m,_)}else{if(!Un[d])throw new Error(`Types doesn't contain name = ${d}`);s=Un[d]}const p=[];for(;l<t.length;l++){const m=r.parse(t[l],l,bt);if(!m)return null;p.push(m)}return new $(s,p)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!Bn(this.type,ei(s)))return s;if(r===this.args.length-1)throw new Wt(`Expected value to be of type ${Jt(this.type)}, but found ${Jt(ei(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const de={"to-boolean":_t,"to-color":si,"to-number":Be,"to-string":lt};class Fe{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!de[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const l=de[s],d=[];for(let p=1;p<t.length;p++){const m=r.parse(t[p],p,bt);if(!m)return null;d.push(m)}return new Fe(l,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(t),s=null,r instanceof Pt)return r;if(typeof r=="string"){const d=t.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Zn(r[0],r[1],r[2],r[3]),!s))return new Pt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Wt(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const l=Pi.parse(r);if(l)return l}throw new Wt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const s of this.args){r=s.evaluate(t);const l=mi.parse(r);if(l)return l}throw new Wt(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const s of this.args){r=s.evaluate(t);const l=bi.parse(r);if(l)return l}throw new Wt(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const l=Xi.parse(r);if(l)return l}throw new Wt(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Wt(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return vi.fromString(It(this.args[0].evaluate(t)));case"resolvedImage":return lr.fromString(It(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return It(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const et=["Unknown","Point","LineString","Polygon"];class $t{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?et[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=Pt.parse(t),this._parseColorCache.set(t,r)),r}}class vt{constructor(t,r,s=[],l,d=new Mt,p=[]){this.registry=t,this.path=s,this.key=s.map(m=>`[${m}]`).join(""),this.scope=d,this.errors=p,this.expectedType=l,this._isConstant=r}parse(t,r,s,l,d={}){return r?this.concat(r,s,l)._parse(t,d):this._parse(t,d)}_parse(t,r){function s(l,d,p){return p==="assert"?new $(d,[l]):p==="coerce"?new Fe(d,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[l];if(d){let p=d.parse(t,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,_=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||_.kind!=="value"){if(m.kind==="projectionDefinition"&&["string","array"].includes(_.kind)||["color","formatted","resolvedImage"].includes(m.kind)&&["value","string"].includes(_.kind)||["padding","numberArray"].includes(m.kind)&&["value","number","array"].includes(_.kind)||m.kind==="colorArray"&&["value","string","array"].includes(_.kind)||m.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(_.kind))p=s(p,m,r.typeAnnotation||"coerce");else if(this.checkSubtype(m,_))return null}else p=s(p,m,r.typeAnnotation||"assert")}if(!(p instanceof mt)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const m=new $t;try{p=new mt(p.type,p.evaluate(m))}catch(_){return this.error(_.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const l=typeof t=="number"?this.path.concat(t):this.path,d=s?this.scope.concat(s):this.scope;return new vt(this.registry,this._isConstant,l,r||null,d,this.errors)}error(t,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Ct(s,t))}checkSubtype(t,r){const s=Bn(t,r);return s&&this.error(s),s}}class qt{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let d=1;d<t.length-1;d+=2){const p=t[d];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const m=r.parse(t[d+1],d+1);if(!m)return null;s.push([p,m])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return l?new qt(s,l):null}outputDefined(){return this.result.outputDefined()}}class oi{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new oi(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Si{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Be),l=r.parse(t[2],2,_r(r.expectedType||bt));return s&&l?new Si(l.type.itemType,s,l):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new Wt(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Wt(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Wt(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Kt{constructor(t,r){this.type=_t,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,bt),l=r.parse(t[2],2,bt);return s&&l?Hs(s.type,[_t,lt,Be,dt,bt])?new Kt(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!or(r,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(ei(r))} instead.`);if(!or(s,["string","array"]))throw new Wt(`Expected second argument to be of type array or string, but found ${Jt(ei(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ri{constructor(t,r,s){this.type=Be,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,bt),l=r.parse(t[2],2,bt);if(!s||!l)return null;if(!Hs(s.type,[_t,lt,Be,dt,bt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,Be);return d?new Ri(s,l,d):null}return new Ri(s,l)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!or(r,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(ei(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),or(s,["string"])){const d=s.indexOf(r,l);return d===-1?-1:[...s.slice(0,d)].length}if(or(s,["array"]))return s.indexOf(r,l);throw new Wt(`Expected second argument to be of type array or string, but found ${Jt(ei(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Di{constructor(t,r,s,l,d,p){this.inputType=t,this.type=r,this.input=s,this.cases=l,this.outputs=d,this.otherwise=p}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const d={},p=[];for(let v=2;v<t.length-1;v+=2){let w=t[v];const S=t[v+1];Array.isArray(w)||(w=[w]);const I=r.concat(v);if(w.length===0)return I.error("Expected at least one branch label.");for(const k of w){if(typeof k!="number"&&typeof k!="string")return I.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return I.error("Numeric branch labels must be integer values.");if(s){if(I.checkSubtype(s,ei(k)))return null}else s=ei(k);if(d[String(k)]!==void 0)return I.error("Branch labels must be unique.");d[String(k)]=p.length}const A=r.parse(S,v,l);if(!A)return null;l=l||A.type,p.push(A)}const m=r.parse(t[1],1,bt);if(!m)return null;const _=r.parse(t[t.length-1],t.length-1,l);return _?m.type.kind!=="value"&&r.concat(1).checkSubtype(s,m.type)?null:new Di(s,l,m,d,p,_):null}evaluate(t){const r=this.input.evaluate(t);return(ei(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class jt{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let p=1;p<t.length-1;p+=2){const m=r.parse(t[p],p,_t);if(!m)return null;const _=r.parse(t[p+1],p+1,s);if(!_)return null;l.push([m,_]),s=s||_.type}const d=r.parse(t[t.length-1],t.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new jt(s,l,d)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Ii{constructor(t,r,s,l){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,bt),l=r.parse(t[2],2,Be);if(!s||!l)return null;if(!Hs(s.type,[_r(bt),lt,bt]))return r.error(`Expected first argument to be of type array or string, but found ${Jt(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,Be);return d?new Ii(s.type,s,l,d):null}return new Ii(s.type,s,l)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),or(r,["string"]))return[...r].slice(s,l).join("");if(or(r,["array"]))return r.slice(s,l);throw new Wt(`Expected first argument to be of type array or string, but found ${Jt(ei(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ui(n,t){const r=n.length-1;let s,l,d=0,p=r,m=0;for(;d<=p;)if(m=Math.floor((d+p)/2),s=n[m],l=n[m+1],s<=t){if(m===r||t<l)return m;d=m+1}else{if(!(s>t))throw new Wt("Input is not a number.");p=m-1}return 0}class Ji{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,d]of s)this.labels.push(l),this.outputs.push(d)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,Be);if(!s)return null;const l=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let p=1;p<t.length;p+=2){const m=p===1?-1/0:t[p],_=t[p+1],v=p,w=p+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const S=r.parse(_,w,d);if(!S)return null;d=d||S.type,l.push([m,S])}return new Ji(d,s,l)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;return l>=r[d-1]?s[d-1].evaluate(t):s[Ui(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Xt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Or,os,ls=function(){if(os)return Or;function n(t,r,s,l){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=s,this.p2y=l}return os=1,Or=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,l=0;l<8;l++){var d=this.sampleCurveX(s)-t;if(Math.abs(d)<r)return s;var p=this.sampleCurveDerivativeX(s);if(Math.abs(p)<1e-6)break;s-=d/p}var m=0,_=1;for(s=t,l=0;l<20&&(d=this.sampleCurveX(s),!(Math.abs(d-t)<r));l++)t>d?m=s:_=s,s=.5*(_-m)+m;return s},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Or}(),Ts=Xt(ls);class cr{constructor(t,r,s,l,d){this.type=t,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[p,m]of d)this.labels.push(p),this.outputs.push(m)}static interpolationFactor(t,r,s,l){let d=0;if(t.name==="exponential")d=Ys(r,t.base,s,l);else if(t.name==="linear")d=Ys(r,1,s,l);else if(t.name==="cubic-bezier"){const p=t.controlPoints;d=new Ts(p[0],p[1],p[2],p[3]).solve(Ys(r,1,s,l))}return d}static parse(t,r){let[s,l,d,...p]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const v=l[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const v=l.slice(1);if(v.length!==4||v.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Be),!d)return null;const m=[];let _=null;s!=="interpolate-hcl"&&s!=="interpolate-lab"||r.expectedType==Pr?r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType):_=si;for(let v=0;v<p.length;v+=2){const w=p[v],S=p[v+1],I=v+3,A=v+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const k=r.parse(S,A,_);if(!k)return null;_=_||k.type,m.push([w,k])}return Xr(_,Be)||Xr(_,Vt)||Xr(_,si)||Xr(_,vn)||Xr(_,Kr)||Xr(_,Pr)||Xr(_,fi)||Xr(_,_r(Be))?new cr(_,s,l,d,m):r.error(`Type ${Jt(_)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;if(l>=r[d-1])return s[d-1].evaluate(t);const p=Ui(r,l),m=cr.interpolationFactor(this.interpolation,l,r[p],r[p+1]),_=s[p].evaluate(t),v=s[p+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ai(_,v,m);case"color":return Pt.interpolate(_,v,m);case"padding":return Pi.interpolate(_,v,m);case"colorArray":return bi.interpolate(_,v,m);case"numberArray":return mi.interpolate(_,v,m);case"variableAnchorOffsetCollection":return Xi.interpolate(_,v,m);case"array":return Tn(_,v,m);case"projectionDefinition":return Yi.interpolate(_,v,m)}case"interpolate-hcl":switch(this.type.kind){case"color":return Pt.interpolate(_,v,m,"hcl");case"colorArray":return bi.interpolate(_,v,m,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Pt.interpolate(_,v,m,"lab");case"colorArray":return bi.interpolate(_,v,m,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ys(n,t,r,s){const l=s-r,d=n-r;return l===0?0:t===1?d/l:(Math.pow(t,d)-1)/(Math.pow(t,l)-1)}const cn={color:Pt.interpolate,number:ai,padding:Pi.interpolate,numberArray:mi.interpolate,colorArray:bi.interpolate,variableAnchorOffsetCollection:Xi.interpolate,array:Tn};class cs{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const d=[];for(const m of t.slice(1)){const _=r.parse(m,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!_)return null;s=s||_.type,d.push(_)}if(!s)throw new Error("No output type");const p=l&&d.some(m=>Bn(l,m.type));return new cs(p?bt:s,d)}evaluate(t){let r,s=null,l=0;for(const d of this.args)if(l++,s=d.evaluate(t),s&&s instanceof lr&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Js(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function jr(n,t,r,s){return s.compare(t,r)===0}function hs(n,t,r){const s=n!=="=="&&n!=="!=";return class wf{constructor(d,p,m){this.type=_t,this.lhs=d,this.rhs=p,this.collator=m,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const m=d[0];let _=p.parse(d[1],1,bt);if(!_)return null;if(!Js(m,_.type))return p.concat(1).error(`"${m}" comparisons are not supported for type '${Jt(_.type)}'.`);let v=p.parse(d[2],2,bt);if(!v)return null;if(!Js(m,v.type))return p.concat(2).error(`"${m}" comparisons are not supported for type '${Jt(v.type)}'.`);if(_.type.kind!==v.type.kind&&_.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${Jt(_.type)}' and '${Jt(v.type)}'.`);s&&(_.type.kind==="value"&&v.type.kind!=="value"?_=new $(v.type,[_]):_.type.kind!=="value"&&v.type.kind==="value"&&(v=new $(_.type,[v])));let w=null;if(d.length===4){if(_.type.kind!=="string"&&v.type.kind!=="string"&&_.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(w=p.parse(d[3],3,Dn),!w)return null}return new wf(_,v,w)}evaluate(d){const p=this.lhs.evaluate(d),m=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const _=ei(p),v=ei(m);if(_.kind!==v.kind||_.kind!=="string"&&_.kind!=="number")throw new Wt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${_.kind}, ${v.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const _=ei(p),v=ei(m);if(_.kind!=="string"||v.kind!=="string")return t(d,p,m)}return this.collator?r(d,p,m,this.collator.evaluate(d)):t(d,p,m)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const La=hs("==",function(n,t,r){return t===r},jr),sh=hs("!=",function(n,t,r){return t!==r},function(n,t,r,s){return!jr(0,t,r,s)}),Lo=hs("<",function(n,t,r){return t<r},function(n,t,r,s){return s.compare(t,r)<0}),ah=hs(">",function(n,t,r){return t>r},function(n,t,r,s){return s.compare(t,r)>0}),oh=hs("<=",function(n,t,r){return t<=r},function(n,t,r,s){return s.compare(t,r)<=0}),lh=hs(">=",function(n,t,r){return t>=r},function(n,t,r,s){return s.compare(t,r)>=0});class Ra{constructor(t,r,s){this.type=Dn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,_t);if(!l)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,_t);if(!d)return null;let p=null;return s.locale&&(p=r.parse(s.locale,1,lt),!p)?null:new Ra(l,d,p)}evaluate(t){return new ss(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ss{constructor(t,r,s,l,d){this.type=lt,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,Be);if(!s)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=r.parse(l.locale,1,lt),!d))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,lt),!p))return null;let m=null;if(l["min-fraction-digits"]&&(m=r.parse(l["min-fraction-digits"],1,Be),!m))return null;let _=null;return l["max-fraction-digits"]&&(_=r.parse(l["max-fraction-digits"],1,Be),!_)?null:new Ss(s,d,p,m,_)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Da{constructor(t){this.type=is,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let d=!1;for(let p=1;p<=t.length-1;++p){const m=t[p];if(d&&typeof m=="object"&&!Array.isArray(m)){d=!1;let _=null;if(m["font-scale"]&&(_=r.parse(m["font-scale"],1,Be),!_))return null;let v=null;if(m["text-font"]&&(v=r.parse(m["text-font"],1,_r(lt)),!v))return null;let w=null;if(m["text-color"]&&(w=r.parse(m["text-color"],1,si),!w))return null;let S=null;if(m["vertical-align"]){if(typeof m["vertical-align"]=="string"&&!as.includes(m["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${m["vertical-align"]}' instead.`);if(S=r.parse(m["vertical-align"],1,lt),!S)return null}const I=l[l.length-1];I.scale=_,I.font=v,I.textColor=w,I.verticalAlign=S}else{const _=r.parse(t[p],1,bt);if(!_)return null;const v=_.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:_,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Da(l)}evaluate(t){return new vi(this.sections.map(r=>{const s=r.content.evaluate(t);return ei(s)===bn?new Vn("",s,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new Vn(It(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Ba{constructor(t){this.type=bn,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,lt);return s?new Ba(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=lr.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class Fa{constructor(t){this.type=Be,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Jt(s.type)} instead.`):new Fa(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Wt(`Expected value to be of type string or array, but found ${Jt(ei(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const hn=8192;function Zl(n,t){const r=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*hn),Math.round(s*l*hn)]}function Ro(n,t){const r=Math.pow(2,t.z);return[(l=(n[0]/hn+t.x)/r,360*l-180),(s=(n[1]/hn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function Qs(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function ea(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function ch(n,t,r){const s=n[0]-t[0],l=n[1]-t[1],d=n[0]-r[0],p=n[1]-r[1];return s*p-d*l==0&&s*d<=0&&l*p<=0}function Oa(n,t,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(d=[t[0]-n[0],t[1]-n[1]])[1]-l[1]*d[0]!=0&&!(!ql(n,t,r,s)||!ql(r,s,n,t));var l,d}function Ul(n,t,r){for(const s of r)for(let l=0;l<s.length-1;++l)if(Oa(n,t,s[l],s[l+1]))return!0;return!1}function us(n,t,r=!1){let s=!1;for(const m of t)for(let _=0;_<m.length-1;_++){if(ch(n,m[_],m[_+1]))return r;(d=m[_])[1]>(l=n)[1]!=(p=m[_+1])[1]>l[1]&&l[0]<(p[0]-d[0])*(l[1]-d[1])/(p[1]-d[1])+d[0]&&(s=!s)}var l,d,p;return s}function Gl(n,t){for(const r of t)if(us(n,r))return!0;return!1}function $l(n,t){for(const r of n)if(!us(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Ul(n[r],n[r+1],t))return!1;return!0}function hh(n,t){for(const r of t)if($l(n,r))return!0;return!1}function ql(n,t,r,s){const l=s[0]-r[0],d=s[1]-r[1],p=(n[0]-r[0])*d-l*(n[1]-r[1]),m=(t[0]-r[0])*d-l*(t[1]-r[1]);return p>0&&m<0||p<0&&m>0}function ta(n,t,r){const s=[];for(let l=0;l<n.length;l++){const d=[];for(let p=0;p<n[l].length;p++){const m=Zl(n[l][p],r);Qs(t,m),d.push(m)}s.push(d)}return s}function Hl(n,t,r){const s=[];for(let l=0;l<n.length;l++){const d=ta(n[l],t,r);s.push(d)}return s}function Wl(n,t,r,s){if(n[0]<r[0]||n[0]>r[2]){const l=.5*s;let d=n[0]-r[0]>l?-s:r[0]-n[0]>l?s:0;d===0&&(d=n[0]-r[2]>l?-s:r[2]-n[0]>l?s:0),n[0]+=d}Qs(t,n)}function Kl(n,t,r,s){const l=Math.pow(2,s.z)*hn,d=[s.x*hn,s.y*hn],p=[];for(const m of n)for(const _ of m){const v=[_.x+d[0],_.y+d[1]];Wl(v,t,r,l),p.push(v)}return p}function Do(n,t,r,s){const l=Math.pow(2,s.z)*hn,d=[s.x*hn,s.y*hn],p=[];for(const _ of n){const v=[];for(const w of _){const S=[w.x+d[0],w.y+d[1]];Qs(t,S),v.push(S)}p.push(v)}if(t[2]-t[0]<=l/2){(m=t)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const _ of p)for(const v of _)Wl(v,t,r,l)}var m;return p}class Gn{constructor(t,r){this.type=_t,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ot(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const l=[];for(const d of s.features){const{type:p,coordinates:m}=d.geometry;p==="Polygon"&&l.push(m),p==="MultiPolygon"&&l.push(...m)}if(l.length)return new Gn(s,{type:"MultiPolygon",coordinates:l})}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Gn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Gn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const m=ta(s.coordinates,d,p),_=Kl(r.geometry(),l,d,p);if(!ea(l,d))return!1;for(const v of _)if(!us(v,m))return!1}if(s.type==="MultiPolygon"){const m=Hl(s.coordinates,d,p),_=Kl(r.geometry(),l,d,p);if(!ea(l,d))return!1;for(const v of _)if(!Gl(v,m))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(s.type==="Polygon"){const m=ta(s.coordinates,d,p),_=Do(r.geometry(),l,d,p);if(!ea(l,d))return!1;for(const v of _)if(!$l(v,m))return!1}if(s.type==="MultiPolygon"){const m=Hl(s.coordinates,d,p),_=Do(r.geometry(),l,d,p);if(!ea(l,d))return!1;for(const v of _)if(!hh(v,m))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xl=class{constructor(n=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,s=t[n];for(;n>0;){const l=n-1>>1,d=t[l];if(r(s,d)>=0)break;t[n]=d,n=l}t[n]=s}_down(n){const{data:t,compare:r}=this,s=this.length>>1,l=t[n];for(;n<s;){let d=1+(n<<1);const p=d+1;if(p<this.length&&r(t[p],t[d])<0&&(d=p),r(t[d],l)>=0)break;t[n]=t[d],n=d}t[n]=l}};function Yl(n,t,r=0,s=n.length-1,l=Jl){for(;s>r;){if(s-r>600){const _=s-r+1,v=t-r+1,w=Math.log(_),S=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*S*(_-S)/_)*(v-_/2<0?-1:1);Yl(n,t,Math.max(r,Math.floor(t-v*S/_+I)),Math.min(s,Math.floor(t+(_-v)*S/_+I)),l)}const d=n[t];let p=r,m=s;for(Cs(n,r,t),l(n[s],d)>0&&Cs(n,r,s);p<m;){for(Cs(n,p,m),p++,m--;l(n[p],d)<0;)p++;for(;l(n[m],d)>0;)m--}l(n[r],d)===0?Cs(n,r,m):(m++,Cs(n,m,s)),m<=t&&(r=m+1),t<=m&&(s=m-1)}}function Cs(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}function Jl(n,t){return n<t?-1:n>t?1:0}function ja(n,t){if(n.length<=1)return[n];const r=[];let s,l;for(const d of n){const p=dh(d);p!==0&&(d.area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(s&&r.push(s),s=[d]):s.push(d))}if(s&&r.push(s),t>1)for(let d=0;d<r.length;d++)r[d].length<=t||(Yl(r[d],t,1,r[d].length-1,uh),r[d]=r[d].slice(0,t));return r}function uh(n,t){return t.area-n.area}function dh(n){let t=0;for(let r,s,l=0,d=n.length,p=d-1;l<d;p=l++)r=n[l],s=n[p],t+=(s.x-r.x)*(r.y+s.y);return t}const Bo=1/298.257223563,Ql=Bo*(2-Bo),ec=Math.PI/180;class Fo{constructor(t){const r=6378.137*ec*1e3,s=Math.cos(t*ec),l=1/(1-Ql*(1-s*s)),d=Math.sqrt(l);this.kx=r*d*s,this.ky=r*d*l*(1-Ql)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+l*l)}pointOnLine(t,r){let s,l,d,p,m=1/0;for(let _=0;_<t.length-1;_++){let v=t[_][0],w=t[_][1],S=this.wrap(t[_+1][0]-v)*this.kx,I=(t[_+1][1]-w)*this.ky,A=0;S===0&&I===0||(A=(this.wrap(r[0]-v)*this.kx*S+(r[1]-w)*this.ky*I)/(S*S+I*I),A>1?(v=t[_+1][0],w=t[_+1][1]):A>0&&(v+=S/this.kx*A,w+=I/this.ky*A)),S=this.wrap(r[0]-v)*this.kx,I=(r[1]-w)*this.ky;const k=S*S+I*I;k<m&&(m=k,s=v,l=w,d=_,p=A)}return{point:[s,l],index:d,t:Math.max(0,Math.min(1,p))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function tc(n,t){return t[0]-n[0]}function Nt(n){return n[1]-n[0]+1}function Sn(n,t){return n[1]>=n[0]&&n[1]<t}function Oo(n,t){if(n[0]>n[1])return[null,null];const r=Nt(n);if(t){if(r===2)return[n,null];const l=Math.floor(r/2);return[[n[0],n[0]+l],[n[0]+l,n[1]]]}if(r===1)return[n,null];const s=Math.floor(r/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}function jo(n,t){if(!Sn(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)Qs(r,n[s]);return r}function No(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const s of r)Qs(t,s);return t}function ic(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Vo(n,t,r){if(!ic(n)||!ic(t))return NaN;let s=0,l=0;return n[2]<t[0]&&(s=t[0]-n[2]),n[0]>t[2]&&(s=n[0]-t[2]),n[1]>t[3]&&(l=n[1]-t[3]),n[3]<t[1]&&(l=t[1]-n[3]),r.distance([0,0],[s,l])}function ds(n,t,r){const s=r.pointOnLine(t,n);return r.distance(n,s.point)}function Zo(n,t,r,s,l){const d=Math.min(ds(n,[r,s],l),ds(t,[r,s],l)),p=Math.min(ds(r,[n,t],l),ds(s,[n,t],l));return Math.min(d,p)}function ph(n,t,r,s,l){if(!Sn(t,n.length)||!Sn(s,r.length))return 1/0;let d=1/0;for(let p=t[0];p<t[1];++p){const m=n[p],_=n[p+1];for(let v=s[0];v<s[1];++v){const w=r[v],S=r[v+1];if(Oa(m,_,w,S))return 0;d=Math.min(d,Zo(m,_,w,S,l))}}return d}function fh(n,t,r,s,l){if(!Sn(t,n.length)||!Sn(s,r.length))return NaN;let d=1/0;for(let p=t[0];p<=t[1];++p)for(let m=s[0];m<=s[1];++m)if(d=Math.min(d,l.distance(n[p],r[m])),d===0)return d;return d}function mh(n,t,r){if(us(n,t,!0))return 0;let s=1/0;for(const l of t){const d=l[0],p=l[l.length-1];if(d!==p&&(s=Math.min(s,ds(n,[p,d],r)),s===0))return s;const m=r.pointOnLine(l,n);if(s=Math.min(s,r.distance(n,m.point)),s===0)return s}return s}function gh(n,t,r,s){if(!Sn(t,n.length))return NaN;for(let d=t[0];d<=t[1];++d)if(us(n[d],r,!0))return 0;let l=1/0;for(let d=t[0];d<t[1];++d){const p=n[d],m=n[d+1];for(const _ of r)for(let v=0,w=_.length,S=w-1;v<w;S=v++){const I=_[S],A=_[v];if(Oa(p,m,I,A))return 0;l=Math.min(l,Zo(p,m,I,A,s))}}return l}function rc(n,t){for(const r of n)for(const s of r)if(us(s,t,!0))return!0;return!1}function _h(n,t,r,s=1/0){const l=No(n),d=No(t);if(s!==1/0&&Vo(l,d,r)>=s)return s;if(ea(l,d)){if(rc(n,t))return 0}else if(rc(t,n))return 0;let p=1/0;for(const m of n)for(let _=0,v=m.length,w=v-1;_<v;w=_++){const S=m[w],I=m[_];for(const A of t)for(let k=0,B=A.length,Z=B-1;k<B;Z=k++){const X=A[Z],ae=A[k];if(Oa(S,I,X,ae))return 0;p=Math.min(p,Zo(S,I,X,ae,r))}}return p}function nc(n,t,r,s,l,d){if(!d)return;const p=Vo(jo(s,d),l,r);p<t&&n.push([p,d,[0,0]])}function Na(n,t,r,s,l,d,p){if(!d||!p)return;const m=Vo(jo(s,d),jo(l,p),r);m<t&&n.push([m,d,p])}function Va(n,t,r,s,l=1/0){let d=Math.min(s.distance(n[0],r[0][0]),l);if(d===0)return d;const p=new Xl([[0,[0,n.length-1],[0,0]]],tc),m=No(r);for(;p.length>0;){const _=p.pop();if(_[0]>=d)continue;const v=_[1],w=t?50:100;if(Nt(v)<=w){if(!Sn(v,n.length))return NaN;if(t){const S=gh(n,v,r,s);if(isNaN(S)||S===0)return S;d=Math.min(d,S)}else for(let S=v[0];S<=v[1];++S){const I=mh(n[S],r,s);if(d=Math.min(d,I),d===0)return 0}}else{const S=Oo(v,t);nc(p,d,s,n,m,S[0]),nc(p,d,s,n,m,S[1])}}return d}function Za(n,t,r,s,l,d=1/0){let p=Math.min(d,l.distance(n[0],r[0]));if(p===0)return p;const m=new Xl([[0,[0,n.length-1],[0,r.length-1]]],tc);for(;m.length>0;){const _=m.pop();if(_[0]>=p)continue;const v=_[1],w=_[2],S=t?50:100,I=s?50:100;if(Nt(v)<=S&&Nt(w)<=I){if(!Sn(v,n.length)&&Sn(w,r.length))return NaN;let A;if(t&&s)A=ph(n,v,r,w,l),p=Math.min(p,A);else if(t&&!s){const k=n.slice(v[0],v[1]+1);for(let B=w[0];B<=w[1];++B)if(A=ds(r[B],k,l),p=Math.min(p,A),p===0)return p}else if(!t&&s){const k=r.slice(w[0],w[1]+1);for(let B=v[0];B<=v[1];++B)if(A=ds(n[B],k,l),p=Math.min(p,A),p===0)return p}else A=fh(n,v,r,w,l),p=Math.min(p,A)}else{const A=Oo(v,t),k=Oo(w,s);Na(m,p,l,n,r,A[0],k[0]),Na(m,p,l,n,r,A[0],k[1]),Na(m,p,l,n,r,A[1],k[0]),Na(m,p,l,n,r,A[1],k[1])}}return p}function Uo(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class ps{constructor(t,r){this.type=Be,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ot(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new ps(s,s.features.map(l=>Uo(l.geometry)).flat());if(s.type==="Feature")return new ps(s,Uo(s.geometry));if("type"in s&&"coordinates"in s)return new ps(s,Uo(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=r.geometry(),d=l.flat().map(_=>Ro([_.x,_.y],r.canonical));if(l.length===0)return NaN;const p=new Fo(d[0][1]);let m=1/0;for(const _ of s){switch(_.type){case"Point":m=Math.min(m,Za(d,!1,[_.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,Za(d,!1,_.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,Va(d,!1,_.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=r.geometry(),d=l.flat().map(_=>Ro([_.x,_.y],r.canonical));if(l.length===0)return NaN;const p=new Fo(d[0][1]);let m=1/0;for(const _ of s){switch(_.type){case"Point":m=Math.min(m,Za(d,!0,[_.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,Za(d,!0,_.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,Va(d,!0,_.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const d=ja(l,0).map(_=>_.map(v=>v.map(w=>Ro([w.x,w.y],r.canonical)))),p=new Fo(d[0][0][0][1]);let m=1/0;for(const _ of s)for(const v of d){switch(_.type){case"Point":m=Math.min(m,Va([_.coordinates],!1,v,p,m));break;case"LineString":m=Math.min(m,Va(_.coordinates,!0,v,p,m));break;case"Polygon":m=Math.min(m,_h(v,_.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ua{constructor(t){this.type=bt,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=t[1];return s==null?r.error("Global state property must be defined."):typeof s!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Ua(s)}evaluate(t){var r;const s=(r=t.globals)===null||r===void 0?void 0:r.globalState;return s&&Object.keys(s).length!==0?ns(s,this.key):null}eachChild(){}outputDefined(){return!1}}const Ms={"==":La,"!=":sh,">":ah,"<":Lo,">=":lh,"<=":oh,array:$,at:Si,boolean:$,case:jt,coalesce:cs,collator:Ra,format:Da,image:Ba,in:Kt,"index-of":Ri,interpolate:cr,"interpolate-hcl":cr,"interpolate-lab":cr,length:Fa,let:qt,literal:mt,match:Di,number:$,"number-format":Ss,object:$,slice:Ii,step:Ji,string:$,"to-boolean":Fe,"to-color":Fe,"to-number":Fe,"to-string":Fe,var:oi,within:Gn,distance:ps,"global-state":Ua};class Nr{constructor(t,r,s,l){this.name=t,this.type=r,this._evaluate=s,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],l=Nr.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=p.filter(([v])=>!Array.isArray(v)||v.length===t.length-1);let _=null;for(const[v,w]of m){_=new vt(r.registry,Ga,r.path,null,r.scope);const S=[];let I=!1;for(let A=1;A<t.length;A++){const k=t[A],B=Array.isArray(v)?v[A-1]:v.type,Z=_.parse(k,1+S.length,B);if(!Z){I=!0;break}S.push(Z)}if(!I)if(Array.isArray(v)&&v.length!==S.length)_.error(`Expected ${v.length} arguments, but found ${S.length} instead.`);else{for(let A=0;A<S.length;A++){const k=Array.isArray(v)?v[A]:v.type,B=S[A];_.concat(A+1).checkSubtype(k,B.type)}if(_.errors.length===0)return new Nr(s,d,w,S)}}if(m.length===1)r.errors.push(..._.errors);else{const v=(m.length?m:p).map(([S])=>{return I=S,Array.isArray(I)?`(${I.map(Jt).join(", ")})`:`(${Jt(I.type)}...)`;var I}).join(" | "),w=[];for(let S=1;S<t.length;S++){const I=r.parse(t[S],1+w.length);if(!I)return null;w.push(Jt(I.type))}r.error(`Expected arguments of type ${v}, but found (${w.join(", ")}) instead.`)}return null}static register(t,r){Nr.definitions=r;for(const s in r)t[s]=Nr}}function sc(n,[t,r,s,l]){t=t.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const d=l?l.evaluate(n):1,p=Zn(t,r,s,d);if(p)throw new Wt(p);return new Pt(t/255,r/255,s/255,d,!1)}function ac(n,t){return n in t}function Go(n,t){const r=t[n];return r===void 0?null:r}function fs(n){return{type:n}}function Ga(n){if(n instanceof oi)return Ga(n.boundExpression);if(n instanceof Nr&&n.name==="error"||n instanceof Ra||n instanceof Gn||n instanceof ps||n instanceof Ua)return!1;const t=n instanceof Fe||n instanceof $;let r=!0;return n.eachChild(s=>{r=t?r&&Ga(s):r&&s instanceof mt}),!!r&&$a(n)&&qa(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function $a(n){if(n instanceof Nr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Gn||n instanceof ps)return!1;let t=!0;return n.eachChild(r=>{t&&!$a(r)&&(t=!1)}),t}function ia(n){if(n instanceof Nr&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!ia(r)&&(t=!1)}),t}function qa(n,t){if(n instanceof Nr&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(s=>{r&&!qa(s,t)&&(r=!1)}),r}function Ha(n){return{result:"success",value:n}}function Ps(n){return{result:"error",value:n}}function Is(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function oc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Wa(n){return!!n.expression&&n.expression.interpolated}function Et(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Ka(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&ei(n)===ar}function Xa(n){return n}function $o(n,t){const r=n.stops&&typeof n.stops[0][0]=="object",s=r||!(r||n.property!==void 0),l=n.type||(Wa(t)?"exponential":"interval"),d=function(w){switch(w.type){case"color":return Pt.parse;case"padding":return Pi.parse;case"numberArray":return mi.parse;case"colorArray":return bi.parse;default:return null}}(t);if(d&&((n=Ft({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],d(w[1])])),n.default=d(n.default?n.default:t.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const m=function(w){switch(w){case"exponential":return lc;case"interval":return vh;case"categorical":return yh;case"identity":return bh;default:throw new Error(`Unknown function type "${w}"`)}}(l);let _,v;if(l==="categorical"){_=Object.create(null);for(const w of n.stops)_[w[0]]=w[1];v=typeof n.stops[0][0]}if(r){const w={},S=[];for(let k=0;k<n.stops.length;k++){const B=n.stops[k],Z=B[0].zoom;w[Z]===void 0&&(w[Z]={zoom:Z,type:n.type,property:n.property,default:n.default,stops:[]},S.push(Z)),w[Z].stops.push([B[0].value,B[1]])}const I=[];for(const k of S)I.push([w[k].zoom,$o(w[k],t)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:cr.interpolationFactor.bind(void 0,A),zoomStops:I.map(k=>k[0]),evaluate:({zoom:k},B)=>lc({stops:I,base:n.base},t,k).evaluate(k,B)}}if(s){const w=l==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:cr.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(S=>S[0]),evaluate:({zoom:S})=>m(n,t,S,_,v)}}return{kind:"source",evaluate(w,S){const I=S&&S.properties?S.properties[n.property]:void 0;return I===void 0?ra(n.default,t.default):m(n,t,I,_,v)}}}function ra(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function yh(n,t,r,s,l){return ra(typeof r===l?s[r]:void 0,n.default,t.default)}function vh(n,t,r){if(Et(r)!=="number")return ra(n.default,t.default);const s=n.stops.length;if(s===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[s-1][0])return n.stops[s-1][1];const l=Ui(n.stops.map(d=>d[0]),r);return n.stops[l][1]}function lc(n,t,r){const s=n.base!==void 0?n.base:1;if(Et(r)!=="number")return ra(n.default,t.default);const l=n.stops.length;if(l===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[l-1][0])return n.stops[l-1][1];const d=Ui(n.stops.map(w=>w[0]),r),p=function(w,S,I,A){const k=A-I,B=w-I;return k===0?0:S===1?B/k:(Math.pow(S,B)-1)/(Math.pow(S,k)-1)}(r,s,n.stops[d][0],n.stops[d+1][0]),m=n.stops[d][1],_=n.stops[d+1][1],v=cn[t.type]||Xa;return typeof m.evaluate=="function"?{evaluate(...w){const S=m.evaluate.apply(void 0,w),I=_.evaluate.apply(void 0,w);if(S!==void 0&&I!==void 0)return v(S,I,p,n.colorSpace)}}:v(m,_,p,n.colorSpace)}function bh(n,t,r){switch(t.type){case"color":r=Pt.parse(r);break;case"formatted":r=vi.fromString(r.toString());break;case"resolvedImage":r=lr.fromString(r.toString());break;case"padding":r=Pi.parse(r);break;case"colorArray":r=bi.parse(r);break;case"numberArray":r=mi.parse(r);break;default:Et(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ra(r,n.default,t.default)}Nr.register(Ms,{error:[{kind:"error"},[lt],(n,[t])=>{throw new Wt(t.evaluate(n))}],typeof:[lt,[bt],(n,[t])=>Jt(ei(t.evaluate(n)))],"to-rgba":[_r(Be,4),[si],(n,[t])=>{const[r,s,l,d]=t.evaluate(n).rgb;return[255*r,255*s,255*l,d]}],rgb:[si,[Be,Be,Be],sc],rgba:[si,[Be,Be,Be,Be],sc],has:{type:_t,overloads:[[[lt],(n,[t])=>ac(t.evaluate(n),n.properties())],[[lt,ar],(n,[t,r])=>ac(t.evaluate(n),r.evaluate(n))]]},get:{type:bt,overloads:[[[lt],(n,[t])=>Go(t.evaluate(n),n.properties())],[[lt,ar],(n,[t,r])=>Go(t.evaluate(n),r.evaluate(n))]]},"feature-state":[bt,[lt],(n,[t])=>Go(t.evaluate(n),n.featureState||{})],properties:[ar,[],n=>n.properties()],"geometry-type":[lt,[],n=>n.geometryType()],id:[bt,[],n=>n.id()],zoom:[Be,[],n=>n.globals.zoom],"heatmap-density":[Be,[],n=>n.globals.heatmapDensity||0],"line-progress":[Be,[],n=>n.globals.lineProgress||0],accumulated:[bt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Be,fs(Be),(n,t)=>{let r=0;for(const s of t)r+=s.evaluate(n);return r}],"*":[Be,fs(Be),(n,t)=>{let r=1;for(const s of t)r*=s.evaluate(n);return r}],"-":{type:Be,overloads:[[[Be,Be],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Be],(n,[t])=>-t.evaluate(n)]]},"/":[Be,[Be,Be],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Be,[Be,Be],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Be,[],()=>Math.LN2],pi:[Be,[],()=>Math.PI],e:[Be,[],()=>Math.E],"^":[Be,[Be,Be],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Be,[Be],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Be,[Be],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Be,[Be],(n,[t])=>Math.log(t.evaluate(n))],log2:[Be,[Be],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Be,[Be],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Be,[Be],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Be,[Be],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Be,[Be],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Be,[Be],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Be,[Be],(n,[t])=>Math.atan(t.evaluate(n))],min:[Be,fs(Be),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[Be,fs(Be),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[Be,[Be],(n,[t])=>Math.abs(t.evaluate(n))],round:[Be,[Be],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Be,[Be],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Be,[Be],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[_t,[lt,bt],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[_t,[bt],(n,[t])=>n.id()===t.value],"filter-type-==":[_t,[lt],(n,[t])=>n.geometryType()===t.value],"filter-<":[_t,[lt,bt],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[_t,[bt],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[_t,[lt,bt],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[_t,[bt],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[_t,[lt,bt],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[_t,[bt],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[_t,[lt,bt],(n,[t,r])=>{const s=n.properties()[t.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[_t,[bt],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[_t,[bt],(n,[t])=>t.value in n.properties()],"filter-has-id":[_t,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[_t,[_r(lt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[_t,[_r(bt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[_t,[lt,_r(bt)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[_t,[lt,_r(bt)],(n,[t,r])=>function(s,l,d,p){for(;d<=p;){const m=d+p>>1;if(l[m]===s)return!0;l[m]>s?p=m-1:d=m+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[fs(_t),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[fs(_t),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[_t,[_t],(n,[t])=>!t.evaluate(n)],"is-supported-script":[_t,[lt],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[lt,[lt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[lt,[lt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[lt,fs(bt),(n,t)=>t.map(r=>It(r.evaluate(n))).join("")],"resolved-locale":[lt,[Dn],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Ya{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new $t,this._defaultValue=r?function(s){if(s.type==="color"&&Ka(s.default))return new Pt(0,0,0,0);switch(s.type){case"color":return Pt.parse(s.default)||null;case"padding":return Pi.parse(s.default)||null;case"numberArray":return mi.parse(s.default)||null;case"colorArray":return bi.parse(s.default)||null;case"variableAnchorOffsetCollection":return Xi.parse(s.default)||null;case"projectionDefinition":return Yi.parse(s.default)||null;default:return s.default===void 0?null:s.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,l,d,p){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,l,d,p){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null;try{const m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Wt(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function na(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ms}function Ja(n,t){const r=new vt(Ms,Ga,[],t?function(l){const d={color:si,string:lt,number:Be,enum:lt,boolean:_t,formatted:is,padding:vn,numberArray:Kr,colorArray:Pr,projectionDefinition:Vt,resolvedImage:bn,variableAnchorOffsetCollection:fi};return l.type==="array"?_r(d[l.value]||bt,l.length):d[l.type]}(t):void 0),s=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Ha(new Ya(s,t)):Ps(r.errors)}class qo{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!ia(r.expression)}evaluateWithoutErrorHandling(t,r,s,l,d,p){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,p)}evaluate(t,r,s,l,d,p){return this._styleExpression.evaluate(t,r,s,l,d,p)}}class Qa{constructor(t,r,s,l){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!ia(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,s,l,d,p){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,p)}evaluate(t,r,s,l,d,p){return this._styleExpression.evaluate(t,r,s,l,d,p)}interpolationFactor(t,r,s){return this.interpolationType?cr.interpolationFactor(this.interpolationType,t,r,s):0}}function Ho(n,t){const r=Ja(n,t);if(r.result==="error")return r;const s=r.value.expression,l=$a(s);if(!l&&!Is(t))return Ps([new Ct("","data expressions not supported")]);const d=qa(s,["zoom"]);if(!d&&!oc(t))return Ps([new Ct("","zoom expressions not supported")]);const p=aa(s);return p||d?p instanceof Ct?Ps([p]):p instanceof cr&&!Wa(t)?Ps([new Ct("",'"interpolate" expressions cannot be used with this property')]):Ha(p?new Qa(l?"camera":"composite",r.value,p.labels,p instanceof cr?p.interpolation:void 0):new qo(l?"constant":"source",r.value)):Ps([new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sa{constructor(t,r){this._parameters=t,this._specification=r,Ft(this,$o(this._parameters,this._specification))}static deserialize(t){return new sa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function aa(n){let t=null;if(n instanceof qt)t=aa(n.result);else if(n instanceof cs){for(const r of n.args)if(t=aa(r),t)break}else(n instanceof Ji||n instanceof cr)&&n.input instanceof Nr&&n.input.name==="zoom"&&(t=n);return t instanceof Ct||n.eachChild(r=>{const s=aa(r);s instanceof Ct?t=s:!t&&s?t=new Ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new Ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function oa(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!oa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Wo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function la(n){if(n==null)return{filter:()=>!0,needGeometry:!1};oa(n)||(n=to(n));const t=Ja(n,Wo);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>t.value.evaluate(r,s,{},l),needGeometry:cc(n)}}function eo(n,t){return n<t?-1:n>t?1:0}function cc(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(cc(n[t]))return!0;return!1}function to(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Ko(n[1],n[2],"=="):t==="!="?io(Ko(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ko(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(to))):t==="all"?["all"].concat(n.slice(1).map(to)):t==="none"?["all"].concat(n.slice(1).map(to).map(io)):t==="in"?hc(n[1],n.slice(2)):t==="!in"?io(hc(n[1],n.slice(2))):t==="has"?uc(n[1]):t!=="!has"||io(uc(n[1]));var r}function Ko(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function hc(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(eo)]]:["filter-in-small",n,["literal",t]]}}function uc(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function io(n){return["!",n]}function ro(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let l="[";for(const d of n)l+=`${ro(d)},`;return`${l}]`}const r=Object.keys(n).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${ro(n[r[l]])},`;return`${s}}`}function dc(n){let t="";for(const r of ye)t+=`/${ro(n[r])}`;return t}function ca(n){const t=n.value;return t?[new Me(n.key,t,"constants have been deprecated as of v8")]:[]}function xi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function $n(n){if(Array.isArray(n))return n.map($n);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=$n(n[r]);return t}return xi(n)}function Ir(n){const t=n.key,r=n.value,s=n.valueSpec||{},l=n.objectElementValidators||{},d=n.style,p=n.styleSpec,m=n.validateSpec;let _=[];const v=Et(r);if(v!=="object")return[new Me(t,r,`object expected, ${v} found`)];for(const w in r){const S=w.split(".")[0],I=ns(s,S)||s["*"];let A;if(ns(l,S))A=l[S];else if(ns(s,S))A=m;else if(l["*"])A=l["*"];else{if(!s["*"]){_.push(new Me(t,r[w],`unknown property "${w}"`));continue}A=m}_=_.concat(A({key:(t&&`${t}.`)+w,value:r[w],valueSpec:I,style:d,styleSpec:p,object:r,objectKey:w,validateSpec:m},r))}for(const w in s)l[w]||s[w].required&&s[w].default===void 0&&r[w]===void 0&&_.push(new Me(t,r,`missing required property "${w}"`));return _}function Xo(n){const t=n.value,r=n.valueSpec,s=n.style,l=n.styleSpec,d=n.key,p=n.arrayElementValidator||n.validateSpec;if(Et(t)!=="array")return[new Me(d,t,`array expected, ${Et(t)} found`)];if(r.length&&t.length!==r.length)return[new Me(d,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Me(d,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let m={type:r.value,values:r.values};l.$version<7&&(m.function=r.function),Et(r.value)==="object"&&(m=r.value);let _=[];for(let v=0;v<t.length;v++)_=_.concat(p({array:t,arrayIndex:v,value:t[v],valueSpec:m,validateSpec:n.validateSpec,style:s,styleSpec:l,key:`${d}[${v}]`}));return _}function ha(n){const t=n.key,r=n.value,s=n.valueSpec;let l=Et(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new Me(t,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new Me(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Me(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Yo(n){const t=n.valueSpec,r=xi(n.value.type);let s,l,d,p={};const m=r!=="categorical"&&n.value.property===void 0,_=!m,v=Et(n.value.stops)==="array"&&Et(n.value.stops[0])==="array"&&Et(n.value.stops[0][0])==="object",w=Ir({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(A){if(r==="identity")return[new Me(A.key,A.value,'identity function may not have a "stops" property')];let k=[];const B=A.value;return k=k.concat(Xo({key:A.key,value:B,valueSpec:A.valueSpec,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:S})),Et(B)==="array"&&B.length===0&&k.push(new Me(A.key,B,"array must have at least one stop")),k},default:function(A){return A.validateSpec({key:A.key,value:A.value,valueSpec:t,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec})}}});return r==="identity"&&m&&w.push(new Me(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||w.push(new Me(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Wa(n.valueSpec)&&w.push(new Me(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(_&&!Is(n.valueSpec)?w.push(new Me(n.key,n.value,"property functions not supported")):m&&!oc(n.valueSpec)&&w.push(new Me(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!v||n.value.property!==void 0||w.push(new Me(n.key,n.value,'"property" property is required')),w;function S(A){let k=[];const B=A.value,Z=A.key;if(Et(B)!=="array")return[new Me(Z,B,`array expected, ${Et(B)} found`)];if(B.length!==2)return[new Me(Z,B,`array length 2 expected, length ${B.length} found`)];if(v){if(Et(B[0])!=="object")return[new Me(Z,B,`object expected, ${Et(B[0])} found`)];if(B[0].zoom===void 0)return[new Me(Z,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new Me(Z,B,"object stop key must have value")];if(d&&d>xi(B[0].zoom))return[new Me(Z,B[0].zoom,"stop zoom values must appear in ascending order")];xi(B[0].zoom)!==d&&(d=xi(B[0].zoom),l=void 0,p={}),k=k.concat(Ir({key:`${Z}[0]`,value:B[0],valueSpec:{zoom:{}},validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{zoom:ha,value:I}}))}else k=k.concat(I({key:`${Z}[0]`,value:B[0],validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec},B));return na($n(B[1]))?k.concat([new Me(`${Z}[1]`,B[1],"expressions are not allowed in function stops.")]):k.concat(A.validateSpec({key:`${Z}[1]`,value:B[1],valueSpec:t,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec}))}function I(A,k){const B=Et(A.value),Z=xi(A.value),X=A.value!==null?A.value:k;if(s){if(B!==s)return[new Me(A.key,X,`${B} stop domain type must match previous stop domain type ${s}`)]}else s=B;if(B!=="number"&&B!=="string"&&B!=="boolean")return[new Me(A.key,X,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&r!=="categorical"){let ae=`number expected, ${B} found`;return Is(t)&&r===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(A.key,X,ae)]}return r!=="categorical"||B!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&B==="number"&&l!==void 0&&Z<l?[new Me(A.key,X,"stop domain values must appear in ascending order")]:(l=Z,r==="categorical"&&Z in p?[new Me(A.key,X,"stop domain values must be unique")]:(p[Z]=!0,[])):[new Me(A.key,X,`integer expected, found ${Z}`)]}}function un(n){const t=(n.expressionContext==="property"?Ho:Ja)($n(n.value),n.valueSpec);if(t.result==="error")return t.value.map(s=>new Me(`${n.key}${s.key}`,n.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Me(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ia(r))return[new Me(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ia(r))return[new Me(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!qa(r,["zoom","feature-state"]))return[new Me(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!$a(r))return[new Me(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jo(n){const t=n.key,r=n.value,s=Et(r);return s!=="string"?[new Me(t,r,`color expected, ${s} found`)]:Pt.parse(String(r))?[]:[new Me(t,r,`color expected, "${r}" found`)]}function ua(n){const t=n.key,r=n.value,s=n.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(xi(r))===-1&&l.push(new Me(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(xi(r))===-1&&l.push(new Me(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Qo(n){return oa($n(n.value))?un(Ft({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pc(n)}function pc(n){const t=n.value,r=n.key;if(Et(t)!=="array")return[new Me(r,t,`array expected, ${Et(t)} found`)];const s=n.styleSpec;let l,d=[];if(t.length<1)return[new Me(r,t,"filter array must have at least 1 element")];switch(d=d.concat(ua({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),xi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&xi(t[1])==="$type"&&d.push(new Me(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new Me(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Et(t[1]),l!=="string"&&d.push(new Me(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let p=2;p<t.length;p++)l=Et(t[p]),xi(t[1])==="$type"?d=d.concat(ua({key:`${r}[${p}]`,value:t[p],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new Me(`${r}[${p}]`,t[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<t.length;p++)d=d.concat(pc({key:`${r}[${p}]`,value:t[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":l=Et(t[1]),t.length!==2?d.push(new Me(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new Me(`${r}[1]`,t[1],`string expected, ${l} found`))}return d}function fc(n,t){const r=n.key,s=n.validateSpec,l=n.style,d=n.styleSpec,p=n.value,m=n.objectKey,_=d[`${t}_${n.layerType}`];if(!_)return[];const v=m.match(/^(.*)-transition$/);if(t==="paint"&&v&&_[v[1]]&&_[v[1]].transition)return s({key:r,value:p,valueSpec:d.transition,style:l,styleSpec:d});const w=n.valueSpec||_[m];if(!w)return[new Me(r,p,`unknown property "${m}"`)];let S;if(Et(p)==="string"&&Is(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(p)))return[new Me(r,p,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const I=[];return n.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&I.push(new Me(r,p,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Ka($n(p))&&xi(p.type)==="identity"&&I.push(new Me(r,p,'"text-font" does not support identity functions'))),I.concat(s({key:n.key,value:p,valueSpec:w,style:l,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:m}))}function mc(n){return fc(n,"paint")}function Es(n){return fc(n,"layout")}function As(n){let t=[];const r=n.value,s=n.key,l=n.style,d=n.styleSpec;if(Et(r)!=="object")return[new Me(s,r,`object expected, ${Et(r)} found`)];r.type||r.ref||t.push(new Me(s,r,'either "type" or "ref" is required'));let p=xi(r.type);const m=xi(r.ref);if(r.id){const _=xi(r.id);for(let v=0;v<n.arrayIndex;v++){const w=l.layers[v];xi(w.id)===_&&t.push(new Me(s,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let _;["type","source","source-layer","filter","layout"].forEach(v=>{v in r&&t.push(new Me(s,r[v],`"${v}" is prohibited for ref layers`))}),l.layers.forEach(v=>{xi(v.id)===m&&(_=v)}),_?_.ref?t.push(new Me(s,r.ref,"ref cannot reference another ref layer")):p=xi(_.type):t.push(new Me(s,r.ref,`ref layer "${m}" not found`))}else if(p!=="background")if(r.source){const _=l.sources&&l.sources[r.source],v=_&&xi(_.type);_?v==="vector"&&p==="raster"?t.push(new Me(s,r.source,`layer "${r.id}" requires a raster source`)):v!=="raster-dem"&&p==="hillshade"?t.push(new Me(s,r.source,`layer "${r.id}" requires a raster-dem source`)):v==="raster"&&p!=="raster"?t.push(new Me(s,r.source,`layer "${r.id}" requires a vector source`)):v!=="vector"||r["source-layer"]?v==="raster-dem"&&p!=="hillshade"?t.push(new Me(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||v==="geojson"&&_.lineMetrics||t.push(new Me(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Me(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Me(s,r.source,`source "${r.source}" not found`))}else t.push(new Me(s,r,'missing required property "source"'));return t=t.concat(Ir({key:s,value:r,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:Qo,layout:_=>Ir({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":v=>Es(Ft({layerType:p},v))}}),paint:_=>Ir({layer:r,key:_.key,value:_.value,style:_.style,styleSpec:_.styleSpec,validateSpec:_.validateSpec,objectElementValidators:{"*":v=>mc(Ft({layerType:p},v))}})}})),t}function Bi(n){const t=n.value,r=n.key,s=Et(t);return s!=="string"?[new Me(r,t,`string expected, ${s} found`)]:[]}const ks={promoteId:function({key:n,value:t}){if(Et(t)==="string")return Bi({key:n,value:t});{const r=[];for(const s in t)r.push(...Bi({key:`${n}.${s}`,value:t[s]}));return r}}};function el(n){const t=n.value,r=n.key,s=n.styleSpec,l=n.style,d=n.validateSpec;if(!t.type)return[new Me(r,t,'"type" is required')];const p=xi(t.type);let m;switch(p){case"vector":case"raster":return m=Ir({key:r,value:t,valueSpec:s[`source_${p.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:ks,validateSpec:d}),m;case"raster-dem":return m=function(_){var v;const w=(v=_.sourceName)!==null&&v!==void 0?v:"",S=_.value,I=_.styleSpec,A=I.source_raster_dem,k=_.style;let B=[];const Z=Et(S);if(S===void 0)return B;if(Z!=="object")return B.push(new Me("source_raster_dem",S,`object expected, ${Z} found`)),B;const X=xi(S.encoding)==="custom",ae=["redFactor","greenFactor","blueFactor","baseShift"],Q=_.value.encoding?`"${_.value.encoding}"`:"Default";for(const E in S)!X&&ae.includes(E)?B.push(new Me(E,S[E],`In "${w}": "${E}" is only valid when "encoding" is set to "custom". ${Q} encoding found`)):A[E]?B=B.concat(_.validateSpec({key:E,value:S[E],valueSpec:A[E],validateSpec:_.validateSpec,style:k,styleSpec:I})):B.push(new Me(E,S[E],`unknown property "${E}"`));return B}({sourceName:r,value:t,style:n.style,styleSpec:s,validateSpec:d}),m;case"geojson":if(m=Ir({key:r,value:t,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:d,objectElementValidators:ks}),t.cluster)for(const _ in t.clusterProperties){const[v,w]=t.clusterProperties[_],S=typeof v=="string"?[v,["accumulated"],["get",_]]:v;m.push(...un({key:`${r}.${_}.map`,value:w,expressionContext:"cluster-map"})),m.push(...un({key:`${r}.${_}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return m;case"video":return Ir({key:r,value:t,valueSpec:s.source_video,style:l,validateSpec:d,styleSpec:s});case"image":return Ir({key:r,value:t,valueSpec:s.source_image,style:l,validateSpec:d,styleSpec:s});case"canvas":return[new Me(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ua({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function gc(n){const t=n.value,r=n.styleSpec,s=r.light,l=n.style;let d=[];const p=Et(t);if(t===void 0)return d;if(p!=="object")return d=d.concat([new Me("light",t,`object expected, ${p} found`)]),d;for(const m in t){const _=m.match(/^(.*)-transition$/);d=d.concat(_&&s[_[1]]&&s[_[1]].transition?n.validateSpec({key:m,value:t[m],valueSpec:r.transition,validateSpec:n.validateSpec,style:l,styleSpec:r}):s[m]?n.validateSpec({key:m,value:t[m],valueSpec:s[m],validateSpec:n.validateSpec,style:l,styleSpec:r}):[new Me(m,t[m],`unknown property "${m}"`)])}return d}function _c(n){const t=n.value,r=n.styleSpec,s=r.sky,l=n.style,d=Et(t);if(t===void 0)return[];if(d!=="object")return[new Me("sky",t,`object expected, ${d} found`)];let p=[];for(const m in t)p=p.concat(s[m]?n.validateSpec({key:m,value:t[m],valueSpec:s[m],style:l,styleSpec:r}):[new Me(m,t[m],`unknown property "${m}"`)]);return p}function zs(n){const t=n.value,r=n.styleSpec,s=r.terrain,l=n.style;let d=[];const p=Et(t);if(t===void 0)return d;if(p!=="object")return d=d.concat([new Me("terrain",t,`object expected, ${p} found`)]),d;for(const m in t)d=d.concat(s[m]?n.validateSpec({key:m,value:t[m],valueSpec:s[m],validateSpec:n.validateSpec,style:l,styleSpec:r}):[new Me(m,t[m],`unknown property "${m}"`)]);return d}function tl(n){let t=[];const r=n.value,s=n.key;if(Array.isArray(r)){const l=[],d=[];for(const p in r)r[p].id&&l.includes(r[p].id)&&t.push(new Me(s,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),l.push(r[p].id),r[p].url&&d.includes(r[p].url)&&t.push(new Me(s,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),d.push(r[p].url),t=t.concat(Ir({key:`${s}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Bi({key:s,value:r})}function no(n){return t=n.value,t&&t.constructor===Object?[]:[new Me(n.key,n.value,`object expected, ${Et(n.value)} found`)];var t}const yc={"*":()=>[],array:Xo,boolean:function(n){const t=n.value,r=n.key,s=Et(t);return s!=="boolean"?[new Me(r,t,`boolean expected, ${s} found`)]:[]},number:ha,color:Jo,constants:ca,enum:ua,filter:Qo,function:Yo,layer:As,object:Ir,source:el,light:gc,sky:_c,terrain:zs,projection:function(n){const t=n.value,r=n.styleSpec,s=r.projection,l=n.style,d=Et(t);if(t===void 0)return[];if(d!=="object")return[new Me("projection",t,`object expected, ${d} found`)];let p=[];for(const m in t)p=p.concat(s[m]?n.validateSpec({key:m,value:t[m],valueSpec:s[m],style:l,styleSpec:r}):[new Me(m,t[m],`unknown property "${m}"`)]);return p},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const s=Et(r);return s!=="array"||function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"}(r)||function(l){return!!["interpolate","step","literal"].includes(l[0])}(r)?["array","string"].includes(s)?[]:[new Me(t,r,`projection expected, invalid type "${s}" found`)]:[new Me(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Bi,formatted:function(n){return Bi(n).length===0?[]:un(n)},resolvedImage:function(n){return Bi(n).length===0?[]:un(n)},padding:function(n){const t=n.key,r=n.value;if(Et(r)==="array"){if(r.length<1||r.length>4)return[new Me(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let d=0;d<r.length;d++)l=l.concat(n.validateSpec({key:`${t}[${d}]`,value:r[d],validateSpec:n.validateSpec,valueSpec:s}));return l}return ha({key:t,value:r,valueSpec:{}})},numberArray:function(n){const t=n.key,r=n.value;if(Et(r)==="array"){const s={type:"number"};if(r.length<1)return[new Me(t,r,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<r.length;d++)l=l.concat(n.validateSpec({key:`${t}[${d}]`,value:r[d],validateSpec:n.validateSpec,valueSpec:s}));return l}return ha({key:t,value:r,valueSpec:{}})},colorArray:function(n){const t=n.key,r=n.value;if(Et(r)==="array"){if(r.length<1)return[new Me(t,r,"array length at least 1 expected, length 0 found")];let s=[];for(let l=0;l<r.length;l++)s=s.concat(Jo({key:`${t}[${l}]`,value:r[l]}));return s}return Jo({key:t,value:r})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,s=Et(r),l=n.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Me(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let p=0;p<r.length;p+=2)d=d.concat(ua({key:`${t}[${p}]`,value:r[p],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(Xo({key:`${t}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:l}));return d},sprite:tl,state:no};function Ls(n){const t=n.value,r=n.valueSpec,s=n.styleSpec;return n.validateSpec=Ls,r.expression&&Ka(xi(t))?Yo(n):r.expression&&na($n(t))?un(n):r.type&&yc[r.type]?yc[r.type](n):Ir(Ft({},n,{valueSpec:r.type?s[r.type]:r}))}function vc(n){const t=n.value,r=n.key,s=Bi(n);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new Me(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new Me(r,t,'"glyphs" url must include a "{range}" token'))),s}function hr(n,t=U){let r=[];return r=r.concat(Ls({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Ls,objectElementValidators:{glyphs:vc,"*":()=>[]}})),n.constants&&(r=r.concat(ca({key:"constants",value:n.constants}))),Rs(r)}function Yr(n){return function(t){return n({...t,validateSpec:Ls})}}function Rs(n){return[].concat(n).sort((t,r)=>t.line-r.line)}function Jr(n){return function(...t){return Rs(n.apply(this,t))}}hr.source=Jr(Yr(el)),hr.sprite=Jr(Yr(tl)),hr.glyphs=Jr(Yr(vc)),hr.light=Jr(Yr(gc)),hr.sky=Jr(Yr(_c)),hr.terrain=Jr(Yr(zs)),hr.state=Jr(Yr(no)),hr.layer=Jr(Yr(As)),hr.filter=Jr(Yr(Qo)),hr.paintProperty=Jr(Yr(mc)),hr.layoutProperty=Jr(Yr(Es));const Ds=hr,so=Ds.light,xh=Ds.sky,il=Ds.paintProperty,ao=Ds.layoutProperty;function rl(n,t){let r=!1;if(t&&t.length)for(const s of t)n.fire(new Y(new Error(s.message))),r=!0;return r}class Bs{constructor(t,r,s){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(r=p[1])+2*(s=p[2]);for(let _=0;_<this.d*this.d;_++){const v=p[3+_],w=p[3+_+1];l.push(v===w?null:p.subarray(v,w))}const m=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],m),this.bboxes=p.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const d=s/r*t;this.min=-d,this.max=t+d}insert(t,r,s,l,d){this._forEachCell(r,s,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,l,d,p){this.cells[d].push(p)}query(t,r,s,l,d){const p=this.min,m=this.max;if(t<=p&&r<=p&&m<=s&&m<=l&&!d)return Array.prototype.slice.call(this.keys);{const _=[];return this._forEachCell(t,r,s,l,this._queryCell,_,{},d),_}}_queryCell(t,r,s,l,d,p,m,_){const v=this.cells[d];if(v!==null){const w=this.keys,S=this.bboxes;for(let I=0;I<v.length;I++){const A=v[I];if(m[A]===void 0){const k=4*A;(_?_(S[k+0],S[k+1],S[k+2],S[k+3]):t<=S[k+2]&&r<=S[k+3]&&s>=S[k+0]&&l>=S[k+1])?(m[A]=!0,p.push(w[A])):m[A]=!1}}}}_forEachCell(t,r,s,l,d,p,m,_){const v=this._convertToCellCoord(t),w=this._convertToCellCoord(r),S=this._convertToCellCoord(s),I=this._convertToCellCoord(l);for(let A=v;A<=S;A++)for(let k=w;k<=I;k++){const B=this.d*k+A;if((!_||_(this._convertFromCellCoord(A),this._convertFromCellCoord(k),this._convertFromCellCoord(A+1),this._convertFromCellCoord(k+1)))&&d.call(this,t,r,s,l,B,p,m,_))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let p=0;p<this.cells.length;p++)s+=this.cells[p].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=r;for(let p=0;p<t.length;p++){const m=t[p];l[3+p]=d,l.set(m,d),d+=m.length}return l[3+t.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+t.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new Bs(t.buffer)}}const dn={};function Je(n,t,r={}){if(dn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),dn[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Je("Object",Object),Je("TransferableGridIndex",Bs),Je("Color",Pt),Je("Error",Error),Je("AJAXError",gr),Je("ResolvedImage",lr),Je("StylePropertyFunction",sa),Je("StyleExpression",Ya,{omit:["_evaluator"]}),Je("ZoomDependentExpression",Qa),Je("ZoomConstantExpression",qo),Je("CompoundExpression",Nr,{omit:["_evaluate"]});for(const n in Ms)Ms[n]._classRegistryKey||Je(`Expression_${n}`,Ms[n]);function oo(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function lo(n){return n.$name||n.constructor._classRegistryKey}function bc(n){return!function(t){if(t===null||typeof t!="object")return!1;const r=lo(t);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||oo(n)||Tr(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Fs(n,t){if(bc(n))return(oo(n)||Tr(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const d=[];for(const p of n)d.push(Fs(p,t));return d}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=lo(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!dn[r])throw new Error(`${r} is not registered.`);const{klass:s}=dn[r],l=s.serialize?s.serialize(n,t):{};if(s.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in n){if(!n.hasOwnProperty(d)||dn[r].omit.indexOf(d)>=0)continue;const p=n[d];l[d]=dn[r].shallow.indexOf(d)>=0?p:Fs(p,t)}n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function da(n){if(bc(n))return n;if(Array.isArray(n))return n.map(da);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=lo(n)||"Object";if(!dn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=dn[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const s=Object.create(r.prototype);for(const l of Object.keys(n)){if(l==="$name")continue;const d=n[l];s[l]=dn[t].shallow.indexOf(l)>=0?d:da(d)}return s}class nl{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const At={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function co(n){for(const t of n)if(ho(t.charCodeAt(0)))return!0;return!1}function wh(n){for(const t of n)if(!wc(t.charCodeAt(0)))return!1;return!0}function sl(n){const t=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const xc=sl(["Arab","Dupl","Mong","Ougr","Syrc"]);function wc(n){return!xc.test(String.fromCodePoint(n))}const al=sl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ho(n){return!(n!==746&&n!==747&&(n<4352||!(At["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||At["CJK Compatibility"](n)||At["CJK Strokes"](n)||!(!At["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||At["Enclosed CJK Letters and Months"](n)||At["Ideographic Description Characters"](n)||At.Kanbun(n)||At.Katakana(n)&&n!==12540||!(!At["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!At["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||At["Vertical Forms"](n)||At["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||al.test(String.fromCodePoint(n)))))}function pa(n){return!(ho(n)||function(t){return!!(At["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||At["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||At["Letterlike Symbols"](t)||At["Number Forms"](t)||At["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||At["Control Pictures"](t)&&t!==9251||At["Optical Character Recognition"](t)||At["Enclosed Alphanumerics"](t)||At["Geometric Shapes"](t)||At["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||At["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||At["CJK Symbols and Punctuation"](t)||At.Katakana(t)||At["Private Use Area"](t)||At["CJK Compatibility Forms"](t)||At["Small Form Variants"](t)||At["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const Th=sl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function uo(n){return Th.test(String.fromCodePoint(n))}function Sh(n,t){return!(!t&&uo(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||At.Khmer(n))}function Ch(n){for(const t of n)if(uo(t.charCodeAt(0)))return!0;return!1}const Cn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Cn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,s=new Promise(d=>{this.loadScriptResolve=d});t(r);const l=new Promise(d=>setTimeout(()=>d(),this.TIMEOUT));if(yield Promise.race([s,l]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:r};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class ti{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new nl,this.transition={})}isSupportedScript(t){return function(r,s){for(const l of r)if(!Sh(l.charCodeAt(0),s))return!1;return!0}(t,Cn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class fa{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,l){if(Ka(s))return new sa(s,l);if(na(s)){const d=Ho(s,l);if(d.result==="error")throw new Error(d.value.map(p=>`${p.key}: ${p.message}`).join(", "));return d.value}{let d=s;return l.type==="color"&&typeof s=="string"?d=Pt.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type!=="numberArray"||typeof s!="number"&&!Array.isArray(s)?l.type!=="colorArray"||typeof s!="string"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)?d=Xi.parse(s):l.type==="projectionDefinition"&&typeof s=="string"&&(d=Yi.parse(s)):d=bi.parse(s):d=mi.parse(s):d=Pi.parse(s),{kind:"constant",evaluate:()=>d}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class ol{constructor(t){this.property=t,this.value=new fa(t,void 0)}transitioned(t,r){return new Sc(this.property,this.value,r,Bt({},t.transition,this.transition),t.now)}untransitioned(){return new Sc(this.property,this.value,null,{},0)}}class Tc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return nr(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ol(this._values[t].property)),this._values[t].value=new fa(this._values[t].property,r===null?void 0:nr(r))}getTransition(t){return nr(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ol(this._values[t].property)),this._values[t].transition=nr(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const s=new Cc(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(t,r._values[l]);return s}untransitioned(){const t=new Cc(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Sc{constructor(t,r,s,l,d){this.property=t,this.value=r,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const l=t.now||0,d=this.value.possiblyEvaluate(t,r,s),p=this.prior;if(p){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return p.possiblyEvaluate(t,r,s);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(t,r,s),d,Vi(m))}}return d}}class Cc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const l=new po(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Mh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return nr(this._values[t].value)}setValue(t,r){this._values[t]=new fa(this._values[t].property,r===null?void 0:nr(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const l=new po(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}}class yr{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,l){return this.property.evaluate(this.value,this.parameters,t,r,s,l)}}class po{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class nt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const l=cn[this.specification.type];return l?l(t,r,s):t}}class ht{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,l){return new yr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,l)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},t.parameters);const l=cn[this.specification.type];if(l){const d=l(t.value.value,r.value.value,s);return new yr(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,r,s,l,d,p){return t.kind==="constant"?t.value:t.evaluate(r,s,l,d,p)}}class ma extends ht{possiblyEvaluate(t,r,s,l){if(t.value===void 0)return new yr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l),p=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,m=this._calculate(p,p,p,r);return new yr(this,{kind:"constant",value:m},r)}if(t.expression.kind==="camera"){const d=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new yr(this,{kind:"constant",value:d},r)}return new yr(this,t.expression,r)}evaluate(t,r,s,l,d,p){if(t.kind==="source"){const m=t.evaluate(r,s,l,d,p);return this._calculate(m,m,m,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,l),t.evaluate({zoom:Math.floor(r.zoom)},s,l),t.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):t.value}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class ll{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l);return this._calculate(d,d,d,r)}return this._calculate(t.expression.evaluate(new ti(Math.floor(r.zoom-1),r)),t.expression.evaluate(new ti(Math.floor(r.zoom),r)),t.expression.evaluate(new ti(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class cl{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){return!!t.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class Ei{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new fa(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new ol(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Je("DataDrivenProperty",ht),Je("DataConstantProperty",nt),Je("CrossFadedDataDrivenProperty",ma),Je("CrossFadedProperty",ll),Je("ColorRampProperty",cl);const hl="-transition";class Vr extends oe{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Mh(r.layout)),r.paint)){this._transitionablePaint=new Tc(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new po(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(ao,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(hl)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(il,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(hl))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[t],d=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const _=this._transitionablePaint._values[t].value;return _.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(t,m,_)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),qr(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,l,d={}){return(!d||d.validate!==!1)&&rl(this,t.call(Ds,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:U,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof yr&&Is(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Mc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ms{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function li(n,t=1){let r=0,s=0;return{members:n.map(l=>{const d=Mc[l.type].BYTES_PER_ELEMENT,p=r=Os(r,Math.max(t,d)),m=l.components||1;return s=Math.max(s,d),r+=d*m,{name:l.name,type:l.type,components:m,offset:p}}),size:Os(r,Math.max(s,t)),alignment:t}}function Os(n,t){return Math.ceil(n/t)*t}class ga extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=s,t}}ga.prototype.bytesPerElement=4,Je("StructArrayLayout2i4",ga);class _a extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=l,t}}_a.prototype.bytesPerElement=6,Je("StructArrayLayout3i6",_a);class gs extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const p=4*t;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,this.int16[p+3]=d,t}}gs.prototype.bytesPerElement=8,Je("StructArrayLayout4i8",gs);class ul extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,s,l,d,p)}emplace(t,r,s,l,d,p,m){const _=6*t;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=d,this.int16[_+4]=p,this.int16[_+5]=m,t}}ul.prototype.bytesPerElement=12,Je("StructArrayLayout2i4i12",ul);class dl extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,s,l,d,p)}emplace(t,r,s,l,d,p,m){const _=4*t,v=8*t;return this.int16[_+0]=r,this.int16[_+1]=s,this.uint8[v+4]=l,this.uint8[v+5]=d,this.uint8[v+6]=p,this.uint8[v+7]=m,t}}dl.prototype.bytesPerElement=8,Je("StructArrayLayout2i4ub8",dl);class js extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=s,t}}js.prototype.bytesPerElement=8,Je("StructArrayLayout2f8",js);class pl extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p,m,_,v,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,s,l,d,p,m,_,v,w)}emplace(t,r,s,l,d,p,m,_,v,w,S){const I=10*t;return this.uint16[I+0]=r,this.uint16[I+1]=s,this.uint16[I+2]=l,this.uint16[I+3]=d,this.uint16[I+4]=p,this.uint16[I+5]=m,this.uint16[I+6]=_,this.uint16[I+7]=v,this.uint16[I+8]=w,this.uint16[I+9]=S,t}}pl.prototype.bytesPerElement=20,Je("StructArrayLayout10ui20",pl);class h extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p,m,_,v,w,S,I){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,s,l,d,p,m,_,v,w,S,I)}emplace(t,r,s,l,d,p,m,_,v,w,S,I,A){const k=12*t;return this.int16[k+0]=r,this.int16[k+1]=s,this.int16[k+2]=l,this.int16[k+3]=d,this.uint16[k+4]=p,this.uint16[k+5]=m,this.uint16[k+6]=_,this.uint16[k+7]=v,this.int16[k+8]=w,this.int16[k+9]=S,this.int16[k+10]=I,this.int16[k+11]=A,t}}h.prototype.bytesPerElement=24,Je("StructArrayLayout4i4ui4i24",h);class e extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}e.prototype.bytesPerElement=12,Je("StructArrayLayout3f12",e);class i extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}i.prototype.bytesPerElement=4,Je("StructArrayLayout1ul4",i);class a extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p,m,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,s,l,d,p,m,_,v)}emplace(t,r,s,l,d,p,m,_,v,w){const S=10*t,I=5*t;return this.int16[S+0]=r,this.int16[S+1]=s,this.int16[S+2]=l,this.int16[S+3]=d,this.int16[S+4]=p,this.int16[S+5]=m,this.uint32[I+3]=_,this.uint16[S+8]=v,this.uint16[S+9]=w,t}}a.prototype.bytesPerElement=20,Je("StructArrayLayout6i1ul2ui20",a);class o extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,s,l,d,p)}emplace(t,r,s,l,d,p,m){const _=6*t;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=l,this.int16[_+3]=d,this.int16[_+4]=p,this.int16[_+5]=m,t}}o.prototype.bytesPerElement=12,Je("StructArrayLayout2i2i2i12",o);class u extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,l,d)}emplace(t,r,s,l,d,p){const m=4*t,_=8*t;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=l,this.int16[_+6]=d,this.int16[_+7]=p,t}}u.prototype.bytesPerElement=16,Je("StructArrayLayout2f1f2i16",u);class f extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,s,l,d,p)}emplace(t,r,s,l,d,p,m){const _=16*t,v=4*t,w=8*t;return this.uint8[_+0]=r,this.uint8[_+1]=s,this.float32[v+1]=l,this.float32[v+2]=d,this.int16[w+6]=p,this.int16[w+7]=m,t}}f.prototype.bytesPerElement=16,Je("StructArrayLayout2ub2f2i16",f);class g extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=l,t}}g.prototype.bytesPerElement=6,Je("StructArrayLayout3ui6",g);class y extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p,m,_,v,w,S,I,A,k,B,Z,X){const ae=this.length;return this.resize(ae+1),this.emplace(ae,t,r,s,l,d,p,m,_,v,w,S,I,A,k,B,Z,X)}emplace(t,r,s,l,d,p,m,_,v,w,S,I,A,k,B,Z,X,ae){const Q=24*t,E=12*t,V=48*t;return this.int16[Q+0]=r,this.int16[Q+1]=s,this.uint16[Q+2]=l,this.uint16[Q+3]=d,this.uint32[E+2]=p,this.uint32[E+3]=m,this.uint32[E+4]=_,this.uint16[Q+10]=v,this.uint16[Q+11]=w,this.uint16[Q+12]=S,this.float32[E+7]=I,this.float32[E+8]=A,this.uint8[V+36]=k,this.uint8[V+37]=B,this.uint8[V+38]=Z,this.uint32[E+10]=X,this.int16[Q+22]=ae,t}}y.prototype.bytesPerElement=48,Je("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",y);class b extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,p,m,_,v,w,S,I,A,k,B,Z,X,ae,Q,E,V,ee,ve,je,we,Ie,Ge,Ne){const $e=this.length;return this.resize($e+1),this.emplace($e,t,r,s,l,d,p,m,_,v,w,S,I,A,k,B,Z,X,ae,Q,E,V,ee,ve,je,we,Ie,Ge,Ne)}emplace(t,r,s,l,d,p,m,_,v,w,S,I,A,k,B,Z,X,ae,Q,E,V,ee,ve,je,we,Ie,Ge,Ne,$e){const ze=32*t,Qe=16*t;return this.int16[ze+0]=r,this.int16[ze+1]=s,this.int16[ze+2]=l,this.int16[ze+3]=d,this.int16[ze+4]=p,this.int16[ze+5]=m,this.int16[ze+6]=_,this.int16[ze+7]=v,this.uint16[ze+8]=w,this.uint16[ze+9]=S,this.uint16[ze+10]=I,this.uint16[ze+11]=A,this.uint16[ze+12]=k,this.uint16[ze+13]=B,this.uint16[ze+14]=Z,this.uint16[ze+15]=X,this.uint16[ze+16]=ae,this.uint16[ze+17]=Q,this.uint16[ze+18]=E,this.uint16[ze+19]=V,this.uint16[ze+20]=ee,this.uint16[ze+21]=ve,this.uint16[ze+22]=je,this.uint32[Qe+12]=we,this.float32[Qe+13]=Ie,this.float32[Qe+14]=Ge,this.uint16[ze+30]=Ne,this.uint16[ze+31]=$e,t}}b.prototype.bytesPerElement=64,Je("StructArrayLayout8i15ui1ul2f2ui64",b);class T extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}T.prototype.bytesPerElement=4,Je("StructArrayLayout1f4",T);class P extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[6*t+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}P.prototype.bytesPerElement=12,Je("StructArrayLayout1ui2f12",P);class M extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=4*t;return this.uint32[2*t+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=l,t}}M.prototype.bytesPerElement=8,Je("StructArrayLayout1ul2ui8",M);class z extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=s,t}}z.prototype.bytesPerElement=4,Je("StructArrayLayout2ui4",z);class R extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}R.prototype.bytesPerElement=2,Je("StructArrayLayout1ui2",R);class W extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const p=4*t;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,this.float32[p+3]=d,t}}W.prototype.bytesPerElement=16,Je("StructArrayLayout4f16",W);class H extends ms{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Re(this.anchorPointX,this.anchorPointY)}}H.prototype.size=20;class K extends a{get(t){return new H(this,t)}}Je("CollisionBoxArray",K);class J extends ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class ie extends y{get(t){return new J(this,t)}}Je("PlacedSymbolArray",ie);class te extends ms{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}te.prototype.size=64;class re extends b{get(t){return new te(this,t)}}Je("SymbolInstanceArray",re);class le extends T{getoffsetX(t){return this.float32[1*t+0]}}Je("GlyphOffsetArray",le);class se extends _a{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Je("SymbolLineVertexArray",se);class _e extends ms{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}_e.prototype.size=12;class Ee extends P{get(t){return new _e(this,t)}}Je("TextAnchorOffsetArray",Ee);class Te extends ms{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Te.prototype.size=8;class Se extends M{get(t){return new Te(this,t)}}Je("FeatureIndexArray",Se);class Pe extends ga{}class Ke extends ga{}class We extends ga{}class Ve extends ul{}class tt extends dl{}class wt extends js{}class Rt extends pl{}class ci extends h{}class Yt extends e{}class hi extends i{}class ui extends o{}class Qt extends f{}class Zt extends g{}class Fi extends z{}const Gi=li([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qi}=Gi;class Ut{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,s,l){const d=this.segments[this.segments.length-1];return t>Ut.MAX_VERTEX_ARRAY_LENGTH&&Zi(`Max vertices per segment is ${Ut.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ut.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+t>Ut.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l?this.createNewSegment(r,s,l):d}createNewSegment(t,r,s){const l={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return s!==void 0&&(l.sortKey=s),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,r,s){return this.prepareSegment(0,t,r,s)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,l){return new Ut([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function qn(n,t){return 256*(n=xt(Math.floor(n),0,255))+xt(Math.floor(t),0,255)}Ut.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Je("SegmentVector",Ut);const pn=li([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Hn,_s,ya,Wn={exports:{}},ys={exports:{}},Er={exports:{}},Kn=function(){if(ya)return Wn.exports;ya=1;var n=(Hn||(Hn=1,ys.exports=function(r,s){var l,d,p,m,_,v,w,S;for(d=r.length-(l=3&r.length),p=s,_=3432918353,v=461845907,S=0;S<d;)w=255&r.charCodeAt(S)|(255&r.charCodeAt(++S))<<8|(255&r.charCodeAt(++S))<<16|(255&r.charCodeAt(++S))<<24,++S,p=27492+(65535&(m=5*(65535&(p=(p^=w=(65535&(w=(w=(65535&w)*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,l){case 3:w^=(255&r.charCodeAt(S+2))<<16;case 2:w^=(255&r.charCodeAt(S+1))<<8;case 1:p^=w=(65535&(w=(w=(65535&(w^=255&r.charCodeAt(S)))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return p^=r.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),ys.exports),t=(_s||(_s=1,Er.exports=function(r,s){for(var l,d=r.length,p=s^d,m=0;d>=4;)l=1540483477*(65535&(l=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++m;switch(d){case 3:p^=(255&r.charCodeAt(m+2))<<16;case 2:p^=(255&r.charCodeAt(m+1))<<8;case 1:p=1540483477*(65535&(p^=255&r.charCodeAt(m)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Er.exports);return Wn.exports=n,Wn.exports.murmur3=n,Wn.exports.murmur2=t,Wn.exports}(),Mn=me(Kn);class Xn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,l){this.ids.push(Ai(t)),this.positions.push(r,s,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ai(t);let s=0,l=this.ids.length-1;for(;s<l;){const p=s+l>>1;this.ids[p]>=r?l=p:s=p+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(t,r){const s=new Float64Array(t.ids),l=new Uint32Array(t.positions);return ki(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(t){const r=new Xn;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Ai(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Mn(String(n))}function ki(n,t,r,s){for(;r<s;){const l=n[r+s>>1];let d=r-1,p=s+1;for(;;){do d++;while(n[d]<l);do p--;while(n[p]>l);if(d>=p)break;vr(n,d,p),vr(t,3*d,3*p),vr(t,3*d+1,3*p+1),vr(t,3*d+2,3*p+2)}p-r<s-p?(ki(n,t,r,p),r=p+1):(ki(n,t,p+1,s),s=p)}}function vr(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}Je("FeaturePositionMap",Xn);class ii{constructor(t,r){this.gl=t.gl,this.location=r}}class fo extends ii{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Pc extends ii{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ic extends ii{constructor(t,r){super(t,r),this.current=Pt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ph=new Float32Array(16);function fl(n){return[qn(255*n.r,255*n.g),qn(255*n.b,255*n.a)]}class va{constructor(t,r,s){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new Ic(t,r):new fo(t,r)}}class Zr{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,l){const d=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new Pc(t,r):new fo(t,r)}}class fn{constructor(t,r,s,l){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,s,l,d){const p=this.paintVertexArray.length,m=this.expression.evaluate(new ti(0),r,{},l,[],d);this.paintVertexArray.resize(t),this._setPaintValue(p,t,m)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(t,r,d)}_setPaintValue(t,r,s){if(this.type==="color"){const l=fl(s);for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ur{constructor(t,r,s,l,d,p){this.expression=t,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,r,s,l,d){const p=this.expression.evaluate(new ti(this.zoom),r,{},l,[],d),m=this.expression.evaluate(new ti(this.zoom+1),r,{},l,[],d),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,p,m)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:this.zoom},s,l),p=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(t,r,d,p)}_setPaintValue(t,r,s,l){if(this.type==="color"){const d=fl(s),p=fl(l);for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,d[0],d[1],p[0],p[1])}else{for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=xt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,s){return new fo(t,r)}}class Pn{constructor(t,r,s,l,d,p){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,l,d){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(t,r,s,l){if(!l||!s)return;const{min:d,mid:p,max:m}=s,_=l[d],v=l[p],w=l[m];if(_&&v&&w)for(let S=t;S<r;S++)this.zoomInPaintVertexArray.emplace(S,v.tl[0],v.tl[1],v.br[0],v.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],v.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(S,v.tl[0],v.tl[1],v.br[0],v.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],v.pixelRatio,w.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,pn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,pn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class mo{constructor(t,r,s){this.binders={},this._buffers=[];const l=[];for(const d in t.paint._values){if(!s(d))continue;const p=t.paint.get(d);if(!(p instanceof yr&&Is(p.property.specification)))continue;const m=ml(d,t.type),_=p.value,v=p.property.specification.type,w=p.property.useIntegerZoom,S=p.property.specification["property-type"],I=S==="cross-faded"||S==="cross-faded-data-driven";if(_.kind==="constant")this.binders[d]=I?new Zr(_.value,m):new va(_.value,m,v),l.push(`/u_${d}`);else if(_.kind==="source"||I){const A=qu(d,v,"source");this.binders[d]=I?new Pn(_,v,w,r,A,t.id):new fn(_,m,v,A),l.push(`/a_${d}`)}else{const A=qu(d,v,"composite");this.binders[d]=new Ur(_,m,v,w,r,A),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof fn||r instanceof Ur?r.maxValue:0}populatePaintArrays(t,r,s,l,d){for(const p in this.binders){const m=this.binders[p];(m instanceof fn||m instanceof Ur||m instanceof Pn)&&m.populatePaintArray(t,r,s,l,d)}}setConstantPatternPositions(t,r){for(const s in this.binders){const l=this.binders[s];l instanceof Zr&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,l,d){let p=!1;for(const m in t){const _=r.getPositions(m);for(const v of _){const w=s.feature(v.index);for(const S in this.binders){const I=this.binders[S];if((I instanceof fn||I instanceof Ur||I instanceof Pn)&&I.expression.isStateDependent===!0){const A=l.paint.get(S);I.expression=A.value,I.updatePaintArray(v.start,v.end,w,t[m],d),p=!0}}}}return p}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof va||s instanceof Zr)&&t.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof fn||s instanceof Ur)for(let l=0;l<s.paintVertexAttributes.length;l++)t.push(s.paintVertexAttributes[l].name);else if(s instanceof Pn)for(let l=0;l<pn.members.length;l++)t.push(pn.members[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof va||s instanceof Zr||s instanceof Ur)for(const l of s.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof va||d instanceof Zr||d instanceof Ur){for(const p of d.uniformNames)if(r[p]){const m=d.getBinding(t,r[p],p);s.push({name:p,property:l,binding:m})}}}return s}setUniforms(t,r,s,l){for(const{name:d,property:p,binding:m}of r)this.binders[p].setUniform(m,l,s.get(p),d)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof Pn){const l=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof fn||s instanceof Ur)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof fn||s instanceof Ur||s instanceof Pn)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof fn||r instanceof Ur||r instanceof Pn)&&r.destroy()}}}class Yn{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new mo(l,r,s);this.needsUpload=!1,this._featureMap=new Xn,this._bufferOffset=0}populatePaintArrays(t,r,s,l,d,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,l,d,p);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,l){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,r,d,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ml(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function qu(n,t,r){const s={color:{source:js,composite:W},number:{source:T,composite:js}},l=function(d){return{"line-pattern":{source:Rt,composite:Rt},"fill-pattern":{source:Rt,composite:Rt},"fill-extrusion-pattern":{source:Rt,composite:Rt}}[d]}(n);return l&&l[r]||s[t][r]}Je("ConstantBinder",va),Je("CrossFadedConstantBinder",Zr),Je("SourceExpressionBinder",fn),Je("CrossFadedCompositeBinder",Pn),Je("CompositeExpressionBinder",Ur),Je("ProgramConfiguration",mo,{omit:["_buffers"]}),Je("ProgramConfigurationSet",Yn);const Ih=Math.pow(2,14)-1,Hu=-Ih-1;function ba(n){const t=yt/n.extent,r=n.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let d=0;d<l.length;d++){const p=l[d],m=Math.round(p.x*t),_=Math.round(p.y*t);p.x=xt(m,Hu,Ih),p.y=xt(_,Hu,Ih),(m<p.x||m>p.x+1||_<p.y||_>p.y+1)&&Zi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function xa(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?ba(n):[]}}const Wu=-32768;function Ef(n,t,r,s,l){n.emplaceBack(Wu+8*t+s,Wu+8*r+l)}class Eh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.indexArray=new Zt,this.segments=new Ut,this.programConfigurations=new Yn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const l=this.layers[0],d=[];let p=null,m=!1,_=l.type==="heatmap";if(l.type==="circle"){const w=l;p=w.layout.get("circle-sort-key"),m=!p.isConstant(),_=_||w.paint.get("circle-pitch-alignment")==="map"}const v=_?r.subdivisionGranularity.circle:1;for(const{feature:w,id:S,index:I,sourceLayerIndex:A}of t){const k=this.layers[0]._featureFilter.needGeometry,B=xa(w,k);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),B,s))continue;const Z=m?p.evaluate(B,{},s):void 0,X={id:S,properties:w.properties,type:w.type,sourceLayerIndex:A,index:I,geometry:k?B.geometry:ba(w),patterns:{},sortKey:Z};d.push(X)}m&&d.sort((w,S)=>w.sortKey-S.sortKey);for(const w of d){const{geometry:S,index:I,sourceLayerIndex:A}=w,k=t[I].feature;this.addFeature(w,S,I,s,v),r.featureIndex.insert(k,S,I,A,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,l,d=1){let p;switch(d){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const m=p.length;for(const _ of r)for(const v of _){const w=v.x,S=v.y;if(w<0||w>=yt||S<0||S>=yt)continue;const I=this.segments.prepareSegment(m*m,this.layoutVertexArray,this.indexArray,t.sortKey),A=I.vertexLength;for(let k=0;k<m;k++)for(let B=0;B<m;B++)Ef(this.layoutVertexArray,w,S,p[B],p[k]);for(let k=0;k<m-1;k++)for(let B=0;B<m-1;B++){const Z=A+k*m+B,X=A+(k+1)*m+B;this.indexArray.emplaceBack(Z,X+1,Z+1),this.indexArray.emplaceBack(Z,X,X+1)}I.vertexLength+=m*m,I.primitiveLength+=(m-1)*(m-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},l)}}function Ku(n,t){for(let r=0;r<n.length;r++)if(wa(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(wa(n,t[r]))return!0;return!!Ah(n,t)}function Af(n,t,r){return!!wa(n,t)||!!kh(t,n,r)}function Xu(n,t){if(n.length===1)return Ju(t,n[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let l=0;l<s.length;l++)if(wa(n,s[l]))return!0}for(let r=0;r<n.length;r++)if(Ju(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Ah(n,t[r]))return!0;return!1}function kf(n,t,r){if(n.length>1){if(Ah(n,t))return!0;for(let s=0;s<t.length;s++)if(kh(t[s],n,r))return!0}for(let s=0;s<n.length;s++)if(kh(n[s],t,r))return!0;return!1}function Ah(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const s=n[r],l=n[r+1];for(let d=0;d<t.length-1;d++)if(zf(s,l,t[d],t[d+1]))return!0}return!1}function zf(n,t,r,s){return Gt(n,r,s)!==Gt(t,r,s)&&Gt(n,t,r)!==Gt(n,t,s)}function kh(n,t,r){const s=r*r;if(t.length===1)return n.distSqr(t[0])<s;for(let l=1;l<t.length;l++)if(Yu(n,t[l-1],t[l])<s)return!0;return!1}function Yu(n,t,r){const s=t.distSqr(r);if(s===0)return n.distSqr(t);const l=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/s;return n.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function Ju(n,t){for(let r=0;r<n.length;r++)if(wa(n[r],t))return!0;return!1}function wa(n,t){let r=!1;for(let s=0,l=n.length-1;s<n.length;l=s++){const d=n[s],p=n[l];d.y>t.y!=p.y>t.y&&t.x<(p.x-d.x)*(t.y-d.y)/(p.y-d.y)+d.x&&(r=!r)}return r}function Lf(n,t,r){const s=r[0],l=r[2];if(n.x<s.x&&t.x<s.x||n.x>l.x&&t.x>l.x||n.y<s.y&&t.y<s.y||n.y>l.y&&t.y>l.y)return!1;const d=Gt(n,t,r[0]);return d!==Gt(n,t,r[1])||d!==Gt(n,t,r[2])||d!==Gt(n,t,r[3])}function gl(n,t,r){const s=t.paint.get(n).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Ec(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Ac(n,t,r,s,l){if(!t[0]&&!t[1])return n;const d=Re.convert(t)._mult(l);r==="viewport"&&d._rotate(-s);const p=[];for(let m=0;m<n.length;m++)p.push(n[m].sub(d));return p}let Qu,ed;Je("CircleBucket",Eh,{omit:["layers"]});var Rf={get paint(){return ed=ed||new Ei({"circle-radius":new ht(U.paint_circle["circle-radius"]),"circle-color":new ht(U.paint_circle["circle-color"]),"circle-blur":new ht(U.paint_circle["circle-blur"]),"circle-opacity":new ht(U.paint_circle["circle-opacity"]),"circle-translate":new nt(U.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(U.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(U.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(U.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ht(U.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ht(U.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ht(U.paint_circle["circle-stroke-opacity"])})},get layout(){return Qu=Qu||new Ei({"circle-sort-key":new ht(U.layout_circle["circle-sort-key"])})}};class Df extends Vr{constructor(t){super(t,Rf)}createBucket(t){return new Eh(t)}queryRadius(t){const r=t;return gl("circle-radius",this,r)+gl("circle-stroke-width",this,r)+Ec(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:l,transform:d,pixelsToTileUnits:p,unwrappedTileID:m,getElevation:_}){const v=Ac(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,p),w=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),S=this.paint.get("circle-pitch-alignment")==="map",I=S?v:function(k,B,Z,X){return k.map(ae=>td(ae,B,Z,X))}(v,d,m,_),A=S?w*p:w;for(const k of l)for(const B of k){const Z=S?B:td(B,d,m,_);let X=A;const ae=d.projectTileCoordinates(B.x,B.y,m,_).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=ae/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=d.cameraToCenterDistance/ae),Af(I,Z,X))return!0}return!1}}function td(n,t,r,s){const l=t.projectTileCoordinates(n.x,n.y,r,s).point;return new Re((.5*l.x+.5)*t.width,(.5*-l.y+.5)*t.height)}class id extends Eh{}let rd;Je("HeatmapBucket",id,{omit:["layers"]});var Bf={get paint(){return rd=rd||new Ei({"heatmap-radius":new ht(U.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ht(U.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(U.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cl(U.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(U.paint_heatmap["heatmap-opacity"])})}};function zh(n,{width:t,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*s}`)}else l=new Uint8Array(t*r*s);return n.width=t,n.height=r,n.data=l,n}function nd(n,{width:t,height:r},s){if(t===n.width&&r===n.height)return;const l=zh({},{width:t,height:r},s);Lh(n,l,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},s),n.width=t,n.height=r,n.data=l.data}function Lh(n,t,r,s,l,d){if(l.width===0||l.height===0)return t;if(l.width>n.width||l.height>n.height||r.x>n.width-l.width||r.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||s.x>t.width-l.width||s.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,m=t.data;if(p===m)throw new Error("srcData equals dstData, so image is already copied");for(let _=0;_<l.height;_++){const v=((r.y+_)*n.width+r.x)*d,w=((s.y+_)*t.width+s.x)*d;for(let S=0;S<l.width*d;S++)m[w+S]=p[v+S]}return t}class _l{constructor(t,r){zh(this,t,1,r)}resize(t){nd(this,t,1)}clone(){return new _l({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){Lh(t,r,s,l,d,1)}}class Qr{constructor(t,r){zh(this,t,4,r)}resize(t){nd(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){Lh(t,r,s,l,d,4)}}function sd(n){const t={},r=n.resolution||256,s=n.clips?n.clips.length:1,l=n.image||new Qr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(p,m,_)=>{t[n.evaluationKey]=_;const v=n.expression.evaluate(t);l.data[p+m+0]=Math.floor(255*v.r/v.a),l.data[p+m+1]=Math.floor(255*v.g/v.a),l.data[p+m+2]=Math.floor(255*v.b/v.a),l.data[p+m+3]=Math.floor(255*v.a)};if(n.clips)for(let p=0,m=0;p<s;++p,m+=4*r)for(let _=0,v=0;_<r;_++,v+=4){const w=_/(r-1),{start:S,end:I}=n.clips[p];d(m,v,S*(1-w)+I*w)}else for(let p=0,m=0;p<r;p++,m+=4)d(0,m,p/(r-1));return l}Je("AlphaImage",_l),Je("RGBAImage",Qr);const Rh="big-fb";class Ff extends Vr{createBucket(t){return new id(t)}constructor(t){super(t,Bf),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Rh)&&this.heatmapFbos.delete(Rh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ad;var Of={get paint(){return ad=ad||new Ei({"hillshade-illumination-direction":new nt(U.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new nt(U.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new nt(U.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(U.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(U.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(U.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(U.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new nt(U.paint_hillshade["hillshade-method"])})}};class jf extends Vr{constructor(t){super(t,Of),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,s=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values;const d=Math.max(t.length,r.length,s.length,l.length);t=t.concat(Array(d-t.length).fill(t.at(-1))),r=r.concat(Array(d-r.length).fill(r.at(-1))),s=s.concat(Array(d-s.length).fill(s.at(-1))),l=l.concat(Array(d-l.length).fill(l.at(-1)));const p=r.map(_n);return{directionRadians:t.map(_n),altitudeRadians:p,shadowColor:l,highlightColor:s}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Nf=li([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vf}=Nf;function Dh(n,t,r){const s=r.patternDependencies;let l=!1;for(const d of t){const p=d.paint.get(`${n}-pattern`);p.isConstant()||(l=!0);const m=p.constantOr(null);m&&(l=!0,s[m.to]=!0,s[m.from]=!0)}return l}function Bh(n,t,r,s,l){const d=l.patternDependencies;for(const p of t){const m=p.paint.get(`${n}-pattern`).value;if(m.kind!=="constant"){let _=m.evaluate({zoom:s-1},r,{},l.availableImages),v=m.evaluate({zoom:s},r,{},l.availableImages),w=m.evaluate({zoom:s+1},r,{},l.availableImages);_=_&&_.name?_.name:_,v=v&&v.name?v.name:v,w=w&&w.name?w.name:w,d[_]=!0,d[v]=!0,d[w]=!0,r.patterns[p.id]={min:_,mid:v,max:w}}}return r}function od(n,t,r,s,l){let d;if(l===function(p,m,_,v){let w=0;for(let S=m,I=_-v;S<_;S+=v)w+=(p[I]-p[S])*(p[S+1]+p[I+1]),I=S;return w}(n,t,r,s)>0)for(let p=t;p<r;p+=s)d=ud(p/s|0,n[p],n[p+1],d);else for(let p=r-s;p>=t;p-=s)d=ud(p/s|0,n[p],n[p+1],d);return d&&go(d,d.next)&&(xl(d),d=d.next),d}function Ta(n,t){if(!n)return n;t||(t=n);let r,s=n;do if(r=!1,s.steiner||!go(s,s.next)&&Ci(s.prev,s,s.next)!==0)s=s.next;else{if(xl(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function yl(n,t,r,s,l,d,p){if(!n)return;!p&&d&&function(_,v,w,S){let I=_;do I.z===0&&(I.z=Fh(I.x,I.y,v,w,S)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==_);I.prevZ.nextZ=null,I.prevZ=null,function(A){let k,B=1;do{let Z,X=A;A=null;let ae=null;for(k=0;X;){k++;let Q=X,E=0;for(let ee=0;ee<B&&(E++,Q=Q.nextZ,Q);ee++);let V=B;for(;E>0||V>0&&Q;)E!==0&&(V===0||!Q||X.z<=Q.z)?(Z=X,X=X.nextZ,E--):(Z=Q,Q=Q.nextZ,V--),ae?ae.nextZ=Z:A=Z,Z.prevZ=ae,ae=Z;X=Q}ae.nextZ=null,B*=2}while(k>1)}(I)}(n,s,l,d);let m=n;for(;n.prev!==n.next;){const _=n.prev,v=n.next;if(d?Uf(n,s,l,d):Zf(n))t.push(_.i,n.i,v.i),xl(n),n=v.next,m=v.next;else if((n=v)===m){p?p===1?yl(n=Gf(Ta(n),t),t,r,s,l,d,2):p===2&&$f(n,t,r,s,l,d):yl(Ta(n),t,r,s,l,d,1);break}}}function Zf(n){const t=n.prev,r=n,s=n.next;if(Ci(t,r,s)>=0)return!1;const l=t.x,d=r.x,p=s.x,m=t.y,_=r.y,v=s.y,w=Math.min(l,d,p),S=Math.min(m,_,v),I=Math.max(l,d,p),A=Math.max(m,_,v);let k=s.next;for(;k!==t;){if(k.x>=w&&k.x<=I&&k.y>=S&&k.y<=A&&vl(l,m,d,_,p,v,k.x,k.y)&&Ci(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function Uf(n,t,r,s){const l=n.prev,d=n,p=n.next;if(Ci(l,d,p)>=0)return!1;const m=l.x,_=d.x,v=p.x,w=l.y,S=d.y,I=p.y,A=Math.min(m,_,v),k=Math.min(w,S,I),B=Math.max(m,_,v),Z=Math.max(w,S,I),X=Fh(A,k,t,r,s),ae=Fh(B,Z,t,r,s);let Q=n.prevZ,E=n.nextZ;for(;Q&&Q.z>=X&&E&&E.z<=ae;){if(Q.x>=A&&Q.x<=B&&Q.y>=k&&Q.y<=Z&&Q!==l&&Q!==p&&vl(m,w,_,S,v,I,Q.x,Q.y)&&Ci(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,E.x>=A&&E.x<=B&&E.y>=k&&E.y<=Z&&E!==l&&E!==p&&vl(m,w,_,S,v,I,E.x,E.y)&&Ci(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;Q&&Q.z>=X;){if(Q.x>=A&&Q.x<=B&&Q.y>=k&&Q.y<=Z&&Q!==l&&Q!==p&&vl(m,w,_,S,v,I,Q.x,Q.y)&&Ci(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;E&&E.z<=ae;){if(E.x>=A&&E.x<=B&&E.y>=k&&E.y<=Z&&E!==l&&E!==p&&vl(m,w,_,S,v,I,E.x,E.y)&&Ci(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function Gf(n,t){let r=n;do{const s=r.prev,l=r.next.next;!go(s,l)&&cd(s,r,r.next,l)&&bl(s,l)&&bl(l,s)&&(t.push(s.i,r.i,l.i),xl(r),xl(r.next),r=n=l),r=r.next}while(r!==n);return Ta(r)}function $f(n,t,r,s,l,d){let p=n;do{let m=p.next.next;for(;m!==p.prev;){if(p.i!==m.i&&Xf(p,m)){let _=hd(p,m);return p=Ta(p,p.next),_=Ta(_,_.next),yl(p,t,r,s,l,d,0),void yl(_,t,r,s,l,d,0)}m=m.next}p=p.next}while(p!==n)}function qf(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Hf(n,t){const r=function(l,d){let p=d;const m=l.x,_=l.y;let v,w=-1/0;if(go(l,p))return p;do{if(go(l,p.next))return p.next;if(_<=p.y&&_>=p.next.y&&p.next.y!==p.y){const B=p.x+(_-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(B<=m&&B>w&&(w=B,v=p.x<p.next.x?p:p.next,B===m))return v}p=p.next}while(p!==d);if(!v)return null;const S=v,I=v.x,A=v.y;let k=1/0;p=v;do{if(m>=p.x&&p.x>=I&&m!==p.x&&ld(_<A?m:w,_,I,A,_<A?w:m,_,p.x,p.y)){const B=Math.abs(_-p.y)/(m-p.x);bl(p,l)&&(B<k||B===k&&(p.x>v.x||p.x===v.x&&Wf(v,p)))&&(v=p,k=B)}p=p.next}while(p!==S);return v}(n,t);if(!r)return t;const s=hd(r,n);return Ta(s,s.next),Ta(r,r.next)}function Wf(n,t){return Ci(n.prev,n,t.prev)<0&&Ci(t.next,n,n.next)<0}function Fh(n,t,r,s,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Kf(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function ld(n,t,r,s,l,d,p,m){return(l-p)*(t-m)>=(n-p)*(d-m)&&(n-p)*(s-m)>=(r-p)*(t-m)&&(r-p)*(d-m)>=(l-p)*(s-m)}function vl(n,t,r,s,l,d,p,m){return!(n===p&&t===m)&&ld(n,t,r,s,l,d,p,m)}function Xf(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,s){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&cd(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(n,t)&&(bl(n,t)&&bl(t,n)&&function(r,s){let l=r,d=!1;const p=(r.x+s.x)/2,m=(r.y+s.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&p<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==r);return d}(n,t)&&(Ci(n.prev,n,t.prev)||Ci(n,t.prev,t))||go(n,t)&&Ci(n.prev,n,n.next)>0&&Ci(t.prev,t,t.next)>0)}function Ci(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function go(n,t){return n.x===t.x&&n.y===t.y}function cd(n,t,r,s){const l=zc(Ci(n,t,r)),d=zc(Ci(n,t,s)),p=zc(Ci(r,s,n)),m=zc(Ci(r,s,t));return l!==d&&p!==m||!(l!==0||!kc(n,r,t))||!(d!==0||!kc(n,s,t))||!(p!==0||!kc(r,n,s))||!(m!==0||!kc(r,t,s))}function kc(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function zc(n){return n>0?1:n<0?-1:0}function bl(n,t){return Ci(n.prev,n,n.next)<0?Ci(n,t,n.next)>=0&&Ci(n,n.prev,t)>=0:Ci(n,t,n.prev)<0||Ci(n,n.next,t)<0}function hd(n,t){const r=Oh(n.i,n.x,n.y),s=Oh(t.i,t.x,t.y),l=n.next,d=t.prev;return n.next=t,t.prev=n,r.next=l,l.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function ud(n,t,r,s){const l=Oh(n,t,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function xl(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Oh(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _o{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Lc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Lc.noSubdivision=new Lc({fill:new _o(0,0),line:new _o(0,0),tile:new _o(0,0),stencil:new _o(0,0),circle:1}),Je("SubdivisionGranularityExpression",_o),Je("SubdivisionGranularitySetting",Lc);const yo=-32768,wl=32767;class Yf{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=yt/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|(r+=32768)<<0}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const s=0|Math.round(t),l=0|Math.round(r),d=this._getKey(s,l);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,p),this._vertexBuffer.push(s,l),p}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(l,d){const p=[];for(let m=0;m<d.length;m+=3){const _=d[m],v=d[m+1],w=d[m+2],S=l[2*_],I=l[2*_+1];(l[2*v]-S)*(l[2*w+1]-I)-(l[2*v+1]-I)*(l[2*w]-S)>0?(p.push(_),p.push(w),p.push(v)):(p.push(_),p.push(v),p.push(w))}return p}(this._vertexBuffer,t);const r=[],s=t.length;for(let l=0;l<s;l+=3){const d=[t[l+0],t[l+1],t[l+2]],p=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]];let m=1/0,_=1/0,v=-1/0,w=-1/0;for(let B=0;B<3;B++){const Z=p[2*B],X=p[2*B+1];m=Math.min(m,Z),v=Math.max(v,Z),_=Math.min(_,X),w=Math.max(w,X)}if(m===v||_===w)continue;const S=Math.floor(m/this._granularityCellSize),I=Math.ceil(v/this._granularityCellSize),A=Math.floor(_/this._granularityCellSize),k=Math.ceil(w/this._granularityCellSize);if(S!==I||A!==k)for(let B=A;B<k;B++){const Z=this._scanlineGenerateVertexRingForCellRow(B,p,d);Jf(this._vertexBuffer,Z,r)}else r.push(...d)}return r}_scanlineGenerateVertexRingForCellRow(t,r,s){const l=t*this._granularityCellSize,d=l+this._granularityCellSize,p=[];for(let m=0;m<3;m++){const _=r[2*m],v=r[2*m+1],w=r[2*(m+1)%6],S=r[(2*(m+1)+1)%6],I=r[2*(m+2)%6],A=r[(2*(m+2)+1)%6],k=w-_,B=S-v,Z=k===0,X=B===0,ae=(l-v)/B,Q=(d-v)/B,E=Math.min(ae,Q),V=Math.max(ae,Q);if(!X&&(E>=1||V<=0)||X&&(v<l||v>d)){S>=l&&S<=d&&p.push(s[(m+1)%3]);continue}!X&&E>0&&p.push(this._vertexToIndex(_+k*E,v+B*E));const ee=_+k*Math.max(E,0),ve=_+k*Math.min(V,1);Z||this._generateIntraEdgeVertices(p,_,v,w,S,ee,ve),!X&&V<1&&p.push(this._vertexToIndex(_+k*V,v+B*V)),(X||S>=l&&S<=d)&&p.push(s[(m+1)%3]),!X&&(S<=l||S>=d)&&this._generateInterEdgeVertices(p,_,v,w,S,I,A,ve,l,d)}return p}_generateIntraEdgeVertices(t,r,s,l,d,p,m){const _=l-r,v=d-s,w=v===0,S=w?Math.min(r,l):Math.min(p,m),I=w?Math.max(r,l):Math.max(p,m),A=Math.floor(S/this._granularityCellSize)+1,k=Math.ceil(I/this._granularityCellSize)-1;if(w?r<l:p<m)for(let B=A;B<=k;B++){const Z=B*this._granularityCellSize;t.push(this._vertexToIndex(Z,s+v*(Z-r)/_))}else for(let B=k;B>=A;B--){const Z=B*this._granularityCellSize;t.push(this._vertexToIndex(Z,s+v*(Z-r)/_))}}_generateInterEdgeVertices(t,r,s,l,d,p,m,_,v,w){const S=d-s,I=p-l,A=m-d,k=(v-d)/A,B=(w-d)/A,Z=Math.min(k,B),X=Math.max(k,B),ae=l+I*Z;let Q=Math.floor(Math.min(ae,_)/this._granularityCellSize)+1,E=Math.ceil(Math.max(ae,_)/this._granularityCellSize)-1,V=_<ae;const ee=A===0;if(ee&&(m===v||m===w))return;if(ee||Z>=1||X<=0){const je=s-m,we=p+(r-p)*Math.min((v-m)/je,(w-m)/je);Q=Math.floor(Math.min(we,_)/this._granularityCellSize)+1,E=Math.ceil(Math.max(we,_)/this._granularityCellSize)-1,V=_<we}const ve=S>0?w:v;if(V)for(let je=Q;je<=E;je++)t.push(this._vertexToIndex(je*this._granularityCellSize,ve));else for(let je=E;je>=Q;je--)t.push(this._vertexToIndex(je*this._granularityCellSize,ve))}_generateOutline(t){const r=[];for(const s of t){const l=Sa(s,this._granularity,!0),d=this._pointArrayToIndices(l),p=[];for(let m=1;m<d.length;m++)p.push(d[m-1]),p.push(d[m]);r.push(p)}return r}_handlePoles(t){let r=!1,s=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(s=!0)),(r||s)&&this._fillPoles(t,r,s)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const s=t[r+1];s===yo&&(t[r+1]=-32767),s===wl&&(t[r+1]=32766)}}_generatePoleQuad(t,r,s,l,d,p){l>d!=(p===yo)?(t.push(r),t.push(s),t.push(this._vertexToIndex(l,p)),t.push(s),t.push(this._vertexToIndex(d,p)),t.push(this._vertexToIndex(l,p))):(t.push(s),t.push(r),t.push(this._vertexToIndex(l,p)),t.push(this._vertexToIndex(d,p)),t.push(s),t.push(this._vertexToIndex(l,p)))}_fillPoles(t,r,s){const l=this._vertexBuffer,d=yt,p=t.length;for(let m=2;m<p;m+=3){const _=t[m-2],v=t[m-1],w=t[m],S=l[2*_],I=l[2*_+1],A=l[2*v],k=l[2*v+1],B=l[2*w],Z=l[2*w+1];r&&(I===0&&k===0&&this._generatePoleQuad(t,_,v,S,A,yo),k===0&&Z===0&&this._generatePoleQuad(t,v,w,A,B,yo),Z===0&&I===0&&this._generatePoleQuad(t,w,_,B,S,yo)),s&&(I===d&&k===d&&this._generatePoleQuad(t,_,v,S,A,wl),k===d&&Z===d&&this._generatePoleQuad(t,v,w,A,B,wl),Z===d&&I===d&&this._generatePoleQuad(t,w,_,B,S,wl))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:s,holeIndices:l}=function(m){const _=[],v=[];for(const w of m)if(w.length!==0){w!==m[0]&&_.push(v.length/2);for(let S=0;S<w.length;S++)v.push(w[S].x),v.push(w[S].y)}return{flattened:v,holeIndices:_}}(t);let d;this._initializeVertices(s);try{const m=function(v,w,S=2){const I=w&&w.length,A=I?w[0]*S:v.length;let k=od(v,0,A,S,!0);const B=[];if(!k||k.next===k.prev)return B;let Z,X,ae;if(I&&(k=function(Q,E,V,ee){const ve=[];for(let je=0,we=E.length;je<we;je++){const Ie=od(Q,E[je]*ee,je<we-1?E[je+1]*ee:Q.length,ee,!1);Ie===Ie.next&&(Ie.steiner=!0),ve.push(Kf(Ie))}ve.sort(qf);for(let je=0;je<ve.length;je++)V=Hf(ve[je],V);return V}(v,w,k,S)),v.length>80*S){Z=1/0,X=1/0;let Q=-1/0,E=-1/0;for(let V=S;V<A;V+=S){const ee=v[V],ve=v[V+1];ee<Z&&(Z=ee),ve<X&&(X=ve),ee>Q&&(Q=ee),ve>E&&(E=ve)}ae=Math.max(Q-Z,E-X),ae=ae!==0?32767/ae:0}return yl(k,B,S,Z,X,ae,0),B}(s,l),_=this._convertIndices(s,m);d=this._subdivideTrianglesScanline(_)}catch(m){console.error(m)}let p=[];return r&&(p=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:p}}_convertIndices(t,r){const s=[];for(let l=0;l<r.length;l++)s.push(this._vertexToIndex(t[2*r[l]],t[2*r[l]+1]));return s}_pointArrayToIndices(t){const r=[];for(let s=0;s<t.length;s++){const l=t[s];r.push(this._vertexToIndex(l.x,l.y))}return r}}function dd(n,t,r,s=!0){return new Yf(r,t).subdividePolygonInternal(n,s)}function Sa(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const s=n[0],l=n[n.length-1],d=r&&(s.x!==l.x||s.y!==l.y);if(t<2)return d?[...n,n[0]]:[...n];const p=Math.floor(yt/t),m=[];m.push(new Re(n[0].x,n[0].y));const _=n.length,v=d?_:_-1;for(let w=0;w<v;w++){const S=n[w],I=w<_-1?n[w+1]:n[0],A=S.x,k=S.y,B=I.x,Z=I.y,X=A!==B,ae=k!==Z;if(!X&&!ae)continue;const Q=B-A,E=Z-k,V=Math.abs(Q),ee=Math.abs(E);let ve=A,je=k;for(;;){const Ie=Q>0?(Math.floor(ve/p)+1)*p:(Math.ceil(ve/p)-1)*p,Ge=E>0?(Math.floor(je/p)+1)*p:(Math.ceil(je/p)-1)*p,Ne=Math.abs(ve-Ie),$e=Math.abs(je-Ge),ze=Math.abs(ve-B),Qe=Math.abs(je-Z),ct=X?Ne/V:Number.POSITIVE_INFINITY,ot=ae?$e/ee:Number.POSITIVE_INFINITY;if((ze<=Ne||!X)&&(Qe<=$e||!ae))break;if(ct<ot&&X||!ae){ve=Ie,je+=E*ct;const it=new Re(ve,Math.round(je));m[m.length-1].x===it.x&&m[m.length-1].y===it.y||m.push(it)}else{ve+=Q*ot,je=Ge;const it=new Re(Math.round(ve),je);m[m.length-1].x===it.x&&m[m.length-1].y===it.y||m.push(it)}}const we=new Re(B,Z);m[m.length-1].x===we.x&&m[m.length-1].y===we.y||m.push(we)}return m}function Jf(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let s=0,l=n[2*t[0]];for(let _=1;_<t.length;_++){const v=n[2*t[_]];v<l&&(l=v,s=_)}const d=t.length;let p=s,m=(p+1)%d;for(;;){const _=p-1>=0?p-1:d-1,v=(m+1)%d,w=n[2*t[_]],S=n[2*t[v]],I=n[2*t[p]],A=n[2*t[p]+1],k=n[2*t[m]+1];let B=!1;if(w<S)B=!0;else if(w>S)B=!1;else{const Z=k-A,X=-(n[2*t[m]]-I),ae=A<k?1:-1;((w-I)*Z+(n[2*t[_]+1]-A)*X)*ae>((S-I)*Z+(n[2*t[v]+1]-A)*X)*ae&&(B=!0)}if(B){const Z=t[_],X=t[p],ae=t[m];Z!==X&&Z!==ae&&X!==ae&&r.push(ae,X,Z),p--,p<0&&(p=d-1)}else{const Z=t[v],X=t[p],ae=t[m];Z!==X&&Z!==ae&&X!==ae&&r.push(ae,X,Z),m++,m>=d&&(m=0)}if(_===v)break}}function pd(n,t,r,s,l,d,p,m,_){const v=l.length/2,w=p&&m&&_;if(v<Ut.MAX_VERTEX_ARRAY_LENGTH){const S=t.prepareSegment(v,r,s),I=S.vertexLength;for(let B=0;B<d.length;B+=3)s.emplaceBack(I+d[B],I+d[B+1],I+d[B+2]);let A,k;S.vertexLength+=v,S.primitiveLength+=d.length/3,w&&(k=p.prepareSegment(v,r,m),A=k.vertexLength,k.vertexLength+=v);for(let B=0;B<l.length;B+=2)n(l[B],l[B+1]);if(w)for(let B=0;B<_.length;B++){const Z=_[B];for(let X=1;X<Z.length;X+=2)m.emplaceBack(A+Z[X-1],A+Z[X]);k.primitiveLength+=Z.length/2}}else(function(S,I,A,k,B,Z){const X=[];for(let ee=0;ee<k.length/2;ee++)X.push(-1);const ae={count:0};let Q=0,E=S.getOrCreateLatestSegment(I,A),V=E.vertexLength;for(let ee=2;ee<B.length;ee+=3){const ve=B[ee-2],je=B[ee-1],we=B[ee];let Ie=X[ve]<Q,Ge=X[je]<Q,Ne=X[we]<Q;E.vertexLength+((Ie?1:0)+(Ge?1:0)+(Ne?1:0))>Ut.MAX_VERTEX_ARRAY_LENGTH&&(E=S.createNewSegment(I,A),Q=ae.count,Ie=!0,Ge=!0,Ne=!0,V=0);const $e=Tl(X,k,Z,ae,ve,Ie,E),ze=Tl(X,k,Z,ae,je,Ge,E),Qe=Tl(X,k,Z,ae,we,Ne,E);A.emplaceBack(V+$e-Q,V+ze-Q,V+Qe-Q),E.primitiveLength++}})(t,r,s,l,d,n),w&&function(S,I,A,k,B,Z){const X=[];for(let ee=0;ee<k.length/2;ee++)X.push(-1);const ae={count:0};let Q=0,E=S.getOrCreateLatestSegment(I,A),V=E.vertexLength;for(let ee=0;ee<B.length;ee++){const ve=B[ee];for(let je=1;je<B[ee].length;je+=2){const we=ve[je-1],Ie=ve[je];let Ge=X[we]<Q,Ne=X[Ie]<Q;E.vertexLength+((Ge?1:0)+(Ne?1:0))>Ut.MAX_VERTEX_ARRAY_LENGTH&&(E=S.createNewSegment(I,A),Q=ae.count,Ge=!0,Ne=!0,V=0);const $e=Tl(X,k,Z,ae,we,Ge,E),ze=Tl(X,k,Z,ae,Ie,Ne,E);A.emplaceBack(V+$e-Q,V+ze-Q),E.primitiveLength++}}}(p,r,m,l,_,n),t.forceNewSegmentOnNextPrepare(),p==null||p.forceNewSegmentOnNextPrepare()}function Tl(n,t,r,s,l,d,p){if(d){const m=s.count;return r(t[2*l],t[2*l+1]),n[l]=s.count,s.count++,p.vertexLength++,m}return n[l]}class jh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new We,this.indexArray=new Zt,this.indexArray2=new Fi,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new Ut,this.segments2=new Ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Dh("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),p=[];for(const{feature:m,id:_,index:v,sourceLayerIndex:w}of t){const S=this.layers[0]._featureFilter.needGeometry,I=xa(m,S);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),I,s))continue;const A=d?l.evaluate(I,{},s,r.availableImages):void 0,k={id:_,properties:m.properties,type:m.type,sourceLayerIndex:w,index:v,geometry:S?I.geometry:ba(m),patterns:{},sortKey:A};p.push(k)}d&&p.sort((m,_)=>m.sortKey-_.sortKey);for(const m of p){const{geometry:_,index:v,sourceLayerIndex:w}=m;if(this.hasPattern){const S=Bh("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(m,_,v,s,{},r.subdivisionGranularity);r.featureIndex.insert(t[v].feature,_,v,w,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,l,d,p){for(const m of ja(r,500)){const _=dd(m,l,p.fill.getGranularityForZoomLevel(l.z)),v=this.layoutVertexArray;pd((w,S)=>{v.emplaceBack(w,S)},this.segments,this.layoutVertexArray,this.indexArray,_.verticesFlattened,_.indicesTriangles,this.segments2,this.indexArray2,_.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}}let fd,md;Je("FillBucket",jh,{omit:["layers","patternFeatures"]});var Qf={get paint(){return md=md||new Ei({"fill-antialias":new nt(U.paint_fill["fill-antialias"]),"fill-opacity":new ht(U.paint_fill["fill-opacity"]),"fill-color":new ht(U.paint_fill["fill-color"]),"fill-outline-color":new ht(U.paint_fill["fill-outline-color"]),"fill-translate":new nt(U.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(U.paint_fill["fill-translate-anchor"]),"fill-pattern":new ma(U.paint_fill["fill-pattern"])})},get layout(){return fd=fd||new Ei({"fill-sort-key":new ht(U.layout_fill["fill-sort-key"])})}};class em extends Vr{constructor(t){super(t,Qf)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new jh(t)}queryRadius(){return Ec(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:s,pixelsToTileUnits:l}){return Xu(Ac(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-s.bearingInRadians,l),r)}isTileClipped(){return!0}}const tm=li([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),im=li([{name:"a_centroid",components:2,type:"Int16"}],4),{members:rm}=tm;var Nh,gd,Vh,_d,Zh,yd,vd,Rc={};function bd(){if(gd)return Nh;gd=1;var n=He();function t(l,d,p,m,_){this.properties={},this.extent=p,this.type=0,this._pbf=l,this._geometry=-1,this._keys=m,this._values=_,l.readFields(r,this,d)}function r(l,d,p){l==1?d.id=p.readVarint():l==2?function(m,_){for(var v=m.readVarint()+m.pos;m.pos<v;){var w=_._keys[m.readVarint()],S=_._values[m.readVarint()];_.properties[w]=S}}(p,d):l==3?d.type=p.readVarint():l==4&&(d._geometry=p.pos)}function s(l){for(var d,p,m=0,_=0,v=l.length,w=v-1;_<v;w=_++)m+=((p=l[w]).x-(d=l[_]).x)*(d.y+p.y);return m}return Nh=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var d,p=l.readVarint()+l.pos,m=1,_=0,v=0,w=0,S=[];l.pos<p;){if(_<=0){var I=l.readVarint();m=7&I,_=I>>3}if(_--,m===1||m===2)v+=l.readSVarint(),w+=l.readSVarint(),m===1&&(d&&S.push(d),d=[]),d.push(new n(v,w));else{if(m!==7)throw new Error("unknown command "+m);d&&d.push(d[0].clone())}}return d&&S.push(d),S},t.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var d=l.readVarint()+l.pos,p=1,m=0,_=0,v=0,w=1/0,S=-1/0,I=1/0,A=-1/0;l.pos<d;){if(m<=0){var k=l.readVarint();p=7&k,m=k>>3}if(m--,p===1||p===2)(_+=l.readSVarint())<w&&(w=_),_>S&&(S=_),(v+=l.readSVarint())<I&&(I=v),v>A&&(A=v);else if(p!==7)throw new Error("unknown command "+p)}return[w,I,S,A]},t.prototype.toGeoJSON=function(l,d,p){var m,_,v=this.extent*Math.pow(2,p),w=this.extent*l,S=this.extent*d,I=this.loadGeometry(),A=t.types[this.type];function k(X){for(var ae=0;ae<X.length;ae++){var Q=X[ae];X[ae]=[360*(Q.x+w)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+S)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(m=0;m<I.length;m++)B[m]=I[m][0];k(I=B);break;case 2:for(m=0;m<I.length;m++)k(I[m]);break;case 3:for(I=function(X){var ae=X.length;if(ae<=1)return[X];for(var Q,E,V=[],ee=0;ee<ae;ee++){var ve=s(X[ee]);ve!==0&&(E===void 0&&(E=ve<0),E===ve<0?(Q&&V.push(Q),Q=[X[ee]]):Q.push(X[ee]))}return Q&&V.push(Q),V}(I),m=0;m<I.length;m++)for(_=0;_<I[m].length;_++)k(I[m][_])}I.length===1?I=I[0]:A="Multi"+A;var Z={type:"Feature",geometry:{type:A,coordinates:I},properties:this.properties};return"id"in this&&(Z.id=this.id),Z},Nh}function xd(){if(_d)return Vh;_d=1;var n=bd();function t(s,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(r,this,l),this.length=this._features.length}function r(s,l,d){s===15?l.version=d.readVarint():s===1?l.name=d.readString():s===5?l.extent=d.readVarint():s===2?l._features.push(d.pos):s===3?l._keys.push(d.readString()):s===4&&l._values.push(function(p){for(var m=null,_=p.readVarint()+p.pos;p.pos<_;){var v=p.readVarint()>>3;m=v===1?p.readString():v===2?p.readFloat():v===3?p.readDouble():v===4?p.readVarint64():v===5?p.readVarint():v===6?p.readSVarint():v===7?p.readBoolean():null}return m}(d))}return Vh=t,t.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var l=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,l,this.extent,this._keys,this._values)},Vh}function wd(){return vd||(vd=1,Rc.VectorTile=function(){if(yd)return Zh;yd=1;var n=xd();function t(r,s,l){if(r===3){var d=new n(l,l.readVarint()+l.pos);d.length&&(s[d.name]=d)}}return Zh=function(r,s){this.layers=r.readFields(t,{},s)},Zh}(),Rc.VectorTileFeature=bd(),Rc.VectorTileLayer=xd()),Rc}var Sl=me(wd());const nm=Sl.VectorTileFeature.types,Uh=Math.pow(2,13);function Cl(n,t,r,s,l,d,p,m){n.emplaceBack(t,r,2*Math.floor(s*Uh)+p,l*Uh*2,d*Uh*2,Math.round(m))}class Gh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ve,this.centroidVertexArray=new Pe,this.indexArray=new Zt,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new Ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=Dh("fill-extrusion",this.layers,r);for(const{feature:l,id:d,index:p,sourceLayerIndex:m}of t){const _=this.layers[0]._featureFilter.needGeometry,v=xa(l,_);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),v,s))continue;const w={id:d,sourceLayerIndex:m,index:p,geometry:_?v.geometry:ba(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Bh("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,p,s,{},r.subdivisionGranularity),r.featureIndex.insert(l,w.geometry,p,m,this.index,!0)}}addFeatures(t,r,s){for(const l of this.features){const{geometry:d}=l;this.addFeature(l,d,l.index,r,s,t.subdivisionGranularity)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rm),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,im.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,l,d,p){for(const m of ja(r,500)){const _={x:0,y:0,sampleCount:0},v=this.layoutVertexArray.length;this.processPolygon(_,l,t,m,p);const w=this.layoutVertexArray.length-v,S=Math.floor(_.x/_.sampleCount),I=Math.floor(_.y/_.sampleCount);for(let A=0;A<w;A++)this.centroidVertexArray.emplaceBack(S,I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}processPolygon(t,r,s,l,d){if(l.length<1||Td(l[0]))return;for(const S of l)S.length!==0&&sm(t,S);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},m=d.fill.getGranularityForZoomLevel(r.z),_=nm[s.type]==="Polygon";for(const S of l){if(S.length===0||Td(S))continue;const I=Sa(S,m,_);this._generateSideFaces(I,p)}if(!_)return;const v=dd(l,r,m,!1),w=this.layoutVertexArray;pd((S,I)=>{Cl(w,S,I,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,v.verticesFlattened,v.indicesTriangles)}_generateSideFaces(t,r){let s=0;for(let l=1;l<t.length;l++){const d=t[l],p=t[l-1];if(am(d,p))continue;r.segment.vertexLength+4>Ut.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const m=d.sub(p)._perp()._unit(),_=p.dist(d);s+_>32768&&(s=0),Cl(this.layoutVertexArray,d.x,d.y,m.x,m.y,0,0,s),Cl(this.layoutVertexArray,d.x,d.y,m.x,m.y,0,1,s),s+=_,Cl(this.layoutVertexArray,p.x,p.y,m.x,m.y,0,0,s),Cl(this.layoutVertexArray,p.x,p.y,m.x,m.y,0,1,s);const v=r.segment.vertexLength;this.indexArray.emplaceBack(v,v+2,v+1),this.indexArray.emplaceBack(v+1,v+2,v+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function sm(n,t){for(let r=0;r<t.length;r++){const s=t[r];r===t.length-1&&t[0].x===s.x&&t[0].y===s.y||(n.x+=s.x,n.y+=s.y,n.sampleCount++)}}function am(n,t){return n.x===t.x&&(n.x<0||n.x>yt)||n.y===t.y&&(n.y<0||n.y>yt)}function Td(n){return n.every(t=>t.x<0)||n.every(t=>t.x>yt)||n.every(t=>t.y<0)||n.every(t=>t.y>yt)}let Sd;Je("FillExtrusionBucket",Gh,{omit:["layers","features"]});var om={get paint(){return Sd=Sd||new Ei({"fill-extrusion-opacity":new nt(U["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ht(U["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(U["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(U["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ma(U["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ht(U["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ht(U["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(U["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class lm extends Vr{constructor(t){super(t,om)}createBucket(t){return new Gh(t)}queryRadius(){return Ec(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:l,transform:d,pixelsToTileUnits:p,pixelPosMatrix:m}){const _=Ac(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,p),v=this.paint.get("fill-extrusion-height").evaluate(r,s),w=this.paint.get("fill-extrusion-base").evaluate(r,s),S=function(A,k,B){const Z=[];for(const X of A){const ae=[X.x,X.y,0,1];St(ae,ae,k),Z.push(new Re(ae[0]/ae[3],ae[1]/ae[3]))}return Z}(_,m),I=function(A,k,B,Z){const X=[],ae=[],Q=Z[8]*k,E=Z[9]*k,V=Z[10]*k,ee=Z[11]*k,ve=Z[8]*B,je=Z[9]*B,we=Z[10]*B,Ie=Z[11]*B;for(const Ge of A){const Ne=[],$e=[];for(const ze of Ge){const Qe=ze.x,ct=ze.y,ot=Z[0]*Qe+Z[4]*ct+Z[12],it=Z[1]*Qe+Z[5]*ct+Z[13],kt=Z[2]*Qe+Z[6]*ct+Z[14],_i=Z[3]*Qe+Z[7]*ct+Z[15],ji=kt+V,dr=_i+ee,tn=ot+ve,kr=it+je,er=kt+we,di=_i+Ie,$i=new Re((ot+Q)/dr,(it+E)/dr);$i.z=ji/dr,Ne.push($i);const tr=new Re(tn/di,kr/di);tr.z=er/di,$e.push(tr)}X.push(Ne),ae.push($e)}return[X,ae]}(l,w,v,m);return function(A,k,B){let Z=1/0;Xu(B,k)&&(Z=Cd(B,k[0]));for(let X=0;X<k.length;X++){const ae=k[X],Q=A[X];for(let E=0;E<ae.length-1;E++){const V=ae[E],ee=[V,ae[E+1],Q[E+1],Q[E],V];Ku(B,ee)&&(Z=Math.min(Z,Cd(B,ee)))}}return Z!==1/0&&Z}(I[0],I[1],S)}}function Ml(n,t){return n.x*t.x+n.y*t.y}function Cd(n,t){if(n.length===1){let r=0;const s=t[r++];let l;for(;!l||s.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const d=t[r],p=n[0],m=l.sub(s),_=d.sub(s),v=p.sub(s),w=Ml(m,m),S=Ml(m,_),I=Ml(_,_),A=Ml(v,m),k=Ml(v,_),B=w*I-S*S,Z=(I*A-S*k)/B,X=(w*k-S*A)/B,ae=s.z*(1-Z-X)+l.z*Z+d.z*X;if(isFinite(ae))return ae}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const cm=li([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:hm}=cm,um=li([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:dm}=um,pm=Sl.VectorTileFeature.types,fm=Math.cos(Math.PI/180*37.5),Md=Math.pow(2,14)/.5;class $h{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new tt,this.layoutVertexArray2=new wt,this.indexArray=new Zt,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new Ut,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Dh("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),p=[];for(const{feature:m,id:_,index:v,sourceLayerIndex:w}of t){const S=this.layers[0]._featureFilter.needGeometry,I=xa(m,S);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),I,s))continue;const A=d?l.evaluate(I,{},s):void 0,k={id:_,properties:m.properties,type:m.type,sourceLayerIndex:w,index:v,geometry:S?I.geometry:ba(m),patterns:{},sortKey:A};p.push(k)}d&&p.sort((m,_)=>m.sortKey-_.sortKey);for(const m of p){const{geometry:_,index:v,sourceLayerIndex:w}=m;if(this.hasPattern){const S=Bh("line",this.layers,m,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(m,_,v,s,{},r.subdivisionGranularity);r.featureIndex.insert(t[v].feature,_,v,w,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,dm)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hm),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,l,d,p){const m=this.layers[0].layout,_=m.get("line-join").evaluate(t,{}),v=m.get("line-cap"),w=m.get("line-miter-limit"),S=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const I of r)this.addLine(I,t,_,v,w,S,l,p);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}addLine(t,r,s,l,d,p,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Sa(t,m?_.line.getGranularityForZoomLevel(m.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<t.length-1;Q++)this.totalDistance+=t[Q].dist(t[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=pm[r.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let S=0;for(;S<w-1&&t[S].equals(t[S+1]);)S++;if(w<(v?3:2))return;s==="bevel"&&(d=1.05);const I=this.overscaling<=16?15*yt/(512*this.overscaling):0,A=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let k,B,Z,X,ae;this.e1=this.e2=-1,v&&(k=t[w-2],ae=t[S].sub(k)._unit()._perp());for(let Q=S;Q<w;Q++){if(Z=Q===w-1?v?t[S+1]:void 0:t[Q+1],Z&&t[Q].equals(Z))continue;ae&&(X=ae),k&&(B=k),k=t[Q],ae=Z?Z.sub(k)._unit()._perp():X,X=X||ae;let E=X.add(ae);E.x===0&&E.y===0||E._unit();const V=X.x*ae.x+X.y*ae.y,ee=E.x*ae.x+E.y*ae.y,ve=ee!==0?1/ee:1/0,je=2*Math.sqrt(2-2*ee),we=ee<fm&&B&&Z,Ie=X.x*ae.y-X.y*ae.x>0;if(we&&Q>S){const $e=k.dist(B);if($e>2*I){const ze=k.sub(k.sub(B)._mult(I/$e)._round());this.updateDistance(B,ze),this.addCurrentVertex(ze,X,0,0,A),B=ze}}const Ge=B&&Z;let Ne=Ge?s:v?"butt":l;if(Ge&&Ne==="round"&&(ve<p?Ne="miter":ve<=2&&(Ne="fakeround")),Ne==="miter"&&ve>d&&(Ne="bevel"),Ne==="bevel"&&(ve>2&&(Ne="flipbevel"),ve<d&&(Ne="miter")),B&&this.updateDistance(B,k),Ne==="miter")E._mult(ve),this.addCurrentVertex(k,E,0,0,A);else if(Ne==="flipbevel"){if(ve>100)E=ae.mult(-1);else{const $e=ve*X.add(ae).mag()/X.sub(ae).mag();E._perp()._mult($e*(Ie?-1:1))}this.addCurrentVertex(k,E,0,0,A),this.addCurrentVertex(k,E.mult(-1),0,0,A)}else if(Ne==="bevel"||Ne==="fakeround"){const $e=-Math.sqrt(ve*ve-1),ze=Ie?$e:0,Qe=Ie?0:$e;if(B&&this.addCurrentVertex(k,X,ze,Qe,A),Ne==="fakeround"){const ct=Math.round(180*je/Math.PI/20);for(let ot=1;ot<ct;ot++){let it=ot/ct;if(it!==.5){const _i=it-.5;it+=it*_i*(it-1)*((1.0904+V*(V*(3.55645-1.43519*V)-3.2452))*_i*_i+(.848013+V*(.215638*V-1.06021)))}const kt=ae.sub(X)._mult(it)._add(X)._unit()._mult(Ie?-1:1);this.addHalfVertex(k,kt.x,kt.y,!1,Ie,0,A)}}Z&&this.addCurrentVertex(k,ae,-ze,-Qe,A)}else if(Ne==="butt")this.addCurrentVertex(k,E,0,0,A);else if(Ne==="square"){const $e=B?1:-1;this.addCurrentVertex(k,E,$e,$e,A)}else Ne==="round"&&(B&&(this.addCurrentVertex(k,X,0,0,A),this.addCurrentVertex(k,X,1,1,A,!0)),Z&&(this.addCurrentVertex(k,ae,-1,-1,A,!0),this.addCurrentVertex(k,ae,0,0,A)));if(we&&Q<w-1){const $e=k.dist(Z);if($e>2*I){const ze=k.add(Z.sub(k)._mult(I/$e)._round());this.updateDistance(k,ze),this.addCurrentVertex(ze,ae,0,0,A),k=ze}}}}addCurrentVertex(t,r,s,l,d,p=!1){const m=r.y*l-r.x,_=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,p,!1,s,d),this.addHalfVertex(t,m,_,p,!0,-l,d),this.distance>Md/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,l,d,p))}addHalfVertex({x:t,y:r},s,l,d,p,m,_){const v=.5*(this.lineClips?this.scaledDistance*(Md-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(r<<1)+(p?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&v)<<2,v>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const w=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,w,this.e2),_.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Pd,Id;Je("LineBucket",$h,{omit:["layers","patternFeatures"]});var Ed={get paint(){return Id=Id||new Ei({"line-opacity":new ht(U.paint_line["line-opacity"]),"line-color":new ht(U.paint_line["line-color"]),"line-translate":new nt(U.paint_line["line-translate"]),"line-translate-anchor":new nt(U.paint_line["line-translate-anchor"]),"line-width":new ht(U.paint_line["line-width"]),"line-gap-width":new ht(U.paint_line["line-gap-width"]),"line-offset":new ht(U.paint_line["line-offset"]),"line-blur":new ht(U.paint_line["line-blur"]),"line-dasharray":new ll(U.paint_line["line-dasharray"]),"line-pattern":new ma(U.paint_line["line-pattern"]),"line-gradient":new cl(U.paint_line["line-gradient"])})},get layout(){return Pd=Pd||new Ei({"line-cap":new nt(U.layout_line["line-cap"]),"line-join":new ht(U.layout_line["line-join"]),"line-miter-limit":new nt(U.layout_line["line-miter-limit"]),"line-round-limit":new nt(U.layout_line["line-round-limit"]),"line-sort-key":new ht(U.layout_line["line-sort-key"])})}};class mm extends ht{possiblyEvaluate(t,r){return r=new ti(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,l){return r=Bt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,l)}}let Dc;class gm extends Vr{constructor(t){super(t,Ed),this.gradientVersion=0,Dc||(Dc=new mm(Ed.paint.properties["line-width"].specification),Dc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Ji,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Dc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new $h(t)}queryRadius(t){const r=t,s=Ad(gl("line-width",this,r),gl("line-gap-width",this,r)),l=gl("line-offset",this,r);return s/2+Math.abs(l)+Ec(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:l,transform:d,pixelsToTileUnits:p}){const m=Ac(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,p),_=p/2*Ad(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),v=this.paint.get("line-offset").evaluate(r,s);return v&&(l=function(w,S){const I=[];for(let A=0;A<w.length;A++){const k=w[A],B=[];for(let Z=0;Z<k.length;Z++){const X=k[Z-1],ae=k[Z],Q=k[Z+1],E=Z===0?new Re(0,0):ae.sub(X)._unit()._perp(),V=Z===k.length-1?new Re(0,0):Q.sub(ae)._unit()._perp(),ee=E._add(V)._unit(),ve=ee.x*V.x+ee.y*V.y;ve!==0&&ee._mult(1/ve),B.push(ee._mult(S)._add(ae))}I.push(B)}return I}(l,v*p)),function(w,S,I){for(let A=0;A<S.length;A++){const k=S[A];if(w.length>=3){for(let B=0;B<k.length;B++)if(wa(w,k[B]))return!0}if(kf(w,k,I))return!0}return!1}(m,l,_)}isTileClipped(){return!0}}function Ad(n,t){return t>0?t+2*n:n}const _m=li([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ym=li([{name:"a_projected_pos",components:3,type:"Float32"}],4);li([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vm=li([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);li([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kd=li([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bm=li([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function xm(n,t,r){return n.sections.forEach(s=>{s.text=function(l,d,p){const m=d.layout.get("text-transform").evaluate(p,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Cn.applyArabicShaping&&(l=Cn.applyArabicShaping(l)),l}(s.text,t,r)}),n}li([{name:"triangle",components:3,type:"Uint16"}]),li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),li([{type:"Float32",name:"offsetX"}]),li([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),li([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Pl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var zd,qh,Ld,Oi=24,Hh={};function wm(){return zd||(zd=1,Hh.read=function(n,t,r,s,l){var d,p,m=8*l-s-1,_=(1<<m)-1,v=_>>1,w=-7,S=r?l-1:0,I=r?-1:1,A=n[t+S];for(S+=I,d=A&(1<<-w)-1,A>>=-w,w+=m;w>0;d=256*d+n[t+S],S+=I,w-=8);for(p=d&(1<<-w)-1,d>>=-w,w+=s;w>0;p=256*p+n[t+S],S+=I,w-=8);if(d===0)d=1-v;else{if(d===_)return p?NaN:1/0*(A?-1:1);p+=Math.pow(2,s),d-=v}return(A?-1:1)*p*Math.pow(2,d-s)},Hh.write=function(n,t,r,s,l,d){var p,m,_,v=8*d-l-1,w=(1<<v)-1,S=w>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=s?0:d-1,k=s?1:-1,B=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(m=isNaN(t)?1:0,p=w):(p=Math.floor(Math.log(t)/Math.LN2),t*(_=Math.pow(2,-p))<1&&(p--,_*=2),(t+=p+S>=1?I/_:I*Math.pow(2,1-S))*_>=2&&(p++,_/=2),p+S>=w?(m=0,p=w):p+S>=1?(m=(t*_-1)*Math.pow(2,l),p+=S):(m=t*Math.pow(2,S-1)*Math.pow(2,l),p=0));l>=8;n[r+A]=255&m,A+=k,m/=256,l-=8);for(p=p<<l|m,v+=l;v>0;n[r+A]=255&p,A+=k,p/=256,v-=8);n[r+A-k]|=128*B}),Hh}function Rd(){if(Ld)return qh;Ld=1,qh=t;var n=wm();function t(E){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(E)?E:new Uint8Array(E||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,s=1/r,l=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function d(E){return E.type===t.Bytes?E.readVarint()+E.pos:E.pos+1}function p(E,V,ee){return ee?4294967296*V+(E>>>0):4294967296*(V>>>0)+(E>>>0)}function m(E,V,ee){var ve=V<=16383?1:V<=2097151?2:V<=268435455?3:Math.floor(Math.log(V)/(7*Math.LN2));ee.realloc(ve);for(var je=ee.pos-1;je>=E;je--)ee.buf[je+ve]=ee.buf[je]}function _(E,V){for(var ee=0;ee<E.length;ee++)V.writeVarint(E[ee])}function v(E,V){for(var ee=0;ee<E.length;ee++)V.writeSVarint(E[ee])}function w(E,V){for(var ee=0;ee<E.length;ee++)V.writeFloat(E[ee])}function S(E,V){for(var ee=0;ee<E.length;ee++)V.writeDouble(E[ee])}function I(E,V){for(var ee=0;ee<E.length;ee++)V.writeBoolean(E[ee])}function A(E,V){for(var ee=0;ee<E.length;ee++)V.writeFixed32(E[ee])}function k(E,V){for(var ee=0;ee<E.length;ee++)V.writeSFixed32(E[ee])}function B(E,V){for(var ee=0;ee<E.length;ee++)V.writeFixed64(E[ee])}function Z(E,V){for(var ee=0;ee<E.length;ee++)V.writeSFixed64(E[ee])}function X(E,V){return(E[V]|E[V+1]<<8|E[V+2]<<16)+16777216*E[V+3]}function ae(E,V,ee){E[ee]=V,E[ee+1]=V>>>8,E[ee+2]=V>>>16,E[ee+3]=V>>>24}function Q(E,V){return(E[V]|E[V+1]<<8|E[V+2]<<16)+(E[V+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(E,V,ee){for(ee=ee||this.length;this.pos<ee;){var ve=this.readVarint(),je=ve>>3,we=this.pos;this.type=7&ve,E(je,V,this),this.pos===we&&this.skip(ve)}return V},readMessage:function(E,V){return this.readFields(E,V,this.readVarint()+this.pos)},readFixed32:function(){var E=X(this.buf,this.pos);return this.pos+=4,E},readSFixed32:function(){var E=Q(this.buf,this.pos);return this.pos+=4,E},readFixed64:function(){var E=X(this.buf,this.pos)+X(this.buf,this.pos+4)*r;return this.pos+=8,E},readSFixed64:function(){var E=X(this.buf,this.pos)+Q(this.buf,this.pos+4)*r;return this.pos+=8,E},readFloat:function(){var E=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,E},readDouble:function(){var E=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,E},readVarint:function(E){var V,ee,ve=this.buf;return V=127&(ee=ve[this.pos++]),ee<128?V:(V|=(127&(ee=ve[this.pos++]))<<7,ee<128?V:(V|=(127&(ee=ve[this.pos++]))<<14,ee<128?V:(V|=(127&(ee=ve[this.pos++]))<<21,ee<128?V:function(je,we,Ie){var Ge,Ne,$e=Ie.buf;if(Ge=(112&(Ne=$e[Ie.pos++]))>>4,Ne<128||(Ge|=(127&(Ne=$e[Ie.pos++]))<<3,Ne<128)||(Ge|=(127&(Ne=$e[Ie.pos++]))<<10,Ne<128)||(Ge|=(127&(Ne=$e[Ie.pos++]))<<17,Ne<128)||(Ge|=(127&(Ne=$e[Ie.pos++]))<<24,Ne<128)||(Ge|=(1&(Ne=$e[Ie.pos++]))<<31,Ne<128))return p(je,Ge,we);throw new Error("Expected varint not more than 10 bytes")}(V|=(15&(ee=ve[this.pos]))<<28,E,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var E=this.readVarint();return E%2==1?(E+1)/-2:E/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var E=this.readVarint()+this.pos,V=this.pos;return this.pos=E,E-V>=12&&l?function(ee,ve,je){return l.decode(ee.subarray(ve,je))}(this.buf,V,E):function(ee,ve,je){for(var we="",Ie=ve;Ie<je;){var Ge,Ne,$e,ze=ee[Ie],Qe=null,ct=ze>239?4:ze>223?3:ze>191?2:1;if(Ie+ct>je)break;ct===1?ze<128&&(Qe=ze):ct===2?(192&(Ge=ee[Ie+1]))==128&&(Qe=(31&ze)<<6|63&Ge)<=127&&(Qe=null):ct===3?(Ne=ee[Ie+2],(192&(Ge=ee[Ie+1]))==128&&(192&Ne)==128&&((Qe=(15&ze)<<12|(63&Ge)<<6|63&Ne)<=2047||Qe>=55296&&Qe<=57343)&&(Qe=null)):ct===4&&(Ne=ee[Ie+2],$e=ee[Ie+3],(192&(Ge=ee[Ie+1]))==128&&(192&Ne)==128&&(192&$e)==128&&((Qe=(15&ze)<<18|(63&Ge)<<12|(63&Ne)<<6|63&$e)<=65535||Qe>=1114112)&&(Qe=null)),Qe===null?(Qe=65533,ct=1):Qe>65535&&(Qe-=65536,we+=String.fromCharCode(Qe>>>10&1023|55296),Qe=56320|1023&Qe),we+=String.fromCharCode(Qe),Ie+=ct}return we}(this.buf,V,E)},readBytes:function(){var E=this.readVarint()+this.pos,V=this.buf.subarray(this.pos,E);return this.pos=E,V},readPackedVarint:function(E,V){if(this.type!==t.Bytes)return E.push(this.readVarint(V));var ee=d(this);for(E=E||[];this.pos<ee;)E.push(this.readVarint(V));return E},readPackedSVarint:function(E){if(this.type!==t.Bytes)return E.push(this.readSVarint());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readSVarint());return E},readPackedBoolean:function(E){if(this.type!==t.Bytes)return E.push(this.readBoolean());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readBoolean());return E},readPackedFloat:function(E){if(this.type!==t.Bytes)return E.push(this.readFloat());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readFloat());return E},readPackedDouble:function(E){if(this.type!==t.Bytes)return E.push(this.readDouble());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readDouble());return E},readPackedFixed32:function(E){if(this.type!==t.Bytes)return E.push(this.readFixed32());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readFixed32());return E},readPackedSFixed32:function(E){if(this.type!==t.Bytes)return E.push(this.readSFixed32());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readSFixed32());return E},readPackedFixed64:function(E){if(this.type!==t.Bytes)return E.push(this.readFixed64());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readFixed64());return E},readPackedSFixed64:function(E){if(this.type!==t.Bytes)return E.push(this.readSFixed64());var V=d(this);for(E=E||[];this.pos<V;)E.push(this.readSFixed64());return E},skip:function(E){var V=7&E;if(V===t.Varint)for(;this.buf[this.pos++]>127;);else if(V===t.Bytes)this.pos=this.readVarint()+this.pos;else if(V===t.Fixed32)this.pos+=4;else{if(V!==t.Fixed64)throw new Error("Unimplemented type: "+V);this.pos+=8}},writeTag:function(E,V){this.writeVarint(E<<3|V)},realloc:function(E){for(var V=this.length||16;V<this.pos+E;)V*=2;if(V!==this.length){var ee=new Uint8Array(V);ee.set(this.buf),this.buf=ee,this.length=V}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(E){this.realloc(4),ae(this.buf,E,this.pos),this.pos+=4},writeSFixed32:function(E){this.realloc(4),ae(this.buf,E,this.pos),this.pos+=4},writeFixed64:function(E){this.realloc(8),ae(this.buf,-1&E,this.pos),ae(this.buf,Math.floor(E*s),this.pos+4),this.pos+=8},writeSFixed64:function(E){this.realloc(8),ae(this.buf,-1&E,this.pos),ae(this.buf,Math.floor(E*s),this.pos+4),this.pos+=8},writeVarint:function(E){(E=+E||0)>268435455||E<0?function(V,ee){var ve,je;if(V>=0?(ve=V%4294967296|0,je=V/4294967296|0):(je=~(-V/4294967296),4294967295^(ve=~(-V%4294967296))?ve=ve+1|0:(ve=0,je=je+1|0)),V>=18446744073709552e3||V<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ee.realloc(10),function(we,Ie,Ge){Ge.buf[Ge.pos++]=127&we|128,we>>>=7,Ge.buf[Ge.pos++]=127&we|128,we>>>=7,Ge.buf[Ge.pos++]=127&we|128,we>>>=7,Ge.buf[Ge.pos++]=127&we|128,Ge.buf[Ge.pos]=127&(we>>>=7)}(ve,0,ee),function(we,Ie){var Ge=(7&we)<<4;Ie.buf[Ie.pos++]|=Ge|((we>>>=3)?128:0),we&&(Ie.buf[Ie.pos++]=127&we|((we>>>=7)?128:0),we&&(Ie.buf[Ie.pos++]=127&we|((we>>>=7)?128:0),we&&(Ie.buf[Ie.pos++]=127&we|((we>>>=7)?128:0),we&&(Ie.buf[Ie.pos++]=127&we|((we>>>=7)?128:0),we&&(Ie.buf[Ie.pos++]=127&we)))))}(je,ee)}(E,this):(this.realloc(4),this.buf[this.pos++]=127&E|(E>127?128:0),E<=127||(this.buf[this.pos++]=127&(E>>>=7)|(E>127?128:0),E<=127||(this.buf[this.pos++]=127&(E>>>=7)|(E>127?128:0),E<=127||(this.buf[this.pos++]=E>>>7&127))))},writeSVarint:function(E){this.writeVarint(E<0?2*-E-1:2*E)},writeBoolean:function(E){this.writeVarint(!!E)},writeString:function(E){E=String(E),this.realloc(4*E.length),this.pos++;var V=this.pos;this.pos=function(ve,je,we){for(var Ie,Ge,Ne=0;Ne<je.length;Ne++){if((Ie=je.charCodeAt(Ne))>55295&&Ie<57344){if(!Ge){Ie>56319||Ne+1===je.length?(ve[we++]=239,ve[we++]=191,ve[we++]=189):Ge=Ie;continue}if(Ie<56320){ve[we++]=239,ve[we++]=191,ve[we++]=189,Ge=Ie;continue}Ie=Ge-55296<<10|Ie-56320|65536,Ge=null}else Ge&&(ve[we++]=239,ve[we++]=191,ve[we++]=189,Ge=null);Ie<128?ve[we++]=Ie:(Ie<2048?ve[we++]=Ie>>6|192:(Ie<65536?ve[we++]=Ie>>12|224:(ve[we++]=Ie>>18|240,ve[we++]=Ie>>12&63|128),ve[we++]=Ie>>6&63|128),ve[we++]=63&Ie|128)}return we}(this.buf,E,this.pos);var ee=this.pos-V;ee>=128&&m(V,ee,this),this.pos=V-1,this.writeVarint(ee),this.pos+=ee},writeFloat:function(E){this.realloc(4),n.write(this.buf,E,this.pos,!0,23,4),this.pos+=4},writeDouble:function(E){this.realloc(8),n.write(this.buf,E,this.pos,!0,52,8),this.pos+=8},writeBytes:function(E){var V=E.length;this.writeVarint(V),this.realloc(V);for(var ee=0;ee<V;ee++)this.buf[this.pos++]=E[ee]},writeRawMessage:function(E,V){this.pos++;var ee=this.pos;E(V,this);var ve=this.pos-ee;ve>=128&&m(ee,ve,this),this.pos=ee-1,this.writeVarint(ve),this.pos+=ve},writeMessage:function(E,V,ee){this.writeTag(E,t.Bytes),this.writeRawMessage(V,ee)},writePackedVarint:function(E,V){V.length&&this.writeMessage(E,_,V)},writePackedSVarint:function(E,V){V.length&&this.writeMessage(E,v,V)},writePackedBoolean:function(E,V){V.length&&this.writeMessage(E,I,V)},writePackedFloat:function(E,V){V.length&&this.writeMessage(E,w,V)},writePackedDouble:function(E,V){V.length&&this.writeMessage(E,S,V)},writePackedFixed32:function(E,V){V.length&&this.writeMessage(E,A,V)},writePackedSFixed32:function(E,V){V.length&&this.writeMessage(E,k,V)},writePackedFixed64:function(E,V){V.length&&this.writeMessage(E,B,V)},writePackedSFixed64:function(E,V){V.length&&this.writeMessage(E,Z,V)},writeBytesField:function(E,V){this.writeTag(E,t.Bytes),this.writeBytes(V)},writeFixed32Field:function(E,V){this.writeTag(E,t.Fixed32),this.writeFixed32(V)},writeSFixed32Field:function(E,V){this.writeTag(E,t.Fixed32),this.writeSFixed32(V)},writeFixed64Field:function(E,V){this.writeTag(E,t.Fixed64),this.writeFixed64(V)},writeSFixed64Field:function(E,V){this.writeTag(E,t.Fixed64),this.writeSFixed64(V)},writeVarintField:function(E,V){this.writeTag(E,t.Varint),this.writeVarint(V)},writeSVarintField:function(E,V){this.writeTag(E,t.Varint),this.writeSVarint(V)},writeStringField:function(E,V){this.writeTag(E,t.Bytes),this.writeString(V)},writeFloatField:function(E,V){this.writeTag(E,t.Fixed32),this.writeFloat(V)},writeDoubleField:function(E,V){this.writeTag(E,t.Fixed64),this.writeDouble(V)},writeBooleanField:function(E,V){this.writeVarintField(E,!!V)}},qh}var Wh=me(Rd());const Kh=3;function Tm(n,t,r){n===1&&r.readMessage(Sm,t)}function Sm(n,t,r){if(n===3){const{id:s,bitmap:l,width:d,height:p,left:m,top:_,advance:v}=r.readMessage(Cm,{});t.push({id:s,bitmap:new _l({width:d+2*Kh,height:p+2*Kh},l),metrics:{width:d,height:p,left:m,top:_,advance:v}})}}function Cm(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const Mm=Kh;function Dd(n){let t=0,r=0;for(const p of n)t+=p.w*p.h,r=Math.max(r,p.w);n.sort((p,m)=>m.h-p.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,d=0;for(const p of n)for(let m=s.length-1;m>=0;m--){const _=s[m];if(!(p.w>_.w||p.h>_.h)){if(p.x=_.x,p.y=_.y,d=Math.max(d,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===_.w&&p.h===_.h){const v=s.pop();m<s.length&&(s[m]=v)}else p.h===_.h?(_.x+=p.w,_.w-=p.w):p.w===_.w?(_.y+=p.h,_.h-=p.h):(s.push({x:_.x+p.w,y:_.y,w:_.w-p.w,h:p.h}),_.y+=p.h,_.h-=p.h);break}}return{w:l,h:d,fill:t/(l*d)||0}}const Ar=1;class Xh{constructor(t,{pixelRatio:r,version:s,stretchX:l,stretchY:d,content:p,textFitWidth:m,textFitHeight:_}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=d,this.content=p,this.version=s,this.textFitWidth=m,this.textFitHeight=_}get tl(){return[this.paddedRect.x+Ar,this.paddedRect.y+Ar]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ar,this.paddedRect.y+this.paddedRect.h-Ar]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ar)/this.pixelRatio,(this.paddedRect.h-2*Ar)/this.pixelRatio]}}class Bd{constructor(t,r){const s={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,s,d),this.addImages(r,l,d);const{w:p,h:m}=Dd(d),_=new Qr({width:p||1,height:m||1});for(const v in t){const w=t[v],S=s[v].paddedRect;Qr.copy(w.data,_,{x:0,y:0},{x:S.x+Ar,y:S.y+Ar},w.data)}for(const v in r){const w=r[v],S=l[v].paddedRect,I=S.x+Ar,A=S.y+Ar,k=w.data.width,B=w.data.height;Qr.copy(w.data,_,{x:0,y:0},{x:I,y:A},w.data),Qr.copy(w.data,_,{x:0,y:B-1},{x:I,y:A-1},{width:k,height:1}),Qr.copy(w.data,_,{x:0,y:0},{x:I,y:A+B},{width:k,height:1}),Qr.copy(w.data,_,{x:k-1,y:0},{x:I-1,y:A},{width:1,height:B}),Qr.copy(w.data,_,{x:0,y:0},{x:I+k,y:A},{width:1,height:B})}this.image=_,this.iconPositions=s,this.patternPositions=l}addImages(t,r,s){for(const l in t){const d=t[l],p={x:0,y:0,w:d.data.width+2*Ar,h:d.data.height+2*Ar};s.push(p),r[l]=new Xh(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,d]=t.tl;s.update(r.data,void 0,{x:l,y:d})}}var Ns;Je("ImagePosition",Xh),Je("ImageAtlas",Bd),x.al=void 0,(Ns=x.al||(x.al={}))[Ns.none=0]="none",Ns[Ns.horizontal=1]="horizontal",Ns[Ns.vertical=2]="vertical",Ns[Ns.horizontalOnly=3]="horizontalOnly";const Bc=-17;class Il{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,s){const l=new Il;return l.scale=t||1,l.fontStack=r,l.verticalAlign=s||"bottom",l}static forImage(t,r){const s=new Il;return s.imageName=t,s.verticalAlign=r||"bottom",s}}class vo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new vo;for(let l=0;l<t.sections.length;l++){const d=t.sections[l];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const l=t.charCodeAt(s+1)||null,d=t.charCodeAt(s-1)||null;r+=l&&pa(l)&&!Pl[t[s+1]]||d&&pa(d)&&!Pl[t[s-1]]||!Pl[t[s]]?t[s]:Pl[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&Oc[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&Oc[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new vo;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}getMaxImageSize(t){let r=0,s=0;for(let l=0;l<this.length();l++){const d=this.getSection(l);if(d.imageName){const p=t[d.imageName];if(!p)continue;const m=p.displaySize;r=Math.max(r,m[0]),s=Math.max(s,m[1])}}return{maxImageWidth:r,maxImageHeight:s}}addTextSection(t,r){this.text+=t.text,this.sections.push(Il.forText(t.scale,t.fontStack||r,t.verticalAlign));const s=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Zi("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Il.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fc(n,t,r,s,l,d,p,m,_,v,w,S,I,A,k){const B=vo.fromFeature(n,l);let Z;S===x.al.vertical&&B.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:ae}=Cn;if(X&&B.sections.length===1){Z=[];const V=X(B.toString(),Yh(B,v,d,t,s,A));for(const ee of V){const ve=new vo;ve.text=ee,ve.sections=B.sections;for(let je=0;je<ee.length;je++)ve.sectionIndex.push(0);Z.push(ve)}}else if(ae){Z=[];const V=ae(B.text,B.sectionIndex,Yh(B,v,d,t,s,A));for(const ee of V){const ve=new vo;ve.text=ee[0],ve.sectionIndex=ee[1],ve.sections=B.sections,Z.push(ve)}}else Z=function(V,ee){const ve=[],je=V.text;let we=0;for(const Ie of ee)ve.push(V.substring(we,Ie)),we=Ie;return we<je.length&&ve.push(V.substring(we,je.length)),ve}(B,Yh(B,v,d,t,s,A));const Q=[],E={positionedLines:Q,text:B.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:S,iconsInText:!1,verticalizable:!1};return function(V,ee,ve,je,we,Ie,Ge,Ne,$e,ze,Qe,ct){let ot=0,it=0,kt=0,_i=0;const ji=Ne==="right"?1:Ne==="left"?0:.5,dr=Oi/ct;let tn=0;for(const di of we){di.trim();const $i=di.getMaxScale(),tr={positionedGlyphs:[],lineOffset:0};V.positionedLines[tn]=tr;const ir=tr.positionedGlyphs;let Sr=0;if(!di.length()){it+=Ie,++tn;continue}const rn=Am(je,di,dr);for(let zr=0;zr<di.length();zr++){const Ni=di.getSection(zr),Hi=di.getSectionIndex(zr),Wi=di.getCharCode(zr),zi=km($e,Qe,Wi);let ri;if(Ni.imageName){if(V.iconsInText=!0,Ni.scale=Ni.scale*dr,ri=Lm(Ni,zi,$i,rn,je),!ri)continue;Sr=Math.max(Sr,ri.imageOffset)}else if(ri=zm(Ni,Wi,zi,rn,ee,ve),!ri)continue;const{rect:In,metrics:To,baselineOffset:En}=ri;ir.push({glyph:Wi,imageName:Ni.imageName,x:ot,y:it+En+Bc,vertical:zi,scale:Ni.scale,fontStack:Ni.fontStack,sectionIndex:Hi,metrics:To,rect:In}),zi?(V.verticalizable=!0,ot+=(Ni.imageName?To.advance:Oi)*Ni.scale+ze):ot+=To.advance*Ni.scale+ze}ir.length!==0&&(kt=Math.max(ot-ze,kt),Rm(ir,0,ir.length-1,ji)),ot=0,tr.lineOffset=Math.max(Sr,($i-1)*Oi);const qi=Ie*$i+Sr;it+=qi,_i=Math.max(qi,_i),++tn}const{horizontalAlign:kr,verticalAlign:er}=Jh(Ge);(function(di,$i,tr,ir,Sr,rn,qi,zr,Ni){const Hi=($i-tr)*Sr;let Wi=0;Wi=rn!==qi?-zr*ir-Bc:-ir*Ni*qi+.5*qi;for(const zi of di)for(const ri of zi.positionedGlyphs)ri.x+=Hi,ri.y+=Wi})(V.positionedLines,ji,kr,er,kt,_i,Ie,it,we.length),V.top+=-er*it,V.bottom=V.top+it,V.left+=-kr*kt,V.right=V.left+kt}(E,t,r,s,Z,p,m,_,S,v,I,k),!function(V){for(const ee of V)if(ee.positionedGlyphs.length!==0)return!1;return!0}(Q)&&E}const Oc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Im={40:!0};function Fd(n,t,r,s,l,d){if(t.imageName){const p=s[t.imageName];return p?p.displaySize[0]*t.scale*Oi/d+l:0}{const p=r[t.fontStack],m=p&&p[n];return m?m.metrics.advance*t.scale+l:0}}function Od(n,t,r,s){const l=Math.pow(n-t,2);return s?n<t?l/2:2*l:l+Math.abs(r)*r}function Em(n,t,r){let s=0;return n===10&&(s-=1e4),r&&(s+=150),n!==40&&n!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function jd(n,t,r,s,l,d){let p=null,m=Od(t,r,l,d);for(const _ of s){const v=Od(t-_.x,r,l,d)+_.badness;v<=m&&(p=_,m=v)}return{index:n,x:t,priorBreak:p,badness:m}}function Nd(n){return n?Nd(n.priorBreak).concat(n.index):[]}function Yh(n,t,r,s,l,d){if(!n)return[];const p=[],m=function(S,I,A,k,B,Z){let X=0;for(let ae=0;ae<S.length();ae++){const Q=S.getSection(ae);X+=Fd(S.getCharCode(ae),Q,k,B,I,Z)}return X/Math.max(1,Math.ceil(X/A))}(n,t,r,s,l,d),_=n.text.indexOf("​")>=0;let v=0;for(let S=0;S<n.length();S++){const I=n.getSection(S),A=n.getCharCode(S);if(Oc[A]||(v+=Fd(A,I,s,l,t,d)),S<n.length()-1){const k=!((w=A)<11904)&&(!!At["CJK Compatibility Forms"](w)||!!At["CJK Compatibility"](w)||!!At["CJK Strokes"](w)||!!At["CJK Symbols and Punctuation"](w)||!!At["Enclosed CJK Letters and Months"](w)||!!At["Halfwidth and Fullwidth Forms"](w)||!!At["Ideographic Description Characters"](w)||!!At["Vertical Forms"](w)||al.test(String.fromCodePoint(w)));(Pm[A]||k||I.imageName||S!==n.length()-2&&Im[n.getCharCode(S+1)])&&p.push(jd(S+1,v,m,p,Em(A,n.getCharCode(S+1),k&&_),!1))}}var w;return Nd(jd(n.length(),v,m,p,0,!0))}function Jh(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Am(n,t,r){const s=t.getMaxScale()*Oi,{maxImageWidth:l,maxImageHeight:d}=t.getMaxImageSize(n),p=Math.max(s,d*r);return{verticalLineContentWidth:Math.max(s,l*r),horizontalLineContentHeight:p}}function Vd(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function km(n,t,r){return!(n===x.al.horizontal||!t&&!ho(r)||t&&(Oc[r]||(s=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(s)))));var s}function zm(n,t,r,s,l,d){const p=d[n.fontStack],m=function(v,w,S,I){if(v&&v.rect)return v;const A=w[S.fontStack],k=A&&A[I];return k?{rect:null,metrics:k.metrics}:null}(p&&p[t],l,n,t);if(m===null)return null;let _;if(r)_=s.verticalLineContentWidth-n.scale*Oi;else{const v=Vd(n.verticalAlign);_=(s.horizontalLineContentHeight-n.scale*Oi)*v}return{rect:m.rect,metrics:m.metrics,baselineOffset:_}}function Lm(n,t,r,s,l){const d=l[n.imageName];if(!d)return null;const p=d.paddedRect,m=d.displaySize,_={width:m[0],height:m[1],left:Ar,top:-3,advance:t?m[1]:m[0]};let v;if(t)v=s.verticalLineContentWidth-m[1]*n.scale;else{const w=Vd(n.verticalAlign);v=(s.horizontalLineContentHeight-m[1]*n.scale)*w}return{rect:p,metrics:_,baselineOffset:v,imageOffset:(t?m[0]:m[1])*n.scale-Oi*r}}function Rm(n,t,r,s){if(s===0)return;const l=n[r],d=(n[r].x+l.metrics.advance*l.scale)*s;for(let p=t;p<=r;p++)n[p].x-=d}function Dm(n,t,r){const{horizontalAlign:s,verticalAlign:l}=Jh(r),d=t[0]-n.displaySize[0]*s,p=t[1]-n.displaySize[1]*l;return{image:n,top:p,bottom:p+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function Zd(n){var t,r;let s=n.left,l=n.top,d=n.right-s,p=n.bottom-l;const m=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",_=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",v=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(_==="proportional"){if(m==="stretchOnly"&&d/p<v||m==="proportional"){const w=Math.ceil(p*v);s*=w/d,d=w}}else if(m==="proportional"&&_==="stretchOnly"&&v!==0&&d/p>v){const w=Math.ceil(d/v);l*=w/p,p=w}return{x1:s,y1:l,x2:s+d,y2:l+p}}function Ud(n,t,r,s,l,d){const p=n.image;let m;if(p.content){const Z=p.content,X=p.pixelRatio||1;m=[Z[0]/X,Z[1]/X,p.displaySize[0]-Z[2]/X,p.displaySize[1]-Z[3]/X]}const _=t.left*d,v=t.right*d;let w,S,I,A;r==="width"||r==="both"?(A=l[0]+_-s[3],S=l[0]+v+s[1]):(A=l[0]+(_+v-p.displaySize[0])/2,S=A+p.displaySize[0]);const k=t.top*d,B=t.bottom*d;return r==="height"||r==="both"?(w=l[1]+k-s[0],I=l[1]+B+s[2]):(w=l[1]+(k+B-p.displaySize[1])/2,I=w+p.displaySize[1]),{image:p,top:w,right:S,bottom:I,left:A,collisionPadding:m}}const El=255,Jn=128,Vs=El*Jn;function Gd(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ti(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let d=0;for(;d<s.length&&s[d]<=n;)d++;d=Math.max(0,d-1);let p=d;for(;p<s.length&&s[p]<n+1;)p++;p=Math.min(s.length-1,p);const m=s[d],_=s[p];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:_,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:_,minSize:r.evaluate(new ti(m)),maxSize:r.evaluate(new ti(_)),interpolationType:l}}}function Qh(n,t,r){let s="never";const l=n.get(t);return l?s=l:n.get(r)&&(s="always"),s}const Bm=Sl.VectorTileFeature.types,Fm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jc(n,t,r,s,l,d,p,m,_,v,w,S,I){const A=m?Math.min(Vs,Math.round(m[0])):0,k=m?Math.min(Vs,Math.round(m[1])):0;n.emplaceBack(t,r,Math.round(32*s),Math.round(32*l),d,p,(A<<1)+(_?1:0),k,16*v,16*w,256*S,256*I)}function eu(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function Om(n){for(const t of n.sections)if(Ch(t.text))return!0;return!1}class tu{constructor(t){this.layoutVertexArray=new ci,this.indexArray=new Zt,this.programConfigurations=t,this.segments=new Ut,this.dynamicLayoutVertexArray=new Yt,this.opacityVertexArray=new hi,this.hasVisibleVertices=!1,this.placedSymbolArray=new ie}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_m.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ym.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Fm,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Je("SymbolBuffers",tu);class iu{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Ut,this.collisionVertexArray=new Qt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,vm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Je("CollisionBuffers",iu);class bo{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(p=>p.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gd(this.zoom,r["text-size"]),this.iconSizeData=Gd(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=Qh(s,"text-overlap","text-allow-overlap")!=="never"||Qh(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(p=>x.al[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=t.sourceID}createArrays(){this.text=new tu(new Yn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new tu(new Yn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new le,this.lineVertexArray=new se,this.symbolInstances=new re,this.textAnchorOffsets=new Ee}calculateGlyphDependencies(t,r,s,l,d){for(let p=0;p<t.length;p++)if(r[t.charCodeAt(p)]=!0,(s||l)&&d){const m=Pl[t.charAt(p)];m&&(r[m.charCodeAt(0)]=!0)}}populate(t,r,s){const l=this.layers[0],d=l.layout,p=d.get("text-font"),m=d.get("text-field"),_=d.get("icon-image"),v=(m.value.kind!=="constant"||m.value.value instanceof vi&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),w=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,S=d.get("symbol-sort-key");if(this.features=[],!v&&!w)return;const I=r.iconDependencies,A=r.glyphDependencies,k=r.availableImages,B=new ti(this.zoom);for(const{feature:Z,id:X,index:ae,sourceLayerIndex:Q}of t){const E=l._featureFilter.needGeometry,V=xa(Z,E);if(!l._featureFilter.filter(B,V,s))continue;let ee,ve;if(E||(V.geometry=ba(Z)),v){const we=l.getValueAndResolveTokens("text-field",V,s,k),Ie=vi.factory(we),Ge=this.hasRTLText=this.hasRTLText||Om(Ie);(!Ge||Cn.getRTLTextPluginStatus()==="unavailable"||Ge&&Cn.isParsed())&&(ee=xm(Ie,l,V))}if(w){const we=l.getValueAndResolveTokens("icon-image",V,s,k);ve=we instanceof lr?we:lr.fromString(we)}if(!ee&&!ve)continue;const je=this.sortFeaturesByKey?S.evaluate(V,{},s):void 0;if(this.features.push({id:X,text:ee,icon:ve,index:ae,sourceLayerIndex:Q,geometry:V.geometry,properties:Z.properties,type:Bm[Z.type],sortKey:je}),ve&&(I[ve.name]=!0),ee){const we=p.evaluate(V,{},s).join(","),Ie=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.al.vertical)>=0;for(const Ge of ee.sections)if(Ge.image)I[Ge.image.name]=!0;else{const Ne=co(ee.toString()),$e=Ge.fontStack||we,ze=A[$e]=A[$e]||{};this.calculateGlyphDependencies(Ge.text,ze,Ie,this.allowVerticalPlacement,Ne)}}}d.get("symbol-placement")==="line"&&(this.features=function(Z){const X={},ae={},Q=[];let E=0;function V(we){Q.push(Z[we]),E++}function ee(we,Ie,Ge){const Ne=ae[we];return delete ae[we],ae[Ie]=Ne,Q[Ne].geometry[0].pop(),Q[Ne].geometry[0]=Q[Ne].geometry[0].concat(Ge[0]),Ne}function ve(we,Ie,Ge){const Ne=X[Ie];return delete X[Ie],X[we]=Ne,Q[Ne].geometry[0].shift(),Q[Ne].geometry[0]=Ge[0].concat(Q[Ne].geometry[0]),Ne}function je(we,Ie,Ge){const Ne=Ge?Ie[0][Ie[0].length-1]:Ie[0][0];return`${we}:${Ne.x}:${Ne.y}`}for(let we=0;we<Z.length;we++){const Ie=Z[we],Ge=Ie.geometry,Ne=Ie.text?Ie.text.toString():null;if(!Ne){V(we);continue}const $e=je(Ne,Ge),ze=je(Ne,Ge,!0);if($e in ae&&ze in X&&ae[$e]!==X[ze]){const Qe=ve($e,ze,Ge),ct=ee($e,ze,Q[Qe].geometry);delete X[$e],delete ae[ze],ae[je(Ne,Q[ct].geometry,!0)]=ct,Q[Qe].geometry=null}else $e in ae?ee($e,ze,Ge):ze in X?ve($e,ze,Ge):(V(we),X[$e]=E-1,ae[ze]=E-1)}return Q.filter(we=>we.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,X)=>Z.sortKey-X.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),d=t.dist(r[t.segment]);const p={};for(let m=t.segment+1;m<r.length;m++)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:l},m<r.length-1&&(l+=r[m+1].dist(r[m]));for(let m=t.segment||0;m>=0;m--)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:d},m>0&&(d+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){const _=p[m];this.lineVertexArray.emplaceBack(_.x,_.y,_.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,l,d,p,m,_,v,w,S,I){const A=t.indexArray,k=t.layoutVertexArray,B=t.segments.prepareSegment(4*r.length,k,A,this.canOverlap?p.sortKey:void 0),Z=this.glyphOffsetArray.length,X=B.vertexLength,ae=this.allowVerticalPlacement&&m===x.al.vertical?Math.PI/2:0,Q=p.text&&p.text.sections;for(let E=0;E<r.length;E++){const{tl:V,tr:ee,bl:ve,br:je,tex:we,pixelOffsetTL:Ie,pixelOffsetBR:Ge,minFontScaleX:Ne,minFontScaleY:$e,glyphOffset:ze,isSDF:Qe,sectionIndex:ct}=r[E],ot=B.vertexLength,it=ze[1];jc(k,_.x,_.y,V.x,it+V.y,we.x,we.y,s,Qe,Ie.x,Ie.y,Ne,$e),jc(k,_.x,_.y,ee.x,it+ee.y,we.x+we.w,we.y,s,Qe,Ge.x,Ie.y,Ne,$e),jc(k,_.x,_.y,ve.x,it+ve.y,we.x,we.y+we.h,s,Qe,Ie.x,Ge.y,Ne,$e),jc(k,_.x,_.y,je.x,it+je.y,we.x+we.w,we.y+we.h,s,Qe,Ge.x,Ge.y,Ne,$e),eu(t.dynamicLayoutVertexArray,_,ae),A.emplaceBack(ot,ot+2,ot+1),A.emplaceBack(ot+1,ot+2,ot+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),E!==r.length-1&&ct===r[E+1].sectionIndex||t.programConfigurations.populatePaintArrays(k.length,p,p.index,{},I,Q&&Q[ct])}t.placedSymbolArray.emplaceBack(_.x,_.y,Z,this.glyphOffsetArray.length-Z,X,v,w,_.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],m,0,!1,0,S)}_addCollisionDebugVertex(t,r,s,l,d,p){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,l,d,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(t,r,s,l,d,p,m){const _=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),v=_.vertexLength,w=d.layoutVertexArray,S=d.collisionVertexArray,I=m.anchorX,A=m.anchorY;this._addCollisionDebugVertex(w,S,p,I,A,new Re(t,r)),this._addCollisionDebugVertex(w,S,p,I,A,new Re(s,r)),this._addCollisionDebugVertex(w,S,p,I,A,new Re(s,l)),this._addCollisionDebugVertex(w,S,p,I,A,new Re(t,l)),_.vertexLength+=4;const k=d.indexArray;k.emplaceBack(v,v+1),k.emplaceBack(v+1,v+2),k.emplaceBack(v+2,v+3),k.emplaceBack(v+3,v),_.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,l){for(let d=t;d<r;d++){const p=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iu(ui,kd.members,Fi),this.iconCollisionBox=new iu(ui,kd.members,Fi);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,l,d,p,m,_,v){const w={};for(let S=r;S<s;S++){const I=t.get(S);w.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},w.textFeatureIndex=I.featureIndex;break}for(let S=l;S<d;S++){const I=t.get(S);w.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},w.verticalTextFeatureIndex=I.featureIndex;break}for(let S=p;S<m;S++){const I=t.get(S);w.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},w.iconFeatureIndex=I.featureIndex;break}for(let S=_;S<v;S++){const I=t.get(S);w.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},w.verticalIconFeatureIndex=I.featureIndex;break}return w}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<l;d+=4)t.indexArray.emplaceBack(d,d+2,d+1),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),l=[],d=[],p=[];for(let m=0;m<this.symbolInstances.length;++m){p.push(m);const _=this.symbolInstances.get(m);l.push(0|Math.round(r*_.anchorX+s*_.anchorY)),d.push(_.featureIndex)}return p.sort((m,_)=>l[m]-l[_]||d[_]-d[m]),p}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,d,p)=>{l>=0&&p.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let $d,qd;Je("SymbolBucket",bo,{omit:["layers","collisionBoxArray","features","compareText"]}),bo.MAX_GLYPHS=65535,bo.addDynamicAttributes=eu;var ru={get paint(){return qd=qd||new Ei({"icon-opacity":new ht(U.paint_symbol["icon-opacity"]),"icon-color":new ht(U.paint_symbol["icon-color"]),"icon-halo-color":new ht(U.paint_symbol["icon-halo-color"]),"icon-halo-width":new ht(U.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ht(U.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(U.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(U.paint_symbol["icon-translate-anchor"]),"text-opacity":new ht(U.paint_symbol["text-opacity"]),"text-color":new ht(U.paint_symbol["text-color"],{runtimeType:si,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ht(U.paint_symbol["text-halo-color"]),"text-halo-width":new ht(U.paint_symbol["text-halo-width"]),"text-halo-blur":new ht(U.paint_symbol["text-halo-blur"]),"text-translate":new nt(U.paint_symbol["text-translate"]),"text-translate-anchor":new nt(U.paint_symbol["text-translate-anchor"])})},get layout(){return $d=$d||new Ei({"symbol-placement":new nt(U.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(U.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(U.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ht(U.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(U.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nt(U.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nt(U.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nt(U.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(U.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(U.layout_symbol["icon-rotation-alignment"]),"icon-size":new ht(U.layout_symbol["icon-size"]),"icon-text-fit":new nt(U.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nt(U.layout_symbol["icon-text-fit-padding"]),"icon-image":new ht(U.layout_symbol["icon-image"]),"icon-rotate":new ht(U.layout_symbol["icon-rotate"]),"icon-padding":new ht(U.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(U.layout_symbol["icon-keep-upright"]),"icon-offset":new ht(U.layout_symbol["icon-offset"]),"icon-anchor":new ht(U.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(U.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(U.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(U.layout_symbol["text-rotation-alignment"]),"text-field":new ht(U.layout_symbol["text-field"]),"text-font":new ht(U.layout_symbol["text-font"]),"text-size":new ht(U.layout_symbol["text-size"]),"text-max-width":new ht(U.layout_symbol["text-max-width"]),"text-line-height":new nt(U.layout_symbol["text-line-height"]),"text-letter-spacing":new ht(U.layout_symbol["text-letter-spacing"]),"text-justify":new ht(U.layout_symbol["text-justify"]),"text-radial-offset":new ht(U.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(U.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ht(U.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ht(U.layout_symbol["text-anchor"]),"text-max-angle":new nt(U.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(U.layout_symbol["text-writing-mode"]),"text-rotate":new ht(U.layout_symbol["text-rotate"]),"text-padding":new nt(U.layout_symbol["text-padding"]),"text-keep-upright":new nt(U.layout_symbol["text-keep-upright"]),"text-transform":new ht(U.layout_symbol["text-transform"]),"text-offset":new ht(U.layout_symbol["text-offset"]),"text-allow-overlap":new nt(U.layout_symbol["text-allow-overlap"]),"text-overlap":new nt(U.layout_symbol["text-overlap"]),"text-ignore-placement":new nt(U.layout_symbol["text-ignore-placement"]),"text-optional":new nt(U.layout_symbol["text-optional"])})}};class Hd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:dt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Je("FormatSectionOverride",Hd,{omit:["defaultValue"]});class Nc extends Vr{constructor(t){super(t,ru)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const d of s)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,l){const d=this.layout.get(t).evaluate(r,{},s,l),p=this._unevaluatedLayout._values[t];return p.isDataDriven()||na(p.value)||!d?d:function(m,_){return _.replace(/{([^{}]+)}/g,(v,w)=>m&&w in m?String(m[w]):"")}(r.properties,d)}createBucket(t){return new bo(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of ru.paint.overridableProperties){if(!Nc.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new Hd(r),l=new Ya(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new qo("source",l):new Qa("composite",l,r.value.zoomStops),this.paint._values[t]=new yr(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Nc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),l=ru.paint.properties[r];let d=!1;const p=m=>{for(const _ of m)if(l.overrides&&l.overrides.hasOverride(_))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof vi)p(s.value.value.sections);else if(s.value.kind==="source"){const m=v=>{d||(v instanceof mt&&ei(v.value)===is?p(v.value.sections):v instanceof Da?p(v.sections):v.eachChild(m))},_=s.value;_._styleExpression&&m(_._styleExpression.expression)}return d}}let Wd;var jm={get paint(){return Wd=Wd||new Ei({"background-color":new nt(U.paint_background["background-color"]),"background-pattern":new ll(U.paint_background["background-pattern"]),"background-opacity":new nt(U.paint_background["background-opacity"])})}};class Nm extends Vr{constructor(t){super(t,jm)}}let Kd;var Vm={get paint(){return Kd=Kd||new Ei({"raster-opacity":new nt(U.paint_raster["raster-opacity"]),"raster-hue-rotate":new nt(U.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(U.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(U.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(U.paint_raster["raster-saturation"]),"raster-contrast":new nt(U.paint_raster["raster-contrast"]),"raster-resampling":new nt(U.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(U.paint_raster["raster-fade-duration"])})}};class Zm extends Vr{constructor(t){super(t,Vm)}}class Um extends Vr{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Gm{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const $m={once:!0},nu=63710088e-1;class Zs{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zs(fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,l=t.lat*r,d=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return nu*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof Zs)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Zs(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Zs(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Xd=2*Math.PI*nu;function Yd(n){return Xd*Math.cos(n*Math.PI/180)}function Jd(n){return(180+n)/360}function Qd(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ep(n,t){return n/Yd(t)}function su(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function tp(n,t){return n*Yd(su(t))}class Al{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=Zs.convert(t);return new Al(Jd(s.lng),Qd(s.lat),ep(r,s.lat))}toLngLat(){return new Zs(360*this.x-180,su(this.y))}toAltitude(){return tp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Xd*(t=su(this.y),1/Math.cos(t*Math.PI/180));var t}}function ip(n,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[n*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class au{constructor(t,r,s){if(!function(l,d,p){return!(l<0||l>25||p<0||p>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=xo(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const l=(p=this.y,m=this.z,_=ip(256*(d=this.x),256*(p=Math.pow(2,m)-p-1),m),v=ip(256*(d+1),256*(p+1),m),_[0]+","+_[1]+","+v[0]+","+v[1]);var d,p,m,_,v;const w=function(S,I,A){let k,B="";for(let Z=S;Z>0;Z--)k=1<<Z-1,B+=(I&k?1:0)+(A&k?2:0);return B}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new Re((t.x*r-this.x)*yt,(t.y*r-this.y)*yt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class rp{constructor(t,r){this.wrap=t,this.canonical=r,this.key=xo(t,r.z,r.z,r.x,r.y)}}class en{constructor(t,r,s,l,d){if(this.terrainRttPosMatrix32f=null,t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new au(s,+l,+d),this.key=xo(r,t,s,l,d)}clone(){return new en(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new en(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new en(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?xo(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):xo(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new en(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new en(r,this.wrap,r,s,l),new en(r,this.wrap,r,s+1,l),new en(r,this.wrap,r,s,l+1),new en(r,this.wrap,r,s+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new en(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new en(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new rp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Al(t.x-this.wrap,t.y))}}function xo(n,t,r,s,l){(n*=2)<0&&(n=-1*n-1);const d=1<<r;return(d*d*n+d*l+s).toString(36)+r.toString(36)+t.toString(36)}Je("CanonicalTileID",au),Je("OverscaledTileID",en,{omit:["terrainRttPosMatrix32f"]});class np{constructor(t,r,s,l=1,d=1,p=1,m=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Zi(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const _=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=p,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let v=0;v<_;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(_,v)]=this.data[this._idx(_-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,_)]=this.data[this._idx(v,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<_;v++)for(let w=0;w<_;w++){const S=this.get(v,w);S>this.max&&(this.max=S),S<this.min&&(this.min=S)}}get(t,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,d=r*this.dim+this.dim,p=s*this.dim,m=s*this.dim+this.dim;switch(r){case-1:l=d-1;break;case 1:d=l+1}switch(s){case-1:p=m-1;break;case 1:m=p+1}const _=-r*this.dim,v=-s*this.dim;for(let w=p;w<m;w++)for(let S=l;S<d;S++)this.data[this._idx(S,w)]=t.data[this._idx(S+_,w+v)]}}Je("DEMData",np);class sp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ap{constructor(t,r,s,l,d){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=l,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class op{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Bs(yt,16,0),this.grid3D=new Bs(yt,16,0),this.featureIndexArray=new Se,this.promoteId=r}insert(t,r,s,l,d,p){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,d);const _=p?this.grid3D:this.grid;for(let v=0;v<r.length;v++){const w=r[v],S=[1/0,1/0,-1/0,-1/0];for(let I=0;I<w.length;I++){const A=w[I];S[0]=Math.min(S[0],A.x),S[1]=Math.min(S[1],A.y),S[2]=Math.max(S[2],A.x),S[3]=Math.max(S[3],A.y)}S[0]<yt&&S[1]<yt&&S[2]>=0&&S[3]>=0&&_.insert(m,S[0],S[1],S[2],S[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Sl.VectorTile(new Wh(this.rawTileData)).layers,this.sourceLayerCoder=new sp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,l){this.loadVTLayers();const d=t.params,p=yt/t.tileSize/t.scale,m=la(d.filter),_=t.queryGeometry,v=t.queryPadding*p,w=cp(_),S=this.grid.query(w.minX-v,w.minY-v,w.maxX+v,w.maxY+v),I=cp(t.cameraQueryGeometry),A=this.grid3D.query(I.minX-v,I.minY-v,I.maxX+v,I.maxY+v,(Z,X,ae,Q)=>function(E,V,ee,ve,je){for(const Ie of E)if(V<=Ie.x&&ee<=Ie.y&&ve>=Ie.x&&je>=Ie.y)return!0;const we=[new Re(V,ee),new Re(V,je),new Re(ve,je),new Re(ve,ee)];if(E.length>2){for(const Ie of we)if(wa(E,Ie))return!0}for(let Ie=0;Ie<E.length-1;Ie++)if(Lf(E[Ie],E[Ie+1],we))return!0;return!1}(t.cameraQueryGeometry,Z-v,X-v,ae+v,Q+v));for(const Z of A)S.push(Z);S.sort(qm);const k={};let B;for(let Z=0;Z<S.length;Z++){const X=S[Z];if(X===B)continue;B=X;const ae=this.featureIndexArray.get(X);let Q=null;this.loadMatchingFeature(k,ae.bucketIndex,ae.sourceLayerIndex,ae.featureIndex,m,d.layers,d.availableImages,r,s,l,(E,V,ee)=>(Q||(Q=ba(E)),V.queryIntersectsFeature({queryGeometry:_,feature:E,featureState:ee,geometry:Q,zoom:this.z,transform:t.transform,pixelsToTileUnits:p,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return k}loadMatchingFeature(t,r,s,l,d,p,m,_,v,w,S){const I=this.bucketLayerIDs[r];if(p&&!I.some(Z=>p.has(Z)))return;const A=this.sourceLayerCoder.decode(s),k=this.vtLayers[A].feature(l);if(d.needGeometry){const Z=xa(k,!0);if(!d.filter(new ti(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!d.filter(new ti(this.tileID.overscaledZ),k))return;const B=this.getId(k,A);for(let Z=0;Z<I.length;Z++){const X=I[Z];if(p&&!p.has(X))continue;const ae=_[X];if(!ae)continue;let Q={};B&&w&&(Q=w.getState(ae.sourceLayer||"_geojsonTileLayer",B));const E=Bt({},v[X]);E.paint=lp(E.paint,ae.paint,k,Q,m),E.layout=lp(E.layout,ae.layout,k,Q,m);const V=!S||S(k,ae,Q);if(!V)continue;const ee=new ap(k,this.z,this.x,this.y,B);ee.layer=E;let ve=t[X];ve===void 0&&(ve=t[X]=[]),ve.push({featureIndex:l,feature:ee,intersectionZ:V})}}lookupSymbolFeatures(t,r,s,l,d,p,m,_){const v={};this.loadVTLayers();const w=la(d);for(const S of t)this.loadMatchingFeature(v,s,l,S,w,p,m,_,r);return v}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){var s;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((s=t.properties)===null||s===void 0)&&s.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function lp(n,t,r,s,l){return rr(n,(d,p)=>{const m=t instanceof po?t.get(p):null;return m&&m.evaluate?m.evaluate(r,s,l):m})}function cp(n){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of n)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return{minX:t,minY:r,maxX:s,maxY:l}}function qm(n,t){return t-n}function hp(n,t,r,s,l){const d=[];for(let p=0;p<n.length;p++){const m=n[p];let _;for(let v=0;v<m.length-1;v++){let w=m[v],S=m[v+1];w.x<t&&S.x<t||(w.x<t?w=new Re(t,w.y+(t-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x<t&&(S=new Re(t,w.y+(t-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y<r&&S.y<r||(w.y<r?w=new Re(w.x+(r-w.y)/(S.y-w.y)*(S.x-w.x),r)._round():S.y<r&&(S=new Re(w.x+(r-w.y)/(S.y-w.y)*(S.x-w.x),r)._round()),w.x>=s&&S.x>=s||(w.x>=s?w=new Re(s,w.y+(s-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x>=s&&(S=new Re(s,w.y+(s-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y>=l&&S.y>=l||(w.y>=l?w=new Re(w.x+(l-w.y)/(S.y-w.y)*(S.x-w.x),l)._round():S.y>=l&&(S=new Re(w.x+(l-w.y)/(S.y-w.y)*(S.x-w.x),l)._round()),_&&w.equals(_[_.length-1])||(_=[w],d.push(_)),_.push(S)))))}}return d}Je("FeatureIndex",op,{omit:["rawTileData","sourceLayerCoder"]});class Us extends Re{constructor(t,r,s,l){super(t,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new Us(this.x,this.y,this.angle,this.segment)}}function up(n,t,r,s,l){if(t.segment===void 0||r===0)return!0;let d=t,p=t.segment+1,m=0;for(;m>-r/2;){if(p--,p<0)return!1;m-=n[p].dist(d),d=n[p]}m+=n[p].dist(n[p+1]),p++;const _=[];let v=0;for(;m<r/2;){const w=n[p],S=n[p+1];if(!S)return!1;let I=n[p-1].angleTo(w)-w.angleTo(S);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:m,angleDelta:I}),v+=I;m-_[0].distance>s;)v-=_.shift().angleDelta;if(v>l)return!1;p++,m+=w.dist(S)}return!0}function dp(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function pp(n,t,r){return n?.6*t*r:0}function fp(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Hm(n,t,r,s,l,d){const p=pp(r,l,d),m=fp(r,s)*d;let _=0;const v=dp(n)/2;for(let w=0;w<n.length-1;w++){const S=n[w],I=n[w+1],A=S.dist(I);if(_+A>v){const k=(v-_)/A,B=cn.number(S.x,I.x,k),Z=cn.number(S.y,I.y,k),X=new Us(B,Z,I.angleTo(S),w);return X._round(),!p||up(n,X,m,p,t)?X:void 0}_+=A}}function Wm(n,t,r,s,l,d,p,m,_){const v=pp(s,d,p),w=fp(s,l),S=w*p,I=n[0].x===0||n[0].x===_||n[0].y===0||n[0].y===_;return t-S<t/4&&(t=S+t/4),mp(n,I?t/2*m%t:(w/2+2*d)*p*m%t,t,v,r,S,I,!1,_)}function mp(n,t,r,s,l,d,p,m,_){const v=d/2,w=dp(n);let S=0,I=t-r,A=[];for(let k=0;k<n.length-1;k++){const B=n[k],Z=n[k+1],X=B.dist(Z),ae=Z.angleTo(B);for(;I+r<S+X;){I+=r;const Q=(I-S)/X,E=cn.number(B.x,Z.x,Q),V=cn.number(B.y,Z.y,Q);if(E>=0&&E<_&&V>=0&&V<_&&I-v>=0&&I+v<=w){const ee=new Us(E,V,ae,k);ee._round(),s&&!up(n,ee,d,s,l)||A.push(ee)}}S+=X}return m||A.length||p||(A=mp(n,S/2,r,s,l,d,p,!0,_)),A}Je("Anchor",Us);const kl=Ar;function gp(n,t,r,s){const l=[],d=n.image,p=d.pixelRatio,m=d.paddedRect.w-2*kl,_=d.paddedRect.h-2*kl;let v={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const w=d.stretchX||[[0,m]],S=d.stretchY||[[0,_]],I=(ze,Qe)=>ze+Qe[1]-Qe[0],A=w.reduce(I,0),k=S.reduce(I,0),B=m-A,Z=_-k;let X=0,ae=A,Q=0,E=k,V=0,ee=B,ve=0,je=Z;if(d.content&&s){const ze=d.content,Qe=ze[2]-ze[0],ct=ze[3]-ze[1];(d.textFitWidth||d.textFitHeight)&&(v=Zd(n)),X=Vc(w,0,ze[0]),Q=Vc(S,0,ze[1]),ae=Vc(w,ze[0],ze[2]),E=Vc(S,ze[1],ze[3]),V=ze[0]-X,ve=ze[1]-Q,ee=Qe-ae,je=ct-E}const we=v.x1,Ie=v.y1,Ge=v.x2-we,Ne=v.y2-Ie,$e=(ze,Qe,ct,ot)=>{const it=Zc(ze.stretch-X,ae,Ge,we),kt=Uc(ze.fixed-V,ee,ze.stretch,A),_i=Zc(Qe.stretch-Q,E,Ne,Ie),ji=Uc(Qe.fixed-ve,je,Qe.stretch,k),dr=Zc(ct.stretch-X,ae,Ge,we),tn=Uc(ct.fixed-V,ee,ct.stretch,A),kr=Zc(ot.stretch-Q,E,Ne,Ie),er=Uc(ot.fixed-ve,je,ot.stretch,k),di=new Re(it,_i),$i=new Re(dr,_i),tr=new Re(dr,kr),ir=new Re(it,kr),Sr=new Re(kt/p,ji/p),rn=new Re(tn/p,er/p),qi=t*Math.PI/180;if(qi){const Hi=Math.sin(qi),Wi=Math.cos(qi),zi=[Wi,-Hi,Hi,Wi];di._matMult(zi),$i._matMult(zi),ir._matMult(zi),tr._matMult(zi)}const zr=ze.stretch+ze.fixed,Ni=Qe.stretch+Qe.fixed;return{tl:di,tr:$i,bl:ir,br:tr,tex:{x:d.paddedRect.x+kl+zr,y:d.paddedRect.y+kl+Ni,w:ct.stretch+ct.fixed-zr,h:ot.stretch+ot.fixed-Ni},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sr,pixelOffsetBR:rn,minFontScaleX:ee/p/Ge,minFontScaleY:je/p/Ne,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const ze=_p(w,B,A),Qe=_p(S,Z,k);for(let ct=0;ct<ze.length-1;ct++){const ot=ze[ct],it=ze[ct+1];for(let kt=0;kt<Qe.length-1;kt++)l.push($e(ot,Qe[kt],it,Qe[kt+1]))}}else l.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:_+1}));return l}function Vc(n,t,r){let s=0;for(const l of n)s+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return s}function _p(n,t,r){const s=[{fixed:-1,stretch:0}];for(const[l,d]of n){const p=s[s.length-1];s.push({fixed:l-p.stretch,stretch:p.stretch}),s.push({fixed:l-p.stretch,stretch:p.stretch+(d-l)})}return s.push({fixed:t+kl,stretch:r}),s}function Zc(n,t,r,s){return n/t*r+s}function Uc(n,t,r,s){return n-t*r/s}class Gc{constructor(t,r,s,l,d,p,m,_,v,w){var S;if(this.boxStartIndex=t.length,v){let I=p.top,A=p.bottom;const k=p.collisionPadding;k&&(I-=k[1],A+=k[3]);let B=A-I;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{const I=!((S=p.image)===null||S===void 0)&&S.content&&(p.image.textFitWidth||p.image.textFitHeight)?Zd(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};I.y1=I.y1*m-_[0],I.y2=I.y2*m+_[2],I.x1=I.x1*m-_[3],I.x2=I.x2*m+_[1];const A=p.collisionPadding;if(A&&(I.x1-=A[0]*m,I.y1-=A[1]*m,I.x2+=A[2]*m,I.y2+=A[3]*m),w){const k=new Re(I.x1,I.y1),B=new Re(I.x2,I.y1),Z=new Re(I.x1,I.y2),X=new Re(I.x2,I.y2),ae=w*Math.PI/180;k._rotate(ae),B._rotate(ae),Z._rotate(ae),X._rotate(ae),I.x1=Math.min(k.x,B.x,Z.x,X.x),I.x2=Math.max(k.x,B.x,Z.x,X.x),I.y1=Math.min(k.y,B.y,Z.y,X.y),I.y2=Math.max(k.y,B.y,Z.y,X.y)}t.emplaceBack(r.x,r.y,I.x1,I.y1,I.x2,I.y2,s,l,d)}this.boxEndIndex=t.length}}class Km{constructor(t=[],r=(s,l)=>s<l?-1:s>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,l=r[t];for(;t>0;){const d=t-1>>1,p=r[d];if(s(l,p)>=0)break;r[t]=p,t=d}r[t]=l}_down(t){const{data:r,compare:s}=this,l=this.length>>1,d=r[t];for(;t<l;){let p=1+(t<<1);const m=p+1;if(m<this.length&&s(r[m],r[p])<0&&(p=m),s(r[p],d)>=0)break;r[t]=r[p],t=p}r[t]=d}}function Xm(n,t=1,r=!1){let s=1/0,l=1/0,d=-1/0,p=-1/0;const m=n[0];for(let A=0;A<m.length;A++){const k=m[A];(!A||k.x<s)&&(s=k.x),(!A||k.y<l)&&(l=k.y),(!A||k.x>d)&&(d=k.x),(!A||k.y>p)&&(p=k.y)}const _=Math.min(d-s,p-l);let v=_/2;const w=new Km([],Ym);if(_===0)return new Re(s,l);for(let A=s;A<d;A+=_)for(let k=l;k<p;k+=_)w.push(new wo(A+v,k+v,v,n));let S=function(A){let k=0,B=0,Z=0;const X=A[0];for(let ae=0,Q=X.length,E=Q-1;ae<Q;E=ae++){const V=X[ae],ee=X[E],ve=V.x*ee.y-ee.x*V.y;B+=(V.x+ee.x)*ve,Z+=(V.y+ee.y)*ve,k+=3*ve}return new wo(B/k,Z/k,0,A)}(n),I=w.length;for(;w.length;){const A=w.pop();(A.d>S.d||!S.d)&&(S=A,r&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,I)),A.max-S.d<=t||(v=A.h/2,w.push(new wo(A.p.x-v,A.p.y-v,v,n)),w.push(new wo(A.p.x+v,A.p.y-v,v,n)),w.push(new wo(A.p.x-v,A.p.y+v,v,n)),w.push(new wo(A.p.x+v,A.p.y+v,v,n)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${S.d}`)),S.p}function Ym(n,t){return t.max-n.max}function wo(n,t,r,s){this.p=new Re(n,t),this.h=r,this.d=function(l,d){let p=!1,m=1/0;for(let _=0;_<d.length;_++){const v=d[_];for(let w=0,S=v.length,I=S-1;w<S;I=w++){const A=v[w],k=v[I];A.y>l.y!=k.y>l.y&&l.x<(k.x-A.x)*(l.y-A.y)/(k.y-A.y)+A.x&&(p=!p),m=Math.min(m,Yu(l,A,k))}}return(p?1:-1)*Math.sqrt(m)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var ur;x.aB=void 0,(ur=x.aB||(x.aB={}))[ur.center=1]="center",ur[ur.left=2]="left",ur[ur.right=3]="right",ur[ur.top=4]="top",ur[ur.bottom=5]="bottom",ur[ur["top-left"]=6]="top-left",ur[ur["top-right"]=7]="top-right",ur[ur["bottom-left"]=8]="bottom-left",ur[ur["bottom-right"]=9]="bottom-right";const Gs=7,ou=Number.POSITIVE_INFINITY;function yp(n,t){return t[1]!==ou?function(r,s,l){let d=0,p=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-Gs;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+Gs}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,p]}(n,t[0],t[1]):function(r,s){let l=0,d=0;s<0&&(s=0);const p=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=p-Gs;break;case"bottom-right":case"bottom-left":d=-p+Gs;break;case"bottom":d=-s+Gs;break;case"top":d=s-Gs}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=s;break;case"right":l=-s}return[l,d]}(n,t[0])}function vp(n,t,r){var s;const l=n.layout,d=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(d){const m=d.values,_=[];for(let v=0;v<m.length;v+=2){const w=_[v]=m[v],S=m[v+1].map(I=>I*Oi);w.startsWith("top")?S[1]-=Gs:w.startsWith("bottom")&&(S[1]+=Gs),_[v+1]=S}return new Xi(_)}const p=l.get("text-variable-anchor");if(p){let m;m=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*Oi,ou]:l.get("text-offset").evaluate(t,{},r).map(v=>v*Oi);const _=[];for(const v of p)_.push(v,yp(v,m));return new Xi(_)}return null}function lu(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jm(n,t,r,s,l,d,p,m,_,v,w,S){let I=d.textMaxSize.evaluate(t,{});I===void 0&&(I=p);const A=n.layers[0].layout,k=A.get("icon-offset").evaluate(t,{},w),B=xp(r.horizontal),Z=p/24,X=n.tilePixelRatio*Z,ae=n.tilePixelRatio*I/24,Q=n.tilePixelRatio*m,E=n.tilePixelRatio*A.get("symbol-spacing"),V=A.get("text-padding")*n.tilePixelRatio,ee=function(ct,ot,it,kt=1){const _i=ct.get("icon-padding").evaluate(ot,{},it),ji=_i&&_i.values;return[ji[0]*kt,ji[1]*kt,ji[2]*kt,ji[3]*kt]}(A,t,w,n.tilePixelRatio),ve=A.get("text-max-angle")/180*Math.PI,je=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",we=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Ie=A.get("symbol-placement"),Ge=E/2,Ne=A.get("icon-text-fit");let $e;s&&Ne!=="none"&&(n.allowVerticalPlacement&&r.vertical&&($e=Ud(s,r.vertical,Ne,A.get("icon-text-fit-padding"),k,Z)),B&&(s=Ud(s,B,Ne,A.get("icon-text-fit-padding"),k,Z)));const ze=w?S.line.getGranularityForZoomLevel(w.z):1,Qe=(ct,ot)=>{ot.x<0||ot.x>=yt||ot.y<0||ot.y>=yt||function(it,kt,_i,ji,dr,tn,kr,er,di,$i,tr,ir,Sr,rn,qi,zr,Ni,Hi,Wi,zi,ri,In,To,En,tg){const So=it.addToLineVertexArray(kt,_i);let Ca,Co,Mo,Po,Cp=0,Mp=0,Pp=0,Ip=0,gu=-1,_u=-1;const vs={};let Ep=Mn("");if(it.allowVerticalPlacement&&ji.vertical){const br=er.layout.get("text-rotate").evaluate(ri,{},En)+90;Mo=new Gc(di,kt,$i,tr,ir,ji.vertical,Sr,rn,qi,br),kr&&(Po=new Gc(di,kt,$i,tr,ir,kr,Ni,Hi,qi,br))}if(dr){const br=er.layout.get("icon-rotate").evaluate(ri,{}),nn=er.layout.get("icon-text-fit")!=="none",Ma=gp(dr,br,To,nn),kn=kr?gp(kr,br,To,nn):void 0;Co=new Gc(di,kt,$i,tr,ir,dr,Ni,Hi,!1,br),Cp=4*Ma.length;const Pa=it.iconSizeData;let Qn=null;Pa.kind==="source"?(Qn=[Jn*er.layout.get("icon-size").evaluate(ri,{})],Qn[0]>Vs&&Zi(`${it.layerIds[0]}: Value for "icon-size" is >= ${El}. Reduce your "icon-size".`)):Pa.kind==="composite"&&(Qn=[Jn*In.compositeIconSizes[0].evaluate(ri,{},En),Jn*In.compositeIconSizes[1].evaluate(ri,{},En)],(Qn[0]>Vs||Qn[1]>Vs)&&Zi(`${it.layerIds[0]}: Value for "icon-size" is >= ${El}. Reduce your "icon-size".`)),it.addSymbols(it.icon,Ma,Qn,zi,Wi,ri,x.al.none,kt,So.lineStartIndex,So.lineLength,-1,En),gu=it.icon.placedSymbolArray.length-1,kn&&(Mp=4*kn.length,it.addSymbols(it.icon,kn,Qn,zi,Wi,ri,x.al.vertical,kt,So.lineStartIndex,So.lineLength,-1,En),_u=it.icon.placedSymbolArray.length-1)}const Ap=Object.keys(ji.horizontal);for(const br of Ap){const nn=ji.horizontal[br];if(!Ca){Ep=Mn(nn.text);const kn=er.layout.get("text-rotate").evaluate(ri,{},En);Ca=new Gc(di,kt,$i,tr,ir,nn,Sr,rn,qi,kn)}const Ma=nn.positionedLines.length===1;if(Pp+=bp(it,kt,nn,tn,er,qi,ri,zr,So,ji.vertical?x.al.horizontal:x.al.horizontalOnly,Ma?Ap:[br],vs,gu,In,En),Ma)break}ji.vertical&&(Ip+=bp(it,kt,ji.vertical,tn,er,qi,ri,zr,So,x.al.vertical,["vertical"],vs,_u,In,En));const ig=Ca?Ca.boxStartIndex:it.collisionBoxArray.length,rg=Ca?Ca.boxEndIndex:it.collisionBoxArray.length,ng=Mo?Mo.boxStartIndex:it.collisionBoxArray.length,sg=Mo?Mo.boxEndIndex:it.collisionBoxArray.length,ag=Co?Co.boxStartIndex:it.collisionBoxArray.length,og=Co?Co.boxEndIndex:it.collisionBoxArray.length,lg=Po?Po.boxStartIndex:it.collisionBoxArray.length,cg=Po?Po.boxEndIndex:it.collisionBoxArray.length;let An=-1;const qc=(br,nn)=>br&&br.circleDiameter?Math.max(br.circleDiameter,nn):nn;An=qc(Ca,An),An=qc(Mo,An),An=qc(Co,An),An=qc(Po,An);const kp=An>-1?1:0;kp&&(An*=tg/Oi),it.glyphOffsetArray.length>=bo.MAX_GLYPHS&&Zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ri.sortKey!==void 0&&it.addToSortKeyRanges(it.symbolInstances.length,ri.sortKey);const hg=vp(er,ri,En),[ug,dg]=function(br,nn){const Ma=br.length,kn=nn==null?void 0:nn.values;if((kn==null?void 0:kn.length)>0)for(let Pa=0;Pa<kn.length;Pa+=2){const Qn=kn[Pa+1];br.emplaceBack(x.aB[kn[Pa]],Qn[0],Qn[1])}return[Ma,br.length]}(it.textAnchorOffsets,hg);it.symbolInstances.emplaceBack(kt.x,kt.y,vs.right>=0?vs.right:-1,vs.center>=0?vs.center:-1,vs.left>=0?vs.left:-1,vs.vertical||-1,gu,_u,Ep,ig,rg,ng,sg,ag,og,lg,cg,$i,Pp,Ip,Cp,Mp,kp,0,Sr,An,ug,dg)}(n,ot,ct,r,s,l,$e,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,X,[V,V,V,V],je,_,Q,ee,we,k,t,d,v,w,p)};if(Ie==="line")for(const ct of hp(t.geometry,0,0,yt,yt)){const ot=Sa(ct,ze),it=Wm(ot,E,ve,r.vertical||B,s,24,ae,n.overscaling,yt);for(const kt of it)B&&Qm(n,B.text,Ge,kt)||Qe(ot,kt)}else if(Ie==="line-center"){for(const ct of t.geometry)if(ct.length>1){const ot=Sa(ct,ze),it=Hm(ot,ve,r.vertical||B,s,24,ae);it&&Qe(ot,it)}}else if(t.type==="Polygon")for(const ct of ja(t.geometry,0)){const ot=Xm(ct,16);Qe(Sa(ct[0],ze,!0),new Us(ot.x,ot.y,0))}else if(t.type==="LineString")for(const ct of t.geometry){const ot=Sa(ct,ze);Qe(ot,new Us(ot[0].x,ot[0].y,0))}else if(t.type==="Point")for(const ct of t.geometry)for(const ot of ct)Qe([ot],new Us(ot.x,ot.y,0))}function bp(n,t,r,s,l,d,p,m,_,v,w,S,I,A,k){const B=function(ae,Q,E,V,ee,ve,je,we){const Ie=V.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,Ge=[];for(const Ne of Q.positionedLines)for(const $e of Ne.positionedGlyphs){if(!$e.rect)continue;const ze=$e.rect||{};let Qe=Mm+1,ct=!0,ot=1,it=0;const kt=(ee||we)&&$e.vertical,_i=$e.metrics.advance*$e.scale/2;if(we&&Q.verticalizable&&(it=Ne.lineOffset/2-($e.imageName?-(Oi-$e.metrics.width*$e.scale)/2:($e.scale-1)*Oi)),$e.imageName){const Hi=je[$e.imageName];ct=Hi.sdf,ot=Hi.pixelRatio,Qe=Ar/ot}const ji=ee?[$e.x+_i,$e.y]:[0,0];let dr=ee?[0,0]:[$e.x+_i+E[0],$e.y+E[1]-it],tn=[0,0];kt&&(tn=dr,dr=[0,0]);const kr=$e.metrics.isDoubleResolution?2:1,er=($e.metrics.left-Qe)*$e.scale-_i+dr[0],di=(-$e.metrics.top-Qe)*$e.scale+dr[1],$i=er+ze.w/kr*$e.scale/ot,tr=di+ze.h/kr*$e.scale/ot,ir=new Re(er,di),Sr=new Re($i,di),rn=new Re(er,tr),qi=new Re($i,tr);if(kt){const Hi=new Re(-_i,_i-Bc),Wi=-Math.PI/2,zi=Oi/2-_i,ri=new Re(5-Bc-zi,-($e.imageName?zi:0)),In=new Re(...tn);ir._rotateAround(Wi,Hi)._add(ri)._add(In),Sr._rotateAround(Wi,Hi)._add(ri)._add(In),rn._rotateAround(Wi,Hi)._add(ri)._add(In),qi._rotateAround(Wi,Hi)._add(ri)._add(In)}if(Ie){const Hi=Math.sin(Ie),Wi=Math.cos(Ie),zi=[Wi,-Hi,Hi,Wi];ir._matMult(zi),Sr._matMult(zi),rn._matMult(zi),qi._matMult(zi)}const zr=new Re(0,0),Ni=new Re(0,0);Ge.push({tl:ir,tr:Sr,bl:rn,br:qi,tex:ze,writingMode:Q.writingMode,glyphOffset:ji,sectionIndex:$e.sectionIndex,isSDF:ct,pixelOffsetTL:zr,pixelOffsetBR:Ni,minFontScaleX:0,minFontScaleY:0})}return Ge}(0,r,m,l,d,p,s,n.allowVerticalPlacement),Z=n.textSizeData;let X=null;Z.kind==="source"?(X=[Jn*l.layout.get("text-size").evaluate(p,{})],X[0]>Vs&&Zi(`${n.layerIds[0]}: Value for "text-size" is >= ${El}. Reduce your "text-size".`)):Z.kind==="composite"&&(X=[Jn*A.compositeTextSizes[0].evaluate(p,{},k),Jn*A.compositeTextSizes[1].evaluate(p,{},k)],(X[0]>Vs||X[1]>Vs)&&Zi(`${n.layerIds[0]}: Value for "text-size" is >= ${El}. Reduce your "text-size".`)),n.addSymbols(n.text,B,X,m,d,p,v,t,_.lineStartIndex,_.lineLength,I,k);for(const ae of w)S[ae]=n.text.placedSymbolArray.length-1;return 4*B.length}function xp(n){for(const t in n)return n[t];return null}function Qm(n,t,r,s){const l=n.compareText;if(t in l){const d=l[t];for(let p=d.length-1;p>=0;p--)if(s.dist(d[p])<r)return!0}else l[t]=[];return l[t].push(s),!1}const wp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class cu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=wp[15&s];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(t,2,1),[m]=new Uint32Array(t,4,1);return new cu(m,p,d,t)}constructor(t,r=64,s=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=wp.indexOf(this.ArrayType),p=2*t*this.ArrayType.BYTES_PER_ELEMENT,m=t*this.IndexArrayType.BYTES_PER_ELEMENT,_=(8-m%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+_,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+p+m+_),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+_,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return hu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:m}=this,_=[0,d.length-1,0],v=[];for(;_.length;){const w=_.pop()||0,S=_.pop()||0,I=_.pop()||0;if(S-I<=m){for(let Z=I;Z<=S;Z++){const X=p[2*Z],ae=p[2*Z+1];X>=t&&X<=s&&ae>=r&&ae<=l&&v.push(d[Z])}continue}const A=I+S>>1,k=p[2*A],B=p[2*A+1];k>=t&&k<=s&&B>=r&&B<=l&&v.push(d[A]),(w===0?t<=k:r<=B)&&(_.push(I),_.push(A-1),_.push(1-w)),(w===0?s>=k:l>=B)&&(_.push(A+1),_.push(S),_.push(1-w))}return v}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:p}=this,m=[0,l.length-1,0],_=[],v=s*s;for(;m.length;){const w=m.pop()||0,S=m.pop()||0,I=m.pop()||0;if(S-I<=p){for(let Z=I;Z<=S;Z++)Sp(d[2*Z],d[2*Z+1],t,r)<=v&&_.push(l[Z]);continue}const A=I+S>>1,k=d[2*A],B=d[2*A+1];Sp(k,B,t,r)<=v&&_.push(l[A]),(w===0?t-s<=k:r-s<=B)&&(m.push(I),m.push(A-1),m.push(1-w)),(w===0?t+s>=k:r+s>=B)&&(m.push(A+1),m.push(S),m.push(1-w))}return _}}function hu(n,t,r,s,l,d){if(l-s<=r)return;const p=s+l>>1;Tp(n,t,p,s,l,d),hu(n,t,r,s,p-1,1-d),hu(n,t,r,p+1,l,1-d)}function Tp(n,t,r,s,l,d){for(;l>s;){if(l-s>600){const v=l-s+1,w=r-s+1,S=Math.log(v),I=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*I*(v-I)/v)*(w-v/2<0?-1:1);Tp(n,t,r,Math.max(s,Math.floor(r-w*I/v+A)),Math.min(l,Math.floor(r+(v-w)*I/v+A)),d)}const p=t[2*r+d];let m=s,_=l;for(zl(n,t,s,r),t[2*l+d]>p&&zl(n,t,s,l);m<_;){for(zl(n,t,m,_),m++,_--;t[2*m+d]<p;)m++;for(;t[2*_+d]>p;)_--}t[2*s+d]===p?zl(n,t,s,_):(_++,zl(n,t,_,l)),_<=r&&(s=_+1),r<=_&&(l=_-1)}}function zl(n,t,r,s){uu(n,r,s),uu(t,2*r,2*s),uu(t,2*r+1,2*s+1)}function uu(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}function Sp(n,t,r,s){const l=n-r,d=t-s;return l*l+d*d}var du;x.co=void 0,(du=x.co||(x.co={})).create="create",du.load="load",du.fullLoad="fullLoad";let $c=null,Ll=[];const pu=1e3/60,fu="loadTime",mu="fullLoadTime",eg={mark(n){performance.mark(n)},frame(n){const t=n;$c!=null&&Ll.push(t-$c),$c=t},clearMetrics(){$c=null,Ll=[],performance.clearMeasures(fu),performance.clearMeasures(mu);for(const n in x.co)performance.clearMarks(x.co[n])},getPerformanceMetrics(){performance.measure(fu,x.co.create,x.co.load),performance.measure(mu,x.co.create,x.co.fullLoad);const n=performance.getEntriesByName(fu)[0].duration,t=performance.getEntriesByName(mu)[0].duration,r=Ll.length,s=1/(Ll.reduce((d,p)=>d+p,0)/r/1e3),l=Ll.filter(d=>d>pu).reduce((d,p)=>d+(p-pu)/pu,0);return{loadTime:n,fullLoadTime:t,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};x.$=Al,x.A=ke,x.B=cn,x.C=ti,x.D=nt,x.E=oe,x.F=xh,x.G=function(n){if(an==null){const t=n.navigator?n.navigator.userAgent:null;an=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return an},x.H=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Gm(()=>this.process()),this.subscription=gn(this.target,"message",r=>this.receive(r),!1),this.globalScope=Dr(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((r,s)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=t?gn(t.signal,"abort",()=>{d==null||d.unsubscribe(),delete this.resolveRejects[l];const _={id:l,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},$m):null;this.resolveRejects[l]={resolve:_=>{d==null||d.unsubscribe(),r(_)},reject:_=>{d==null||d.unsubscribe(),s(_)}};const p=[],m=Object.assign(Object.assign({},n),{id:l,sourceMapId:this.mapId,origin:location.origin,data:Fs(n.data,p)});this.target.postMessage(m,{transfer:p})})}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Dr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const l=this.resolveRejects[n];return delete this.resolveRejects[n],l?void(t.error?l.reject(da(t.error)):l.resolve(da(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=da(t.data),s=new AbortController;this.abortControllers[n]=s;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(n,null,l)}catch(l){this.completeTask(n,l)}})}completeTask(n,t,r){const s=[];delete this.abortControllers[n];const l={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Fs(t):null,data:Fs(r,s)};this.target.postMessage(l,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.I=Xh,x.J=yn,x.K=function(){var n=new ke(16);return ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},x.L=function(n,t,r){var s,l,d,p,m,_,v,w,S,I,A,k,B=r[0],Z=r[1],X=r[2];return t===n?(n[12]=t[0]*B+t[4]*Z+t[8]*X+t[12],n[13]=t[1]*B+t[5]*Z+t[9]*X+t[13],n[14]=t[2]*B+t[6]*Z+t[10]*X+t[14],n[15]=t[3]*B+t[7]*Z+t[11]*X+t[15]):(l=t[1],d=t[2],p=t[3],m=t[4],_=t[5],v=t[6],w=t[7],S=t[8],I=t[9],A=t[10],k=t[11],n[0]=s=t[0],n[1]=l,n[2]=d,n[3]=p,n[4]=m,n[5]=_,n[6]=v,n[7]=w,n[8]=S,n[9]=I,n[10]=A,n[11]=k,n[12]=s*B+m*Z+S*X+t[12],n[13]=l*B+_*Z+I*X+t[13],n[14]=d*B+v*Z+A*X+t[14],n[15]=p*B+w*Z+k*X+t[15]),n},x.M=function(n,t,r){var s=r[0],l=r[1],d=r[2];return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n[3]=t[3]*s,n[4]=t[4]*l,n[5]=t[5]*l,n[6]=t[6]*l,n[7]=t[7]*l,n[8]=t[8]*d,n[9]=t[9]*d,n[10]=t[10]*d,n[11]=t[11]*d,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},x.N=function(n,t,r){var s=t[0],l=t[1],d=t[2],p=t[3],m=t[4],_=t[5],v=t[6],w=t[7],S=t[8],I=t[9],A=t[10],k=t[11],B=t[12],Z=t[13],X=t[14],ae=t[15],Q=r[0],E=r[1],V=r[2],ee=r[3];return n[0]=Q*s+E*m+V*S+ee*B,n[1]=Q*l+E*_+V*I+ee*Z,n[2]=Q*d+E*v+V*A+ee*X,n[3]=Q*p+E*w+V*k+ee*ae,n[4]=(Q=r[4])*s+(E=r[5])*m+(V=r[6])*S+(ee=r[7])*B,n[5]=Q*l+E*_+V*I+ee*Z,n[6]=Q*d+E*v+V*A+ee*X,n[7]=Q*p+E*w+V*k+ee*ae,n[8]=(Q=r[8])*s+(E=r[9])*m+(V=r[10])*S+(ee=r[11])*B,n[9]=Q*l+E*_+V*I+ee*Z,n[10]=Q*d+E*v+V*A+ee*X,n[11]=Q*p+E*w+V*k+ee*ae,n[12]=(Q=r[12])*s+(E=r[13])*m+(V=r[14])*S+(ee=r[15])*B,n[13]=Q*l+E*_+V*I+ee*Z,n[14]=Q*d+E*v+V*A+ee*X,n[15]=Q*p+E*w+V*k+ee*ae,n},x.O=function(n,t){const r={};for(let s=0;s<t.length;s++){const l=t[s];l in n&&(r[l]=n[l])}return r},x.P=Re,x.Q=Zs,x.R=Qr,x.S=Qd,x.T=Tc,x.U=Jd,x.V=Tt,x.W=Ce,x.X=ts,x.Y=en,x.Z=yt,x._=c,x.a=Fr,x.a$=function(n,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[4],p=t[5],m=t[6],_=t[7],v=t[8],w=t[9],S=t[10],I=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=d*l+v*s,n[5]=p*l+w*s,n[6]=m*l+S*s,n[7]=_*l+I*s,n[8]=v*l-d*s,n[9]=w*l-p*s,n[10]=S*l-m*s,n[11]=I*l-_*s,n},x.a0=25,x.a1=au,x.a2=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of n){const l=window.document.createElement("source");ue(s)||(t.crossOrigin="Anonymous"),l.src=s,t.appendChild(l)}})},x.a3=Me,x.a4=function(){return ni++},x.a5=K,x.a6=bo,x.a7=la,x.a8=xa,x.a9=ap,x.aA=function(n,t,r,s,l=!1){if(!r[0]&&!r[1])return[0,0];const d=l?s==="map"?-n.bearingInRadians:0:s==="viewport"?n.bearingInRadians:0;if(d){const p=Math.sin(d),m=Math.cos(d);r=[r[0]*m-r[1]*p,r[0]*p+r[1]*m]}return[l?r[0]:xr(t,r[0],n.zoom),l?r[1]:xr(t,r[1],n.zoom)]},x.aC=Qh,x.aD=lu,x.aE=Jh,x.aF=cu,x.aG=li,x.aH=Lc,x.aI=Pe,x.aJ=Ut,x.aK=Zt,x.aL=fr,x.aM=Hr,x.aN=tp,x.aO=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n},x.aP=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n},x.aQ=function(n){var t=new ke(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},x.aR=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},x.aS=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},x.aT=function(n,t){var r=t[0],s=t[1],l=t[2],d=r*r+s*s+l*l;return d>0&&(d=1/Math.sqrt(d)),n[0]=t[0]*d,n[1]=t[1]*d,n[2]=t[2]*d,n},x.aU=function(n,t,r){var s=t[0],l=t[1],d=t[2],p=r[0],m=r[1],_=r[2];return n[0]=l*_-d*m,n[1]=d*p-s*_,n[2]=s*m-l*p,n},x.aV=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},x.aW=rp,x.aX=xo,x.aY=function(n,t,r,s,l){var d,p=1/Math.tan(t/2);return n[0]=p/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0?(n[10]=(l+s)*(d=1/(s-l)),n[14]=2*l*s*d):(n[10]=-1,n[14]=-2*s),n},x.aZ=function(n){var t=new ke(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},x.a_=function(n,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[0],p=t[1],m=t[2],_=t[3],v=t[4],w=t[5],S=t[6],I=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*l+v*s,n[1]=p*l+w*s,n[2]=m*l+S*s,n[3]=_*l+I*s,n[4]=v*l-d*s,n[5]=w*l-p*s,n[6]=S*l-m*s,n[7]=I*l-_*s,n},x.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,d)=>{const p=l||d;return t[s]=!p||p.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},x.ab=_n,x.ac=function(n){return Math.pow(2,n)},x.ad=ge,x.ae=xt,x.af=85.051129,x.ag=ep,x.ah=function(n){return Math.log(n)/Math.LN2},x.ai=function(n){var t=n[0],r=n[1];return t*t+r*r},x.aj=function(n,t){const r=[];for(const s in n)s in t||r.push(s);return r},x.ak=function(n,t){let r=0,s=0;if(n.kind==="constant")s=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:p}=n,m=l?xt(cr.interpolationFactor(l,t,d,p),0,1):0;n.kind==="camera"?s=cn.number(n.minSize,n.maxSize,m):r=m}return{uSizeT:r,uSize:s}},x.am=function(n,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:l}){return n.kind==="source"?s/Jn:n.kind==="composite"?cn.number(s/Jn,l/Jn,r):t},x.an=function(n,t){var r=t[0],s=t[1],l=t[2],d=t[3],p=t[4],m=t[5],_=t[6],v=t[7],w=t[8],S=t[9],I=t[10],A=t[11],k=t[12],B=t[13],Z=t[14],X=t[15],ae=r*m-s*p,Q=r*_-l*p,E=r*v-d*p,V=s*_-l*m,ee=s*v-d*m,ve=l*v-d*_,je=w*B-S*k,we=w*Z-I*k,Ie=w*X-A*k,Ge=S*Z-I*B,Ne=S*X-A*B,$e=I*X-A*Z,ze=ae*$e-Q*Ne+E*Ge+V*Ie-ee*we+ve*je;return ze?(n[0]=(m*$e-_*Ne+v*Ge)*(ze=1/ze),n[1]=(l*Ne-s*$e-d*Ge)*ze,n[2]=(B*ve-Z*ee+X*V)*ze,n[3]=(I*ee-S*ve-A*V)*ze,n[4]=(_*Ie-p*$e-v*we)*ze,n[5]=(r*$e-l*Ie+d*we)*ze,n[6]=(Z*E-k*ve-X*Q)*ze,n[7]=(w*ve-I*E+A*Q)*ze,n[8]=(p*Ne-m*Ie+v*je)*ze,n[9]=(s*Ie-r*Ne-d*je)*ze,n[10]=(k*ee-B*E+X*ae)*ze,n[11]=(S*E-w*ee-A*ae)*ze,n[12]=(m*we-p*Ge-_*je)*ze,n[13]=(r*Ge-s*we+l*je)*ze,n[14]=(B*Q-k*V-Z*ae)*ze,n[15]=(w*V-S*Q+I*ae)*ze,n):null},x.ao=Ht,x.ap=function(n){return Math.hypot(n[0],n[1])},x.aq=function(n){return n[0]=0,n[1]=0,n},x.ar=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},x.as=eu,x.at=St,x.au=function(n,t,r,s){const l=t.y-n.y,d=t.x-n.x,p=s.y-r.y,m=s.x-r.x,_=p*d-m*l;if(_===0)return null;const v=(m*(n.y-r.y)-p*(n.x-r.x))/_;return new Re(n.x+v*d,n.y+v*l)},x.av=hp,x.aw=Ku,x.ax=function(n){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of n)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return[t,r,s,l]},x.ay=Oi,x.az=xr,x.b=Tr,x.b$=class extends R{},x.b0=function(){const n=new Float32Array(16);return ge(n),n},x.b1=function(){const n=new Float64Array(16);return ge(n),n},x.b2=function(){return new Float64Array(16)},x.b3=function(n,t,r){const s=new Float64Array(4);return function(l,d,p,m){var _=.5*Math.PI/180;d*=_,p*=_,m*=_;var v=Math.sin(d),w=Math.cos(d),S=Math.sin(p),I=Math.cos(p),A=Math.sin(m),k=Math.cos(m);l[0]=v*I*k-w*S*A,l[1]=w*S*k+v*I*A,l[2]=w*I*A-v*S*k,l[3]=w*I*k+v*S*A}(s,n,t-90,r),s},x.b4=function(n,t,r,s){var l,d,p,m,_,v=t[0],w=t[1],S=t[2],I=t[3],A=r[0],k=r[1],B=r[2],Z=r[3];return(d=v*A+w*k+S*B+I*Z)<0&&(d=-d,A=-A,k=-k,B=-B,Z=-Z),1-d>be?(l=Math.acos(d),p=Math.sin(l),m=Math.sin((1-s)*l)/p,_=Math.sin(s*l)/p):(m=1-s,_=s),n[0]=m*v+_*A,n[1]=m*w+_*k,n[2]=m*S+_*B,n[3]=m*I+_*Z,n},x.b5=function(n){const t=new Float64Array(9);var r,s,l,d,p,m,_,v,w,S,I,A,k,B,Z,X,ae,Q;S=(l=(s=n)[0])*(_=l+l),I=(d=s[1])*_,k=(p=s[2])*_,B=p*(v=d+d),X=(m=s[3])*_,ae=m*v,Q=m*(w=p+p),(r=t)[0]=1-(A=d*v)-(Z=p*w),r[3]=I-Q,r[6]=k+ae,r[1]=I+Q,r[4]=1-S-Z,r[7]=B-X,r[2]=k-ae,r[5]=B+X,r[8]=1-S-A;const E=Hr(-Math.asin(xt(t[2],-1,1)));let V,ee;return Math.hypot(t[5],t[8])<.001?(V=0,ee=-Hr(Math.atan2(t[3],t[4]))):(V=Hr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ee=Hr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:V,pitch:E+90,bearing:ee}},x.b6=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},x.b7=Pt,x.b8=fo,x.b9=yo,x.bA=function(n){if(n.type==="custom")return new Um(n);switch(n.type){case"background":return new Nm(n);case"circle":return new Df(n);case"fill":return new em(n);case"fill-extrusion":return new lm(n);case"heatmap":return new Ff(n);case"hillshade":return new jf(n);case"line":return new gm(n);case"raster":return new Zm(n);case"symbol":return new Nc(n)}},x.bB=nr,x.bC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!fe(n.version,t.version))return[{command:"setStyle",args:[t]}];fe(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),fe(n.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),fe(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),fe(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),fe(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),fe(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),fe(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),fe(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),fe(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),fe(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),fe(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),fe(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),fe(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),fe(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},l=[];(function(p,m,_,v){let w;for(w in m=m||{},p=p||{})Object.prototype.hasOwnProperty.call(p,w)&&(Object.prototype.hasOwnProperty.call(m,w)||De(w,_,v));for(w in m)Object.prototype.hasOwnProperty.call(m,w)&&(Object.prototype.hasOwnProperty.call(p,w)?fe(p[w],m[w])||(p[w].type==="geojson"&&m[w].type==="geojson"&&Xe(p,m,w)?xe(_,{command:"setGeoJSONSourceData",args:[w,m[w].data]}):qe(w,m,_,v)):pe(w,m,_))})(n.sources,t.sources,l,s);const d=[];n.layers&&n.layers.forEach(p=>{"source"in p&&s[p.source]?r.push({command:"removeLayer",args:[p.id]}):d.push(p)}),r=r.concat(l),function(p,m,_){m=m||[];const v=(p=p||[]).map(gt),w=m.map(gt),S=p.reduce(pt,{}),I=m.reduce(pt,{}),A=v.slice(),k=Object.create(null);let B,Z,X,ae,Q;for(let E=0,V=0;E<v.length;E++)B=v[E],Object.prototype.hasOwnProperty.call(I,B)?V++:(xe(_,{command:"removeLayer",args:[B]}),A.splice(A.indexOf(B,V),1));for(let E=0,V=0;E<w.length;E++)B=w[w.length-1-E],A[A.length-1-E]!==B&&(Object.prototype.hasOwnProperty.call(S,B)?(xe(_,{command:"removeLayer",args:[B]}),A.splice(A.lastIndexOf(B,A.length-V),1)):V++,ae=A[A.length-E],xe(_,{command:"addLayer",args:[I[B],ae]}),A.splice(A.length-E,0,B),k[B]=!0);for(let E=0;E<w.length;E++)if(B=w[E],Z=S[B],X=I[B],!k[B]&&!fe(Z,X))if(fe(Z.source,X.source)&&fe(Z["source-layer"],X["source-layer"])&&fe(Z.type,X.type)){for(Q in at(Z.layout,X.layout,_,B,null,"setLayoutProperty"),at(Z.paint,X.paint,_,B,null,"setPaintProperty"),fe(Z.filter,X.filter)||xe(_,{command:"setFilter",args:[B,X.filter]}),fe(Z.minzoom,X.minzoom)&&fe(Z.maxzoom,X.maxzoom)||xe(_,{command:"setLayerZoomRange",args:[B,X.minzoom,X.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,Q)&&Q!=="layout"&&Q!=="paint"&&Q!=="filter"&&Q!=="metadata"&&Q!=="minzoom"&&Q!=="maxzoom"&&(Q.indexOf("paint.")===0?at(Z[Q],X[Q],_,B,Q.slice(6),"setPaintProperty"):fe(Z[Q],X[Q])||xe(_,{command:"setLayerProperty",args:[B,Q,X[Q]]}));for(Q in X)Object.prototype.hasOwnProperty.call(X,Q)&&!Object.prototype.hasOwnProperty.call(Z,Q)&&Q!=="layout"&&Q!=="paint"&&Q!=="filter"&&Q!=="metadata"&&Q!=="minzoom"&&Q!=="maxzoom"&&(Q.indexOf("paint.")===0?at(Z[Q],X[Q],_,B,Q.slice(6),"setPaintProperty"):fe(Z[Q],X[Q])||xe(_,{command:"setLayerProperty",args:[B,Q,X[Q]]}))}else xe(_,{command:"removeLayer",args:[B]}),ae=A[A.lastIndexOf(B)+1],xe(_,{command:"addLayer",args:[X,ae]})}(d,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},x.bD=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},x.bE=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!n(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!n(t[s],r[s]))return!1;return!0}return t===r},x.bF=rr,x.bG=qr,x.bH=class extends ii{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},x.bI=Ic,x.bJ=class extends ii{constructor(n,t){super(n,t),this.current=Ph}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},x.bK=Pc,x.bL=class extends ii{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},x.bM=class extends ii{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},x.bN=he,x.bO=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=r,n[2]=0,n[3]=-r,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},x.bP=function(n,t,r){var s=t[0],l=t[1],d=t[2];return n[0]=s*r[0]+l*r[3]+d*r[6],n[1]=s*r[1]+l*r[4]+d*r[7],n[2]=s*r[2]+l*r[5]+d*r[8],n},x.bQ=function(n,t,r,s,l,d,p){var m=1/(t-r),_=1/(s-l),v=1/(d-p);return n[0]=-2*m,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*v,n[11]=0,n[12]=(t+r)*m,n[13]=(l+s)*_,n[14]=(p+d)*v,n[15]=1,n},x.bR=class extends ii{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)t[4*r]=n[r].r,t[4*r+1]=n[r].g,t[4*r+2]=n[r].b,t[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,t)}}},x.bS=class extends ii{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},x.bT=class extends u{},x.bU=bm,x.bV=class extends g{},x.bW=Rh,x.bX=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},x.bY=sd,x.bZ=function(n,t,r){var s=t[0],l=t[1],d=t[2],p=r[3]*s+r[7]*l+r[11]*d+r[15];return n[0]=(r[0]*s+r[4]*l+r[8]*d+r[12])/(p=p||1),n[1]=(r[1]*s+r[5]*l+r[9]*d+r[13])/p,n[2]=(r[2]*s+r[6]*l+r[10]*d+r[14])/p,n},x.b_=class extends gs{},x.ba=wl,x.bb=_o,x.bc=$r,x.bd=Vi,x.be=Yi,x.bf=function(n,t,r,s,l){return $r(s,l,xt((n-t)/(r-t),0,1))},x.bg=wr,x.bh=function(){return new Float64Array(3)},x.bi=function(n,t,r,s){return n[0]=t[0]+r[0]*s,n[1]=t[1]+r[1]*s,n[2]=t[2]+r[2]*s,n},x.bj=ut,x.bk=function(){return new Float64Array(4)},x.bl=function(n,t,r,s){var l=[],d=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],d[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),d[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),d[2]=l[2],n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},x.bm=function(n,t,r,s){var l=[],d=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],d[0]=l[0],d[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),d[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},x.bn=function(n,t,r,s){var l=[],d=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],d[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),d[1]=l[1],d[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},x.bo=Oe,x.bp=function(n,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[0],p=t[1],m=t[2],_=t[3],v=t[8],w=t[9],S=t[10],I=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*l-v*s,n[1]=p*l-w*s,n[2]=m*l-S*s,n[3]=_*l-I*s,n[8]=d*s+v*l,n[9]=p*s+w*l,n[10]=m*s+S*l,n[11]=_*s+I*l,n},x.bq=function(n,t){const r=wr(n,360),s=wr(t,360),l=s-r,d=s>r?l-360:l+360;return Math.abs(l)<Math.abs(d)?l:d},x.br=function(n){return n[0]=0,n[1]=0,n[2]=0,n},x.bs=function(n,t,r,s){const l=Math.sqrt(n*n+t*t),d=Math.sqrt(r*r+s*s);n/=l,t/=l,r/=d,s/=d;const p=Math.acos(n*r+t*s);return-t*r+n*s>0?p:-p},x.bt=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},x.bu=nu,x.bv=function(n,t){const r=wr(n,2*Math.PI),s=wr(t,2*Math.PI);return Math.min(Math.abs(r-s),Math.abs(r-s+2*Math.PI),Math.abs(r-s-2*Math.PI))},x.bw=function(){const n={},t=U.$version;for(const r in U.$root){const s=U.$root[r];if(s.required){let l=null;l=r==="version"?t:s.type==="array"?[]:{},l!=null&&(n[r]=l)}}return n},x.bx=nl,x.by=sr,x.bz=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=ce(n[r],t[n[r].ref]));return n},x.c=Cr,x.c0=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},x.c1=function(n,t){var r=n[0],s=n[1],l=n[2],d=n[3],p=n[4],m=n[5],_=n[6],v=n[7],w=n[8],S=n[9],I=n[10],A=n[11],k=n[12],B=n[13],Z=n[14],X=n[15],ae=t[0],Q=t[1],E=t[2],V=t[3],ee=t[4],ve=t[5],je=t[6],we=t[7],Ie=t[8],Ge=t[9],Ne=t[10],$e=t[11],ze=t[12],Qe=t[13],ct=t[14],ot=t[15];return Math.abs(r-ae)<=be*Math.max(1,Math.abs(r),Math.abs(ae))&&Math.abs(s-Q)<=be*Math.max(1,Math.abs(s),Math.abs(Q))&&Math.abs(l-E)<=be*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(d-V)<=be*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(p-ee)<=be*Math.max(1,Math.abs(p),Math.abs(ee))&&Math.abs(m-ve)<=be*Math.max(1,Math.abs(m),Math.abs(ve))&&Math.abs(_-je)<=be*Math.max(1,Math.abs(_),Math.abs(je))&&Math.abs(v-we)<=be*Math.max(1,Math.abs(v),Math.abs(we))&&Math.abs(w-Ie)<=be*Math.max(1,Math.abs(w),Math.abs(Ie))&&Math.abs(S-Ge)<=be*Math.max(1,Math.abs(S),Math.abs(Ge))&&Math.abs(I-Ne)<=be*Math.max(1,Math.abs(I),Math.abs(Ne))&&Math.abs(A-$e)<=be*Math.max(1,Math.abs(A),Math.abs($e))&&Math.abs(k-ze)<=be*Math.max(1,Math.abs(k),Math.abs(ze))&&Math.abs(B-Qe)<=be*Math.max(1,Math.abs(B),Math.abs(Qe))&&Math.abs(Z-ct)<=be*Math.max(1,Math.abs(Z),Math.abs(ct))&&Math.abs(X-ot)<=be*Math.max(1,Math.abs(X),Math.abs(ot))},x.c2=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},x.c3=n=>n.type==="symbol",x.c4=n=>n.type==="circle",x.c5=n=>n.type==="heatmap",x.c6=n=>n.type==="line",x.c7=n=>n.type==="fill",x.c8=n=>n.type==="fill-extrusion",x.c9=n=>n.type==="hillshade",x.cA=jh,x.cB=Gh,x.cC=Sl,x.cD=Wh,x.cE=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},x.cF=function(n,t,r,s,l){return c(this,void 0,void 0,function*(){if(Ce())try{return yield ts(n,t,r,s,l)}catch{}return function(d,p,m,_,v){const w=d.width,S=d.height;mr&&Br||(mr=new OffscreenCanvas(w,S),Br=mr.getContext("2d",{willReadFrequently:!0})),mr.width=w,mr.height=S,Br.drawImage(d,0,0,w,S);const I=Br.getImageData(p,m,_,v);return Br.clearRect(0,0,w,S),I.data}(n,t,r,s,l)})},x.cG=np,x.cH=me,x.cI=He,x.cJ=wd,x.cK=Rd,x.cL=Ja,x.cM=Cn,x.ca=n=>n.type==="raster",x.cb=n=>n.type==="background",x.cc=n=>n.type==="custom",x.cd=mn,x.ce=function(n,t,r){const s=Ti(t.x-r.x,t.y-r.y),l=Ti(n.x-r.x,n.y-r.y);var d,p;return Hr(Math.atan2(s[0]*l[1]-s[1]*l[0],(d=s)[0]*(p=l)[0]+d[1]*p[1]))},x.cf=pr,x.cg=function(n,t){return Rn[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},x.ch=function(n,t){return Ln[t]&&"touches"in n},x.ci=function(n){return Ln[n]||Rn[n]},x.cj=function(n,t,r){var s=t[0],l=t[1];return n[0]=r[0]*s+r[4]*l+r[12],n[1]=r[1]*s+r[5]*l+r[13],n},x.ck=function(n,t){const{x:r,y:s}=Al.fromLngLat(t);return!(n<0||n>25||s<0||s>=1||r<0||r>=1)},x.cl=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},x.cm=class extends _a{},x.cn=eg,x.cp=function(n){return n.message===Wr},x.cq=gr,x.cr=function(n,t){Fr.REGISTERED_PROTOCOLS[n]=t},x.cs=function(n){delete Fr.REGISTERED_PROTOCOLS[n]},x.ct=function(n,t){const r={};for(let l=0;l<n.length;l++){const d=t&&t[n[l].id]||dc(n[l]);t&&(t[n[l].id]=d);let p=r[d];p||(p=r[d]=[]),p.push(n[l])}const s=[];for(const l in r)s.push(r[l]);return s},x.cu=Je,x.cv=sp,x.cw=op,x.cx=Bd,x.cy=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=yt/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new ti(n.bucket.zoom+1),n.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new ti(n.bucket.zoom+1),n.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new ti(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:v,maxZoom:w}=n.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new ti(v),n.canonical),s["text-size"].possiblyEvaluate(new ti(w),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:v,maxZoom:w}=n.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new ti(v),n.canonical),s["icon-size"].possiblyEvaluate(new ti(w),n.canonical)]}const d=r.get("text-line-height")*Oi,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",m=r.get("text-keep-upright"),_=r.get("text-size");for(const v of n.bucket.features){const w=r.get("text-font").evaluate(v,{},n.canonical).join(","),S=_.evaluate(v,{},n.canonical),I=l.layoutTextSize.evaluate(v,{},n.canonical),A=l.layoutIconSize.evaluate(v,{},n.canonical),k={horizontal:{},vertical:void 0},B=v.text;let Z,X=[0,0];if(B){const E=B.toString(),V=r.get("text-letter-spacing").evaluate(v,{},n.canonical)*Oi,ee=wh(E)?V:0,ve=r.get("text-anchor").evaluate(v,{},n.canonical),je=vp(t,v,n.canonical);if(!je){const Ne=r.get("text-radial-offset").evaluate(v,{},n.canonical);X=Ne?yp(ve,[Ne*Oi,ou]):r.get("text-offset").evaluate(v,{},n.canonical).map($e=>$e*Oi)}let we=p?"center":r.get("text-justify").evaluate(v,{},n.canonical);const Ie=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(v,{},n.canonical)*Oi:1/0,Ge=()=>{n.bucket.allowVerticalPlacement&&co(E)&&(k.vertical=Fc(B,n.glyphMap,n.glyphPositions,n.imagePositions,w,Ie,d,ve,"left",ee,X,x.al.vertical,!0,I,S))};if(!p&&je){const Ne=new Set;if(we==="auto")for(let ze=0;ze<je.values.length;ze+=2)Ne.add(lu(je.values[ze]));else Ne.add(we);let $e=!1;for(const ze of Ne)if(!k.horizontal[ze])if($e)k.horizontal[ze]=k.horizontal[0];else{const Qe=Fc(B,n.glyphMap,n.glyphPositions,n.imagePositions,w,Ie,d,"center",ze,ee,X,x.al.horizontal,!1,I,S);Qe&&(k.horizontal[ze]=Qe,$e=Qe.positionedLines.length===1)}Ge()}else{we==="auto"&&(we=lu(ve));const Ne=Fc(B,n.glyphMap,n.glyphPositions,n.imagePositions,w,Ie,d,ve,we,ee,X,x.al.horizontal,!1,I,S);Ne&&(k.horizontal[we]=Ne),Ge(),co(E)&&p&&m&&(k.vertical=Fc(B,n.glyphMap,n.glyphPositions,n.imagePositions,w,Ie,d,ve,we,ee,X,x.al.vertical,!1,I,S))}}let ae=!1;if(v.icon&&v.icon.name){const E=n.imageMap[v.icon.name];E&&(Z=Dm(n.imagePositions[v.icon.name],r.get("icon-offset").evaluate(v,{},n.canonical),r.get("icon-anchor").evaluate(v,{},n.canonical)),ae=!!E.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ae:n.bucket.sdfIcons!==ae&&Zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(E.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const Q=xp(k.horizontal)||k.vertical;n.bucket.iconsInText=!!Q&&Q.iconsInText,(Q||Z)&&Jm(n.bucket,v,k,Z,n.imageMap,l,I,A,X,ae,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},x.cz=$h,x.d=ue,x.e=Bt,x.f=n=>c(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.g=Li,x.h=n=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=es})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(n)],{type:"image/png"});s.src=n.byteLength?URL.createObjectURL(l):es}),x.i=Dr,x.j=(n,t)=>Mr(Bt(n,{type:"json"}),t),x.k=Y,x.l=G,x.m=Mr,x.n=(n,t)=>Mr(Bt(n,{type:"arrayBuffer"}),t),x.o=function(n){return new Wh(n).readFields(Tm,[])},x.p=Dd,x.q=_l,x.r=Ei,x.s=gn,x.t=so,x.u=At,x.v=U,x.w=Zi,x.x=rl,x.y=Ds,x.z=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}}}),L("worker",["./shared"],function(x){class c{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,j){for(const Y of F){this._layerConfigs[Y.id]=Y;const oe=this._layers[Y.id]=x.bA(Y);oe._featureFilter=x.a7(oe.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of j)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const G=x.ct(Object.values(this._layerConfigs),this.keyCache);for(const Y of G){const oe=Y.map(pe=>this._layers[pe.id]),U=oe[0];if(U.visibility==="none")continue;const ye=U.source||"";let ce=this.familiesBySource[ye];ce||(ce=this.familiesBySource[ye]={});const fe=U.sourceLayer||"_geojsonTileLayer";let xe=ce[fe];xe||(xe=ce[fe]=[]),xe.push(oe)}}}class me{constructor(F){const j={},G=[];for(const ye in F){const ce=F[ye],fe=j[ye]={};for(const xe in ce){const pe=ce[+xe];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const De={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};G.push(De),fe[xe]={rect:De,metrics:pe.metrics}}}const{w:Y,h:oe}=x.p(G),U=new x.q({width:Y||1,height:oe||1});for(const ye in F){const ce=F[ye];for(const fe in ce){const xe=ce[+fe];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const pe=j[ye][fe].rect;x.q.copy(xe.bitmap,U,{x:0,y:0},{x:pe.x+1,y:pe.y+1},xe.bitmap)}}this.image=U,this.positions=j}}x.cu("GlyphAtlas",me);class Ze{constructor(F){this.tileID=new x.Y(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,j,G,Y,oe){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new x.a5;const U=new x.cv(Object.keys(F.layers).sort()),ye=new x.cw(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const ce={},fe={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G,subdivisionGranularity:oe},xe=j.familiesBySource[this.source];for(const dt in xe){const Be=F.layers[dt];if(!Be)continue;Be.version===1&&x.w(`Vector tile source "${this.source}" layer "${dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const lt=U.encode(dt),_t=[];for(let si=0;si<Be.length;si++){const Vt=Be.feature(si),ar=ye.getId(Vt,dt);_t.push({feature:Vt,id:ar,index:si,sourceLayerIndex:lt})}for(const si of xe[dt]){const Vt=si[0];Vt.source!==this.source&&x.w(`layer.source = ${Vt.source} does not equal this.source = ${this.source}`),Vt.minzoom&&this.zoom<Math.floor(Vt.minzoom)||Vt.maxzoom&&this.zoom>=Vt.maxzoom||Vt.visibility!=="none"&&(Ue(si,this.zoom,G),(ce[Vt.id]=Vt.createBucket({index:ye.bucketLayerIDs.length,layers:si,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:lt,sourceID:this.source})).populate(_t,fe,this.tileID.canonical),ye.bucketLayerIDs.push(si.map(ar=>ar.id)))}}const pe=x.bF(fe.glyphDependencies,dt=>Object.keys(dt).map(Number));this.inFlightDependencies.forEach(dt=>dt==null?void 0:dt.abort()),this.inFlightDependencies=[];let De=Promise.resolve({});if(Object.keys(pe).length){const dt=new AbortController;this.inFlightDependencies.push(dt),De=Y.sendAsync({type:"GG",data:{stacks:pe,source:this.source,tileID:this.tileID,type:"glyphs"}},dt)}const qe=Object.keys(fe.iconDependencies);let Xe=Promise.resolve({});if(qe.length){const dt=new AbortController;this.inFlightDependencies.push(dt),Xe=Y.sendAsync({type:"GI",data:{icons:qe,source:this.source,tileID:this.tileID,type:"icons"}},dt)}const at=Object.keys(fe.patternDependencies);let gt=Promise.resolve({});if(at.length){const dt=new AbortController;this.inFlightDependencies.push(dt),gt=Y.sendAsync({type:"GI",data:{icons:at,source:this.source,tileID:this.tileID,type:"patterns"}},dt)}const[pt,Me,Ft]=yield Promise.all([De,Xe,gt]),Ct=new me(pt),Mt=new x.cx(Me,Ft);for(const dt in ce){const Be=ce[dt];Be instanceof x.a6?(Ue(Be.layers,this.zoom,G),x.cy({bucket:Be,glyphMap:pt,glyphPositions:Ct.positions,imageMap:Me,imagePositions:Mt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:fe.subdivisionGranularity})):Be.hasPattern&&(Be instanceof x.cz||Be instanceof x.cA||Be instanceof x.cB)&&(Ue(Be.layers,this.zoom,G),Be.addFeatures(fe,this.tileID.canonical,Mt.patternPositions))}return this.status="done",{buckets:Object.values(ce).filter(dt=>!dt.isEmpty()),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ct.image,imageAtlas:Mt,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?Me:null,glyphPositions:this.returnDependencies?Ct.positions:null}})}}function Ue(ue,F,j){const G=new x.C(F);for(const Y of ue)Y.recalculate(G,j)}class He{constructor(F,j,G){this.actor=F,this.layerIndex=j,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,j){return x._(this,void 0,void 0,function*(){const G=yield x.n(F.request,j);try{return{vectorTile:new x.cC.VectorTile(new x.cD(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch(Y){const oe=new Uint8Array(G.data);let U=`Unable to parse the tile at ${F.request.url}, `;throw U+=oe[0]===31&&oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.message}`,new Error(U)}})}loadTile(F){return x._(this,void 0,void 0,function*(){const j=F.uid,G=!!(F&&F.request&&F.request.collectResourceTiming)&&new x.cE(F.request),Y=new Ze(F);this.loading[j]=Y;const oe=new AbortController;Y.abort=oe;try{const U=yield this.loadVectorTile(F,oe);if(delete this.loading[j],!U)return null;const ye=U.rawData,ce={};U.expires&&(ce.expires=U.expires),U.cacheControl&&(ce.cacheControl=U.cacheControl);const fe={};if(G){const pe=G.finish();pe&&(fe.resourceTiming=JSON.parse(JSON.stringify(pe)))}Y.vectorTile=U.vectorTile;const xe=Y.parse(U.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);this.loaded[j]=Y,this.fetching[j]={rawTileData:ye,cacheControl:ce,resourceTiming:fe};try{const pe=yield xe;return x.e({rawTileData:ye.slice(0)},pe,ce,fe)}finally{delete this.fetching[j]}}catch(U){throw delete this.loading[j],Y.status="done",this.loaded[j]=Y,U}})}reloadTile(F){return x._(this,void 0,void 0,function*(){const j=F.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const G=this.loaded[j];if(G.showCollisionBoxes=F.showCollisionBoxes,G.status==="parsing"){const Y=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity);let oe;if(this.fetching[j]){const{rawTileData:U,cacheControl:ye,resourceTiming:ce}=this.fetching[j];delete this.fetching[j],oe=x.e({rawTileData:U.slice(0)},Y,ye,ce)}else oe=Y;return oe}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,F.subdivisionGranularity)})}abortTile(F){return x._(this,void 0,void 0,function*(){const j=this.loading,G=F.uid;j&&j[G]&&j[G].abort&&(j[G].abort.abort(),delete j[G])})}removeTile(F){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]})}}class Le{constructor(){this.loaded={}}loadTile(F){return x._(this,void 0,void 0,function*(){const{uid:j,encoding:G,rawImageData:Y,redFactor:oe,greenFactor:U,blueFactor:ye,baseShift:ce}=F,fe=Y.width+2,xe=Y.height+2,pe=x.b(Y)?new x.R({width:fe,height:xe},yield x.cF(Y,-1,-1,fe,xe)):Y,De=new x.cG(j,pe,G,oe,U,ye,ce);return this.loaded=this.loaded||{},this.loaded[j]=De,De})}removeTile(F){const j=this.loaded,G=F.uid;j&&j[G]&&delete j[G]}}var ne,Re,st=function(){if(Re)return ne;function ue(j,G){if(j.length!==0){F(j[0],G);for(var Y=1;Y<j.length;Y++)F(j[Y],!G)}}function F(j,G){for(var Y=0,oe=0,U=0,ye=j.length,ce=ye-1;U<ye;ce=U++){var fe=(j[U][0]-j[ce][0])*(j[ce][1]+j[U][1]),xe=Y+fe;oe+=Math.abs(Y)>=Math.abs(fe)?Y-xe+fe:fe-xe+Y,Y=xe}Y+oe>=0!=!!G&&j.reverse()}return Re=1,ne=function j(G,Y){var oe,U=G&&G.type;if(U==="FeatureCollection")for(oe=0;oe<G.features.length;oe++)j(G.features[oe],Y);else if(U==="GeometryCollection")for(oe=0;oe<G.geometries.length;oe++)j(G.geometries[oe],Y);else if(U==="Feature")j(G.geometry,Y);else if(U==="Polygon")ue(G.coordinates,Y);else if(U==="MultiPolygon")for(oe=0;oe<G.coordinates.length;oe++)ue(G.coordinates[oe],Y);return G}}(),ft=x.cH(st);const zt=x.cC.VectorTileFeature.prototype.toGeoJSON;class Dt{constructor(F){this._feature=F,this.extent=x.Z,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(this._feature.type===1){const F=[];for(const j of this._feature.geometry)F.push([new x.P(j[0],j[1])]);return F}{const F=[];for(const j of this._feature.geometry){const G=[];for(const Y of j)G.push(new x.P(Y[0],Y[1]));F.push(G)}return F}}toGeoJSON(F,j,G){return zt.call(this,F,j,G)}}class Tt{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.Z,this.length=F.length,this._features=F}feature(F){return new Dt(this._features[F])}}var Ce,be,ke,he={exports:{}},ge=function(){if(ke)return he.exports;ke=1;var ue=x.cK(),F=function(){if(be)return Ce;be=1;var xe=x.cI(),pe=x.cJ().VectorTileFeature;function De(Xe,at){this.options=at||{},this.features=Xe,this.length=Xe.length}function qe(Xe,at){this.id=typeof Xe.id=="number"?Xe.id:void 0,this.type=Xe.type,this.rawGeometry=Xe.type===1?[Xe.geometry]:Xe.geometry,this.properties=Xe.tags,this.extent=at||4096}return Ce=De,De.prototype.feature=function(Xe){return new qe(this.features[Xe],this.options.extent)},qe.prototype.loadGeometry=function(){var Xe=this.rawGeometry;this.geometry=[];for(var at=0;at<Xe.length;at++){for(var gt=Xe[at],pt=[],Me=0;Me<gt.length;Me++)pt.push(new xe(gt[Me][0],gt[Me][1]));this.geometry.push(pt)}return this.geometry},qe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Xe=this.geometry,at=1/0,gt=-1/0,pt=1/0,Me=-1/0,Ft=0;Ft<Xe.length;Ft++)for(var Ct=Xe[Ft],Mt=0;Mt<Ct.length;Mt++){var dt=Ct[Mt];at=Math.min(at,dt.x),gt=Math.max(gt,dt.x),pt=Math.min(pt,dt.y),Me=Math.max(Me,dt.y)}return[at,pt,gt,Me]},qe.prototype.toGeoJSON=pe.prototype.toGeoJSON,Ce}();function j(xe){var pe=new ue;return function(De,qe){for(var Xe in De.layers)qe.writeMessage(3,G,De.layers[Xe])}(xe,pe),pe.finish()}function G(xe,pe){var De;pe.writeVarintField(15,xe.version||1),pe.writeStringField(1,xe.name||""),pe.writeVarintField(5,xe.extent||4096);var qe={keys:[],values:[],keycache:{},valuecache:{}};for(De=0;De<xe.length;De++)qe.feature=xe.feature(De),pe.writeMessage(2,Y,qe);var Xe=qe.keys;for(De=0;De<Xe.length;De++)pe.writeStringField(3,Xe[De]);var at=qe.values;for(De=0;De<at.length;De++)pe.writeMessage(4,fe,at[De])}function Y(xe,pe){var De=xe.feature;De.id!==void 0&&pe.writeVarintField(1,De.id),pe.writeMessage(2,oe,xe),pe.writeVarintField(3,De.type),pe.writeMessage(4,ce,De)}function oe(xe,pe){var De=xe.feature,qe=xe.keys,Xe=xe.values,at=xe.keycache,gt=xe.valuecache;for(var pt in De.properties){var Me=De.properties[pt],Ft=at[pt];if(Me!==null){Ft===void 0&&(qe.push(pt),at[pt]=Ft=qe.length-1),pe.writeVarint(Ft);var Ct=typeof Me;Ct!=="string"&&Ct!=="boolean"&&Ct!=="number"&&(Me=JSON.stringify(Me));var Mt=Ct+":"+Me,dt=gt[Mt];dt===void 0&&(Xe.push(Me),gt[Mt]=dt=Xe.length-1),pe.writeVarint(dt)}}}function U(xe,pe){return(pe<<3)+(7&xe)}function ye(xe){return xe<<1^xe>>31}function ce(xe,pe){for(var De=xe.loadGeometry(),qe=xe.type,Xe=0,at=0,gt=De.length,pt=0;pt<gt;pt++){var Me=De[pt],Ft=1;qe===1&&(Ft=Me.length),pe.writeVarint(U(1,Ft));for(var Ct=qe===3?Me.length-1:Me.length,Mt=0;Mt<Ct;Mt++){Mt===1&&qe!==1&&pe.writeVarint(U(2,Ct-1));var dt=Me[Mt].x-Xe,Be=Me[Mt].y-at;pe.writeVarint(ye(dt)),pe.writeVarint(ye(Be)),Xe+=dt,at+=Be}qe===3&&pe.writeVarint(U(7,1))}}function fe(xe,pe){var De=typeof xe;De==="string"?pe.writeStringField(1,xe):De==="boolean"?pe.writeBooleanField(7,xe):De==="number"&&(xe%1!=0?pe.writeDoubleField(3,xe):xe<0?pe.writeSVarintField(6,xe):pe.writeVarintField(5,xe))}return he.exports=j,he.exports.fromVectorTileJs=j,he.exports.fromGeojsonVt=function(xe,pe){pe=pe||{};var De={};for(var qe in xe)De[qe]=new F(xe[qe].features,pe),De[qe].name=qe,De[qe].version=pe.version,De[qe].extent=pe.extent;return j({layers:De})},he.exports.GeoJSONWrapper=F,he.exports}(),Ae=x.cH(ge);const Oe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},Ye=Math.fround||(rt=new Float32Array(1),ue=>(rt[0]=+ue,rt[0]));var rt;const ut=3,St=5,Mi=6;class Ht{constructor(F){this.options=Object.assign(Object.create(Oe),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:j,minZoom:G,maxZoom:Y}=this.options;j&&console.time("total time");const oe=`prepare ${F.length} points`;j&&console.time(oe),this.points=F;const U=[];for(let ce=0;ce<F.length;ce++){const fe=F[ce];if(!fe.geometry)continue;const[xe,pe]=fe.geometry.coordinates,De=Ye(xr(xe)),qe=Ye(wr(pe));U.push(De,qe,1/0,ce,-1,1),this.options.reduce&&U.push(0)}let ye=this.trees[Y+1]=this._createTree(U);j&&console.timeEnd(oe);for(let ce=Y;ce>=G;ce--){const fe=+Date.now();ye=this.trees[ce]=this._createTree(this._cluster(ye,ce)),j&&console.log("z%d: %d clusters in %dms",ce,ye.numItems,+Date.now()-fe)}return j&&console.timeEnd("total time"),this}getClusters(F,j){let G=((F[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,F[1]));let oe=F[2]===180?180:((F[2]+180)%360+360)%360-180;const U=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)G=-180,oe=180;else if(G>oe){const pe=this.getClusters([G,Y,180,U],j),De=this.getClusters([-180,Y,oe,U],j);return pe.concat(De)}const ye=this.trees[this._limitZoom(j)],ce=ye.range(xr(G),wr(U),xr(oe),wr(Y)),fe=ye.data,xe=[];for(const pe of ce){const De=this.stride*pe;xe.push(fe[De+St]>1?Ti(fe,De,this.clusterProps):this.points[fe[De+ut]])}return xe}getChildren(F){const j=this._getOriginId(F),G=this._getOriginZoom(F),Y="No cluster with the specified id.",oe=this.trees[G];if(!oe)throw new Error(Y);const U=oe.data;if(j*this.stride>=U.length)throw new Error(Y);const ye=this.options.radius/(this.options.extent*Math.pow(2,G-1)),ce=oe.within(U[j*this.stride],U[j*this.stride+1],ye),fe=[];for(const xe of ce){const pe=xe*this.stride;U[pe+4]===F&&fe.push(U[pe+St]>1?Ti(U,pe,this.clusterProps):this.points[U[pe+ut]])}if(fe.length===0)throw new Error(Y);return fe}getLeaves(F,j,G){const Y=[];return this._appendLeaves(Y,F,j=j||10,G=G||0,0),Y}getTile(F,j,G){const Y=this.trees[this._limitZoom(F)],oe=Math.pow(2,F),{extent:U,radius:ye}=this.options,ce=ye/U,fe=(G-ce)/oe,xe=(G+1+ce)/oe,pe={features:[]};return this._addTileFeatures(Y.range((j-ce)/oe,fe,(j+1+ce)/oe,xe),Y.data,j,G,oe,pe),j===0&&this._addTileFeatures(Y.range(1-ce/oe,fe,1,xe),Y.data,oe,G,oe,pe),j===oe-1&&this._addTileFeatures(Y.range(0,fe,ce/oe,xe),Y.data,-1,G,oe,pe),pe.features.length?pe:null}getClusterExpansionZoom(F){let j=this._getOriginZoom(F)-1;for(;j<=this.options.maxZoom;){const G=this.getChildren(F);if(j++,G.length!==1)break;F=G[0].properties.cluster_id}return j}_appendLeaves(F,j,G,Y,oe){const U=this.getChildren(j);for(const ye of U){const ce=ye.properties;if(ce&&ce.cluster?oe+ce.point_count<=Y?oe+=ce.point_count:oe=this._appendLeaves(F,ce.cluster_id,G,Y,oe):oe<Y?oe++:F.push(ye),F.length===G)break}return oe}_createTree(F){const j=new x.aF(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<F.length;G+=this.stride)j.add(F[G],F[G+1]);return j.finish(),j.data=F,j}_addTileFeatures(F,j,G,Y,oe,U){for(const ye of F){const ce=ye*this.stride,fe=j[ce+St]>1;let xe,pe,De;if(fe)xe=yt(j,ce,this.clusterProps),pe=j[ce],De=j[ce+1];else{const at=this.points[j[ce+ut]];xe=at.properties;const[gt,pt]=at.geometry.coordinates;pe=xr(gt),De=wr(pt)}const qe={type:1,geometry:[[Math.round(this.options.extent*(pe*oe-G)),Math.round(this.options.extent*(De*oe-Y))]],tags:xe};let Xe;Xe=fe||this.options.generateId?j[ce+ut]:this.points[j[ce+ut]].id,Xe!==void 0&&(qe.id=Xe),U.features.push(qe)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,j){const{radius:G,extent:Y,reduce:oe,minPoints:U}=this.options,ye=G/(Y*Math.pow(2,j)),ce=F.data,fe=[],xe=this.stride;for(let pe=0;pe<ce.length;pe+=xe){if(ce[pe+2]<=j)continue;ce[pe+2]=j;const De=ce[pe],qe=ce[pe+1],Xe=F.within(ce[pe],ce[pe+1],ye),at=ce[pe+St];let gt=at;for(const pt of Xe){const Me=pt*xe;ce[Me+2]>j&&(gt+=ce[Me+St])}if(gt>at&&gt>=U){let pt,Me=De*at,Ft=qe*at,Ct=-1;const Mt=((pe/xe|0)<<5)+(j+1)+this.points.length;for(const dt of Xe){const Be=dt*xe;if(ce[Be+2]<=j)continue;ce[Be+2]=j;const lt=ce[Be+St];Me+=ce[Be]*lt,Ft+=ce[Be+1]*lt,ce[Be+4]=Mt,oe&&(pt||(pt=this._map(ce,pe,!0),Ct=this.clusterProps.length,this.clusterProps.push(pt)),oe(pt,this._map(ce,Be)))}ce[pe+4]=Mt,fe.push(Me/gt,Ft/gt,1/0,Mt,-1,gt),oe&&fe.push(Ct)}else{for(let pt=0;pt<xe;pt++)fe.push(ce[pe+pt]);if(gt>1)for(const pt of Xe){const Me=pt*xe;if(!(ce[Me+2]<=j)){ce[Me+2]=j;for(let Ft=0;Ft<xe;Ft++)fe.push(ce[Me+Ft])}}}}return fe}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,j,G){if(F[j+St]>1){const U=this.clusterProps[F[j+Mi]];return G?Object.assign({},U):U}const Y=this.points[F[j+ut]].properties,oe=this.options.map(Y);return G&&oe===Y?Object.assign({},oe):oe}}function Ti(ue,F,j){return{type:"Feature",id:ue[F+ut],properties:yt(ue,F,j),geometry:{type:"Point",coordinates:[(G=ue[F],360*(G-.5)),$r(ue[F+1])]}};var G}function yt(ue,F,j){const G=ue[F+St],Y=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,oe=ue[F+Mi],U=oe===-1?{}:Object.assign({},j[oe]);return Object.assign(U,{cluster:!0,cluster_id:ue[F+ut],point_count:G,point_count_abbreviated:Y})}function xr(ue){return ue/360+.5}function wr(ue){const F=Math.sin(ue*Math.PI/180),j=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return j<0?0:j>1?1:j}function $r(ue){const F=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Vi(ue,F,j,G){let Y=G;const oe=F+(j-F>>1);let U,ye=j-F;const ce=ue[F],fe=ue[F+1],xe=ue[j],pe=ue[j+1];for(let De=F+3;De<j;De+=3){const qe=mn(ue[De],ue[De+1],ce,fe,xe,pe);if(qe>Y)U=De,Y=qe;else if(qe===Y){const Xe=Math.abs(De-oe);Xe<ye&&(U=De,ye=Xe)}}Y>G&&(U-F>3&&Vi(ue,F,U,G),ue[U+2]=Y,j-U>3&&Vi(ue,U,j,G))}function mn(ue,F,j,G,Y,oe){let U=Y-j,ye=oe-G;if(U!==0||ye!==0){const ce=((ue-j)*U+(F-G)*ye)/(U*U+ye*ye);ce>1?(j=Y,G=oe):ce>0&&(j+=U*ce,G+=ye*ce)}return U=ue-j,ye=F-G,U*U+ye*ye}function pr(ue,F,j,G){const Y={id:ue??null,type:F,geometry:j,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(F==="Point"||F==="MultiPoint"||F==="LineString")xt(Y,j);else if(F==="Polygon")xt(Y,j[0]);else if(F==="MultiLineString")for(const oe of j)xt(Y,oe);else if(F==="MultiPolygon")for(const oe of j)xt(Y,oe[0]);return Y}function xt(ue,F){for(let j=0;j<F.length;j+=3)ue.minX=Math.min(ue.minX,F[j]),ue.minY=Math.min(ue.minY,F[j+1]),ue.maxX=Math.max(ue.maxX,F[j]),ue.maxY=Math.max(ue.maxY,F[j+1])}function fr(ue,F,j,G){if(!F.geometry)return;const Y=F.geometry.coordinates;if(Y&&Y.length===0)return;const oe=F.geometry.type,U=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let ye=[],ce=F.id;if(j.promoteId?ce=F.properties[j.promoteId]:j.generateId&&(ce=G||0),oe==="Point")Bt(Y,ye);else if(oe==="MultiPoint")for(const fe of Y)Bt(fe,ye);else if(oe==="LineString")ni(Y,ye,U,!1);else if(oe==="MultiLineString"){if(j.lineMetrics){for(const fe of Y)ye=[],ni(fe,ye,U,!1),ue.push(pr(ce,"LineString",ye,F.properties));return}rr(Y,ye,U,!1)}else if(oe==="Polygon")rr(Y,ye,U,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(const fe of F.geometry.geometries)fr(ue,{id:ce,geometry:fe,properties:F.properties},j,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const fe of Y){const xe=[];rr(fe,xe,U,!0),ye.push(xe)}}ue.push(pr(ce,oe,ye,F.properties))}function Bt(ue,F){F.push(qr(ue[0]),nr(ue[1]),0)}function ni(ue,F,j,G){let Y,oe,U=0;for(let ce=0;ce<ue.length;ce++){const fe=qr(ue[ce][0]),xe=nr(ue[ce][1]);F.push(fe,xe,0),ce>0&&(U+=G?(Y*xe-fe*oe)/2:Math.sqrt(Math.pow(fe-Y,2)+Math.pow(xe-oe,2))),Y=fe,oe=xe}const ye=F.length-3;F[2]=1,Vi(F,0,ye,j),F[ye+2]=1,F.size=Math.abs(U),F.start=0,F.end=F.size}function rr(ue,F,j,G){for(let Y=0;Y<ue.length;Y++){const oe=[];ni(ue[Y],oe,j,G),F.push(oe)}}function qr(ue){return ue/360+.5}function nr(ue){const F=Math.sin(ue*Math.PI/180),j=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return j<0?0:j>1?1:j}function Ki(ue,F,j,G,Y,oe,U,ye){if(G/=F,oe>=(j/=F)&&U<G)return ue;if(U<j||oe>=G)return null;const ce=[];for(const fe of ue){const xe=fe.geometry;let pe=fe.type;const De=Y===0?fe.minX:fe.minY,qe=Y===0?fe.maxX:fe.maxY;if(De>=j&&qe<G){ce.push(fe);continue}if(qe<j||De>=G)continue;let Xe=[];if(pe==="Point"||pe==="MultiPoint")Zi(xe,Xe,j,G,Y);else if(pe==="LineString")Gt(xe,Xe,j,G,Y,!1,ye.lineMetrics);else if(pe==="MultiLineString")an(xe,Xe,j,G,Y,!1);else if(pe==="Polygon")an(xe,Xe,j,G,Y,!0);else if(pe==="MultiPolygon")for(const at of xe){const gt=[];an(at,gt,j,G,Y,!0),gt.length&&Xe.push(gt)}if(Xe.length){if(ye.lineMetrics&&pe==="LineString"){for(const at of Xe)ce.push(pr(fe.id,pe,at,fe.tags));continue}pe!=="LineString"&&pe!=="MultiLineString"||(Xe.length===1?(pe="LineString",Xe=Xe[0]):pe="MultiLineString"),pe!=="Point"&&pe!=="MultiPoint"||(pe=Xe.length===3?"Point":"MultiPoint"),ce.push(pr(fe.id,pe,Xe,fe.tags))}}return ce.length?ce:null}function Zi(ue,F,j,G,Y){for(let oe=0;oe<ue.length;oe+=3){const U=ue[oe+Y];U>=j&&U<=G&&Tr(F,ue[oe],ue[oe+1],ue[oe+2])}}function Gt(ue,F,j,G,Y,oe,U){let ye=Dr(ue);const ce=Y===0?es:ts;let fe,xe,pe=ue.start;for(let gt=0;gt<ue.length-3;gt+=3){const pt=ue[gt],Me=ue[gt+1],Ft=ue[gt+2],Ct=ue[gt+3],Mt=ue[gt+4],dt=Y===0?pt:Me,Be=Y===0?Ct:Mt;let lt=!1;U&&(fe=Math.sqrt(Math.pow(pt-Ct,2)+Math.pow(Me-Mt,2))),dt<j?Be>j&&(xe=ce(ye,pt,Me,Ct,Mt,j),U&&(ye.start=pe+fe*xe)):dt>G?Be<G&&(xe=ce(ye,pt,Me,Ct,Mt,G),U&&(ye.start=pe+fe*xe)):Tr(ye,pt,Me,Ft),Be<j&&dt>=j&&(xe=ce(ye,pt,Me,Ct,Mt,j),lt=!0),Be>G&&dt<=G&&(xe=ce(ye,pt,Me,Ct,Mt,G),lt=!0),!oe&&lt&&(U&&(ye.end=pe+fe*xe),F.push(ye),ye=Dr(ue)),U&&(pe+=fe)}let De=ue.length-3;const qe=ue[De],Xe=ue[De+1],at=Y===0?qe:Xe;at>=j&&at<=G&&Tr(ye,qe,Xe,ue[De+2]),De=ye.length-3,oe&&De>=3&&(ye[De]!==ye[0]||ye[De+1]!==ye[1])&&Tr(ye,ye[0],ye[1],ye[2]),ye.length&&F.push(ye)}function Dr(ue){const F=[];return F.size=ue.size,F.start=ue.start,F.end=ue.end,F}function an(ue,F,j,G,Y,oe){for(const U of ue)Gt(U,F,j,G,Y,oe,!1)}function Tr(ue,F,j,G){ue.push(F,j,G)}function es(ue,F,j,G,Y,oe){const U=(oe-F)/(G-F);return Tr(ue,oe,j+(Y-j)*U,1),U}function ts(ue,F,j,G,Y,oe){const U=(oe-j)/(Y-j);return Tr(ue,F+(G-F)*U,oe,1),U}function mr(ue,F){const j=[];for(let G=0;G<ue.length;G++){const Y=ue[G],oe=Y.type;let U;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")U=Br(Y.geometry,F);else if(oe==="MultiLineString"||oe==="Polygon"){U=[];for(const ye of Y.geometry)U.push(Br(ye,F))}else if(oe==="MultiPolygon"){U=[];for(const ye of Y.geometry){const ce=[];for(const fe of ye)ce.push(Br(fe,F));U.push(ce)}}j.push(pr(Y.id,oe,U,Y.tags))}return j}function Br(ue,F){const j=[];j.size=ue.size,ue.start!==void 0&&(j.start=ue.start,j.end=ue.end);for(let G=0;G<ue.length;G+=3)j.push(ue[G]+F,ue[G+1],ue[G+2]);return j}function gn(ue,F){if(ue.transformed)return ue;const j=1<<ue.z,G=ue.x,Y=ue.y;for(const oe of ue.features){const U=oe.geometry,ye=oe.type;if(oe.geometry=[],ye===1)for(let ce=0;ce<U.length;ce+=2)oe.geometry.push(_n(U[ce],U[ce+1],F,j,G,Y));else for(let ce=0;ce<U.length;ce++){const fe=[];for(let xe=0;xe<U[ce].length;xe+=2)fe.push(_n(U[ce][xe],U[ce][xe+1],F,j,G,Y));oe.geometry.push(fe)}}return ue.transformed=!0,ue}function _n(ue,F,j,G,Y,oe){return[Math.round(j*(ue*G-Y)),Math.round(j*(F*G-oe))]}function Hr(ue,F,j,G,Y){const oe=F===Y.maxZoom?0:Y.tolerance/((1<<F)*Y.extent),U={features:[],numPoints:0,numSimplified:0,numFeatures:ue.length,source:null,x:j,y:G,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ye of ue)Ln(U,ye,oe,Y);return U}function Ln(ue,F,j,G){const Y=F.geometry,oe=F.type,U=[];if(ue.minX=Math.min(ue.minX,F.minX),ue.minY=Math.min(ue.minY,F.minY),ue.maxX=Math.max(ue.maxX,F.maxX),ue.maxY=Math.max(ue.maxY,F.maxY),oe==="Point"||oe==="MultiPoint")for(let ye=0;ye<Y.length;ye+=3)U.push(Y[ye],Y[ye+1]),ue.numPoints++,ue.numSimplified++;else if(oe==="LineString")Rn(U,Y,ue,j,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(let ye=0;ye<Y.length;ye++)Rn(U,Y[ye],ue,j,oe==="Polygon",ye===0);else if(oe==="MultiPolygon")for(let ye=0;ye<Y.length;ye++){const ce=Y[ye];for(let fe=0;fe<ce.length;fe++)Rn(U,ce[fe],ue,j,!0,fe===0)}if(U.length){let ye=F.tags||null;if(oe==="LineString"&&G.lineMetrics){ye={};for(const fe in F.tags)ye[fe]=F.tags[fe];ye.mapbox_clip_start=Y.start/Y.size,ye.mapbox_clip_end=Y.end/Y.size}const ce={geometry:U,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:ye};F.id!==null&&(ce.id=F.id),ue.features.push(ce)}}function Rn(ue,F,j,G,Y,oe){const U=G*G;if(G>0&&F.size<(Y?U:G))return void(j.numPoints+=F.length/3);const ye=[];for(let ce=0;ce<F.length;ce+=3)(G===0||F[ce+2]>U)&&(j.numSimplified++,ye.push(F[ce],F[ce+1])),j.numPoints++;Y&&function(ce,fe){let xe=0;for(let pe=0,De=ce.length,qe=De-2;pe<De;qe=pe,pe+=2)xe+=(ce[pe]-ce[qe])*(ce[pe+1]+ce[qe+1]);if(xe>0===fe)for(let pe=0,De=ce.length;pe<De/2;pe+=2){const qe=ce[pe],Xe=ce[pe+1];ce[pe]=ce[De-2-pe],ce[pe+1]=ce[De-1-pe],ce[De-2-pe]=qe,ce[De-1-pe]=Xe}}(ye,oe),ue.push(ye)}const Wr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Cr{constructor(F,j){const G=(j=this.options=function(oe,U){for(const ye in U)oe[ye]=U[ye];return oe}(Object.create(Wr),j)).debug;if(G&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let Y=function(oe,U){const ye=[];if(oe.type==="FeatureCollection")for(let ce=0;ce<oe.features.length;ce++)fr(ye,oe.features[ce],U,ce);else fr(ye,oe.type==="Feature"?oe:{geometry:oe},U);return ye}(F,j);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(oe,U){const ye=U.buffer/U.extent;let ce=oe;const fe=Ki(oe,1,-1-ye,ye,0,-1,2,U),xe=Ki(oe,1,1-ye,2+ye,0,-1,2,U);return(fe||xe)&&(ce=Ki(oe,1,-ye,1+ye,0,-1,2,U)||[],fe&&(ce=mr(fe,1).concat(ce)),xe&&(ce=ce.concat(mr(xe,-1)))),ce}(Y,j),Y.length&&this.splitTile(Y,0,0,0),G&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(F,j,G,Y,oe,U,ye){const ce=[F,j,G,Y],fe=this.options,xe=fe.debug;for(;ce.length;){Y=ce.pop(),G=ce.pop(),j=ce.pop(),F=ce.pop();const pe=1<<j,De=Fr(j,G,Y);let qe=this.tiles[De];if(!qe&&(xe>1&&console.time("creation"),qe=this.tiles[De]=Hr(F,j,G,Y,fe),this.tileCoords.push({z:j,x:G,y:Y}),xe)){xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,G,Y,qe.numFeatures,qe.numPoints,qe.numSimplified),console.timeEnd("creation"));const lt=`z${j}`;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(qe.source=F,oe==null){if(j===fe.indexMaxZoom||qe.numPoints<=fe.indexMaxPoints)continue}else{if(j===fe.maxZoom||j===oe)continue;if(oe!=null){const lt=oe-j;if(G!==U>>lt||Y!==ye>>lt)continue}}if(qe.source=null,F.length===0)continue;xe>1&&console.time("clipping");const Xe=.5*fe.buffer/fe.extent,at=.5-Xe,gt=.5+Xe,pt=1+Xe;let Me=null,Ft=null,Ct=null,Mt=null,dt=Ki(F,pe,G-Xe,G+gt,0,qe.minX,qe.maxX,fe),Be=Ki(F,pe,G+at,G+pt,0,qe.minX,qe.maxX,fe);F=null,dt&&(Me=Ki(dt,pe,Y-Xe,Y+gt,1,qe.minY,qe.maxY,fe),Ft=Ki(dt,pe,Y+at,Y+pt,1,qe.minY,qe.maxY,fe),dt=null),Be&&(Ct=Ki(Be,pe,Y-Xe,Y+gt,1,qe.minY,qe.maxY,fe),Mt=Ki(Be,pe,Y+at,Y+pt,1,qe.minY,qe.maxY,fe),Be=null),xe>1&&console.timeEnd("clipping"),ce.push(Me||[],j+1,2*G,2*Y),ce.push(Ft||[],j+1,2*G,2*Y+1),ce.push(Ct||[],j+1,2*G+1,2*Y),ce.push(Mt||[],j+1,2*G+1,2*Y+1)}}getTile(F,j,G){F=+F,j=+j,G=+G;const Y=this.options,{extent:oe,debug:U}=Y;if(F<0||F>24)return null;const ye=1<<F,ce=Fr(F,j=j+ye&ye-1,G);if(this.tiles[ce])return gn(this.tiles[ce],oe);U>1&&console.log("drilling down to z%d-%d-%d",F,j,G);let fe,xe=F,pe=j,De=G;for(;!fe&&xe>0;)xe--,pe>>=1,De>>=1,fe=this.tiles[Fr(xe,pe,De)];return fe&&fe.source?(U>1&&(console.log("found parent tile z%d-%d-%d",xe,pe,De),console.time("drilling down")),this.splitTile(fe.source,xe,pe,De,F,j,G),U>1&&console.timeEnd("drilling down"),this.tiles[ce]?gn(this.tiles[ce],oe):null):null}}function Fr(ue,F,j){return 32*((1<<ue)*j+F)+ue}function Li(ue,F){return F?ue.properties[F]:ue.id}function yn(ue,F){if(ue==null)return!0;if(ue.type==="Feature")return Li(ue,F)!=null;if(ue.type==="FeatureCollection"){const j=new Set;for(const G of ue.features){const Y=Li(G,F);if(Y==null||j.has(Y))return!1;j.add(Y)}return!0}return!1}function gr(ue,F){const j=new Map;if(ue!=null)if(ue.type==="Feature")j.set(Li(ue,F),ue);else for(const G of ue.features)j.set(Li(G,F),G);return j}class sr extends He{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,j){return x._(this,void 0,void 0,function*(){const G=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!Y)return null;const oe=new Tt(Y.features);let U=Ae(oe);return U.byteOffset===0&&U.byteLength===U.buffer.byteLength||(U=new Uint8Array(U)),{vectorTile:oe,rawData:U.buffer}})}loadData(F){return x._(this,void 0,void 0,function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const G=!!(F&&F.request&&F.request.collectResourceTiming)&&new x.cE(F.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(F,this._pendingRequest),this._geoJSONIndex=F.cluster?new Ht(function({superclusterOptions:U,clusterProperties:ye}){if(!ye||!U)return U;const ce={},fe={},xe={accumulated:null,zoom:0},pe={properties:null},De=Object.keys(ye);for(const qe of De){const[Xe,at]=ye[qe],gt=x.cL(at),pt=x.cL(typeof Xe=="string"?[Xe,["accumulated"],["get",qe]]:Xe);ce[qe]=gt.value,fe[qe]=pt.value}return U.map=qe=>{pe.properties=qe;const Xe={};for(const at of De)Xe[at]=ce[at].evaluate(xe,pe);return Xe},U.reduce=(qe,Xe)=>{pe.properties=Xe;for(const at of De)xe.accumulated=qe[at],qe[at]=fe[at].evaluate(xe,pe)},U}(F)).load((yield this._pendingData).features):(Y=yield this._pendingData,new Cr(Y,F.geojsonVtOptions)),this.loaded={};const oe={};if(G){const U=G.finish();U&&(oe.resourceTiming={},oe.resourceTiming[F.source]=JSON.parse(JSON.stringify(U)))}return oe}catch(oe){if(delete this._pendingRequest,x.cp(oe))return{abandoned:!0};throw oe}var Y})}getData(){return x._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(F){const j=this.loaded;return j&&j[F.uid]?super.reloadTile(F):this.loadTile(F)}loadAndProcessGeoJSON(F,j){return x._(this,void 0,void 0,function*(){let G=yield this.loadGeoJSON(F,j);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(ft(G,!0),F.filter){const Y=x.cL(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(U=>`${U.key}: ${U.message}`).join(", "));G={type:"FeatureCollection",features:G.features.filter(U=>Y.value.evaluate({zoom:0},U))}}return G})}loadGeoJSON(F,j){return x._(this,void 0,void 0,function*(){const{promoteId:G}=F;if(F.request){const Y=yield x.j(F.request,j);return this._dataUpdateable=yn(Y.data,G)?gr(Y.data,G):void 0,Y.data}if(typeof F.data=="string")try{const Y=JSON.parse(F.data);return this._dataUpdateable=yn(Y,G)?gr(Y,G):void 0,Y}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return function(Y,oe,U){var ye,ce,fe,xe;if(oe.removeAll&&Y.clear(),oe.remove)for(const pe of oe.remove)Y.delete(pe);if(oe.add)for(const pe of oe.add){const De=Li(pe,U);De!=null&&Y.set(De,pe)}if(oe.update)for(const pe of oe.update){let De=Y.get(pe.id);if(De==null)continue;const qe=!pe.removeAllProperties&&(((ye=pe.removeProperties)===null||ye===void 0?void 0:ye.length)>0||((ce=pe.addOrUpdateProperties)===null||ce===void 0?void 0:ce.length)>0);if((pe.newGeometry||pe.removeAllProperties||qe)&&(De=Object.assign({},De),Y.set(pe.id,De),qe&&(De.properties=Object.assign({},De.properties))),pe.newGeometry&&(De.geometry=pe.newGeometry),pe.removeAllProperties)De.properties={};else if(((fe=pe.removeProperties)===null||fe===void 0?void 0:fe.length)>0)for(const Xe of pe.removeProperties)Object.prototype.hasOwnProperty.call(De.properties,Xe)&&delete De.properties[Xe];if(((xe=pe.addOrUpdateProperties)===null||xe===void 0?void 0:xe.length)>0)for(const{key:Xe,value:at}of pe.addOrUpdateProperties)De.properties[Xe]=at}}(this._dataUpdateable,F.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(F){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class Mr{constructor(F){this.self=F,this.actor=new x.H(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(j,G)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=G},this.self.addProtocol=x.cr,this.self.removeProtocol=x.cs,this.self.registerRTLTextPlugin=j=>{x.cM.setMethods(j)},this.actor.registerMessageHandler("LDT",(j,G)=>this._getDEMWorkerSource(j,G.source).loadTile(G)),this.actor.registerMessageHandler("RDT",(j,G)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(j,G.source).removeTile(G)})),this.actor.registerMessageHandler("GCEZ",(j,G)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(j,G.type,G.source).getClusterExpansionZoom(G)})),this.actor.registerMessageHandler("GCC",(j,G)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(j,G.type,G.source).getClusterChildren(G)})),this.actor.registerMessageHandler("GCL",(j,G)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(j,G.type,G.source).getClusterLeaves(G)})),this.actor.registerMessageHandler("LD",(j,G)=>this._getWorkerSource(j,G.type,G.source).loadData(G)),this.actor.registerMessageHandler("GD",(j,G)=>this._getWorkerSource(j,G.type,G.source).getData()),this.actor.registerMessageHandler("LT",(j,G)=>this._getWorkerSource(j,G.type,G.source).loadTile(G)),this.actor.registerMessageHandler("RT",(j,G)=>this._getWorkerSource(j,G.type,G.source).reloadTile(G)),this.actor.registerMessageHandler("AT",(j,G)=>this._getWorkerSource(j,G.type,G.source).abortTile(G)),this.actor.registerMessageHandler("RMT",(j,G)=>this._getWorkerSource(j,G.type,G.source).removeTile(G)),this.actor.registerMessageHandler("RS",(j,G)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[j]||!this.workerSources[j][G.type]||!this.workerSources[j][G.type][G.source])return;const Y=this.workerSources[j][G.type][G.source];delete this.workerSources[j][G.type][G.source],Y.removeSource!==void 0&&Y.removeSource(G)})),this.actor.registerMessageHandler("RM",j=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j]})),this.actor.registerMessageHandler("SR",(j,G)=>x._(this,void 0,void 0,function*(){this.referrer=G})),this.actor.registerMessageHandler("SRPS",(j,G)=>this._syncRTLPluginState(j,G)),this.actor.registerMessageHandler("IS",(j,G)=>x._(this,void 0,void 0,function*(){this.self.importScripts(G)})),this.actor.registerMessageHandler("SI",(j,G)=>this._setImages(j,G)),this.actor.registerMessageHandler("UL",(j,G)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(j).update(G.layers,G.removedIds)})),this.actor.registerMessageHandler("SL",(j,G)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(j).replace(G)}))}_setImages(F,j){return x._(this,void 0,void 0,function*(){this.availableImages[F]=j;for(const G in this.workerSources[F]){const Y=this.workerSources[F][G];for(const oe in Y)Y[oe].availableImages=j}})}_syncRTLPluginState(F,j){return x._(this,void 0,void 0,function*(){return yield x.cM.syncState(j,this.self.importScripts)})}_getAvailableImages(F){let j=this.availableImages[F];return j||(j=[]),j}_getLayerIndex(F){let j=this.layerIndexes[F];return j||(j=this.layerIndexes[F]=new c),j}_getWorkerSource(F,j,G){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][j]||(this.workerSources[F][j]={}),!this.workerSources[F][j][G]){const Y={sendAsync:(oe,U)=>(oe.targetMapId=F,this.actor.sendAsync(oe,U))};switch(j){case"vector":this.workerSources[F][j][G]=new He(Y,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][j][G]=new sr(Y,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][j][G]=new this.externalWorkerSourceTypes[j](Y,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][j][G]}_getDEMWorkerSource(F,j){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][j]||(this.demWorkerSources[F][j]=new Le),this.demWorkerSources[F][j]}}return x.i(self)&&(self.worker=new Mr(self)),Mr}),L("index",["exports","./shared"],function(x,c){var me="5.5.0";function Ze(){var h=new c.A(4);return c.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}let Ue,He;const Le={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h,e,i){const a=requestAnimationFrame(u=>{o(),e(u)}),{unsubscribe:o}=c.s(h.signal,"abort",()=>{o(),cancelAnimationFrame(a),i(c.c())},!1)},frameAsync(h){return new Promise((e,i)=>{this.frame(h,e,i)})},getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,i.drawImage(h,0,0,h.width,h.height),i},resolveURL:h=>(Ue||(Ue=document.createElement("a")),Ue.href=h,Ue.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(He==null&&(He=matchMedia("(prefers-reduced-motion: reduce)")),He.matches)}};class ne{static testProp(e){if(!ne.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in ne.docStyle)return e[i];return e[0]}static create(e,i,a){const o=window.document.createElement(e);return i!==void 0&&(o.className=i),a&&a.appendChild(o),o}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){ne.docStyle&&ne.selectProp&&(ne.userSelect=ne.docStyle[ne.selectProp],ne.docStyle[ne.selectProp]="none")}static enableDrag(){ne.docStyle&&ne.selectProp&&(ne.docStyle[ne.selectProp]=ne.userSelect)}static setTransform(e,i){e.style[ne.transformProp]=i}static addEventListener(e,i,a,o={}){e.addEventListener(i,a,"passive"in o?o:o.capture)}static removeEventListener(e,i,a,o={}){e.removeEventListener(i,a,"passive"in o?o:o.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ne.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ne.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ne.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,a){const o=i.boundingClientRect;return new c.P((a.clientX-o.left)/i.x-e.clientLeft,(a.clientY-o.top)/i.y-e.clientTop)}static mousePos(e,i){const a=ne.getScale(e);return ne.getPoint(e,a,i)}static touchPos(e,i){const a=[],o=ne.getScale(e);for(let u=0;u<i.length;u++)a.push(ne.getPoint(e,o,i[u]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),a=i.querySelectorAll("script");for(const o of a)o.remove();return ne.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const a=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!a.includes("javascript:")&&!a.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const a of i)ne.removeAttributes(a),ne.clean(a)}static removeAttributes(e){for(const{name:i,value:a}of e.attributes)ne.isPossiblyDangerous(i,a)&&e.removeAttribute(i)}}ne.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ne.selectProp=ne.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ne.transformProp=ne.testProp(["transform","WebkitTransform"]);const Re={supported:!1,testSupport:function(h){!zt&&ft&&(Dt?Tt(h):st=h)}};let st,ft,zt=!1,Dt=!1;function Tt(h){const e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,ft),h.isContextLost())return;Re.supported=!0}catch{}h.deleteTexture(e),zt=!0}var Ce;typeof document<"u"&&(ft=document.createElement("img"),ft.onload=()=>{st&&Tt(st),st=null,Dt=!0},ft.onerror=()=>{zt=!0,st=null},ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let e,i,a,o;h.resetRequestQueue=()=>{e=[],i=0,a=0,o={}},h.addThrottleControl=y=>{const b=a++;return o[b]=y,b},h.removeThrottleControl=y=>{delete o[y],f()},h.getImage=(y,b,T=!0)=>new Promise((P,M)=>{Re.supported&&(y.headers||(y.headers={}),y.headers.accept="image/webp,*/*"),c.e(y,{type:"image"}),e.push({abortController:b,requestParameters:y,supportImageRefresh:T,state:"queued",onError:z=>{M(z)},onSuccess:z=>{P(z)}}),f()});const u=y=>c._(this,void 0,void 0,function*(){y.state="running";const{requestParameters:b,supportImageRefresh:T,onError:P,onSuccess:M,abortController:z}=y,R=T===!1&&!c.i(self)&&!c.g(b.url)&&(!b.headers||Object.keys(b.headers).reduce((K,J)=>K&&J==="accept",!0));i++;const W=R?g(b,z):c.m(b,z);try{const K=yield W;delete y.abortController,y.state="completed",K.data instanceof HTMLImageElement||c.b(K.data)?M(K):K.data&&M({data:yield(H=K.data,typeof createImageBitmap=="function"?c.f(H):c.h(H)),cacheControl:K.cacheControl,expires:K.expires})}catch(K){delete y.abortController,P(K)}finally{i--,f()}var H}),f=()=>{const y=(()=>{for(const b of Object.keys(o))if(o[b]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let b=i;b<y&&e.length>0;b++){const T=e.shift();T.abortController.signal.aborted?b--:u(T)}},g=(y,b)=>new Promise((T,P)=>{const M=new Image,z=y.url,R=y.credentials;R&&R==="include"?M.crossOrigin="use-credentials":(R&&R==="same-origin"||!c.d(z))&&(M.crossOrigin="anonymous"),b.signal.addEventListener("abort",()=>{M.src="",P(c.c())}),M.fetchPriority="high",M.onload=()=>{M.onerror=M.onload=null,T({data:M})},M.onerror=()=>{M.onerror=M.onload=null,b.signal.aborted||P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},M.src=z})}(Ce||(Ce={})),Ce.resetRequestQueue();class be{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ke(h){const e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){const i=[];for(const{id:a,url:o}of h){const u=`${a}${o}`;i.indexOf(u)===-1&&(i.push(u),e.push({id:a,url:o}))}}return e}function he(h,e,i){try{const a=new URL(h);return a.pathname+=`${e}${i}`,a.toString()}catch{throw new Error(`Invalid sprite URL "${h}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class ge{constructor(e,i,a,o){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,o)}update(e,i,a){const{width:o,height:u}=e,f=!(this.size&&this.size[0]===o&&this.size[1]===u||a),{context:g}=this,{gl:y}=g;if(this.useMipmap=!!(i&&i.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),f)this.size=[o,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,o,u,0,this.format,y.UNSIGNED_BYTE,e.data);else{const{x:b,y:T}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?y.texSubImage2D(y.TEXTURE_2D,0,b,T,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,b,T,o,u,y.RGBA,y.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D),g.pixelStoreUnpackFlipY.setDefault(),g.pixelStoreUnpack.setDefault(),g.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,a){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_2D,this.texture),a!==u.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=u.LINEAR),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,a||e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Ae(h){const{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class Oe extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:a}of this.requestors)a(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const a=i.spriteData;i.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let a=!0;const o=i.data||i.spriteData;return this._validateStretch(i.stretchX,o&&o.width)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(i.stretchY,o&&o.height)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(i.content,i)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,i){if(!e)return!0;let a=0;for(const o of e){if(o[0]<a||o[1]<o[0]||i<o[1])return!1;a=o[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const a=i.spriteData,o=a&&a.width||i.data.width,u=a&&a.height||i.data.height;return!(e[0]<0||o<e[0]||e[1]<0||u<e[1]||e[2]<0||o<e[2]||e[3]<0||u<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,a=!0){const o=this.getImage(e);if(a&&(o.data.width!==i.data.width||o.data.height!==i.data.height))throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=o.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,a)=>{let o=!0;if(!this.isLoaded())for(const u of e)this.images[u]||(o=!1);this.isLoaded()||o?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const a of e){let o=this.getImage(a);o||(this.fire(new c.l("styleimagemissing",{id:a})),o=this.getImage(a)),o?i[a]={data:o.data.clone(),pixelRatio:o.pixelRatio,sdf:o.sdf,version:o.version,stretchX:o.stretchX,stretchY:o.stretchY,content:o.content,textFitWidth:o.textFitWidth,textFitHeight:o.textFitHeight,hasRenderCallback:!!(o.userImage&&o.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],a=this.getImage(e);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{const o={w:a.data.width+2,h:a.data.height+2,x:0,y:0},u=new c.I(o,a);this.patterns[e]={bin:o,position:u}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ge(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const u in this.patterns)e.push(this.patterns[u].bin);const{w:i,h:a}=c.p(e),o=this.atlasImage;o.resize({width:i||1,height:a||1});for(const u in this.patterns){const{bin:f}=this.patterns[u],g=f.x+1,y=f.y+1,b=this.getImage(u).data,T=b.width,P=b.height;c.R.copy(b,o,{x:0,y:0},{x:g,y},{width:T,height:P}),c.R.copy(b,o,{x:0,y:P-1},{x:g,y:y-1},{width:T,height:1}),c.R.copy(b,o,{x:0,y:0},{x:g,y:y+P},{width:T,height:1}),c.R.copy(b,o,{x:T-1,y:0},{x:g-1,y},{width:1,height:P}),c.R.copy(b,o,{x:0,y:0},{x:g+T,y},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const a=this.getImage(i);a||c.w(`Image with ID: "${i}" was not found`),Ae(a)&&this.updateImage(i,a)}}}const Ye=1e20;function rt(h,e,i,a,o,u,f,g,y){for(let b=e;b<e+a;b++)ut(h,i*u+b,u,o,f,g,y);for(let b=i;b<i+o;b++)ut(h,b*u+e,1,a,f,g,y)}function ut(h,e,i,a,o,u,f){u[0]=0,f[0]=-1e20,f[1]=Ye,o[0]=h[e];for(let g=1,y=0,b=0;g<a;g++){o[g]=h[e+g*i];const T=g*g;do{const P=u[y];b=(o[g]-o[P]+T-P*P)/(g-P)/2}while(b<=f[y]&&--y>-1);y++,u[y]=g,f[y]=b,f[y+1]=Ye}for(let g=0,y=0;g<a;g++){for(;f[y+1]<g;)y++;const b=u[y],T=g-b;h[e+g*i]=o[b]+T*T}}class St{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const i=[];for(const u in e)for(const f of e[u])i.push(this._getAndCacheGlyphsPromise(u,f));const a=yield Promise.all(i),o={};for(const{stack:u,id:f,glyph:g}of a)o[u]||(o[u]={}),o[u][f]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics};return o})}_getAndCacheGlyphsPromise(e,i){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let o=a.glyphs[i];if(o!==void 0)return{stack:e,id:i,glyph:o};if(o=this._tinySDF(a,e,i),o)return a.glyphs[i]=o,{stack:e,id:i,glyph:o};const u=Math.floor(i/256);if(256*u>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[u])return{stack:e,id:i,glyph:o};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[u]){const g=St.loadGlyphRange(e,u,this.url,this.requestManager);a.requests[u]=g}const f=yield a.requests[u];for(const g in f)this._doesCharSupportLocalGlyph(+g)||(a.glyphs[+g]=f[+g]);return a.ranges[u]=!0,{stack:e,id:i,glyph:f[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||c.u["CJK Unified Ideographs"](e)||c.u["Hangul Syllables"](e)||c.u.Hiragana(e)||c.u.Katakana(e)||c.u["CJK Symbols and Punctuation"](e)||c.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,a){const o=this.localIdeographFontFamily;if(!o||!this._doesCharSupportLocalGlyph(a))return;let u=e.tinySDF;if(!u){let g="400";/bold/i.test(i)?g="900":/medium/i.test(i)?g="500":/light/i.test(i)&&(g="200"),u=e.tinySDF=new St.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:o,fontWeight:g})}const f=u.draw(String.fromCharCode(a));return{id:a,bitmap:new c.q({width:f.width||60,height:f.height||60},f.data),metrics:{width:f.glyphWidth/2||24,height:f.glyphHeight/2||24,left:f.glyphLeft/2+.5||0,top:f.glyphTop/2-27.5||-8,advance:f.glyphAdvance/2||24,isDoubleResolution:!0}}}}St.loadGlyphRange=function(h,e,i,a){return c._(this,void 0,void 0,function*(){const o=256*e,u=o+255,f=a.transformRequest(i.replace("{fontstack}",h).replace("{range}",`${o}-${u}`),"Glyphs"),g=yield c.n(f,new AbortController);if(!g||!g.data)throw new Error(`Could not load glyph range. range: ${e}, ${o}-${u}`);const y={};for(const b of c.o(g.data))y[b.id]=b;return y})},St.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:o="sans-serif",fontWeight:u="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const g=this.size=h+4*e,y=this._createCanvas(g),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${u} ${h}px ${o}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(h){const e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:o,actualBoundingBoxRight:u}=this.ctx.measureText(h),f=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-o))),y=Math.min(this.size-this.buffer,f+Math.ceil(a)),b=g+2*this.buffer,T=y+2*this.buffer,P=Math.max(b*T,0),M=new Uint8ClampedArray(P),z={data:M,width:b,height:T,glyphWidth:g,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return z;const{ctx:R,buffer:W,gridInner:H,gridOuter:K}=this;R.clearRect(W,W,g,y),R.fillText(h,W,W+f);const J=R.getImageData(W,W,g,y);K.fill(Ye,0,P),H.fill(0,0,P);for(let ie=0;ie<y;ie++)for(let te=0;te<g;te++){const re=J.data[4*(ie*g+te)+3]/255;if(re===0)continue;const le=(ie+W)*b+te+W;if(re===1)K[le]=0,H[le]=Ye;else{const se=.5-re;K[le]=se>0?se*se:0,H[le]=se<0?se*se:0}}rt(K,0,0,b,T,b,this.f,this.v,this.z),rt(H,W,W,g,y,b,this.f,this.v,this.z);for(let ie=0;ie<P;ie++){const te=Math.sqrt(K[ie])-Math.sqrt(H[ie]);M[ie]=Math.round(255-255*(te/this.radius+this.cutoff))}return z}};class Mi{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,i){return c.z(e.expression.evaluate(i))}interpolate(e,i,a){return{x:c.B.number(e.x,i.x,a),y:c.B.number(e.y,i.y,a),z:c.B.number(e.z,i.z,a)}}}let Ht;class Ti extends c.E{constructor(e){super(),Ht=Ht||new c.r({anchor:new c.D(c.v.light.anchor),position:new Mi,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Ht),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(c.t,e,i))for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a){return(!a||a.validate!==!1)&&c.x(this,e.call(c.y,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const yt=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class xr extends c.E{constructor(e){super(),this._transitionable=new c.T(yt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.C(0))}setSky(e,i={}){if(!this._validate(c.F,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a={}){return(a==null?void 0:a.validate)!==!1&&c.x(this,e.call(c.y,c.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class wr{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const a=e.join(",")+String(i);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,i)),this.dashEntry[a]}getDashRanges(e,i,a){const o=[];let u=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,g=!0;o.push({left:u,right:f,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){g=!g;const T=e[b];u=y*a,y+=T,f=y*a,o.push({left:u,right:f,isDash:g,zeroLength:T===0})}return o}addRoundDash(e,i,a){const o=i/2;for(let u=-a;u<=a;u++){const f=this.width*(this.nextRow+a+u);let g=0,y=e[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++g]);const T=Math.abs(b-y.left),P=Math.abs(b-y.right),M=Math.min(T,P);let z;const R=u/a*(o+1);if(y.isDash){const W=o-Math.abs(R);z=Math.sqrt(M*M+W*W)}else z=o-Math.sqrt(M*M+R*R);this.data[f+b]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e){for(let g=e.length-1;g>=0;--g){const y=e[g],b=e[g+1];y.zeroLength?e.splice(g,1):b&&b.isDash===y.isDash&&(b.left=y.left,e.splice(g,1))}const i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const o=this.width*this.nextRow;let u=0,f=e[u];for(let g=0;g<this.width;g++){g/f.right>1&&(f=e[++u]);const y=Math.abs(g-f.left),b=Math.abs(g-f.right),T=Math.min(y,b);this.data[o+g]=Math.max(0,Math.min(255,(f.isDash?T:-T)+128))}}addDash(e,i){const a=i?7:0,o=2*a+1;if(this.nextRow+o>this.height)return c.w("LineAtlas out of space"),null;let u=0;for(let g=0;g<e.length;g++)u+=e[g];if(u!==0){const g=this.width/u,y=this.getDashRanges(e,this.width,g);i?this.addRoundDash(y,g,a):this.addRegularDash(y)}const f={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:u};return this.nextRow+=o,this.dirty=!0,f}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const $r="maplibre_preloaded_worker_pool";class Vi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Vi.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$r]}numActive(){return Object.keys(this.active).length}}const mn=Math.floor(Le.hardwareConcurrency/2);let pr,xt;function fr(){return pr||(pr=new Vi),pr}Vi.workerCount=c.G(globalThis)?Math.max(Math.min(mn,3),1):1;class Bt{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const a=this.workerPool.acquire(i);for(let o=0;o<a.length;o++){const u=new c.H(a[o],i);u.name=`Worker ${o}`,this.actors.push(u)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const a=[];for(const o of this.actors)a.push(o.sendAsync({type:e,data:i}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const a of this.actors)a.registerMessageHandler(e,i)}}function ni(){return xt||(xt=new Bt(fr(),c.J),xt.registerMessageHandler("GR",(h,e,i)=>c.m(e,i))),xt}function rr(h,e){const i=c.K();return c.L(i,i,[1,1,0]),c.M(i,i,[.5*h.width,.5*h.height,1]),h.calculatePosMatrix?c.N(i,i,h.calculatePosMatrix(e.toUnwrapped())):i}function qr(h,e,i,a,o,u,f){var g;const y=function(M,z,R){if(M)for(const W of M){const H=z[W];if(H&&H.source===R&&H.type==="fill-extrusion")return!0}else for(const W in z){const H=z[W];if(H.source===R&&H.type==="fill-extrusion")return!0}return!1}((g=o==null?void 0:o.layers)!==null&&g!==void 0?g:null,e,h.id),b=u.maxPitchScaleFactor(),T=h.tilesIn(a,b,y);T.sort(nr);const P=[];for(const M of T)P.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,i,h._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,o,u,b,rr(h.transform,M.tileID),f?(z,R)=>f(M.tileID,z,R):void 0)});return function(M,z){for(const R in M)for(const W of M[R])Ki(W,z);return M}(function(M){const z={},R={};for(const W of M){const H=W.queryResults,K=W.wrappedTileID,J=R[K]=R[K]||{};for(const ie in H){const te=H[ie],re=J[ie]=J[ie]||{},le=z[ie]=z[ie]||[];for(const se of te)re[se.featureIndex]||(re[se.featureIndex]=!0,le.push(se))}}return z}(P),h)}function nr(h,e){const i=h.tileID,a=e.tileID;return i.overscaledZ-a.overscaledZ||i.canonical.y-a.canonical.y||i.wrap-a.wrap||i.canonical.x-a.canonical.x}function Ki(h,e){const i=h.feature,a=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}function Zi(h,e,i){return c._(this,void 0,void 0,function*(){let a=h;if(h.url?a=(yield c.j(e.transformRequest(h.url,"Source"),i)).data:yield Le.frameAsync(i),!a)return null;const o=c.O(c.e(a,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(o.vectorLayerIds=a.vector_layers.map(u=>u.id)),o})}class Gt{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.Q?new c.Q(e.lng,e.lat):c.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.Q?new c.Q(e.lng,e.lat):c.Q.convert(e),this}extend(e){const i=this._sw,a=this._ne;let o,u;if(e instanceof c.Q)o=e,u=e;else{if(!(e instanceof Gt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Gt.convert(e)):this.extend(c.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.Q.convert(e)):this;if(o=e._sw,u=e._ne,!o||!u)return this}return i||a?(i.lng=Math.min(o.lng,i.lng),i.lat=Math.min(o.lat,i.lat),a.lng=Math.max(u.lng,a.lng),a.lat=Math.max(u.lat,a.lat)):(this._sw=new c.Q(o.lng,o.lat),this._ne=new c.Q(u.lng,u.lat)),this}getCenter(){return new c.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.Q(this.getWest(),this.getNorth())}getSouthEast(){return new c.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=c.Q.convert(e);let o=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&o}static convert(e){return e instanceof Gt?e:e&&new Gt(e)}static fromLngLat(e,i=0){const a=360*i/40075017,o=a/Math.cos(Math.PI/180*e.lat);return new Gt(new c.Q(e.lng-o,e.lat-a),new c.Q(e.lng+o,e.lat+a))}adjustAntiMeridian(){const e=new c.Q(this._sw.lng,this._sw.lat),i=new c.Q(this._ne.lng,this._ne.lat);return new Gt(e,e.lng>i.lng?new c.Q(i.lng+360,i.lat):i)}}class Dr{constructor(e,i,a){this.bounds=Gt.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),a=Math.floor(c.U(this.bounds.getWest())*i),o=Math.floor(c.S(this.bounds.getNorth())*i),u=Math.ceil(c.U(this.bounds.getEast())*i),f=Math.ceil(c.S(this.bounds.getSouth())*i);return e.x>=a&&e.x<u&&e.y>=o&&e.y<f}}class an extends c.E{constructor(e,i,a,o){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.O(i,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Zi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Dr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};a.request.collectResourceTiming=this._collectResourceTiming;let o="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((u,f)=>{e.reloadPromise={resolve:u,reject:f}})}else e.actor=this.dispatcher.getActor(),o="LT";e.abortController=new AbortController;try{const u=yield e.actor.sendAsync({type:o,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,u)}catch(u){if(delete e.abortController,e.aborted)return;if(u&&u.status!==404)throw u;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Tr extends c.E{constructor(e,i,a,o){super(),this.id=e,this.dispatcher=a,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},i),c.e(this,c.O(i,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Zi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(c.e(this,i),i.bounds&&(this.tileBounds=new Dr(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new c.k(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Ce.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&(a.cacheControl||a.expires)&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const o=this.map.painter.context,u=o.gl,f=a.data;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new ge(o,f,u.RGBA,{useMipmap:!0}),e.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class es extends Tr{constructor(e,i,a,o){super(e,i,a,o),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const o=yield Ce.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){const u=o.data;this.map._refreshExpiredTiles&&(o.cacheControl||o.expires)&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});const f=c.b(u)&&c.V()?u:yield this.readImageNow(u),g={type:this.type,uid:e.uid,source:this.id,rawImageData:f,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const y=yield e.actor.sendAsync({type:"LDT",data:g});e.dem=y,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.W()){const i=e.width+2,a=e.height+2;try{return new c.R({width:i,height:a},yield c.X(e,-1,-1,i,a))}catch{}}return Le.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,a=Math.pow(2,i.z),o=(i.x-1+a)%a,u=i.x===0?e.wrap-1:e.wrap,f=(i.x+1+a)%a,g=i.x+1===a?e.wrap+1:e.wrap,y={};return y[new c.Y(e.overscaledZ,u,i.z,o,i.y).key]={backfilled:!1},y[new c.Y(e.overscaledZ,g,i.z,f,i.y).key]={backfilled:!1},i.y>0&&(y[new c.Y(e.overscaledZ,u,i.z,o,i.y-1).key]={backfilled:!1},y[new c.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},y[new c.Y(e.overscaledZ,g,i.z,f,i.y-1).key]={backfilled:!1}),i.y+1<a&&(y[new c.Y(e.overscaledZ,u,i.z,o,i.y+1).key]={backfilled:!1},y[new c.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},y[new c.Y(e.overscaledZ,g,i.z,f,i.y+1).key]={backfilled:!1}),y}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class ts extends c.E{constructor(e,i,a,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(o),this._data=i.data,this._options=c.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:c.Z,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:c.Z,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(c.Z/this.tileSize)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(i=>i.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,function*(){const e=new Gt,i=yield this.getData();let a;switch(i.type){case"FeatureCollection":a=i.features.map(o=>this.getCoordinatesFromGeometry(o.geometry)).flat(1/0);break;case"Feature":a=this.getCoordinatesFromGeometry(i.geometry);break;default:a=this.getCoordinatesFromGeometry(i)}if(a.length==0)return e;for(let o=0;o<a.length-1;o+=2)e.extend([a[o],a[o+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const i=c.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(Le.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.l("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));let o=null;a.resourceTiming&&a.resourceTiming[this.id]&&(o=a.resourceTiming[this.id].slice(0));const u={dataType:"source"};this._collectResourceTiming&&o&&o.length>0&&c.e(u,{resourceTiming:o}),this.fire(new c.l("data",Object.assign(Object.assign({},u),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},u),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const o=yield this.actor.sendAsync({type:i,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(o,this.map.painter,i==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class mr extends c.E{constructor(e,i,a,o){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=i}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield Ce.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new c.k(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(c.$.fromLngLat);var a;return this.tileID=function(o){let u=1/0,f=1/0,g=-1/0,y=-1/0;for(const M of o)u=Math.min(u,M.x),f=Math.min(f,M.y),g=Math.max(g,M.x),y=Math.max(y,M.y);const b=Math.max(g-u,y-f),T=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),P=Math.pow(2,T);return new c.a1(T,Math.floor((u+g)/2*P),Math.floor((f+y)/2*P))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(o=>this.tileID.getTilePoint(o)._round()),this.flippedWindingOrder=((a=this.tileCoords)[1].x-a[0].x)*(a[2].y-a[0].y)-(a[1].y-a[0].y)*(a[2].x-a[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new ge(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,a=!0)}a&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let i=1/0,a=1/0,o=-1/0,u=-1/0;for(const g of e)i=Math.min(i,g.x),a=Math.min(a,g.y),o=Math.max(o,g.x),u=Math.max(u,g.y);const f={};for(let g=0;g<=c.a0;g++){const y=Math.pow(2,g),b=Math.floor(i*y),T=Math.floor(a*y),P=Math.floor(o*y),M=Math.floor(u*y);f[g]={minTileX:b,minTileY:T,maxTileX:P,maxTileY:M}}return f}}class Br extends mr{constructor(e,i,a,o){super(e,i,a,o),this.roundZoom=!0,this.type="video",this.options=i}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield c.a2(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new c.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new c.k(new c.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new ge(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture,a=!0)}a&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class gn extends mr{constructor(e,i,a,o){super(e,i,a,o),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(u=>!Array.isArray(u)||u.length!==2||u.some(f=>typeof f!="number"))||this.fire(new c.k(new c.a3(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a3(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new c.k(new c.a3(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a3(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a3(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,a=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ge(i,this.canvas,a.RGBA,{premultiply:!0});let o=!1;for(const u in this.tiles){const f=this.tiles[u];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,o=!0)}o&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const _n={},Hr=h=>{switch(h){case"geojson":return ts;case"image":return mr;case"raster":return Tr;case"raster-dem":return es;case"vector":return an;case"video":return Br;case"canvas":return gn}return _n[h]},Ln="RTLPluginLoaded";class Rn extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ni()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(i,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Le.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(Ln))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Wr=null;function Cr(){return Wr||(Wr=new Rn),Wr}class Fr{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(o,u){const f={};if(!u)return f;for(const g of o){const y=g.layerIds.map(b=>u.getLayer(b)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(const b of y)f[b.id]=g}}return f}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const o in this.buckets){const u=this.buckets[o];if(u instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const o in this.buckets){const u=this.buckets[o];if(u instanceof c.a6&&u.hasRTLText){this.hasRTLText=!0,Cr().lazyLoad();break}}this.queryPadding=0;for(const o in this.buckets){const u=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(o).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const o=this.buckets[a];o.uploadPending()&&o.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ge(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ge(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,o,u,f,g,y,b,T,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:o,cameraQueryGeometry:u,scale:f,tileSize:this.tileSize,pixelPosMatrix:T,transform:y,params:g,queryPadding:this.queryPadding*b,getElevation:P},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const o=a.loadVTLayers(),u=i&&i.sourceLayer?i.sourceLayer:"",f=o._geojsonTileLayer||o[u];if(!f)return;const g=c.a7(i&&i.filter),{z:y,x:b,y:T}=this.tileID.canonical,P={z:y,x:b,y:T};for(let M=0;M<f.length;M++){const z=f.feature(M);if(g.needGeometry){const H=c.a8(z,!0);if(!g.filter(new c.C(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!g.filter(new c.C(this.tileID.overscaledZ),z))continue;const R=a.getId(z,u),W=new c.a9(z,y,b,T,R);W.tile=P,e.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let o=!1;if(this.expirationTime>a)o=!1;else if(i)if(this.expirationTime<i)o=!0;else{const u=this.expirationTime-i;u?this.expirationTime=a+Math.max(u,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const o in this.buckets){if(!i.style.hasLayer(o))continue;const u=this.buckets[o],f=u.layers[0].sourceLayer||"_geojsonTileLayer",g=a[f],y=e[f];if(!g||!y||Object.keys(y).length===0)continue;u.update(y,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});const b=i&&i.style&&i.style.getLayer(o);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(u)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Le.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Le.now()+e}setDependencies(e,i){const a={};for(const o of i)a[o]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const o=this.dependencies[a];if(o){for(const u of i)if(o[u])return!0}}return!1}}class Li{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const o=e.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:i,timeout:void 0};if(a!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},a)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,o=i===void 0?0:this.data[a].indexOf(i),u=this.data[a][o];return this.data[a].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(u.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const o of this.data[a])e(o.value)||i.push(o);for(const a of i)this.remove(a.value.tileID,a)}}class yn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const o=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},c.e(this.stateChanges[e][o],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==o&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][o]===null){this.deletedStates[e][o]={};for(const u in this.state[e][o])a[u]||(this.deletedStates[e][o][u]=null)}else for(const u in a)this.deletedStates[e]&&this.deletedStates[e][o]&&this.deletedStates[e][o][u]===null&&delete this.deletedStates[e][o][u]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;const o=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][o]!==null&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][o])for(a in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][a]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),o=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][i];if(u===null)return{};for(const f in u)delete o[f]}return o}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const u={};for(const f in this.stateChanges[o])this.state[o][f]||(this.state[o][f]={}),c.e(this.state[o][f],this.stateChanges[o][f]),u[f]=this.state[o][f];a[o]=u}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const u={};if(this.deletedStates[o]===null)for(const f in this.state[o])u[f]={},this.state[o][f]={};else for(const f in this.deletedStates[o]){if(this.deletedStates[o][f]===null)this.state[o][f]={};else for(const g of Object.keys(this.deletedStates[o][f]))delete this.state[o][f][g];u[f]=this.state[o][f]}a[o]=a[o]||{},c.e(a[o],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const o in e)e[o].setFeatureState(a,i)}}const gr=89.25;function sr(h,e){const i=c.ae(e.lat,-85.051129,c.af);return new c.P(c.U(e.lng)*h,c.S(i)*h)}function Mr(h,e){return new c.$(e.x/h,e.y/h).toLngLat()}function ue(h){return h.cameraToCenterDistance*Math.min(.85*Math.tan(c.ab(90-h.pitch)),Math.tan(c.ab(gr-h.pitch)))}function F(h,e){const i=h.canonical,a=e/c.ac(i.z),o=i.x+Math.pow(2,i.z)*h.wrap,u=c.ad(new Float64Array(16));return c.L(u,u,[o*a,i.y*a,0]),c.M(u,u,[a/c.Z,a/c.Z,1]),u}function j(h,e,i,a,o){const u=c.$.fromLngLat(h,e),f=o*c.ag(1,h.lat),g=f*Math.cos(c.ab(i)),y=Math.sqrt(f*f-g*g),b=y*Math.sin(c.ab(-a)),T=y*Math.cos(c.ab(-a));return new c.$(u.x+b,u.y+T,u.z+g)}function G(h,e,i){const a=e.intersectsFrustum(h);if(!i)return a;const o=e.intersectsPlane(i);return a===0||o===0?0:a===2&&o===2?2:1}function Y(h,e,i){let a=0;const o=(i-e)/10;for(let u=0;u<10;u++)a+=o*Math.pow(Math.cos(e+(u+.5)/10*(i-e)),h);return a}function oe(h,e){return function(i,a,o,u,f){const g=2*((h-1)/c.ah(Math.cos(c.ab(gr-f))/Math.cos(c.ab(gr)))-1),y=Math.acos(o/u),b=2*Y(g-1,0,c.ab(f/2)),T=Math.min(c.ab(gr),y+c.ab(f/2)),P=Y(g-1,Math.min(T,y-c.ab(f/2)),T),M=Math.atan(a/o),z=Math.hypot(a,o);let R=i;return R+=c.ah(u/z/Math.max(.5,Math.cos(c.ab(f/2)))),R+=g*c.ah(Math.cos(M))/2,R-=c.ah(Math.max(1,P/b/e))/2,R}}const U=oe(9.314,3);function ye(h,e){const i=(e.roundZoom?Math.round:Math.floor)(h.zoom+c.ah(h.tileSize/e.tileSize));return Math.max(0,i)}function ce(h,e){const i=h.getCameraFrustum(),a=h.getClippingPlane(),o=h.screenPointToMercatorCoordinate(h.getCameraPoint()),u=c.$.fromLngLat(h.center,h.elevation);o.z=u.z+Math.cos(h.pitchInRadians)*h.cameraToCenterDistance/h.worldSize;const f=h.getCoveringTilesDetailsProvider(),g=f.allowVariableZoom(h,e),y=ye(h,e),b=e.minzoom||0,T=e.maxzoom!==void 0?e.maxzoom:h.maxZoom,P=Math.min(Math.max(0,y),T),M=Math.pow(2,P),z=[M*o.x,M*o.y,0],R=[M*u.x,M*u.y,0],W=Math.hypot(u.x-o.x,u.y-o.y),H=Math.abs(u.z-o.z),K=Math.hypot(W,H),J=re=>({zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),ie=[],te=[];if(h.renderWorldCopies&&f.allowWorldCopies())for(let re=1;re<=3;re++)ie.push(J(-re)),ie.push(J(re));for(ie.push(J(0));ie.length>0;){const re=ie.pop(),le=re.x,se=re.y;let _e=re.fullyVisible;const Ee={x:le,y:se,z:re.zoom},Te=f.getTileAABB(Ee,re.wrap,h.elevation,e);if(!_e){const We=G(i,Te,a);if(We===0)continue;_e=We===2}const Se=f.distanceToTile2d(o.x,o.y,Ee,Te);let Pe=y;g&&(Pe=(e.calculateTileZoom||U)(h.zoom+c.ah(h.tileSize/e.tileSize),Se,H,K,h.fov)),Pe=(e.roundZoom?Math.round:Math.floor)(Pe),Pe=Math.max(0,Pe);const Ke=Math.min(Pe,T);if(re.wrap=f.getWrap(u,Ee,re.wrap),re.zoom>=Ke){if(re.zoom<b)continue;const We=P-re.zoom,Ve=z[0]-.5-(le<<We),tt=z[1]-.5-(se<<We),wt=e.reparseOverscaled?Math.max(re.zoom,Pe):re.zoom;te.push({tileID:new c.Y(re.zoom===T?wt:re.zoom,re.wrap,re.zoom,le,se),distanceSq:c.ai([R[0]-.5-le,R[1]-.5-se]),tileDistanceToCamera:Math.sqrt(Ve*Ve+tt*tt)})}else for(let We=0;We<4;We++)ie.push({zoom:re.zoom+1,x:(le<<1)+We%2,y:(se<<1)+(We>>1),wrap:re.wrap,fullyVisible:_e})}return te.sort((re,le)=>re.distanceSq-le.distanceSq).map(re=>re.tileID)}class fe extends c.E{constructor(e,i,a){super(),this.id=e,this.dispatcher=a,this.on("data",o=>this._dataHandler(o)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((o,u,f,g)=>{const y=new(Hr(u.type))(o,u,f,g);if(y.id!==o)throw new Error(`Expected Source id to be ${o} instead of ${y.id}`);return y})(e,i,a,this),this._tiles={},this._cache=new Li(0,o=>this._unloadTile(o)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yn,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,a)}catch(o){e.state="errored",o.status!==404?this._source.fire(new c.k(o,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(xe).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&i.push(this._tiles[a]);return e?i.sort((a,o)=>{const u=a.tileID,f=o.tileID,g=new c.P(u.canonical.x,u.canonical.y)._rotate(-this.transform.bearingInRadians),y=new c.P(f.canonical.x,f.canonical.y)._rotate(-this.transform.bearingInRadians);return u.overscaledZ-f.overscaledZ||y.y-g.y||y.x-g.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(xe).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)(e||this._tiles[i].state!=="errored")&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),yield this._loadTile(a,e,i))})}_tileLoaded(e,i,a){e.timeAdded=Le.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let o=0;o<i.length;o++){const u=i[o];if(e.neighboringTiles&&e.neighboringTiles[u]){const f=this.getTileByID(u);a(e,f),a(f,e)}}function a(o,u){o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0;let f=u.tileID.canonical.x-o.tileID.canonical.x;const g=u.tileID.canonical.y-o.tileID.canonical.y,y=Math.pow(2,o.tileID.canonical.z),b=u.tileID.key;f===0&&g===0||Math.abs(g)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),u.dem&&o.dem&&(o.dem.backfillBorder(u.dem,f,g),o.neighboringTiles&&o.neighboringTiles[b]&&(o.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,o){for(const u in this._tiles){let f=this._tiles[u];if(o[u]||!f.hasData()||f.tileID.overscaledZ<=i||f.tileID.overscaledZ>a)continue;let g=f.tileID;for(;f&&f.tileID.overscaledZ>i+1;){const b=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[b.key],f&&f.hasData()&&(g=b)}let y=g;for(;y.overscaledZ>i;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]||e[y.canonical.key]){o[g.key]=g;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const o=e.scaledTo(a),u=this._getLoadedTile(o);if(u)return u}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,o=Math.floor(i*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),u=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(u)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const o in this._tiles){const u=this._tiles[o];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+i),a[u.tileID.key]=u}this._tiles=a;for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}}_updateCoveredAndRetainedTiles(e,i,a,o,u,f){const g={},y={},b=Object.keys(e),T=Le.now();for(const P of b){const M=e[P],z=this._tiles[P];if(!z||z.fadeEndTime!==0&&z.fadeEndTime<=T)continue;const R=this.findLoadedParent(M,i),W=this.findLoadedSibling(M),H=R||W||null;H&&(this._addTile(H.tileID),g[H.tileID.key]=H.tileID),y[P]=M}this._retainLoadedChildren(y,o,a,e);for(const P in g)e[P]||(this._coveredTiles[P]=!0,e[P]=g[P]);if(f){const P={},M={};for(const z of u)this._tiles[z.key].hasData()?P[z.key]=z:M[z.key]=z;for(const z in M){const R=M[z].children(this._source.maxzoom);this._tiles[R[0].key]&&this._tiles[R[1].key]&&this._tiles[R[2].key]&&this._tiles[R[3].key]&&(P[R[0].key]=e[R[0].key]=R[0],P[R[1].key]=e[R[1].key]=R[1],P[R[2].key]=e[R[2].key]=R[2],P[R[3].key]=e[R[3].key]=R[3],delete M[z])}for(const z in M){const R=M[z],W=this.findLoadedParent(R,this._source.minzoom),H=this.findLoadedSibling(R),K=W||H||null;if(K){P[K.tileID.key]=e[K.tileID.key]=K.tileID;for(const J in P)P[J].isChildOf(K.tileID)&&delete P[J]}}for(const z in this._tiles)P[z]||(this._coveredTiles[z]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new c.Y(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(a=ce(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(a=a.filter(T=>this._source.hasTile(T)))):a=[];const o=ye(e,this._source),u=Math.max(o-fe.maxOverzooming,this._source.minzoom),f=Math.max(o+fe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const T={};for(const P of a)if(P.canonical.z>this._source.minzoom){const M=P.scaledTo(P.canonical.z-1);T[M.key]=M;const z=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));T[z.key]=z}a=a.concat(Object.values(T))}const g=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=this._updateRetainedTiles(a,o);pe(this._source.type)&&this._updateCoveredAndRetainedTiles(y,u,f,o,a,i);for(const T in y)this._tiles[T].clearFadeHold();const b=c.aj(this._tiles,y);for(const T of b){const P=this._tiles[T];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(T)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var a;const o={},u={},f=Math.max(i-fe.maxOverzooming,this._source.minzoom),g=Math.max(i+fe.maxUnderzooming,this._source.minzoom),y={};for(const b of e){const T=this._addTile(b);o[b.key]=b,T.hasData()||i<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,i,g,o);for(const b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(i+1>this._source.maxzoom){const M=b.children(this._source.maxzoom)[0],z=this.getTile(M);if(z&&z.hasData()){o[M.key]=M;continue}}else{const M=b.children(this._source.maxzoom);if(o[M[0].key]&&o[M[1].key]&&o[M[2].key]&&o[M[3].key])continue}let P=T.wasRequested();for(let M=b.overscaledZ-1;M>=f;--M){const z=b.scaledTo(M);if(u[z.key])break;if(u[z.key]=!0,T=this.getTile(z),!T&&P&&(T=this._addTile(z)),T){const R=T.hasData();if((R||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||P)&&(o[z.key]=z),P=T.wasRequested(),R)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){a=this._loadedParentTiles[o.key];break}i.push(o.key);const u=o.scaledTo(o.overscaledZ-1);if(a=this._getLoadedTile(u),a)break;o=u}for(const u of i)this._loadedParentTiles[u]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,a=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=i;return i||(i=new Fr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,a||this._source.fire(new c.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}refreshTiles(e){for(const i in this._tiles)this._isIdRenderable(i)&&e.some(a=>a.equals(this._tiles[i].tileID.canonical))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,a){const o=[],u=this.transform;if(!u)return o;const f=a?u.getCameraQueryGeometry(e):e,g=e.map(R=>u.screenPointToMercatorCoordinate(R,this.terrain)),y=f.map(R=>u.screenPointToMercatorCoordinate(R,this.terrain)),b=this.getIds();let T=1/0,P=1/0,M=-1/0,z=-1/0;for(const R of y)T=Math.min(T,R.x),P=Math.min(P,R.y),M=Math.max(M,R.x),z=Math.max(z,R.y);for(let R=0;R<b.length;R++){const W=this._tiles[b[R]];if(W.holdingForFade())continue;const H=u.getCoveringTilesDetailsProvider().allowWorldCopies()?W.tileID:W.tileID.unwrapTo(0),K=Math.pow(2,u.zoom-W.tileID.overscaledZ),J=i*W.queryPadding*c.Z/W.tileSize/K,ie=[H.getTilePoint(new c.$(T,P)),H.getTilePoint(new c.$(M,z))];if(ie[0].x-J<c.Z&&ie[0].y-J<c.Z&&ie[1].x+J>=0&&ie[1].y+J>=0){const te=g.map(le=>H.getTilePoint(le)),re=y.map(le=>H.getTilePoint(le));o.push({tile:W,tileID:H,queryGeometry:te,cameraQueryGeometry:re,scale:K})}}return o}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(pe(this._source.type)){const e=Le.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const o=this._tiles[e];o&&o.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}}function xe(h,e){const i=Math.abs(2*h.wrap)-+(h.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||a-i||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function pe(h){return h==="raster"||h==="image"||h==="video"}fe.maxOverzooming=10,fe.maxUnderzooming=3;class De{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ae(e,0,1);let i=1,a=this._distances[i];const o=e*this.paddedLength+this.padding;for(;a<o&&i<this._distances.length;)a=this._distances[++i];const u=i-1,f=this._distances[u],g=a-f,y=g>0?(o-f)/g:0;return this.points[u].mult(1-y).add(this.points[i].mult(y))}}function qe(h,e){let i=!0;return h==="always"||h!=="never"&&e!=="never"||(i=!1),i}class Xe{constructor(e,i,a){const o=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(i/a);for(let f=0;f<this.xCellCount*this.yCellCount;f++)o.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,a,o,u){this._forEachCell(i,a,o,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(u)}insertCircle(e,i,a,o){this._forEachCell(i-o,a-o,i+o,a+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(a),this.circles.push(o)}_insertBoxCell(e,i,a,o,u,f){this.boxCells[u].push(f)}_insertCircleCell(e,i,a,o,u,f){this.circleCells[u].push(f)}_query(e,i,a,o,u,f,g){if(a<0||e>this.width||o<0||i>this.height)return[];const y=[];if(e<=0&&i<=0&&this.width<=a&&this.height<=o){if(u)return[{key:null,x1:e,y1:i,x2:a,y2:o}];for(let b=0;b<this.boxKeys.length;b++)y.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const T=this.circles[3*b],P=this.circles[3*b+1],M=this.circles[3*b+2];y.push({key:this.circleKeys[b],x1:T-M,y1:P-M,x2:T+M,y2:P+M})}}else this._forEachCell(e,i,a,o,this._queryCell,y,{hitTest:u,overlapMode:f,seenUids:{box:{},circle:{}}},g);return y}query(e,i,a,o){return this._query(e,i,a,o,!1,null)}hitTest(e,i,a,o,u,f){return this._query(e,i,a,o,!0,u,f).length>0}hitTestCircle(e,i,a,o,u){const f=e-a,g=e+a,y=i-a,b=i+a;if(g<0||f>this.width||b<0||y>this.height)return!1;const T=[];return this._forEachCell(f,y,g,b,this._queryCellCircle,T,{hitTest:!0,overlapMode:o,circle:{x:e,y:i,radius:a},seenUids:{box:{},circle:{}}},u),T.length>0}_queryCell(e,i,a,o,u,f,g,y){const{seenUids:b,hitTest:T,overlapMode:P}=g,M=this.boxCells[u];if(M!==null){const R=this.bboxes;for(const W of M)if(!b.box[W]){b.box[W]=!0;const H=4*W,K=this.boxKeys[W];if(e<=R[H+2]&&i<=R[H+3]&&a>=R[H+0]&&o>=R[H+1]&&(!y||y(K))&&(!T||!qe(P,K.overlapMode))&&(f.push({key:K,x1:R[H],y1:R[H+1],x2:R[H+2],y2:R[H+3]}),T))return!0}}const z=this.circleCells[u];if(z!==null){const R=this.circles;for(const W of z)if(!b.circle[W]){b.circle[W]=!0;const H=3*W,K=this.circleKeys[W];if(this._circleAndRectCollide(R[H],R[H+1],R[H+2],e,i,a,o)&&(!y||y(K))&&(!T||!qe(P,K.overlapMode))){const J=R[H],ie=R[H+1],te=R[H+2];if(f.push({key:K,x1:J-te,y1:ie-te,x2:J+te,y2:ie+te}),T)return!0}}}return!1}_queryCellCircle(e,i,a,o,u,f,g,y){const{circle:b,seenUids:T,overlapMode:P}=g,M=this.boxCells[u];if(M!==null){const R=this.bboxes;for(const W of M)if(!T.box[W]){T.box[W]=!0;const H=4*W,K=this.boxKeys[W];if(this._circleAndRectCollide(b.x,b.y,b.radius,R[H+0],R[H+1],R[H+2],R[H+3])&&(!y||y(K))&&!qe(P,K.overlapMode))return f.push(!0),!0}}const z=this.circleCells[u];if(z!==null){const R=this.circles;for(const W of z)if(!T.circle[W]){T.circle[W]=!0;const H=3*W,K=this.circleKeys[W];if(this._circlesCollide(R[H],R[H+1],R[H+2],b.x,b.y,b.radius)&&(!y||y(K))&&!qe(P,K.overlapMode))return f.push(!0),!0}}}_forEachCell(e,i,a,o,u,f,g,y){const b=this._convertToXCellCoord(e),T=this._convertToYCellCoord(i),P=this._convertToXCellCoord(a),M=this._convertToYCellCoord(o);for(let z=b;z<=P;z++)for(let R=T;R<=M;R++)if(u.call(this,e,i,a,o,this.xCellCount*R+z,f,g,y))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,a,o,u,f){const g=o-e,y=u-i,b=a+f;return b*b>g*g+y*y}_circleAndRectCollide(e,i,a,o,u,f,g){const y=(f-o)/2,b=Math.abs(e-(o+y));if(b>y+a)return!1;const T=(g-u)/2,P=Math.abs(i-(u+T));if(P>T+a)return!1;if(b<=y||P<=T)return!0;const M=b-y,z=P-T;return M*M+z*z<=a*a}}function at(h,e,i){const a=c.K();if(!h){const{vecSouth:P,vecEast:M}=pt(e),z=Ze();z[0]=M[0],z[1]=M[1],z[2]=P[0],z[3]=P[1],o=z,(T=(f=(u=z)[0])*(b=u[3])-(y=u[2])*(g=u[1]))&&(o[0]=b*(T=1/T),o[1]=-g*T,o[2]=-y*T,o[3]=f*T),a[0]=z[0],a[1]=z[1],a[4]=z[2],a[5]=z[3]}var o,u,f,g,y,b,T;return c.M(a,a,[1/i,1/i,1]),a}function gt(h,e,i,a){if(h){const o=c.K();if(!e){const{vecSouth:u,vecEast:f}=pt(i);o[0]=f[0],o[1]=f[1],o[4]=u[0],o[5]=u[1]}return c.M(o,o,[a,a,1]),o}return i.pixelsToClipSpaceMatrix}function pt(h){const e=Math.cos(h.rollInRadians),i=Math.sin(h.rollInRadians),a=Math.cos(h.pitchInRadians),o=Math.cos(h.bearingInRadians),u=Math.sin(h.bearingInRadians),f=c.ao();f[0]=-o*a*i-u*e,f[1]=-u*a*i+o*e;const g=c.ap(f);g<1e-9?c.aq(f):c.ar(f,f,1/g);const y=c.ao();y[0]=o*a*e-u*i,y[1]=u*a*e+o*i;const b=c.ap(y);return b<1e-9?c.aq(y):c.ar(y,y,1/b),{vecEast:y,vecSouth:f}}function Me(h,e,i,a){let o;a?(o=[h,e,a(h,e),1],c.at(o,o,i)):(o=[h,e,0,1],bn(o,o,i));const u=o[3];return{point:new c.P(o[0]/u,o[1]/u),signedDistanceFromCamera:u,isOccluded:!1}}function Ft(h,e){return .5+h/e*.5}function Ct(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function Mt(h,e,i,a,o,u,f,g,y,b,T,P,M){const z=i?h.textSizeData:h.iconSizeData,R=c.ak(z,e.transform.zoom),W=[256/e.width*2+1,256/e.height*2+1],H=i?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;H.clear();const K=h.lineVertexArray,J=i?h.text.placedSymbolArray:h.icon.placedSymbolArray,ie=e.transform.width/e.transform.height;let te=!1;for(let re=0;re<J.length;re++){const le=J.get(re);if(le.hidden||le.writingMode===c.al.vertical&&!te){Kr(le.numGlyphs,H);continue}te=!1;const se=new c.P(le.anchorX,le.anchorY),_e={getElevation:M,pitchedLabelPlaneMatrix:a,lineVertexArray:K,pitchWithMap:u,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:se,unwrappedTileID:y,width:b,height:T,translation:P},Ee=bt(le.anchorX,le.anchorY,_e);if(!Ct(Ee.point,W)){Kr(le.numGlyphs,H);continue}const Te=Ft(e.transform.cameraToCenterDistance,Ee.signedDistanceFromCamera),Se=c.am(z,R,le),Pe=u?Se*e.transform.getPitchedTextCorrection(le.anchorX,le.anchorY,y)/Te:Se*Te,Ke=lt({projectionContext:_e,pitchedLabelPlaneMatrixInverse:o,symbol:le,fontSize:Pe,flip:!1,keepUpright:f,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:H,aspectRatio:ie,rotateToLine:g});te=Ke.useVertical,(Ke.notEnoughRoom||te||Ke.needsFlipping&&lt({projectionContext:_e,pitchedLabelPlaneMatrixInverse:o,symbol:le,fontSize:Pe,flip:!0,keepUpright:f,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:H,aspectRatio:ie,rotateToLine:g}).notEnoughRoom)&&Kr(le.numGlyphs,H)}i?h.text.dynamicLayoutVertexBuffer.updateData(H):h.icon.dynamicLayoutVertexBuffer.updateData(H)}function dt(h,e,i,a,o,u,f,g){const y=u.glyphStartIndex+u.numGlyphs,b=u.lineStartIndex,T=u.lineStartIndex+u.lineLength,P=e.getoffsetX(u.glyphStartIndex),M=e.getoffsetX(y-1),z=vn(h*P,i,a,o,u.segment,b,T,g,f);if(!z)return null;const R=vn(h*M,i,a,o,u.segment,b,T,g,f);return R?g.projectionCache.anyProjectionOccluded?null:{first:z,last:R}:null}function Be(h,e,i,a){return h===c.al.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*a?{useVertical:!0}:(h===c.al.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function lt(h){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:a,fontSize:o,flip:u,keepUpright:f,glyphOffsetArray:g,dynamicLayoutVertexArray:y,aspectRatio:b,rotateToLine:T}=h,P=o/24,M=a.lineOffsetX*P,z=a.lineOffsetY*P;let R;if(a.numGlyphs>1){const W=a.glyphStartIndex+a.numGlyphs,H=a.lineStartIndex,K=a.lineStartIndex+a.lineLength,J=dt(P,g,M,z,u,a,T,e);if(!J)return{notEnoughRoom:!0};const ie=ar(J.first.point.x,J.first.point.y,e,i),te=ar(J.last.point.x,J.last.point.y,e,i);if(f&&!u){const re=Be(a.writingMode,ie,te,b);if(re)return re}R=[J.first];for(let re=a.glyphStartIndex+1;re<W-1;re++)R.push(vn(P*g.getoffsetX(re),M,z,u,a.segment,H,K,e,T));R.push(J.last)}else{if(f&&!u){const H=Vt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,K=a.lineStartIndex+a.segment+1,J=new c.P(e.lineVertexArray.getx(K),e.lineVertexArray.gety(K)),ie=Vt(J.x,J.y,e),te=ie.signedDistanceFromCamera>0?ie.point:_t(e.tileAnchorPoint,J,H,1,e),re=ar(H.x,H.y,e,i),le=ar(te.x,te.y,e,i),se=Be(a.writingMode,re,le,b);if(se)return se}const W=vn(P*g.getoffsetX(a.glyphStartIndex),M,z,u,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,e,T);if(!W||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};R=[W]}for(const W of R)c.as(y,W.point,W.angle);return{}}function _t(h,e,i,a,o){const u=h.add(h.sub(e)._unit()),f=Vt(u.x,u.y,o).point,g=i.sub(f);return i.add(g._mult(a/g.mag()))}function si(h,e,i){const a=e.projectionCache;if(a.projections[h])return a.projections[h];const o=new c.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),u=Vt(o.x,o.y,e);if(u.signedDistanceFromCamera>0)return a.projections[h]=u.point,a.anyProjectionOccluded=a.anyProjectionOccluded||u.isOccluded,u.point;const f=h-i.direction;return _t(i.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),o,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function Vt(h,e,i){const a=h+i.translation[0],o=e+i.translation[1];let u;return i.pitchWithMap?(u=Me(a,o,i.pitchedLabelPlaneMatrix,i.getElevation),u.isOccluded=!1):(u=i.transform.projectTileCoordinates(a,o,i.unwrappedTileID,i.getElevation),u.point.x=(.5*u.point.x+.5)*i.width,u.point.y=(.5*-u.point.y+.5)*i.height),u}function ar(h,e,i,a){if(i.pitchWithMap){const o=[h,e,0,1];return c.at(o,o,a),i.transform.projectTileCoordinates(o[0]/o[3],o[1]/o[3],i.unwrappedTileID,i.getElevation).point}return{x:h/i.width*2-1,y:e/i.height*2-1}}function bt(h,e,i){return i.transform.projectTileCoordinates(h,e,i.unwrappedTileID,i.getElevation)}function Dn(h,e,i){return h._unit()._perp()._mult(e*i)}function is(h,e,i,a,o,u,f,g,y){if(g.projectionCache.offsets[h])return g.projectionCache.offsets[h];const b=i.add(e);if(h+y.direction<a||h+y.direction>=o)return g.projectionCache.offsets[h]=b,b;const T=si(h+y.direction,g,y),P=Dn(T.sub(i),f,y.direction),M=i.add(P),z=T.add(P);return g.projectionCache.offsets[h]=c.au(u,b,M,z)||b,g.projectionCache.offsets[h]}function vn(h,e,i,a,o,u,f,g,y){const b=a?h-e:h+e;let T=b>0?1:-1,P=0;a&&(T*=-1,P=Math.PI),T<0&&(P+=Math.PI);let M,z=T>0?u+o:u+o+1;g.projectionCache.cachedAnchorPoint?M=g.projectionCache.cachedAnchorPoint:(M=Vt(g.tileAnchorPoint.x,g.tileAnchorPoint.y,g).point,g.projectionCache.cachedAnchorPoint=M);let R,W,H=M,K=M,J=0,ie=0;const te=Math.abs(b),re=[];let le;for(;J+ie<=te;){if(z+=T,z<u||z>=f)return null;J+=ie,K=H,W=R;const Ee={absOffsetX:te,direction:T,distanceFromAnchor:J,previousVertex:K};if(H=si(z,g,Ee),i===0)re.push(K),le=H.sub(K);else{let Te;const Se=H.sub(K);Te=Se.mag()===0?Dn(si(z+T,g,Ee).sub(H),i,T):Dn(Se,i,T),W||(W=K.add(Te)),R=is(z,Te,H,u,f,W,i,g,Ee),re.push(W),le=R.sub(W)}ie=le.mag()}const se=le._mult((te-J)/ie)._add(W||K),_e=P+Math.atan2(H.y-K.y,H.x-K.x);return re.push(se),{point:se,angle:y?_e:0,path:re}}const Pr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Kr(h,e){for(let i=0;i<h;i++){const a=e.length;e.resize(a+4),e.float32.set(Pr,3*a)}}function bn(h,e,i){const a=e[0],o=e[1];return h[0]=i[0]*a+i[4]*o+i[12],h[1]=i[1]*a+i[5]*o+i[13],h[3]=i[3]*a+i[7]*o+i[15],h}const fi=100;class _r{constructor(e,i=new Xe(e.width+200,e.height+200,25),a=new Xe(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=a,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+fi,this.screenBottomBoundary=e.height+fi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,a,o,u,f,g,y,b,T,P,M){const z=this.projectAndGetPerspectiveRatio(e.anchorPointX+y[0],e.anchorPointY+y[1],u,T,M),R=a*z.perspectiveRatio;let W;if(f||g)W=this._projectCollisionBox(e,R,o,u,f,g,y,z,T,P,M);else{const le=z.x+(P?P.x*R:0),se=z.y+(P?P.y*R:0);W={allPointsOccluded:!1,box:[le+e.x1*R,se+e.y1*R,le+e.x2*R,se+e.y2*R]}}const[H,K,J,ie]=W.box,te=f?W.allPointsOccluded:z.isOccluded;let re=te;return re||(re=z.perspectiveRatio<this.perspectiveRatioCutoff),re||(re=!this.isInsideGrid(H,K,J,ie)),re||i!=="always"&&this.grid.hitTest(H,K,J,ie,i,b)?{box:[H,K,J,ie],placeable:!1,offscreen:!1,occluded:te}:{box:[H,K,J,ie],placeable:!0,offscreen:this.isOffscreen(H,K,J,ie),occluded:te}}placeCollisionCircles(e,i,a,o,u,f,g,y,b,T,P,M,z,R){const W=[],H=new c.P(i.anchorX,i.anchorY),K=this.getPerspectiveRatio(H.x,H.y,f,R),J=(b?u*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,f)/K:u*K)/c.ay,ie={getElevation:R,pitchedLabelPlaneMatrix:g,lineVertexArray:a,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:H,unwrappedTileID:f,width:this.transform.width,height:this.transform.height,translation:z},te=dt(J,o,i.lineOffsetX*J,i.lineOffsetY*J,!1,i,!1,ie);let re=!1,le=!1,se=!0;if(te){const _e=.5*P*K+M,Ee=new c.P(-100,-100),Te=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Se=new De,Pe=te.first,Ke=te.last;let We=[];for(let wt=Pe.path.length-1;wt>=1;wt--)We.push(Pe.path[wt]);for(let wt=1;wt<Ke.path.length;wt++)We.push(Ke.path[wt]);const Ve=2.5*_e;if(b){const wt=this.projectPathToScreenSpace(We,ie);We=wt.some(Rt=>Rt.signedDistanceFromCamera<=0)?[]:wt.map(Rt=>Rt.point)}let tt=[];if(We.length>0){const wt=We[0].clone(),Rt=We[0].clone();for(let ci=1;ci<We.length;ci++)wt.x=Math.min(wt.x,We[ci].x),wt.y=Math.min(wt.y,We[ci].y),Rt.x=Math.max(Rt.x,We[ci].x),Rt.y=Math.max(Rt.y,We[ci].y);tt=wt.x>=Ee.x&&Rt.x<=Te.x&&wt.y>=Ee.y&&Rt.y<=Te.y?[We]:Rt.x<Ee.x||wt.x>Te.x||Rt.y<Ee.y||wt.y>Te.y?[]:c.av([We],Ee.x,Ee.y,Te.x,Te.y)}for(const wt of tt){Se.reset(wt,.25*_e);let Rt=0;Rt=Se.length<=.5*_e?1:Math.ceil(Se.paddedLength/Ve)+1;for(let ci=0;ci<Rt;ci++){const Yt=ci/Math.max(Rt-1,1),hi=Se.lerp(Yt),ui=hi.x+fi,Qt=hi.y+fi;W.push(ui,Qt,_e,0);const Zt=ui-_e,Fi=Qt-_e,Gi=ui+_e,Qi=Qt+_e;if(se=se&&this.isOffscreen(Zt,Fi,Gi,Qi),le=le||this.isInsideGrid(Zt,Fi,Gi,Qi),e!=="always"&&this.grid.hitTestCircle(ui,Qt,_e,e,T)&&(re=!0,!y))return{circles:[],offscreen:!1,collisionDetected:re}}}}return{circles:!y&&re||!le||K<this.perspectiveRatioCutoff?[]:W,offscreen:se,collisionDetected:re}}projectPathToScreenSpace(e,i){const a=function(o,u){const f=c.K();return c.an(f,u.pitchedLabelPlaneMatrix),o.map(g=>{const y=Me(g.x,g.y,f,u.getElevation),b=u.transform.projectTileCoordinates(y.point.x,y.point.y,u.unwrappedTileID,u.getElevation);return b.point.x=(.5*b.point.x+.5)*u.width,b.point.y=(.5*-b.point.y+.5)*u.height,b})}(e,i);return function(o){let u=0,f=0,g=0,y=0;for(let b=0;b<o.length;b++)o[b].isOccluded?(g=b+1,y=0):(y++,y>f&&(f=y,u=g));return o.slice(u,u+f)}(a)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let a=1/0,o=1/0,u=-1/0,f=-1/0;for(const T of e){const P=new c.P(T.x+fi,T.y+fi);a=Math.min(a,P.x),o=Math.min(o,P.y),u=Math.max(u,P.x),f=Math.max(f,P.y),i.push(P)}const g=this.grid.query(a,o,u,f).concat(this.ignoredGrid.query(a,o,u,f)),y={},b={};for(const T of g){const P=T.key;if(y[P.bucketInstanceId]===void 0&&(y[P.bucketInstanceId]={}),y[P.bucketInstanceId][P.featureIndex])continue;const M=[new c.P(T.x1,T.y1),new c.P(T.x2,T.y1),new c.P(T.x2,T.y2),new c.P(T.x1,T.y2)];c.aw(i,M)&&(y[P.bucketInstanceId][P.featureIndex]=!0,b[P.bucketInstanceId]===void 0&&(b[P.bucketInstanceId]=[]),b[P.bucketInstanceId].push(P.featureIndex))}return b}insertCollisionBox(e,i,a,o,u,f){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:u,collisionGroupID:f,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,a,o,u,f){const g=a?this.ignoredGrid:this.grid,y={bucketInstanceId:o,featureIndex:u,collisionGroupID:f,overlapMode:i};for(let b=0;b<e.length;b+=4)g.insertCircle(y,e[b],e[b+1],e[b+2])}projectAndGetPerspectiveRatio(e,i,a,o,u){if(u){let f;o?(f=[e,i,o(e,i),1],c.at(f,f,u)):(f=[e,i,0,1],bn(f,f,u));const g=f[3];return{x:(f[0]/g+1)/2*this.transform.width+fi,y:(-f[1]/g+1)/2*this.transform.height+fi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/g*.5,isOccluded:!1,signedDistanceFromCamera:g}}{const f=this.transform.projectTileCoordinates(e,i,a,o);return{x:(f.point.x+1)/2*this.transform.width+fi,y:(1-f.point.y)/2*this.transform.height+fi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/f.signedDistanceFromCamera*.5,isOccluded:f.isOccluded,signedDistanceFromCamera:f.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,a,o){const u=this.transform.projectTileCoordinates(e,i,a,o);return .5+this.transform.cameraToCenterDistance/u.signedDistanceFromCamera*.5}isOffscreen(e,i,a,o){return a<fi||e>=this.screenRightBoundary||o<fi||i>this.screenBottomBoundary}isInsideGrid(e,i,a,o){return a>=0&&e<this.gridRightBoundary&&o>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=c.ad([]);return c.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,a,o,u,f,g,y,b,T,P){let M=1,z=0,R=0,W=1;const H=e.anchorPointX+g[0],K=e.anchorPointY+g[1];if(f&&!u){const We=this.projectAndGetPerspectiveRatio(H+1,K,o,b,P),Ve=We.x-y.x,tt=Math.atan((We.y-y.y)/Ve)+(Ve<0?Math.PI:0),wt=Math.sin(tt),Rt=Math.cos(tt);M=Rt,z=wt,R=-wt,W=Rt}else if(!f&&u){const We=pt(this.transform);M=We.vecEast[0],z=We.vecEast[1],R=We.vecSouth[0],W=We.vecSouth[1]}let J=y.x,ie=y.y,te=i;u&&(J=H,ie=K,te=Math.pow(2,-(this.transform.zoom-a.overscaledZ)),te*=this.transform.getPitchedTextCorrection(H,K,o),T||(te*=c.ae(.5+y.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),T&&(J+=M*T.x*te+R*T.y*te,ie+=z*T.x*te+W*T.y*te);const re=e.x1*te,le=e.x2*te,se=(re+le)/2,_e=e.y1*te,Ee=e.y2*te,Te=(_e+Ee)/2,Se=[{offsetX:re,offsetY:_e},{offsetX:se,offsetY:_e},{offsetX:le,offsetY:_e},{offsetX:le,offsetY:Te},{offsetX:le,offsetY:Ee},{offsetX:se,offsetY:Ee},{offsetX:re,offsetY:Ee},{offsetX:re,offsetY:Te}];let Pe=[];for(const{offsetX:We,offsetY:Ve}of Se)Pe.push(new c.P(J+M*We+R*Ve,ie+z*We+W*Ve));let Ke=!1;if(u){const We=Pe.map(Ve=>this.projectAndGetPerspectiveRatio(Ve.x,Ve.y,o,b,P));Ke=We.some(Ve=>!Ve.isOccluded),Pe=We.map(Ve=>new c.P(Ve.x,Ve.y))}else Ke=!0;return{box:c.ax(Pe),allPointsOccluded:!Ke}}}class Jt{constructor(e,i,a,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):o&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class on{constructor(e,i,a,o,u){this.text=new Jt(e?e.text:null,i,a,u),this.icon=new Jt(e?e.icon:null,i,o,u)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bn{constructor(e,i,a){this.text=e,this.icon=i,this.skipFade=a}}class Hs{constructor(e,i,a,o,u){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=a,this.bucketIndex=o,this.tileID=u}}class or{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:a=>a.collisionGroupID===i}}return this.collisionGroups[e]}}function Xr(h,e,i,a,o){const{horizontalAlign:u,verticalAlign:f}=c.aE(h);return new c.P(-(u-.5)*e+a[0]*o,-(f-.5)*i+a[1]*o)}class Ea{constructor(e,i,a,o,u){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new _r(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new or(o),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=u,u&&(u.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(a,o)=>i.getElevation(e,a,o):null}getBucketParts(e,i,a,o){const u=a.getBucket(i),f=a.latestFeatureIndex;if(!u||!f||i.id!==u.layerIds[0])return;const g=a.collisionBoxArray,y=u.layers[0].layout,b=u.layers[0].paint,T=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),P=a.tileSize/c.Z,M=a.tileID.toUnwrapped(),z=y.get("text-rotation-alignment")==="map",R=c.az(a,1,this.transform.zoom),W=c.aA(this.collisionIndex.transform,a,b.get("text-translate"),b.get("text-translate-anchor")),H=c.aA(this.collisionIndex.transform,a,b.get("icon-translate"),b.get("icon-translate-anchor")),K=at(z,this.transform,R);this.retainedQueryData[u.bucketInstanceId]=new Hs(u.bucketInstanceId,f,u.sourceLayerIndex,u.index,a.tileID);const J={bucket:u,layout:y,translationText:W,translationIcon:H,unwrappedTileID:M,pitchedLabelPlaneMatrix:K,scale:T,textPixelRatio:P,holdingForFade:a.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:c.ak(u.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(o)for(const ie of u.sortKeyRanges){const{sortKey:te,symbolInstanceStart:re,symbolInstanceEnd:le}=ie;e.push({sortKey:te,symbolInstanceStart:re,symbolInstanceEnd:le,parameters:J})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:J})}attemptAnchorPlacement(e,i,a,o,u,f,g,y,b,T,P,M,z,R,W,H,K,J,ie,te){const re=c.aB[e.textAnchor],le=[e.textOffset0,e.textOffset1],se=Xr(re,a,o,le,u),_e=this.collisionIndex.placeCollisionBox(i,M,y,b,T,g,f,H,P.predicate,ie,se,te);if((!J||this.collisionIndex.placeCollisionBox(J,M,y,b,T,g,f,K,P.predicate,ie,se,te).placeable)&&_e.placeable){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[z.crossTileID].anchor),z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[z.crossTileID]={textOffset:le,width:a,height:o,anchor:re,textBoxScale:u,prevAnchor:Ee},this.markUsedJustification(R,re,z,W),R.allowVerticalPlacement&&(this.markUsedOrientation(R,W,z),this.placedOrientations[z.crossTileID]=W),{shift:se,placedGlyphBoxes:_e}}}placeLayerBucketPart(e,i,a){const{bucket:o,layout:u,translationText:f,translationIcon:g,unwrappedTileID:y,pitchedLabelPlaneMatrix:b,textPixelRatio:T,holdingForFade:P,collisionBoxArray:M,partiallyEvaluatedTextSize:z,collisionGroup:R}=e.parameters,W=u.get("text-optional"),H=u.get("icon-optional"),K=c.aC(u,"text-overlap","text-allow-overlap"),J=K==="always",ie=c.aC(u,"icon-overlap","icon-allow-overlap"),te=ie==="always",re=u.get("text-rotation-alignment")==="map",le=u.get("text-pitch-alignment")==="map",se=u.get("icon-text-fit")!=="none",_e=u.get("symbol-z-order")==="viewport-y",Ee=J&&(te||!o.hasIconData()||H),Te=te&&(J||!o.hasTextData()||W);!o.collisionArrays&&M&&o.deserializeCollisionBoxes(M);const Se=this.retainedQueryData[o.bucketInstanceId].tileID,Pe=this._getTerrainElevationFunc(Se),Ke=this.transform.getFastPathSimpleProjectionMatrix(Se),We=(Ve,tt,wt)=>{var Rt,ci;if(i[Ve.crossTileID])return;if(P)return void(this.placements[Ve.crossTileID]=new Bn(!1,!1,!1));let Yt=!1,hi=!1,ui=!0,Qt=null,Zt={box:null,placeable:!1,offscreen:null,occluded:!1},Fi={placeable:!1},Gi=null,Qi=null,Ut=null,qn=0,pn=0,Hn=0;tt.textFeatureIndex?qn=tt.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(qn=Ve.featureIndex),tt.verticalTextFeatureIndex&&(pn=tt.verticalTextFeatureIndex);const _s=tt.textBox;if(_s){const Er=Ai=>{let ki=c.al.horizontal;if(o.allowVerticalPlacement&&!Ai&&this.prevPlacement){const vr=this.prevPlacement.placedOrientations[Ve.crossTileID];vr&&(this.placedOrientations[Ve.crossTileID]=vr,ki=vr,this.markUsedOrientation(o,ki,Ve))}return ki},Kn=(Ai,ki)=>{if(o.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&tt.verticalTextBox){for(const vr of o.writingModes)if(vr===c.al.vertical?(Zt=ki(),Fi=Zt):Zt=Ai(),Zt&&Zt.placeable)break}else Zt=Ai()},Mn=Ve.textAnchorOffsetStartIndex,Xn=Ve.textAnchorOffsetEndIndex;if(Xn===Mn){const Ai=(ki,vr)=>{const ii=this.collisionIndex.placeCollisionBox(ki,K,T,Se,y,le,re,f,R.predicate,Pe,void 0,Ke);return ii&&ii.placeable&&(this.markUsedOrientation(o,vr,Ve),this.placedOrientations[Ve.crossTileID]=vr),ii};Kn(()=>Ai(_s,c.al.horizontal),()=>{const ki=tt.verticalTextBox;return o.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&ki?Ai(ki,c.al.vertical):{box:null,offscreen:null}}),Er(Zt&&Zt.placeable)}else{let Ai=c.aB[(ci=(Rt=this.prevPlacement)===null||Rt===void 0?void 0:Rt.variableOffsets[Ve.crossTileID])===null||ci===void 0?void 0:ci.anchor];const ki=(ii,fo,Pc)=>{const Ic=ii.x2-ii.x1,Ph=ii.y2-ii.y1,fl=Ve.textBoxScale,va=se&&ie==="never"?fo:null;let Zr=null,fn=K==="never"?1:2,Ur="never";Ai&&fn++;for(let Pn=0;Pn<fn;Pn++){for(let mo=Mn;mo<Xn;mo++){const Yn=o.textAnchorOffsets.get(mo);if(Ai&&Yn.textAnchor!==Ai)continue;const ml=this.attemptAnchorPlacement(Yn,ii,Ic,Ph,fl,re,le,T,Se,y,R,Ur,Ve,o,Pc,f,g,va,Pe);if(ml&&(Zr=ml.placedGlyphBoxes,Zr&&Zr.placeable))return Yt=!0,Qt=ml.shift,Zr}Ai?Ai=null:Ur=K}return a&&!Zr&&(Zr={box:this.collisionIndex.placeCollisionBox(_s,"always",T,Se,y,le,re,f,R.predicate,Pe,void 0,Ke).box,offscreen:!1,placeable:!1,occluded:!1}),Zr};Kn(()=>ki(_s,tt.iconBox,c.al.horizontal),()=>{const ii=tt.verticalTextBox;return o.allowVerticalPlacement&&(!Zt||!Zt.placeable)&&Ve.numVerticalGlyphVertices>0&&ii?ki(ii,tt.verticalIconBox,c.al.vertical):{box:null,occluded:!0,offscreen:null}}),Zt&&(Yt=Zt.placeable,ui=Zt.offscreen);const vr=Er(Zt&&Zt.placeable);if(!Yt&&this.prevPlacement){const ii=this.prevPlacement.variableOffsets[Ve.crossTileID];ii&&(this.variableOffsets[Ve.crossTileID]=ii,this.markUsedJustification(o,ii.anchor,Ve,vr))}}}if(Gi=Zt,Yt=Gi&&Gi.placeable,ui=Gi&&Gi.offscreen,Ve.useRuntimeCollisionCircles){const Er=o.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex),Kn=c.am(o.textSizeData,z,Er),Mn=u.get("text-padding");Qi=this.collisionIndex.placeCollisionCircles(K,Er,o.lineVertexArray,o.glyphOffsetArray,Kn,y,b,a,le,R.predicate,Ve.collisionCircleDiameter,Mn,f,Pe),Qi.circles.length&&Qi.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),Yt=J||Qi.circles.length>0&&!Qi.collisionDetected,ui=ui&&Qi.offscreen}if(tt.iconFeatureIndex&&(Hn=tt.iconFeatureIndex),tt.iconBox){const Er=Kn=>this.collisionIndex.placeCollisionBox(Kn,ie,T,Se,y,le,re,g,R.predicate,Pe,se&&Qt?Qt:void 0,Ke);Fi&&Fi.placeable&&tt.verticalIconBox?(Ut=Er(tt.verticalIconBox),hi=Ut.placeable):(Ut=Er(tt.iconBox),hi=Ut.placeable),ui=ui&&Ut.offscreen}const ya=W||Ve.numHorizontalGlyphVertices===0&&Ve.numVerticalGlyphVertices===0,Wn=H||Ve.numIconVertices===0;ya||Wn?Wn?ya||(hi=hi&&Yt):Yt=hi&&Yt:hi=Yt=hi&&Yt;const ys=hi&&Ut.placeable;if(Yt&&Gi.placeable&&this.collisionIndex.insertCollisionBox(Gi.box,K,u.get("text-ignore-placement"),o.bucketInstanceId,Fi&&Fi.placeable&&pn?pn:qn,R.ID),ys&&this.collisionIndex.insertCollisionBox(Ut.box,ie,u.get("icon-ignore-placement"),o.bucketInstanceId,Hn,R.ID),Qi&&Yt&&this.collisionIndex.insertCollisionCircles(Qi.circles,K,u.get("text-ignore-placement"),o.bucketInstanceId,qn,R.ID),a&&this.storeCollisionData(o.bucketInstanceId,wt,tt,Gi,Ut,Qi),Ve.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(o.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ve.crossTileID]=new Bn((Yt||Ee)&&!(Gi!=null&&Gi.occluded),(hi||Te)&&!(Ut!=null&&Ut.occluded),ui||o.justReloaded),i[Ve.crossTileID]=!0};if(_e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ve=o.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let tt=Ve.length-1;tt>=0;--tt){const wt=Ve[tt];We(o.symbolInstances.get(wt),o.collisionArrays[wt],wt)}}else for(let Ve=e.symbolInstanceStart;Ve<e.symbolInstanceEnd;Ve++)We(o.symbolInstances.get(Ve),o.collisionArrays[Ve],Ve);o.justReloaded=!1}storeCollisionData(e,i,a,o,u,f){if(a.textBox||a.iconBox){let g,y;this.collisionBoxArrays.has(e)?g=this.collisionBoxArrays.get(e):(g=new Map,this.collisionBoxArrays.set(e,g)),g.has(i)?y=g.get(i):(y={text:null,icon:null},g.set(i,y)),a.textBox&&(y.text=o.box),a.iconBox&&(y.icon=u.box)}if(f){let g=this.collisionCircleArrays[e];g===void 0&&(g=this.collisionCircleArrays[e]=[]);for(let y=0;y<f.circles.length;y+=4)g.push(f.circles[y+0]-fi),g.push(f.circles[y+1]-fi),g.push(f.circles[y+2]),g.push(f.collisionDetected?1:0)}}markUsedJustification(e,i,a,o){let u;u=o===c.al.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.aD(i)];const f=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const g of f)g>=0&&(e.text.placedSymbolArray.get(g).crossTileID=u>=0&&g!==u?0:a.crossTileID)}markUsedOrientation(e,i,a){const o=i===c.al.horizontal||i===c.al.horizontalOnly?i:0,u=i===c.al.vertical?i:0,f=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const g of f)e.text.placedSymbolArray.get(g).placedOrientation=o;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=u)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let a=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const o=i?i.symbolFadeChange(e):1,u=i?i.opacities:{},f=i?i.variableOffsets:{},g=i?i.placedOrientations:{};for(const y in this.placements){const b=this.placements[y],T=u[y];T?(this.opacities[y]=new on(T,o,b.text,b.icon),a=a||b.text!==T.text.placed||b.icon!==T.icon.placed):(this.opacities[y]=new on(null,o,b.text,b.icon,b.skipFade),a=a||b.text||b.icon)}for(const y in u){const b=u[y];if(!this.opacities[y]){const T=new on(b,o,!1,!1);T.isHidden()||(this.opacities[y]=T,a=a||b.text.placed||b.icon.placed)}}for(const y in f)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=f[y]);for(const y in g)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=g[y]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const a={};for(const o of i){const u=o.getBucket(e);u&&o.latestFeatureIndex&&e.id===u.layerIds[0]&&this.updateBucketOpacities(u,o.tileID,a,o.collisionBoxArray)}}updateBucketOpacities(e,i,a,o){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const u=e.layers[0],f=u.layout,g=new on(null,0,!1,!1,!0),y=f.get("text-allow-overlap"),b=f.get("icon-allow-overlap"),T=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),P=f.get("text-rotation-alignment")==="map",M=f.get("text-pitch-alignment")==="map",z=f.get("icon-text-fit")!=="none",R=new on(null,0,y&&(b||!e.hasIconData()||f.get("icon-optional")),b&&(y||!e.hasTextData()||f.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);const W=(K,J,ie)=>{for(let te=0;te<J/4;te++)K.opacityVertexArray.emplaceBack(ie);K.hasVisibleVertices=K.hasVisibleVertices||ie!==xn},H=this.collisionBoxArrays.get(e.bucketInstanceId);for(let K=0;K<e.symbolInstances.length;K++){const J=e.symbolInstances.get(K),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:te,crossTileID:re}=J;let le=this.opacities[re];a[re]?le=g:le||(le=R,this.opacities[re]=le),a[re]=!0;const se=J.numIconVertices>0,_e=this.placedOrientations[J.crossTileID],Ee=_e===c.al.vertical,Te=_e===c.al.horizontal||_e===c.al.horizontalOnly;if(ie>0||te>0){const Pe=xs(le.text);W(e.text,ie,Ee?xn:Pe),W(e.text,te,Te?xn:Pe);const Ke=le.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach(tt=>{tt>=0&&(e.text.placedSymbolArray.get(tt).hidden=Ke||Ee?1:0)}),J.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=Ke||Te?1:0);const We=this.variableOffsets[J.crossTileID];We&&this.markUsedJustification(e,We.anchor,J,_e);const Ve=this.placedOrientations[J.crossTileID];Ve&&(this.markUsedJustification(e,"left",J,Ve),this.markUsedOrientation(e,Ve,J))}if(se){const Pe=xs(le.icon),Ke=!(z&&J.verticalPlacedIconSymbolIndex&&Ee);J.placedIconSymbolIndex>=0&&(W(e.icon,J.numIconVertices,Ke?Pe:xn),e.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=le.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(W(e.icon,J.numVerticalIconVertices,Ke?xn:Pe),e.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}const Se=H&&H.has(K)?H.get(K):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Pe=e.collisionArrays[K];if(Pe){let Ke=new c.P(0,0);if(Pe.textBox||Pe.verticalTextBox){let We=!0;if(T){const Ve=this.variableOffsets[re];Ve?(Ke=Xr(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale),P&&Ke._rotate(M?-this.transform.bearingInRadians:this.transform.bearingInRadians)):We=!1}if(Pe.textBox||Pe.verticalTextBox){let Ve;Pe.textBox&&(Ve=Ee),Pe.verticalTextBox&&(Ve=Te),Ws(e.textCollisionBox.collisionVertexArray,le.text.placed,!We||Ve,Se.text,Ke.x,Ke.y)}}if(Pe.iconBox||Pe.verticalIconBox){const We=!!(!Te&&Pe.verticalIconBox);let Ve;Pe.iconBox&&(Ve=We),Pe.verticalIconBox&&(Ve=!We),Ws(e.iconCollisionBox.collisionVertexArray,le.icon.placed,Ve,Se.icon,z?Ke.x:0,z?Ke.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const a=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function Ws(h,e,i,a,o,u){a&&a.length!==0||(a=[0,0,0,0]);const f=a[0]-fi,g=a[1]-fi,y=a[2]-fi,b=a[3]-fi;h.emplaceBack(e?1:0,i?1:0,o||0,u||0,f,g),h.emplaceBack(e?1:0,i?1:0,o||0,u||0,y,g),h.emplaceBack(e?1:0,i?1:0,o||0,u||0,y,b),h.emplaceBack(e?1:0,i?1:0,o||0,u||0,f,b)}const Aa=Math.pow(2,25),Fn=Math.pow(2,24),ka=Math.pow(2,17),bs=Math.pow(2,16),ko=Math.pow(2,9),rs=Math.pow(2,8),Ks=Math.pow(2,1);function xs(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const e=h.placed?1:0,i=Math.floor(127*h.opacity);return i*Aa+e*Fn+i*ka+e*bs+i*ko+e*rs+i*Ks+e}const xn=0;class Xs{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,a,o,u){const f=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(f,o,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((g,y)=>g.sortKey-y.sortKey));this._currentPartIndex<f.length;)if(i.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,u())return!0;return!1}}class za{constructor(e,i,a,o,u,f,g,y){this.placement=new Ea(e,i,f,g,y),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=u,this._done=!1}isDone(){return this._done}continuePlacement(e,i,a){const o=Le.now(),u=()=>!this._forceFullPlacement&&Le.now()-o>2;for(;this._currentPlacementIndex>=0;){const f=i[e[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if(f.type==="symbol"&&(!f.minzoom||f.minzoom<=g)&&(!f.maxzoom||f.maxzoom>g)){if(this._inProgressLayer||(this._inProgressLayer=new Xs(f)),this._inProgressLayer.continuePlacement(a[f.source],this.placement,this._showCollisionBoxes,f,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const wn=512/c.Z/2;class ws{constructor(e,i,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const o=new Map;for(let u=0;u<i.length;u++){const f=i.get(u),g=f.key,y=o.get(g);y?y.push(f):o.set(g,[f])}for(const[u,f]of o){const g={positions:f.map(y=>({x:Math.floor(y.anchorX*wn),y:Math.floor(y.anchorY*wn)})),crossTileIDs:f.map(y=>y.crossTileID)};if(g.positions.length>128){const y=new c.aF(g.positions.length,16,Uint16Array);for(const{x:b,y:T}of g.positions)y.add(b,T);y.finish(),delete g.positions,g.index=y}this._symbolsByKey[u]=g}}getScaledCoordinates(e,i){const{x:a,y:o,z:u}=this.tileID.canonical,{x:f,y:g,z:y}=i.canonical,b=wn/Math.pow(2,y-u),T=(g*c.Z+e.anchorY)*b,P=o*c.Z*wn;return{x:Math.floor((f*c.Z+e.anchorX)*b-a*c.Z*wn),y:Math.floor(T-P)}}findMatches(e,i,a){const o=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let u=0;u<e.length;u++){const f=e.get(u);if(f.crossTileID)continue;const g=this._symbolsByKey[f.key];if(!g)continue;const y=this.getScaledCoordinates(f,i);if(g.index){const b=g.index.range(y.x-o,y.y-o,y.x+o,y.y+o).sort();for(const T of b){const P=g.crossTileIDs[T];if(!a[P]){a[P]=!0,f.crossTileID=P;break}}}else if(g.positions)for(let b=0;b<g.positions.length;b++){const T=g.positions[b],P=g.crossTileIDs[b];if(Math.abs(T.x-y.x)<=o&&Math.abs(T.y-y.y)<=o&&!a[P]){a[P]=!0,f.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class zo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ns{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const a in this.indexes){const o=this.indexes[a],u={};for(const f in o){const g=o[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+i),u[g.tileID.key]=g}this.indexes[a]=u}this.lng=e}addBucket(e,i,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let u=0;u<i.symbolInstances.length;u++)i.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const o=this.usedCrossTileIDs[e.overscaledZ];for(const u in this.indexes){const f=this.indexes[u];if(Number(u)>e.overscaledZ)for(const g in f){const y=f[g];y.tileID.isChildOf(e)&&y.findMatches(i.symbolInstances,e,o)}else{const g=f[e.scaledTo(Number(u)).key];g&&g.findMatches(i.symbolInstances,e,o)}}for(let u=0;u<i.symbolInstances.length;u++){const f=i.symbolInstances.get(u);f.crossTileID||(f.crossTileID=a.generate(),o[f.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ws(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const a of i.getCrossTileIDsLists())for(const o of a)delete this.usedCrossTileIDs[e][o]}removeStaleBuckets(e){let i=!1;for(const a in this.indexes){const o=this.indexes[a];for(const u in o)e[o[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,o[u]),delete o[u],i=!0)}return i}}class On{constructor(){this.layerIndexes={},this.crossTileIDs=new zo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,a){let o=this.layerIndexes[e.id];o===void 0&&(o=this.layerIndexes[e.id]=new ns);let u=!1;const f={};o.handleWrapJump(a);for(const g of i){const y=g.getBucket(e);y&&e.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(g.tileID,y,this.crossTileIDs)&&(u=!0),f[y.bucketInstanceId]=!0)}return o.removeStaleBuckets(f)&&(u=!0),u}pruneUnusedLayers(e){const i={};e.forEach(a=>{i[a]=!0});for(const a in this.layerIndexes)i[a]||delete this.layerIndexes[a]}}var jn="void main() {fragColor=vec4(1.0);}";const yi={prelude:Lt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Lt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Lt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Lt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Lt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Lt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Lt(jn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Lt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Lt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Lt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Lt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Lt(jn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Lt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Lt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Lt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Lt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Lt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Lt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Lt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Lt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Lt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Lt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Lt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Lt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Lt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Lt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Lt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Lt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Lt(h,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/in ([\w]+) ([\w]+)/g),o=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),u=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=u?u.concat(o):o,g={};return{fragmentSource:h=h.replace(i,(y,b,T,P,M)=>(g[M]=!0,b==="define"?`
#ifndef HAS_UNIFORM_u_${M}
in ${T} ${P} ${M};
#else
uniform ${T} ${P} u_${M};
#endif
`:`
#ifdef HAS_UNIFORM_u_${M}
    ${T} ${P} ${M} = u_${M};
#endif
`)),vertexSource:e=e.replace(i,(y,b,T,P,M)=>{const z=P==="float"?"vec2":"vec4",R=M.match(/color/)?"color":z;return g[M]?b==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
in ${T} ${z} a_${M};
out ${T} ${P} ${M};
#else
uniform ${T} ${P} u_${M};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = a_${M};
#else
    ${T} ${P} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = unpack_mix_${R}(a_${M}, u_${M}_t);
#else
    ${T} ${P} ${M} = u_${M};
#endif
`:b==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
in ${T} ${z} a_${M};
#else
uniform ${T} ${P} u_${M};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${T} ${P} ${M} = a_${M};
#else
    ${T} ${P} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    ${T} ${P} ${M} = unpack_mix_${R}(a_${M}, u_${M}_t);
#else
    ${T} ${P} ${M} = u_${M};
#endif
`}),staticAttributes:a,staticUniforms:f}}class Nn{constructor(e,i,a){this.vertexBuffer=e,this.indexBuffer=i,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ai=c.aG([{name:"a_pos",type:"Int16",components:2}]);const Tn="#define PROJECTION_MERCATOR",Pt="mercator";class ss{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Pt}get shaderDefine(){return Tn}get shaderPreludeCode(){return yi.projectionMercator}get vertexShaderPreludeCode(){return yi.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,a,o,u){if(this._cachedMesh)return this._cachedMesh;const f=new c.aI;f.emplaceBack(0,0),f.emplaceBack(c.Z,0),f.emplaceBack(0,c.Z),f.emplaceBack(c.Z,c.Z);const g=e.createVertexBuffer(f,ai.members),y=c.aJ.simpleSegment(0,0,4,2),b=new c.aK;b.emplaceBack(1,0,2),b.emplaceBack(1,2,3);const T=e.createIndexBuffer(b);return this._cachedMesh=new Nn(g,T,y),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class as{constructor(e=0,i=0,a=0,o=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(a)||a<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=a,this.right=o}interpolate(e,i,a){return i.top!=null&&e.top!=null&&(this.top=c.B.number(e.top,i.top,a)),i.bottom!=null&&e.bottom!=null&&(this.bottom=c.B.number(e.bottom,i.bottom,a)),i.left!=null&&e.left!=null&&(this.left=c.B.number(e.left,i.left,a)),i.right!=null&&e.right!=null&&(this.right=c.B.number(e.right,i.right,a)),this}getCenter(e,i){const a=c.ae((this.left+e-this.right)/2,0,e),o=c.ae((this.top+i-this.bottom)/2,0,i);return new c.P(a,o)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vn(h,e){if(!h.renderWorldCopies||h.lngRange)return;const i=e.lng-h.center.lng;e.lng+=i>180?-360:i<-180?360:0}function vi(h){return Math.max(0,Math.floor(h))}class Pi{constructor(e,i,a,o,u,f){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=o??0,this._maxPitch=u??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=vi(this._zoom),this._scale=c.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new as,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,a){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=vi(this._zoom),this._scale=c.ac(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new as(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!a&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=c.aL(e,-180,180)*Math.PI/180;var a,o,u,f,g,y,b,T,P;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=Ze(),a=this._rotationMatrix,u=-this._bearingInRadians,f=(o=this._rotationMatrix)[0],g=o[1],y=o[2],b=o[3],T=Math.sin(u),P=Math.cos(u),a[0]=f*P+y*T,a[1]=g*P+b*T,a[2]=f*-T+y*P,a[3]=g*-T+b*P)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=c.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aM(this._fovInRadians)}setFov(e){e=c.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=c.ac(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,a){this._unmodified=!1,this._edgeInsets.interpolate(e,i,a),this._constrain(),this._calcMatrices()}resize(e,i,a=!0){this._width=e,this._height=i,a&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Gt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,c.af])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{let a=e.x,o=e.y,u=e.x,f=e.y;for(const g of i)a=Math.min(a,g.x),o=Math.min(o,g.y),u=Math.max(u,g.x),f=Math.max(f,g.y);return[new c.P(a,o),new c.P(u,o),new c.P(u,f),new c.P(a,f),new c.P(a,o)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:a}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(a),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.ad(new Float64Array(16));c.M(e,e,[this._width/2,-this._height/2,1]),c.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.ad(new Float64Array(16)),c.M(e,e,[1,-1,1]),c.L(e,e,[-1,-1,0]),c.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,a,o){const u=a!==void 0?a:this.bearing,f=o=o!==void 0?o:this.pitch,g=c.$.fromLngLat(e,i),y=-Math.cos(c.ab(f)),b=Math.sin(c.ab(f)),T=b*Math.sin(c.ab(u)),P=-b*Math.cos(c.ab(u));let M=this.elevation;const z=i-M;let R;y*z>=0||Math.abs(y)<.1?(R=1e4,M=i+R*y):R=-z/y;let W,H,K=c.aN(1,g.y),J=0;do{if(J+=1,J>10)break;H=R/K,W=new c.$(g.x+T*H,g.y+P*H),K=1/W.meterInMercatorCoordinateUnits()}while(Math.abs(R-H*K)>1e-12);return{center:W.toLngLat(),elevation:M,zoom:c.ah(this.height/2/Math.tan(this.fovInRadians/2)/H/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=c.ag(1,this.center.lat)*this.worldSize,a=this.cameraToCenterDistance/i,o=c.$.fromLngLat(this.center,this.elevation),u=j(this.center,this.elevation,this.pitch,this.bearing,a);this._elevation=e;const f=this.calculateCenterFromCameraLngLatAlt(u.toLngLat(),c.aN(u.z,o.y),this.bearing,this.pitch);this._elevation=f.elevation,this._center=f.center,this.setZoom(f.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.ag(1,this.center.lat)*this.worldSize;return j(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/c.Z,1/i/c.Z]}}class mi{constructor(e,i){this.min=e,this.max=i,this.center=c.aO([],c.aP([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=c.aQ(this.min),o=c.aQ(this.max);for(let u=0;u<i.length;u++)a[u]=i[u]?this.min[u]:this.center[u],o[u]=i[u]?this.center[u]:this.max[u];return o[2]=this.max[2],new mi(a,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let a=0;a<e.planes.length;a++){const o=this.intersectsPlane(e.planes[a]);if(o===0)return 0;o===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],a=e[3];for(let o=0;o<3;o++)e[o]>0?(i+=e[o]*this.min[o],a+=e[o]*this.max[o]):(a+=e[o]*this.min[o],i+=e[o]*this.max[o]);return i>=0?2:a<0?0:1}}class bi{distanceToTile2d(e,i,a,o){const u=o.distanceX([e,i]),f=o.distanceY([e,i]);return Math.hypot(u,f)}getWrap(e,i,a){return a}getTileAABB(e,i,a,o){var u,f;let g=a,y=a;if(o.terrain){const T=new c.Y(e.z,i,e.z,e.x,e.y),P=o.terrain.getMinMaxElevation(T);g=(u=P.minElevation)!==null&&u!==void 0?u:a,y=(f=P.maxElevation)!==null&&f!==void 0?f:a}const b=1<<e.z;return new mi([i+e.x/b,e.y/b,g],[i+(e.x+1)/b,(e.y+1)/b,y])}allowVariableZoom(e,i){const a=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,o=c.ae(78.5-a/2,0,60);return!!i.terrain||e.pitch>o}allowWorldCopies(){return!0}recalculateCache(){}}class Wt{constructor(e,i,a){this.points=e,this.planes=i,this.aabb=a}static fromInvProjectionMatrix(e,i=1,a=0){const o=Math.pow(2,a),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const T=1/(b=c.at([],b,e))[3]/i*o;return c.aR(b,b,[T,T,1/b[3],T])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const T=c.aS([],u[b[0]],u[b[1]]),P=c.aS([],u[b[2]],u[b[1]]),M=c.aT([],c.aU([],T,P)),z=-c.aV(M,u[b[1]]);return M.concat(z)}),g=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],y=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const b of u)for(let T=0;T<3;T++)g[T]=Math.min(g[T],b[T]),y[T]=Math.max(y[T],b[T]);return new Wt(u,f,new mi(g,y))}}class ln{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,a,o,u){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(f,g)=>this.getConstrained(f,g)},e,i,a,o,u),this._coveringTilesDetailsProvider=new bi}clone(){const e=new ln;return e.apply(this),e}apply(e,i,a){this._helper.apply(e,i,a)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new c.aW(0,e)];if(this._helper._renderWorldCopies){const a=this.screenPointToMercatorCoordinate(new c.P(0,0)),o=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),u=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),f=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),g=Math.floor(Math.min(a.x,o.x,u.x,f.x)),y=Math.floor(Math.max(a.x,o.x,u.x,f.x)),b=1;for(let T=g-b;T<=y+b;T++)T!==0&&i.push(new c.aW(T,e))}return i}getCameraFrustum(){return Wt.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),a=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(a)}setLocationAtPoint(e,i){const a=c.ag(this.elevation,this.center.lat),o=this.screenPointToMercatorCoordinateAtZ(i,a),u=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,a),f=c.$.fromLngLat(e),g=new c.$(f.x-(o.x-u.x),f.y-(o.y-u.y));this.setCenter(g==null?void 0:g.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(c.$.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.$.fromLngLat(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a!=null)return a}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const a=i||0,o=[e.x,e.y,0,1],u=[e.x,e.y,1,1];c.at(o,o,this._pixelMatrixInverse),c.at(u,u,this._pixelMatrixInverse);const f=o[3],g=u[3],y=o[1]/f,b=u[1]/g,T=o[2]/f,P=u[2]/g,M=T===P?0:(a-T)/(P-T);return new c.$(c.B.number(o[0]/f,u[0]/g,M)/this.worldSize,c.B.number(y,b,M)/this.worldSize,a)}coordinatePoint(e,i=0,a=this._pixelMatrix){const o=[e.x*this.worldSize,e.y*this.worldSize,i,1];return c.at(o,o,a),new c.P(o[0]/o[3],o[1]/o[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ue(this));return new Gt().extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-ue(this)}calculatePosMatrix(e,i=!1,a){var o;const u=(o=e.key)!==null&&o!==void 0?o:c.aX(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),f=i?this._alignedPosMatrixCache:this._posMatrixCache;if(f.has(u)){const b=f.get(u);return a?b.f32:b.f64}const g=F(e,this.worldSize);c.N(g,i?this._alignedProjMatrix:this._viewProjMatrix,g);const y={f64:g,f32:new Float32Array(g)};return f.set(u,y),a?y.f32:y.f64}calculateFogMatrix(e){const i=e.key,a=this._fogMatrixCacheF32;if(a.has(i))return a.get(i);const o=F(e,this.worldSize);return c.N(o,this._fogMatrix,o),a.set(i,new Float32Array(o)),a.get(i)}getConstrained(e,i){i=c.ae(+i,this.minZoom,this.maxZoom);const a={center:new c.Q(e.lng,e.lat),zoom:i};let o=this._helper._lngRange;this._helper._renderWorldCopies||o!==null||(o=[-179.9999999999,180-1e-10]);const u=this.tileSize*c.ac(a.zoom);let f=0,g=u,y=0,b=u,T=0,P=0;const{x:M,y:z}=this.size;if(this._helper._latRange){const ie=this._helper._latRange;f=c.S(ie[1])*u,g=c.S(ie[0])*u,g-f<z&&(T=z/(g-f))}o&&(y=c.aL(c.U(o[0])*u,0,u),b=c.aL(c.U(o[1])*u,0,u),b<y&&(b+=u),b-y<M&&(P=M/(b-y)));const{x:R,y:W}=sr(u,e);let H,K;const J=Math.max(P||0,T||0);if(J){const ie=new c.P(P?(b+y)/2:R,T?(g+f)/2:W);return a.center=Mr(u,ie).wrap(),a.zoom+=c.ah(J),a}if(this._helper._latRange){const ie=z/2;W-ie<f&&(K=f+ie),W+ie>g&&(K=g-ie)}if(o){const ie=(y+b)/2;let te=R;this._helper._renderWorldCopies&&(te=c.aL(R,ie-u/2,ie+u/2));const re=M/2;te-re<y&&(H=y+re),te+re>b&&(H=b-re)}if(H!==void 0||K!==void 0){const ie=new c.P(H??R,K??W);a.center=Mr(u,ie).wrap()}return a}calculateCenterFromCameraLngLatAlt(e,i,a,o){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,o)}_calculateNearFarZIfNeeded(e,i,a){if(!this._helper.autoCalculateNearFarZ)return;const o=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),u=e-o*this._helper._pixelPerMeter/Math.cos(i),f=o<0?u:e,g=Math.PI/2+this.pitchInRadians,y=c.ab(this.fov)*(Math.abs(Math.cos(c.ab(this.roll)))*this.height+Math.abs(Math.sin(c.ab(this.roll)))*this.width)/this.height*(.5+a.y/this.height),b=Math.sin(y)*f/Math.sin(c.ae(Math.PI-g-y,.01,Math.PI-.01)),T=ue(this),P=Math.atan(T/this._helper.cameraToCenterDistance),M=c.ab(.75),z=P>M?2*P*(.5+a.y/(2*T)):M,R=Math.sin(z)*f/Math.sin(c.ae(Math.PI-g-z,.01,Math.PI-.01)),W=Math.min(b,R);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*W+f),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=sr(this.worldSize,this.center),a=i.x,o=i.y;this._helper._pixelPerMeter=c.ag(1,this.center.lat)*this.worldSize;const u=c.ab(Math.min(this.pitch,gr)),f=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(u));let g;this._calculateNearFarZIfNeeded(f,u,e),g=new Float64Array(16),c.aY(g,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.an(this._invProjMatrix,g),g[8]=2*-e.x/this._helper._width,g[9]=2*e.y/this._helper._height,this._projectionMatrix=c.aZ(g),c.M(g,g,[1,-1,1]),c.L(g,g,[0,0,-this._helper.cameraToCenterDistance]),c.a_(g,g,-this.rollInRadians),c.a$(g,g,this.pitchInRadians),c.a_(g,g,-this.bearingInRadians),c.L(g,g,[-a,-o,0]),this._mercatorMatrix=c.M([],g,[this.worldSize,this.worldSize,this.worldSize]),c.M(g,g,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,g),c.L(g,g,[0,0,-this.elevation]),this._viewProjMatrix=g,this._invViewProjMatrix=c.an([],g);const y=[0,0,-1,1];c.at(y,y,this._invViewProjMatrix),this._cameraPosition=[y[0]/y[3],y[1]/y[3],y[2]/y[3]],this._fogMatrix=new Float64Array(16),c.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,f,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.L(this._fogMatrix,this._fogMatrix,[-a,-o,0]),c.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,g);const b=this._helper._width%2/2,T=this._helper._height%2/2,P=Math.cos(this.bearingInRadians),M=Math.sin(-this.bearingInRadians),z=a-Math.round(a)+P*b+M*T,R=o-Math.round(o)+P*T+M*b,W=new Float64Array(g);if(c.L(W,W,[z>.5?z-1:z,R>.5?R-1:R,0]),this._alignedProjMatrix=W,g=c.an(new Float64Array(16),this._pixelMatrix),!g)throw new Error("failed to invert matrix");this._pixelMatrixInverse=g,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.at(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.ag(1,this.center.lat)*this.worldSize;return j(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const a=c.$.fromLngLat(e),o=[a.x*this.worldSize,a.y*this.worldSize,i,1];return c.at(o,o,this._viewProjMatrix),o[2]/o[3]}getProjectionData(e){const{overscaledTileID:i,aligned:a,applyTerrainMatrix:o}=e,u=this._helper.getMercatorTileCoordinates(i),f=i?this.calculatePosMatrix(i,a,!0):null;let g;return g=i&&i.terrainRttPosMatrix32f&&o?i.terrainRttPosMatrix32f:f||c.b0(),{mainMatrix:g,tileMercatorCoords:u,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:g}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,a){return 1}transformLightDirection(e){return c.aQ(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,a,o){const u=this.calculatePosMatrix(a);let f;o?(f=[e,i,o(e,i),1],c.at(f,f,u)):(f=[e,i,0,1],bn(f,f,u));const g=f[3];return{point:new c.P(f[0]/g,f[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const a=c.$.fromLngLat(e,i),o=a.meterInMercatorCoordinateUnits(),u=c.b1();return c.L(u,u,[a.x,a.y,a.z]),c.a_(u,u,Math.PI),c.a$(u,u,Math.PI/2),c.M(u,u,[-o,o,o]),u}getProjectionDataForCustomLayer(e=!0){const i=new c.Y(0,0,0,0,0),a=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),o=F(i,this.worldSize);c.N(o,this._viewProjMatrix,o),a.tileMercatorCoords=[0,0,1,1];const u=[c.Z,c.Z,this.worldSize/this._helper.pixelsPerMeter],f=c.b2();return c.M(f,o,u),a.fallbackMatrix=f,a.mainMatrix=f,a}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Xi(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function lr(h){if(h.useSlerp)if(h.k<1){const e=c.b3(h.startEulerAngles.roll,h.startEulerAngles.pitch,h.startEulerAngles.bearing),i=c.b3(h.endEulerAngles.roll,h.endEulerAngles.pitch,h.endEulerAngles.bearing),a=new Float64Array(4);c.b4(a,e,i,h.k);const o=c.b5(a);h.tr.setRoll(o.roll),h.tr.setPitch(o.pitch),h.tr.setBearing(o.bearing)}else h.tr.setRoll(h.endEulerAngles.roll),h.tr.setPitch(h.endEulerAngles.pitch),h.tr.setBearing(h.endEulerAngles.bearing);else h.tr.setRoll(c.B.number(h.startEulerAngles.roll,h.endEulerAngles.roll,h.k)),h.tr.setPitch(c.B.number(h.startEulerAngles.pitch,h.endEulerAngles.pitch,h.k)),h.tr.setBearing(c.B.number(h.startEulerAngles.bearing,h.endEulerAngles.bearing,h.k))}function Yi(h,e,i,a,o){const u=o.padding,f=sr(o.worldSize,i.getNorthWest()),g=sr(o.worldSize,i.getNorthEast()),y=sr(o.worldSize,i.getSouthEast()),b=sr(o.worldSize,i.getSouthWest()),T=c.ab(-a),P=f.rotate(T),M=g.rotate(T),z=y.rotate(T),R=b.rotate(T),W=new c.P(Math.max(P.x,M.x,R.x,z.x),Math.max(P.y,M.y,R.y,z.y)),H=new c.P(Math.min(P.x,M.x,R.x,z.x),Math.min(P.y,M.y,R.y,z.y)),K=W.sub(H),J=(o.width-(u.left+u.right+e.left+e.right))/K.x,ie=(o.height-(u.top+u.bottom+e.top+e.bottom))/K.y;if(ie<0||J<0)return void Xi();const te=Math.min(c.ah(o.scale*Math.min(J,ie)),h.maxZoom),re=c.P.convert(h.offset),le=new c.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(c.ab(a)),se=re.add(le).mult(o.scale/c.ac(te));return{center:Mr(o.worldSize,f.add(y).div(2).sub(se)),zoom:te,bearing:a}}class Zn{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,a){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(a,e.around)}cameraForBoxAndBearing(e,i,a,o,u){return Yi(e,i,a,o,u)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(c.Q.convert(i.center))}handleEaseTo(e,i){const a=e.zoom,o=e.padding,u={roll:e.roll,pitch:e.pitch,bearing:e.bearing},f={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},g=i.zoom!==void 0,y=!e.isPaddingEqual(i.padding);let b=!1;const T=g?+i.zoom:e.zoom;let P=e.centerPoint.add(i.offsetAsPoint);const M=e.screenPointToLocation(P),{center:z,zoom:R}=e.getConstrained(c.Q.convert(i.center||M),T??a);Vn(e,z);const W=sr(e.worldSize,M),H=sr(e.worldSize,z).sub(W),K=c.ac(R-a);return b=R!==a,{easeFunc:J=>{if(b&&e.setZoom(c.B.number(a,R,J)),c.b6(u,f)||lr({startEulerAngles:u,endEulerAngles:f,tr:e,k:J,useSlerp:u.roll!=f.roll}),y&&(e.interpolatePadding(o,i.padding,J),P=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const ie=c.ac(e.zoom-a),te=R>a?Math.min(2,K):Math.max(.5,K),re=Math.pow(te,1-J),le=Mr(e.worldSize,W.add(H.mult(J*re)).mult(ie));e.setLocationAtPoint(e.renderWorldCopies?le.wrap():le,P)}},isZooming:b,elevationCenter:z}}handleFlyTo(e,i){const a=i.zoom!==void 0,o=e.zoom,u=e.getConstrained(c.Q.convert(i.center||i.locationAtOffset),a?+i.zoom:o),f=u.center,g=u.zoom;Vn(e,f);const y=sr(e.worldSize,i.locationAtOffset),b=sr(e.worldSize,f).sub(y),T=b.mag(),P=c.ac(g-o);let M;if(i.minZoom!==void 0){const z=Math.min(+i.minZoom,o,g),R=e.getConstrained(f,z).zoom;M=c.ac(R-o)}return{easeFunc:(z,R,W,H)=>{e.setZoom(z===1?g:o+c.ah(R));const K=z===1?f:Mr(e.worldSize,y.add(b.mult(W)).mult(R));e.setLocationAtPoint(e.renderWorldCopies?K.wrap():K,H)},scaleOfZoom:P,targetCenter:f,scaleOfMinZoom:M,pixelPathLength:T}}}class Ot{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}Ot.Replace=[1,0],Ot.disabled=new Ot(Ot.Replace,c.b7.transparent,[!1,!1,!1,!1]),Ot.unblended=new Ot(Ot.Replace,c.b7.transparent,[!0,!0,!0,!0]),Ot.alphaBlended=new Ot([1,771],c.b7.transparent,[!0,!0,!0,!0]);const ei=2305;class It{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}It.disabled=new It(!1,1029,ei),It.backCCW=new It(!0,1029,ei),It.frontCCW=new It(!0,1028,ei);class mt{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}mt.ReadOnly=!1,mt.ReadWrite=!0,mt.disabled=new mt(519,mt.ReadOnly,[0,1]);const Un=7680;class ${constructor(e,i,a,o,u,f){this.test=e,this.ref=i,this.mask=a,this.fail=o,this.depthFail=u,this.pass=f}}$.disabled=new $({func:519,mask:0},0,0,Un,Un,Un);const de=new WeakMap;function Fe(h){var e;if(de.has(h))return de.get(h);{const i=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return de.set(h,i),i}}class et{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,a=i.gl;this._texFormat=a.RGBA,this._texType=a.UNSIGNED_BYTE;const o=new c.aI;o.emplaceBack(-1,-1),o.emplaceBack(2,-1),o.emplaceBack(-1,2);const u=new c.aK;u.emplaceBack(0,1,2),this._fullscreenTriangle=new Nn(i.createVertexBuffer(o,ai.members),i.createIndexBuffer(u),c.aJ.simpleSegment(0,0,o.length,u.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(a.TEXTURE1);const f=a.createTexture();a.bindTexture(a.TEXTURE_2D,f),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(f),Fe(a)&&(this._pbo=a.createBuffer(),a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.bufferData(a.PIXEL_PACK_BUFFER,4,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const a=this._updateCount;return this._readbackQueue?a>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():a>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const a=this._cachedRenderContext.context,o=a.gl;if(this._bindFramebuffer(),a.viewport.set([0,0,this._texWidth,this._texHeight]),a.clear({color:c.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(a,o.TRIANGLES,mt.disabled,$.disabled,Ot.unblended,It.disabled,((u,f)=>({u_input:u,u_output_expected:f}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Fe(o)){o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.readBuffer(o.COLOR_ATTACHMENT0),o.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);const u=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);o.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:u}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Fe(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=et._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const $t=c.Z/128;function vt(h,e){const i=h.granularity!==void 0?Math.max(h.granularity,1):1,a=i+(h.generateBorders?2:0),o=i+(h.extendToNorthPole||h.generateBorders?1:0)+(h.extendToSouthPole||h.generateBorders?1:0),u=a+1,f=o+1,g=h.generateBorders?-1:0,y=h.generateBorders||h.extendToNorthPole?-1:0,b=i+(h.generateBorders?1:0),T=i+(h.generateBorders||h.extendToSouthPole?1:0),P=u*f,M=a*o*6,z=u*f>65536;if(z&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const R=z||e==="32bit",W=new Int16Array(2*P);let H=0;for(let ie=y;ie<=T;ie++)for(let te=g;te<=b;te++){let re=te/i*c.Z;te===-1&&(re=-64),te===i+1&&(re=c.Z+$t);let le=ie/i*c.Z;ie===-1&&(le=h.extendToNorthPole?c.b9:-64),ie===i+1&&(le=h.extendToSouthPole?c.ba:c.Z+$t),W[H++]=re,W[H++]=le}const K=R?new Uint32Array(M):new Uint16Array(M);let J=0;for(let ie=0;ie<o;ie++)for(let te=0;te<a;te++){const re=te+1+ie*u,le=te+(ie+1)*u,se=te+1+(ie+1)*u;K[J++]=te+ie*u,K[J++]=le,K[J++]=re,K[J++]=re,K[J++]=le,K[J++]=se}return{vertices:W.buffer.slice(0),indices:K.buffer.slice(0),uses32bitIndices:R}}const qt=new c.aH({fill:new c.bb(128,2),line:new c.bb(512,0),tile:new c.bb(128,32),stencil:new c.bb(128,1),circle:3});class oi{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return yi.projectionGlobe}get vertexShaderPreludeCode(){return yi.projectionMercator.vertexSource}get subdivisionGranularity(){return qt}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new et(e));const i=c.S(this._errorQueryLatitudeDegrees),a=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,o=this._errorMeasurement.updateErrorLoop(i,a),u=Le.now();o!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=o,this._errorMeasurementLastChangeTime=u);const f=Math.min(Math.max((u-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bd(f))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,a,o,u){const f=(u==="stencil"?qt.stencil:qt.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:f,generateBorders:a,extendToNorthPole:i.y===0&&o,extendToSouthPole:i.y===(1<<i.z)-1&&o})}_getMesh(e,i){const a=this._getMeshKey(i);if(a in this._tileMeshCache)return this._tileMeshCache[a];const o=function(u,f){const g=vt(f,"16bit"),y=c.aI.deserialize({arrayBuffer:g.vertices,length:g.vertices.byteLength/2/2}),b=c.aK.deserialize({arrayBuffer:g.indices,length:g.indices.byteLength/2/3});return new Nn(u.createVertexBuffer(y,ai.members),u.createIndexBuffer(b),c.aJ.simpleSegment(0,0,y.length,b.length))}(e,i);return this._tileMeshCache[a]=o,o}recalculate(e){}hasTransition(){const e=Le.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Si=new c.r({type:new c.D(c.v.projection.type)});class Kt extends c.E{constructor(e){super(),this._transitionable=new c.T(Si),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.C(0)),this._mercatorProjection=new ss,this._verticalPerspectiveProjection=new oi}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof c.be){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,a,o,u){return this.currentProjection.getMeshFromTileID(e,i,a,o,u)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Ri(h){const e=Ii(h.worldSize,h.center.lat);return 2*Math.PI*e}function Di(h,e,i,a,o){const u=1/(1<<o),f=e/c.Z*u+a*u,g=c.bg((h/c.Z*u+i*u)*Math.PI*2+Math.PI,2*Math.PI),y=2*Math.atan(Math.exp(Math.PI-f*Math.PI*2))-.5*Math.PI,b=Math.cos(y),T=new Float64Array(3);return T[0]=Math.sin(g)*b,T[1]=Math.sin(y),T[2]=Math.cos(g)*b,T}function jt(h){return function(e,i){const a=Math.cos(i),o=new Float64Array(3);return o[0]=Math.sin(e)*a,o[1]=Math.sin(i),o[2]=Math.cos(e)*a,o}(h.lng*Math.PI/180,h.lat*Math.PI/180)}function Ii(h,e){return h/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ui(h){const e=Math.asin(h[1])/Math.PI*180,i=Math.sqrt(h[0]*h[0]+h[2]*h[2]);if(i>1e-6){const a=h[0]/i,o=Math.acos(h[2]/i),u=(a>0?o:-o)/Math.PI*180;return new c.Q(c.aL(u,-180,180),e)}return new c.Q(0,e)}function Ji(h){return Math.cos(h*Math.PI/180)}function Xt(h,e){const i=Ji(h),a=Ji(e);return c.ah(a/i)}function Or(h,e){const i=h.rotate(e.bearingInRadians),a=e.zoom+Xt(e.center.lat,0),o=c.bc(1/Ji(e.center.lat),1/Ji(Math.min(Math.abs(e.center.lat),60)),c.bf(a,7,3,0,1)),u=360/Ri({worldSize:e.worldSize,center:{lat:e.center.lat}});return new c.Q(e.center.lng-i.x*u*o,c.ae(e.center.lat+i.y*u,-85.051129,c.af))}function os(h){const e=.5*h,i=Math.sin(e),a=Math.cos(e);return Math.log(i+a)-Math.log(a-i)}function ls(h,e,i,a){const o=h.lat+i*a;if(Math.abs(i)>1){const u=(Math.sign(h.lat+i)!==Math.sign(h.lat)?-Math.abs(h.lat):Math.abs(h.lat))*Math.PI/180,f=Math.abs(h.lat+i)*Math.PI/180,g=os(u+a*(f-u)),y=os(u),b=os(f);return new c.Q(h.lng+e*((g-y)/(b-y)),o)}return new c.Q(h.lng+e*a,o)}class Ts{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,i,a,o){const u=`${e.z}_${e.x}_${e.y}`,f=this._cache.get(u);if(f)return f;const g=this._cachePrevious.get(u);if(g)return this._cache.set(u,g),g;const y=this._aabbFactory(e,i,a,o);return this._cache.set(u,y),this._hadAnyChanges=!0,y}}function cr(h,e,i){const a=h-e;return a<0?-a:Math.max(0,a-i)}function Ys(h,e,i,a,o){const u=h-i;let f;return f=u<0?Math.min(-u,1+u-o):u>1?Math.min(Math.max(u-o,0),1-u):0,Math.max(f,cr(e,a,o))}class cn{constructor(){this._aabbCache=new Ts(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,i,a,o){const u=1<<a.z,f=1/u,g=a.x/u,y=a.y/u;let b=2;return b=Math.min(b,Ys(e,i,g,y,f)),b=Math.min(b,Ys(e,i,g+.5,-y-f,f)),b=Math.min(b,Ys(e,i,g+.5,2-y-f,f)),b}getWrap(e,i,a){const o=1<<i.z,u=1/o,f=i.x/o,g=cr(e.x,f,u),y=cr(e.x,f-1,u),b=cr(e.x,f+1,u),T=Math.min(g,y,b);return T===b?1:T===y?-1:0}allowVariableZoom(e,i){return ye(e,i)>4}allowWorldCopies(){return!1}getTileAABB(e,i,a,o){return this._aabbCache.getTileAABB(e,i,a,o)}_computeTileAABB(e,i,a,o){if(e.z<=0)return new mi([-1,-1,-1],[1,1,1]);if(e.z===1)return new mi([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const u=[Di(0,0,e.x,e.y,e.z),Di(c.Z,0,e.x,e.y,e.z),Di(c.Z,c.Z,e.x,e.y,e.z),Di(0,c.Z,e.x,e.y,e.z)],f=[1,1,1],g=[-1,-1,-1];for(const y of u)for(let b=0;b<3;b++)f[b]=Math.min(f[b],y[b]),g[b]=Math.max(g[b],y[b]);if(e.y===0||e.y===(1<<e.z)-1){const y=[0,e.y===0?1:-1,0];for(let b=0;b<3;b++)f[b]=Math.min(f[b],y[b]),g[b]=Math.max(g[b],y[b])}return new mi(f,g)}}}class cs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=c.bk(),this._projectionMatrix=c.b1(),this._globeViewProjMatrix32f=c.b0(),this._globeViewProjMatrixNoCorrection=c.b1(),this._globeViewProjMatrixNoCorrectionInverted=c.b1(),this._globeProjMatrixInverted=c.b1(),this._cameraPosition=c.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new cn}clone(){const e=new cs;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:a}=e,o=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:o,clippingPlane:this._cachedClippingPlane,projectionTransition:a?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,a=this.cameraToCenterDistance/e,o=Math.sin(i)*a,u=Math.cos(i)*a+1,f=1/Math.sqrt(o*o+u*u)*1;let g=-o,y=u;const b=Math.sqrt(g*g+y*y);g/=b,y/=b;const T=[0,g,y];c.bl(T,T,[0,0,0],-this.bearingInRadians),c.bm(T,T,[0,0,0],-1*this.center.lat*Math.PI/180),c.bn(T,T,[0,0,0],this.center.lng*Math.PI/180);const P=1/c.bo(T);return c.aO(T,T,P),[...T,-f*P]}isLocationOccluded(e){return!this.isSurfacePointVisible(jt(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,a=this._helper._center.lat*Math.PI/180,o=Math.cos(a),u=[Math.sin(i)*o,Math.sin(a),Math.cos(i)*o],f=[u[2],0,-u[0]],g=[0,0,0];c.aU(g,f,u),c.aT(f,f),c.aT(g,g);const y=[0,0,0];return c.aT(y,[f[0]*e[0]+g[0]*e[1]+u[0]*e[2],f[1]*e[0]+g[1]*e[1]+u[1]*e[2],f[2]*e[0]+g[2]*e[1]+u[2]*e[2]]),y}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,a){const o=function(g,y,b){const T=1/(1<<b.z);return new c.$(g/c.Z*T+b.x*T,y/c.Z*T+b.y*T)}(e,i,a.canonical),u=(f=o.y,[c.bg(o.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-f*Math.PI*2))-.5*Math.PI]);var f;return this.getCircleRadiusCorrection()/Math.cos(u[1])}projectTileCoordinates(e,i,a,o){const u=a.canonical,f=Di(e,i,u.x,u.y,u.z),g=1+(o?o(e,i):0)/c.bu,y=[f[0]*g,f[1]*g,f[2]*g,1];c.at(y,y,this._globeViewProjMatrixNoCorrection);const b=this._cachedClippingPlane,T=b[0]*f[0]+b[1]*f[1]+b[2]*f[2]+b[3]<0;return{point:new c.P(y[0]/y[3],y[1]/y[3]),signedDistanceFromCamera:y[3],isOccluded:T}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Ii(this.worldSize,this.center.lat),i=c.b2(),a=c.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.aY(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const o=this.centerOffset;i[8]=2*-o.x/this._helper._width,i[9]=2*o.y/this._helper._height,this._projectionMatrix=c.aZ(i),this._globeProjMatrixInverted=c.b2(),c.an(this._globeProjMatrixInverted,i),c.L(i,i,[0,0,-this.cameraToCenterDistance]),c.a_(i,i,this.rollInRadians),c.a$(i,i,-this.pitchInRadians),c.a_(i,i,this.bearingInRadians),c.L(i,i,[0,0,-e]);const u=c.bh();u[0]=e,u[1]=e,u[2]=e,c.a$(a,i,this.center.lat*Math.PI/180),c.bp(a,a,-this.center.lng*Math.PI/180),c.M(a,a,u),this._globeViewProjMatrixNoCorrection=a,c.a$(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bp(i,i,-this.center.lng*Math.PI/180),c.M(i,i,u),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=c.b2(),c.an(this._globeViewProjMatrixNoCorrectionInverted,a);const f=c.bh();this._cameraPosition=c.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bl(this._cameraPosition,this._cameraPosition,f,-this.rollInRadians),c.bm(this._cameraPosition,this._cameraPosition,f,this.pitchInRadians),c.bl(this._cameraPosition,this._cameraPosition,f,-this.bearingInRadians),c.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bm(this._cameraPosition,this._cameraPosition,f,-this.center.lat*Math.PI/180),c.bn(this._cameraPosition,this._cameraPosition,f,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const g=c.aZ(this._globeViewProjMatrixNoCorrectionInverted);c.M(g,g,[1,1,-1]),this._cachedFrustum=Wt.fromInvProjectionMatrix(g)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const i=c.b2();return c.ad(i),i}getVisibleUnwrappedCoordinates(e){return[new c.aW(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const a=jt(e);c.aO(a,a,1+i/c.bu);const o=c.bk();return c.at(o,[a[0],a[1],a[2],1],this._globeViewProjMatrixNoCorrection),o[2]/o[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,a=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,i),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,i)],o=[];for(const P of a)o.push(this.unprojectScreenPoint(P));let u=0,f=0,g=0,y=0;const b=this.center;for(const P of o){const M=c.bq(b.lng,P.lng),z=c.bq(b.lat,P.lat);M<f&&(f=M),M>u&&(u=M),z<y&&(y=z),z>g&&(g=z)}const T=[b.lng+f,b.lat+y,b.lng+u,b.lat+g];return this.isSurfacePointOnScreen([0,1,0])&&(T[3]=90,T[0]=-180,T[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(T[1]=-90,T[0]=-180,T[2]=180),new Gt(T)}getConstrained(e,i){const a=c.ae(e.lat,-85.051129,c.af),o=c.ae(+i,this.minZoom+Xt(0,a),this.maxZoom);return{center:new c.Q(e.lng,a),zoom:o}}calculateCenterFromCameraLngLatAlt(e,i,a,o){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,o)}setLocationAtPoint(e,i){const a=jt(this.unprojectScreenPoint(i)),o=jt(e),u=c.bh();c.br(u);const f=c.bh();c.bn(f,a,u,-this.center.lng*Math.PI/180),c.bm(f,f,u,this.center.lat*Math.PI/180);const g=o[0]*o[0]+o[2]*o[2],y=f[0]*f[0];if(g<y)return;const b=Math.sqrt(g-y),T=-b,P=c.bs(o[0],o[2],f[0],b),M=c.bs(o[0],o[2],f[0],T),z=c.bh();c.bn(z,o,u,-P);const R=c.bs(z[1],z[2],f[1],f[2]),W=c.bh();c.bn(W,o,u,-M);const H=c.bs(W[1],W[2],f[1],f[2]),K=.5*Math.PI,J=R>=-K&&R<=K,ie=H>=-K&&H<=K;let te,re;if(J&&ie){const Ee=this.center.lng*Math.PI/180,Te=this.center.lat*Math.PI/180;c.bv(P,Ee)+c.bv(R,Te)<c.bv(M,Ee)+c.bv(H,Te)?(te=P,re=R):(te=M,re=H)}else if(J)te=P,re=R;else{if(!ie)return;te=M,re=H}const le=te/Math.PI*180,se=re/Math.PI*180,_e=this.center.lat;this.setCenter(new c.Q(le,c.ae(se,-90,90))),this.setZoom(this.zoom+Xt(_e,this.center.lat))}locationToScreenPoint(e,i){const a=jt(e);if(i){const o=i.getElevationForLngLatZoom(e,this._helper._tileZoom);c.aO(a,a,1+o/c.bu)}return this._projectSurfacePointToScreen(a)}_projectSurfacePointToScreen(e){const i=c.bk();return c.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new c.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a)return a}return c.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}isPointOnMapSurface(e,i){const a=this._cameraPosition,o=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(a,o)}getRayDirectionFromPixel(e){const i=c.bk();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,c.at(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const a=c.bh();a[0]=i[0]-this._cameraPosition[0],a[1]=i[1]-this._cameraPosition[1],a[2]=i[2]-this._cameraPosition[2];const o=c.bh();return c.aT(o,a),o}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=c.bk();return c.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const a=c.aV(e,i),o=c.bh(),u=c.bh();c.aO(u,i,a),c.aS(o,e,u);const f=1-c.aV(o,o);if(f<0)return null;const g=c.aV(e,e)-1,y=-a+(a<0?1:-1)*Math.sqrt(f),b=g/y,T=y;return{tMin:Math.min(b,T),tMax:Math.max(b,T)}}unprojectScreenPoint(e){const i=this._cameraPosition,a=this.getRayDirectionFromPixel(e),o=this.rayPlanetIntersection(i,a);if(o){const T=c.bh();c.aP(T,i,[a[0]*o.tMin,a[1]*o.tMin,a[2]*o.tMin]);const P=c.bh();return c.aT(P,T),Ui(P)}const u=this._cachedClippingPlane,f=u[0]*a[0]+u[1]*a[1]+u[2]*a[2],g=-c.bt(u,i)/f,y=c.bh();if(g>0)c.aP(y,i,[a[0]*g,a[1]*g,a[2]*g]);else{const T=c.bh();c.aP(T,i,[2*a[0],2*a[1],2*a[2]]);const P=c.bt(this._cachedClippingPlane,T);c.aS(y,T,[this._cachedClippingPlane[0]*P,this._cachedClippingPlane[1]*P,this._cachedClippingPlane[2]*P])}const b=function(T){const P=c.bh();return P[0]=T[0]*-T[3],P[1]=T[1]*-T[3],P[2]=T[2]*-T[3],{center:P,radius:Math.sqrt(1-T[3]*T[3])}}(u);return Ui(function(T,P,M){const z=c.bh();c.aS(z,M,T);const R=c.bh();return c.bi(R,T,z,P/c.bj(z)),R}(b.center,b.radius,y))}getMatrixForModel(e,i){const a=c.Q.convert(e),o=1/c.bu,u=c.b1();return c.bp(u,u,a.lng/180*Math.PI),c.a$(u,u,-a.lat/180*Math.PI),c.L(u,u,[0,0,1+i/c.bu]),c.a$(u,u,.5*Math.PI),c.M(u,u,[o,o,o]),u}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new c.Y(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Js{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new ln,this._verticalPerspectiveTransform=new cs}clone(){const e=new Js;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),a=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?a.mainMatrix:i.mainMatrix,clippingPlane:a.clippingPlane,tileMercatorCoords:a.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,a){const o=this._mercatorTransform.getPitchedTextCorrection(e,i,a),u=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,a);return c.bc(o,u,this._globeness)}projectTileCoordinates(e,i,a,o){return this.currentTransform.projectTileCoordinates(e,i,a,o)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,a,o){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,o)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const a=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return a.fallbackMatrix=i.mainMatrix,a}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class jr{get useGlobeControls(){return!0}handlePanInertia(e,i){const a=Or(e,i);return Math.abs(a.lng-i.center.lng)>180&&(a.lng=i.center.lng+179.5*Math.sign(a.lng-i.center.lng)),{easingCenter:a,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const a=e.around,o=i.screenPointToLocation(a);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const u=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const f=i.zoom-u;if(f===0)return;const g=c.bq(i.center.lng,o.lng),y=g/(Math.abs(g/180)+1),b=c.bq(i.center.lat,o.lat),T=i.getRayDirectionFromPixel(a),P=i.cameraPosition,M=-1*c.aV(P,T),z=c.bh();c.aP(z,P,[T[0]*M,T[1]*M,T[2]*M]);const R=c.bo(z)-1,W=Math.exp(.5*-Math.max(R-.3,0)),H=Ii(i.worldSize,i.center.lat)/Math.min(i.width,i.height),K=c.bf(H,.9,.5,1,.25),J=(1-c.ac(-f))*Math.min(W,K),ie=i.center.lat,te=i.zoom,re=new c.Q(i.center.lng+y*J,c.ae(i.center.lat+b*J,-85.051129,c.af));i.setLocationAtPoint(o,a);const le=i.center,se=c.bf(Math.abs(g),45,85,0,1),_e=c.bf(H,.75,.35,0,1),Ee=Math.pow(Math.max(se,_e),.25),Te=c.bq(le.lng,re.lng),Se=c.bq(le.lat,re.lat);i.setCenter(new c.Q(le.lng+Te*Ee,le.lat+Se*Ee).wrap()),i.setZoom(te+Xt(ie,i.center.lat))}handleMapControlsPan(e,i,a){if(!e.panDelta)return;const o=i.center.lat,u=i.zoom;i.setCenter(Or(e.panDelta,i).wrap()),i.setZoom(u+Xt(o,i.center.lat))}cameraForBoxAndBearing(e,i,a,o,u){const f=Yi(e,i,a,o,u),g=i.left/u.width*2-1,y=(u.width-i.right)/u.width*2-1,b=i.top/u.height*-2+1,T=(u.height-i.bottom)/u.height*-2+1,P=c.bq(a.getWest(),a.getEast())<0,M=P?a.getEast():a.getWest(),z=P?a.getWest():a.getEast(),R=Math.max(a.getNorth(),a.getSouth()),W=Math.min(a.getNorth(),a.getSouth()),H=M+.5*c.bq(M,z),K=R+.5*c.bq(R,W),J=u.clone();J.setCenter(f.center),J.setBearing(f.bearing),J.setPitch(0),J.setRoll(0),J.setZoom(f.zoom);const ie=J.modelViewProjectionMatrix,te=[jt(a.getNorthWest()),jt(a.getNorthEast()),jt(a.getSouthWest()),jt(a.getSouthEast()),jt(new c.Q(z,K)),jt(new c.Q(M,K)),jt(new c.Q(H,R)),jt(new c.Q(H,W))],re=jt(f.center);let le=Number.POSITIVE_INFINITY;for(const se of te)g<0&&(le=jr.getLesserNonNegativeNonNull(le,jr.solveVectorScale(se,re,ie,"x",g))),y>0&&(le=jr.getLesserNonNegativeNonNull(le,jr.solveVectorScale(se,re,ie,"x",y))),b>0&&(le=jr.getLesserNonNegativeNonNull(le,jr.solveVectorScale(se,re,ie,"y",b))),T<0&&(le=jr.getLesserNonNegativeNonNull(le,jr.solveVectorScale(se,re,ie,"y",T)));if(Number.isFinite(le)&&le!==0)return f.zoom=J.zoom+c.ah(le),f;Xi()}handleJumpToCenterZoom(e,i){const a=e.center.lat,o=e.getConstrained(i.center?c.Q.convert(i.center):e.center,e.zoom).center;e.setCenter(o.wrap());const u=i.zoom!==void 0?+i.zoom:e.zoom+Xt(a,o.lat);e.zoom!==u&&e.setZoom(u)}handleEaseTo(e,i){const a=e.zoom,o=e.center,u=e.padding,f={roll:e.roll,pitch:e.pitch,bearing:e.bearing},g={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},y=i.zoom!==void 0,b=!e.isPaddingEqual(i.padding);let T=!1;const P=i.center?c.Q.convert(i.center):o,M=e.getConstrained(P,a).center;Vn(e,M);const z=e.clone();z.setCenter(M),z.setZoom(y?+i.zoom:a+Xt(o.lat,P.lat)),z.setBearing(i.bearing);const R=new c.P(c.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),c.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));z.setLocationAtPoint(M,R);const W=(i.offset&&i.offsetAsPoint.mag())>0?z.center:M,H=y?+i.zoom:a+Xt(o.lat,W.lat),K=a+Xt(o.lat,0),J=H+Xt(W.lat,0),ie=c.bq(o.lng,W.lng),te=c.bq(o.lat,W.lat),re=c.ac(J-K);return T=H!==a,{easeFunc:le=>{if(c.b6(f,g)||lr({startEulerAngles:f,endEulerAngles:g,tr:e,k:le,useSlerp:f.roll!=g.roll}),b&&e.interpolatePadding(u,i.padding,le),i.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const se=J>K?Math.min(2,re):Math.max(.5,re),_e=Math.pow(se,1-le),Ee=ls(o,ie,te,le*_e);e.setCenter(Ee.wrap())}if(T){const se=c.B.number(K,J,le)+Xt(0,e.center.lat);e.setZoom(se)}},isZooming:T,elevationCenter:W}}handleFlyTo(e,i){const a=i.zoom!==void 0,o=e.center,u=e.zoom,f=e.padding,g=!e.isPaddingEqual(i.padding),y=e.getConstrained(c.Q.convert(i.center||i.locationAtOffset),u).center,b=a?+i.zoom:e.zoom+Xt(e.center.lat,y.lat),T=e.clone();T.setCenter(y),T.setZoom(b),T.setBearing(i.bearing);const P=new c.P(c.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),c.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));T.setLocationAtPoint(y,P);const M=T.center;Vn(e,M);const z=function(te,re,le){const se=jt(re),_e=jt(le),Ee=c.aV(se,_e),Te=Math.acos(Ee),Se=Ri(te);return Te/(2*Math.PI)*Se}(e,o,M),R=u+Xt(o.lat,0),W=b+Xt(M.lat,0),H=c.ac(W-R);let K;if(typeof i.minZoom=="number"){const te=+i.minZoom+Xt(M.lat,0),re=Math.min(te,R,W)+Xt(0,M.lat),le=e.getConstrained(M,re).zoom+Xt(M.lat,0);K=c.ac(le-R)}const J=c.bq(o.lng,M.lng),ie=c.bq(o.lat,M.lat);return{easeFunc:(te,re,le,se)=>{const _e=ls(o,J,ie,le);g&&e.interpolatePadding(f,i.padding,te);const Ee=te===1?M:_e;e.setCenter(Ee.wrap());const Te=R+c.ah(re);e.setZoom(te===1?b:Te+Xt(0,Ee.lat))},scaleOfZoom:H,targetCenter:M,scaleOfMinZoom:K,pixelPathLength:z}}static solveVectorScale(e,i,a,o,u){const f=o==="x"?[a[0],a[4],a[8],a[12]]:[a[1],a[5],a[9],a[13]],g=[a[3],a[7],a[11],a[15]],y=e[0]*f[0]+e[1]*f[1]+e[2]*f[2],b=e[0]*g[0]+e[1]*g[1]+e[2]*g[2],T=i[0]*f[0]+i[1]*f[1]+i[2]*f[2],P=i[0]*g[0]+i[1]*g[1]+i[2]*g[2];return T+u*b===y+u*P||g[3]*(y-T)+f[3]*(P-b)+y*P==T*b?null:(T+f[3]-u*P-u*g[3])/(T-y-u*P+u*b)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class hs{constructor(e){this._globe=e,this._mercatorCameraHelper=new Zn,this._verticalPerspectiveCameraHelper=new jr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,a){this.currentHelper.handleMapControlsPan(e,i,a)}cameraForBoxAndBearing(e,i,a,o,u){return this.currentHelper.cameraForBoxAndBearing(e,i,a,o,u)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const La=(h,e)=>c.x(h,e&&e.filter(i=>i.identifier!=="source.canvas")),sh=c.bw();class Lo extends c.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const o=this.sourceCaches[a].getSource().type;o!=="vector"&&o!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new Bt(fr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,o)=>this.getGlyphs(a,o)),this.dispatcher.registerMessageHandler("GI",(a,o)=>this.getImages(a,o)),this.imageManager=new Oe,this.imageManager.setEventedParent(this),this.glyphManager=new St(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new wr(256,512),this.crossTileSymbolIndex=new On,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.by()),Cr().on(Ln,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const o=this.sourceCaches[a.sourceId];if(!o)return;const u=o.getSource();if(u&&u.vectorLayerIds)for(const f in this._layers){const g=this._layers[f];g.source===u.id&&this._validateLayer(g)}})}loadURL(e,i={},a){this.fire(new c.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const o=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const u=this._loadStyleRequest;c.j(o,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,i,a)}).catch(f=>{this._loadStyleRequest=null,f&&!u.signal.aborted&&this.fire(new c.k(f))})}loadJSON(e,i={},a){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Le.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(sh,{validate:!1})}_load(e,i,a){var o,u;const f=i.transformStyle?i.transformStyle(a,e):e;if(!i.validate||!La(this,c.y(f))){this._loaded=!0,this.stylesheet=f;for(const g in f.sources)this.addSource(g,f.sources[g],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new Ti(this.stylesheet.light),this._setProjectionInternal(((o=this.stylesheet.projection)===null||o===void 0?void 0:o.type)||"mercator"),this.sky=new xr(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const e=c.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const a=c.bA(i);a.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=a}}_loadSprite(e,i=!1,a=void 0){let o;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(u,f,g,y){return c._(this,void 0,void 0,function*(){const b=ke(u),T=g>1?"@2x":"",P={},M={};for(const{id:z,url:R}of b){const W=f.transformRequest(he(R,T,".json"),"SpriteJSON");P[z]=c.j(W,y);const H=f.transformRequest(he(R,T,".png"),"SpriteImage");M[z]=Ce.getImage(H,y)}return yield Promise.all([...Object.values(P),...Object.values(M)]),function(z,R){return c._(this,void 0,void 0,function*(){const W={};for(const H in z){W[H]={};const K=Le.getImageCanvasContext((yield R[H]).data),J=(yield z[H]).data;for(const ie in J){const{width:te,height:re,x:le,y:se,sdf:_e,pixelRatio:Ee,stretchX:Te,stretchY:Se,content:Pe,textFitWidth:Ke,textFitHeight:We}=J[ie];W[H][ie]={data:null,pixelRatio:Ee,sdf:_e,stretchX:Te,stretchY:Se,content:Pe,textFitWidth:Ke,textFitHeight:We,spriteData:{width:te,height:re,x:le,y:se,context:K}}}}return W})}(P,M)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(u=>{if(this._spriteRequest=null,u)for(const f in u){this._spritesImagesIds[f]=[];const g=this._spritesImagesIds[f]?this._spritesImagesIds[f].filter(y=>!(y in u)):[];for(const y of g)this.imageManager.removeImage(y),this._changedImages[y]=!0;for(const y in u[f]){const b=f==="default"?y:`${f}:${y}`;this._spritesImagesIds[f].push(b),b in this.imageManager.images?this.imageManager.updateImage(b,u[f][y],!1):this.imageManager.addImage(b,u[f][y]),i&&(this._changedImages[b]=!0)}}}).catch(u=>{this._spriteRequest=null,o=u,this.fire(new c.k(o))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),a&&a(o)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const a=e.sourceLayer;if(!a)return;const o=i.getSource();(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.k(new Error(`Source layer "${a}" does not exist on source "${o.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?c.bB(a):a);const o=[];for(const u of e)if(a[u]){const f=i?c.bB(a[u]):a[u];o.push(f)}return o}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const a of i){const o=this._layers[a];o.type!=="custom"&&(e[a]=o.serialize())}return e}hasTransitions(){var e,i,a;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((a=this.projection)===null||a===void 0)&&a.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const o=Object.keys(this._updatedLayers),u=Object.keys(this._removedLayers);(o.length||u.length)&&this._updateWorkerLayers(o,u);for(const f in this._updatedSources){const g=this._updatedSources[f];if(g==="reload")this._reloadSource(f);else{if(g!=="clear")throw new Error(`Invalid action ${g}`);this._clearSource(f)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const f in this._updatedPaintProps)this._layers[f].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const o in this.sourceCaches){const u=this.sourceCaches[o];a[o]=u.used,u.used=!1}for(const o of this._order){const u=this._layers[o];u.recalculate(e,this._availableImages),!u.isHidden(e.zoom)&&u.source&&(this.sourceCaches[u.source].used=!0)}for(const o in a){const u=this.sourceCaches[o];!!a[o]!=!!u.used&&u.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:o}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var a;this._checkLoaded();const o=this.serialize();if(e=i.transformStyle?i.transformStyle(o,e):e,((a=i.validate)===null||a===void 0||a)&&La(this,c.y(e)))return!1;(e=c.bB(e)).layers=c.bz(e.layers);const u=c.bC(o,e),f=this._getOperationsToPerform(u);if(f.unimplemented.length>0)throw new Error(`Unimplemented: ${f.unimplemented.join(", ")}.`);if(f.operations.length===0)return!1;for(const g of f.operations)g();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],a=[];for(const o of e)switch(o.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,o.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,o.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,o.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,o.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,o.args));break;case"addSource":i.push(()=>this.addSource.apply(this,o.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,o.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,o.args));break;case"setLight":i.push(()=>this.setLight.apply(this,o.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,o.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,o.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,o.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,o.args));break;case"setSky":i.push(()=>this.setSky.apply(this,o.args));break;case"setProjection":this.setProjection.apply(this,o.args);break;case"setTransition":i.push(()=>{});break;default:a.push(o.command)}return{operations:i,unimplemented:a}}addImage(e,i){if(this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(c.y.source,`sources.${e}`,i,null,a))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const o=this.sourceCaches[e]=new fe(e,i,this.dispatcher);o.style=this,o.setEventedParent(this,()=>({isSourceLoaded:o.loaded(),source:o.serialize(),sourceId:e})),o.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.k(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,a={}){this._checkLoaded();const o=e.id;if(this.getLayer(o))return void this.fire(new c.k(new Error(`Layer "${o}" already exists on this map.`)));let u;if(e.type==="custom"){if(La(this,c.bD(e)))return;u=c.bA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(o,e.source),e=c.bB(e),e=c.e(e,{source:o})),this._validate(c.y.layer,`layers.${o}`,e,{arrayIndex:-1},a))return;u=c.bA(e),this._validateLayer(u),u.setEventedParent(this,{layer:{id:o}})}const f=i?this._order.indexOf(i):this._order.length;if(i&&f===-1)this.fire(new c.k(new Error(`Cannot add layer "${o}" before non-existing layer "${i}".`)));else{if(this._order.splice(f,0,o),this._layerOrderChanged=!0,this._layers[o]=u,this._removedLayers[o]&&u.source&&u.type!=="custom"){const g=this._removedLayers[o];delete this._removedLayers[o],g.type!==u.type?this._updatedSources[u.source]="clear":(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const a=this._order.indexOf(e);this._order.splice(a,1);const o=i?this._order.indexOf(i):this._order.length;i&&o===-1?this.fire(new c.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(o,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,a){this._checkLoaded();const o=this.getLayer(e);o?o.minzoom===i&&o.maxzoom===a||(i!=null&&(o.minzoom=i),a!=null&&(o.maxzoom=a),this._updateLayer(o)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,a={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!c.bE(o.filter,i))return i==null?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(c.y.filter,`layers.${o.id}.filter`,i,null,a)||(o.filter=c.bB(i),this._updateLayer(o)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bB(this.getLayer(e).filter)}setLayoutProperty(e,i,a,o={}){this._checkLoaded();const u=this.getLayer(e);u?c.bE(u.getLayoutProperty(i),a)||(u.setLayoutProperty(i,a,o),this._updateLayer(u)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const a=this.getLayer(e);if(a)return a.getLayoutProperty(i);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,a,o={}){this._checkLoaded();const u=this.getLayer(e);u?c.bE(u.getPaintProperty(i),a)||(u.setPaintProperty(i,a,o)&&this._updateLayer(u),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const a=e.source,o=e.sourceLayer,u=this.sourceCaches[a];if(u===void 0)return void this.fire(new c.k(new Error(`The source '${a}' does not exist in the map's style.`)));const f=u.getSource().type;f==="geojson"&&o?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):f!=="vector"||o?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),u.setFeatureState(o,e.id,i)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const a=e.source,o=this.sourceCaches[a];if(o===void 0)return void this.fire(new c.k(new Error(`The source '${a}' does not exist in the map's style.`)));const u=o.getSource().type,f=u==="vector"?e.sourceLayer:void 0;u!=="vector"||f?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):o.removeFeatureState(f,e.id,i):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,a=e.sourceLayer,o=this.sourceCaches[i];if(o!==void 0)return o.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),o.getFeatureState(a,e.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bF(this.sourceCaches,u=>u.serialize()),i=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,o=this.stylesheet;return c.bG({version:o.version,name:o.name,metadata:o.metadata,light:o.light,sky:o.sky,center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch,sprite:o.sprite,glyphs:o.glyphs,transition:o.transition,projection:o.projection,sources:e,layers:i,terrain:a},u=>u!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=f=>this._layers[f].type==="fill-extrusion",a={},o=[];for(let f=this._order.length-1;f>=0;f--){const g=this._order[f];if(i(g)){a[g]=f;for(const y of e){const b=y[g];if(b)for(const T of b)o.push(T)}}}o.sort((f,g)=>g.intersectionZ-f.intersectionZ);const u=[];for(let f=this._order.length-1;f>=0;f--){const g=this._order[f];if(i(g))for(let y=o.length-1;y>=0;y--){const b=o[y].feature;if(a[b.layer.id]<f)break;u.push(b),o.pop()}else for(const y of e){const b=y[g];if(b)for(const T of b)u.push(T.feature)}}return u}queryRenderedFeatures(e,i,a){i&&i.filter&&this._validate(c.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const o={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const b of i.layers){const T=this._layers[b];if(!T)return this.fire(new c.k(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];o[T.source]=!0}}const u=[];i.availableImages=this._availableImages;const f=this._serializedAllLayers(),g=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,y=Object.assign(Object.assign({},i),{layers:g});for(const b in this.sourceCaches)i.layers&&!o[b]||u.push(qr(this.sourceCaches[b],this._layers,f,e,y,a,this.map.terrain?(T,P,M)=>this.map.terrain.getElevation(T,P,M):void 0));return this.placement&&u.push(function(b,T,P,M,z,R,W){const H={},K=R.queryRenderedSymbols(M),J=[];for(const ie of Object.keys(K).map(Number))J.push(W[ie]);J.sort(nr);for(const ie of J){const te=ie.featureIndex.lookupSymbolFeatures(K[ie.bucketInstanceId],T,ie.bucketIndex,ie.sourceLayerIndex,z.filter,z.layers,z.availableImages,b);for(const re in te){const le=H[re]=H[re]||[],se=te[re];se.sort((_e,Ee)=>{const Te=ie.featureSortOrder;if(Te){const Se=Te.indexOf(_e.featureIndex);return Te.indexOf(Ee.featureIndex)-Se}return Ee.featureIndex-_e.featureIndex});for(const _e of se)le.push(_e)}}return function(ie,te,re){for(const le in ie)for(const se of ie[le])Ki(se,re[te[le].source]);return ie}(H,b,P)}(this._layers,f,this.sourceCaches,e,y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(e,i){i&&i.filter&&this._validate(c.y.filter,"querySourceFeatures.filter",i.filter,null,i);const a=this.sourceCaches[e];return a?function(o,u){const f=o.getRenderableIds().map(b=>o.getTileByID(b)),g=[],y={};for(let b=0;b<f.length;b++){const T=f[b],P=T.tileID.canonical.key;y[P]||(y[P]=!0,T.querySourceFeatures(g,u))}return g}(a,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const a=this.light.getLight();let o=!1;for(const f in e)if(!c.bE(e[f],a[f])){o=!0;break}if(!o)return;const u={now:Le.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(u)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const a=this.getSky();let o=!1;if(!e&&!a)return;if(e&&!a)o=!0;else if(!e&&a)o=!0;else for(const f in e)if(!c.bE(e[f],a[f])){o=!0;break}if(!o)return;const u={now:Le.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(u)}_setProjectionInternal(e){const i=function(a){if(Array.isArray(a)){const o=new Kt({type:a});return{projection:o,transform:new Js,cameraHelper:new hs(o)}}switch(a){case"mercator":return{projection:new ss,transform:new ln,cameraHelper:new Zn};case"globe":{const o=new Kt({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:o,transform:new Js,cameraHelper:new hs(o)}}case"vertical-perspective":return{projection:new oi,transform:new cs,cameraHelper:new jr};default:return c.w(`Unknown projection name: ${a}. Falling back to mercator projection.`),{projection:new ss,transform:new ln,cameraHelper:new Zn}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const a in this.sourceCaches)this.sourceCaches[a].reload()}_validate(e,i,a,o,u={}){return(!u||u.validate!==!1)&&La(this,e.call(c.y,c.e({key:i,style:this.serialize(),value:a,styleSpec:c.v},o)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Cr().off(Ln,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const a=this.sourceCaches[i];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,a,o,u=!1){let f=!1,g=!1;const y={};for(const b of this._order){const T=this._layers[b];if(T.type!=="symbol")continue;if(!y[T.source]){const M=this.sourceCaches[T.source];y[T.source]=M.getRenderableIds(!0).map(z=>M.getTileByID(z)).sort((z,R)=>R.tileID.overscaledZ-z.tileID.overscaledZ||(z.tileID.isLessThan(R.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(T,y[T.source],e.center.lng);f=f||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((u=u||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Le.now(),e.zoom))&&(this.pauseablePlacement=new za(e,this.map.terrain,this._order,u,i,a,o,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Le.now()),g=!0),f&&this.pauseablePlacement.placement.setStale()),g||f)for(const b of this._order){const T=this._layers[b];T.type==="symbol"&&this.placement.updateLayerOpacities(T,y[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Le.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const o=this.sourceCaches[i.source];return o&&o.setDependencies(i.tileID.key,i.type,i.icons),a})}getGlyphs(e,i){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(i.stacks),o=this.sourceCaches[i.source];return o&&o.setDependencies(i.tileID.key,i.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(c.y.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,a={},o){this._checkLoaded();const u=[{id:e,url:i}],f=[...ke(this.stylesheet.sprite),...u];this._validate(c.y.sprite,"sprite",f,null,a)||(this.stylesheet.sprite=f,this._loadSprite(u,!0,o))}removeSprite(e){this._checkLoaded();const i=ke(this.stylesheet.sprite);if(i.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;i.splice(i.findIndex(a=>a.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ke(this.stylesheet.sprite)}setSprite(e,i={},a){this._checkLoaded(),e&&this._validate(c.y.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var ah=c.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class oh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,a,o,u,f,g,y,b){this.context=e;let T=this.boundPaintVertexBuffers.length!==o.length;for(let P=0;!T&&P<o.length;P++)this.boundPaintVertexBuffers[P]!==o[P]&&(T=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==a||T||this.boundIndexBuffer!==u||this.boundVertexOffset!==f||this.boundDynamicVertexBuffer!==g||this.boundDynamicVertexBuffer2!==y||this.boundDynamicVertexBuffer3!==b?this.freshBind(i,a,o,u,f,g,y,b):(e.bindVertexArray.set(this.vao),g&&g.bind(),u&&u.dynamicDraw&&u.bind(),y&&y.bind(),b&&b.bind())}freshBind(e,i,a,o,u,f,g,y){const b=e.numAttributes,T=this.context,P=T.gl;this.vao&&this.destroy(),this.vao=T.createVertexArray(),T.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=o,this.boundVertexOffset=u,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=g,this.boundDynamicVertexBuffer3=y,i.enableAttributes(P,e);for(const M of a)M.enableAttributes(P,e);f&&f.enableAttributes(P,e),g&&g.enableAttributes(P,e),y&&y.enableAttributes(P,e),i.bind(),i.setVertexAttribPointers(P,e,u);for(const M of a)M.bind(),M.setVertexAttribPointers(P,e,u);f&&(f.bind(),f.setVertexAttribPointers(P,e,u)),o&&o.bind(),g&&(g.bind(),g.setVertexAttribPointers(P,e,u)),y&&(y.bind(),y.setVertexAttribPointers(P,e,u)),T.currentNumAttributes=b}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const lh=(h,e,i,a,o)=>({u_texture:0,u_ele_delta:h,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):c.b7.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?0:i?i.calculateFogBlendOpacity(a):0,u_horizon_color:i?i.properties.get("horizon-color"):c.b7.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:o?1:0}),Ra={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ss(h){const e=[];for(let i=0;i<h.length;i++){if(h[i]===null)continue;const a=h[i].split(" ");e.push(a.pop())}return e}class Da{constructor(e,i,a,o,u,f,g,y,b=[]){const T=e.gl;this.program=T.createProgram();const P=Ss(i.staticAttributes),M=a?a.getBinderAttributes():[],z=P.concat(M),R=yi.prelude.staticUniforms?Ss(yi.prelude.staticUniforms):[],W=g.staticUniforms?Ss(g.staticUniforms):[],H=i.staticUniforms?Ss(i.staticUniforms):[],K=a?a.getBinderUniforms():[],J=R.concat(W).concat(H).concat(K),ie=[];for(const Te of J)ie.indexOf(Te)<0&&ie.push(Te);const te=a?a.defines():[];Fe(T)&&te.unshift("#version 300 es"),u&&te.push("#define OVERDRAW_INSPECTOR;"),f&&te.push("#define TERRAIN3D;"),y&&te.push(y),b&&te.push(...b);let re=te.concat(yi.prelude.fragmentSource,g.fragmentSource,i.fragmentSource).join(`
`),le=te.concat(yi.prelude.vertexSource,g.vertexSource,i.vertexSource).join(`
`);Fe(T)||(re=function(Te){return Te.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(re),le=function(Te){return Te.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(le));const se=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(se,re),T.compileShader(se),!T.getShaderParameter(se,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(se)}`);T.attachShader(this.program,se);const _e=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(_e,le),T.compileShader(_e),!T.getShaderParameter(_e,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(_e)}`);T.attachShader(this.program,_e),this.attributes={};const Ee={};this.numAttributes=z.length;for(let Te=0;Te<this.numAttributes;Te++)z[Te]&&(T.bindAttribLocation(this.program,Te,z[Te]),this.attributes[z[Te]]=Te);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(_e),T.deleteShader(se);for(let Te=0;Te<ie.length;Te++){const Se=ie[Te];if(Se&&!Ee[Se]){const Pe=T.getUniformLocation(this.program,Se);Pe&&(Ee[Se]=Pe)}}this.fixedUniforms=o(e,Ee),this.terrainUniforms=((Te,Se)=>({u_depth:new c.bH(Te,Se.u_depth),u_terrain:new c.bH(Te,Se.u_terrain),u_terrain_dim:new c.b8(Te,Se.u_terrain_dim),u_terrain_matrix:new c.bJ(Te,Se.u_terrain_matrix),u_terrain_unpack:new c.bK(Te,Se.u_terrain_unpack),u_terrain_exaggeration:new c.b8(Te,Se.u_terrain_exaggeration)}))(e,Ee),this.projectionUniforms=((Te,Se)=>({u_projection_matrix:new c.bJ(Te,Se.u_projection_matrix),u_projection_tile_mercator_coords:new c.bK(Te,Se.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bK(Te,Se.u_projection_clipping_plane),u_projection_transition:new c.b8(Te,Se.u_projection_transition),u_projection_fallback_matrix:new c.bJ(Te,Se.u_projection_fallback_matrix)}))(e,Ee),this.binderUniforms=a?a.getUniforms(e,Ee):[]}draw(e,i,a,o,u,f,g,y,b,T,P,M,z,R,W,H,K,J,ie){const te=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(o),e.setColorMode(u),e.setCullFace(f),y){e.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,y.depthTexture),e.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,y.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(y[le])}if(b)for(const le in b)this.projectionUniforms[Ra[le]].set(b[le]);if(g)for(const le in this.fixedUniforms)this.fixedUniforms[le].set(g[le]);H&&H.setUniforms(e,this.binderUniforms,R,{zoom:W});let re=0;switch(i){case te.LINES:re=2;break;case te.TRIANGLES:re=3;break;case te.LINE_STRIP:re=1}for(const le of z.get()){const se=le.vaos||(le.vaos={});(se[T]||(se[T]=new oh)).bind(e,this,P,H?H.getPaintVertexBuffers():[],M,le.vertexOffset,K,J,ie),te.drawElements(i,le.primitiveLength*re,te.UNSIGNED_SHORT,le.primitiveOffset*re*2)}}}function Ba(h,e,i){const a=1/c.az(i,1,e.transform.tileZoom),o=Math.pow(2,i.tileID.overscaledZ),u=i.tileSize*Math.pow(2,e.transform.tileZoom)/o,f=u*(i.tileID.canonical.x+i.tileID.wrap*o),g=u*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[a,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[f>>16,g>>16],u_pixel_coord_lower:[65535&f,65535&g]}}const Fa=(h,e,i,a)=>{const o=h.style.light,u=o.properties.get("position"),f=[u.x,u.y,u.z],g=c.bN();o.properties.get("anchor")==="viewport"&&c.bO(g,h.transform.bearingInRadians),c.bP(f,f,g);const y=h.transform.transformLightDirection(f),b=o.properties.get("color");return{u_lightpos:f,u_lightpos_globe:y,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:a}},hn=(h,e,i,a,o,u,f)=>c.e(Fa(h,e,i,a),Ba(u,h,f),{u_height_factor:-Math.pow(2,o.overscaledZ)/f.tileSize/8}),Zl=(h,e,i,a)=>c.e(Ba(e,h,i),{u_fill_translate:a}),Ro=(h,e)=>({u_world:h,u_fill_translate:e}),Qs=(h,e,i,a,o)=>c.e(Zl(h,e,i,o),{u_world:a}),ea=(h,e,i,a,o)=>{const u=h.transform;let f,g,y=0;if(i.paint.get("circle-pitch-alignment")==="map"){const b=c.az(e,1,u.zoom);f=!0,g=[b,b],y=b/(c.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*o}else f=!1,g=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+f,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:g,u_globe_extrude_scale:y,u_translate:a}},ch=h=>({u_pixel_extrude_scale:[1/h.width,1/h.height]}),Oa=h=>({u_viewport_size:[h.width,h.height]}),Ul=(h,e=1)=>({u_color:h,u_overlay:0,u_overlay_scale:e}),us=(h,e,i,a)=>{const o=c.az(h,1,e)/(c.Z*Math.pow(2,h.tileID.overscaledZ))*2*Math.PI*a;return{u_extrude_scale:c.az(h,1,e),u_intensity:i,u_globe_extrude_scale:o}},Gl=(h,e,i,a)=>{const o=c.K();c.bQ(o,0,h.width,h.height,0,0,1);const u=h.context.gl;return{u_matrix:o,u_world:[u.drawingBufferWidth,u.drawingBufferHeight],u_image:i,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}},$l=(h,e,i)=>{const a=i.paint.get("hillshade-accent-color");let o;switch(i.paint.get("hillshade-method")){case"basic":o=4;break;case"combined":o=1;break;case"igor":o=2;break;case"multidirectional":o=3;break;default:o=0}const u=i.getIlluminationProperties();for(let f=0;f<u.directionRadians.length;f++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(u.directionRadians[f]+=h.transform.bearingInRadians);return{u_image:0,u_latrange:ql(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:u.altitudeRadians,u_azimuths:u.directionRadians,u_accent:a,u_method:o,u_highlights:u.highlightColor,u_shadows:u.shadowColor}},hh=(h,e)=>{const i=e.stride,a=c.K();return c.bQ(a,0,c.Z,-8192,0,0,1),c.L(a,a,[0,-8192,0]),{u_matrix:a,u_image:1,u_dimension:[i,i],u_zoom:h.overscaledZ,u_unpack:e.getUnpackVector()}};function ql(h,e){const i=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.$(0,a/i).toLngLat().lat,new c.$(0,(a+1)/i).toLngLat().lat]}const ta=(h,e,i,a)=>{const o=h.transform;return{u_translation:Gn(h,e,i),u_ratio:a/c.az(e,1,o.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Hl=(h,e,i,a,o)=>c.e(ta(h,e,i,a),{u_image:0,u_image_height:o}),Wl=(h,e,i,a,o)=>{const u=h.transform,f=Do(e,u);return{u_translation:Gn(h,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:a/c.az(e,1,u.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[f,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Kl=(h,e,i,a,o,u)=>{const f=h.lineAtlas,g=Do(e,h.transform),y=i.layout.get("line-cap")==="round",b=f.getDash(o.from,y),T=f.getDash(o.to,y),P=b.width*u.fromScale,M=T.width*u.toScale;return c.e(ta(h,e,i,a),{u_patternscale_a:[g/P,-b.height/2],u_patternscale_b:[g/M,-T.height/2],u_sdfgamma:f.width/(256*Math.min(P,M)*h.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:T.y,u_mix:u.t})};function Do(h,e){return 1/c.az(h,1,e.tileZoom)}function Gn(h,e,i){return c.aA(h.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Xl=(h,e,i,a,o)=>{return{u_tl_parent:h,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(f=a.paint.get("raster-saturation"),f>0?1-1/(1.001-f):-f),u_contrast_factor:(u=a.paint.get("raster-contrast"),u>0?1/(1-u):1+u),u_spin_weights:Yl(a.paint.get("raster-hue-rotate")),u_coords_top:[o[0].x,o[0].y,o[1].x,o[1].y],u_coords_bottom:[o[3].x,o[3].y,o[2].x,o[2].y]};var u,f};function Yl(h){h*=Math.PI/180;const e=Math.sin(h),i=Math.cos(h);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Cs=(h,e,i,a,o,u,f,g,y,b,T,P,M)=>{const z=f.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:z.width/z.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_label_plane_matrix:g,u_coord_matrix:y,u_is_text:+T,u_pitch_with_map:+a,u_is_along_line:o,u_is_variable_anchor:u,u_texsize:P,u_texture:0,u_translation:b,u_pitched_scale:M}},Jl=(h,e,i,a,o,u,f,g,y,b,T,P,M,z)=>{const R=f.transform;return c.e(Cs(h,e,i,a,o,u,f,g,y,b,T,P,z),{u_gamma_scale:a?Math.cos(R.pitch*Math.PI/180)*R.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:1})},ja=(h,e,i,a,o,u,f,g,y,b,T,P,M)=>c.e(Jl(h,e,i,a,o,u,f,g,y,b,!0,T,0,M),{u_texsize_icon:P,u_texture_icon:1}),uh=(h,e)=>({u_opacity:h,u_color:e}),dh=(h,e,i,a,o)=>c.e(function(u,f,g,y){const b=g.imageManager.getPattern(u.from.toString()),T=g.imageManager.getPattern(u.to.toString()),{width:P,height:M}=g.imageManager.getPixelSize(),z=Math.pow(2,y.tileID.overscaledZ),R=y.tileSize*Math.pow(2,g.transform.tileZoom)/z,W=R*(y.tileID.canonical.x+y.tileID.wrap*z),H=R*y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:b.tl,u_pattern_br_a:b.br,u_pattern_tl_b:T.tl,u_pattern_br_b:T.br,u_texsize:[P,M],u_mix:f.t,u_pattern_size_a:b.displaySize,u_pattern_size_b:T.displaySize,u_scale_a:f.fromScale,u_scale_b:f.toScale,u_tile_units_to_pixels:1/c.az(y,1,g.transform.tileZoom),u_pixel_coord_upper:[W>>16,H>>16],u_pixel_coord_lower:[65535&W,65535&H]}}(i,o,e,a),{u_opacity:h}),Bo=(h,e)=>{},Ql={fillExtrusion:(h,e)=>({u_lightpos:new c.bL(h,e.u_lightpos),u_lightpos_globe:new c.bL(h,e.u_lightpos_globe),u_lightintensity:new c.b8(h,e.u_lightintensity),u_lightcolor:new c.bL(h,e.u_lightcolor),u_vertical_gradient:new c.b8(h,e.u_vertical_gradient),u_opacity:new c.b8(h,e.u_opacity),u_fill_translate:new c.bM(h,e.u_fill_translate)}),fillExtrusionPattern:(h,e)=>({u_lightpos:new c.bL(h,e.u_lightpos),u_lightpos_globe:new c.bL(h,e.u_lightpos_globe),u_lightintensity:new c.b8(h,e.u_lightintensity),u_lightcolor:new c.bL(h,e.u_lightcolor),u_vertical_gradient:new c.b8(h,e.u_vertical_gradient),u_height_factor:new c.b8(h,e.u_height_factor),u_opacity:new c.b8(h,e.u_opacity),u_fill_translate:new c.bM(h,e.u_fill_translate),u_image:new c.bH(h,e.u_image),u_texsize:new c.bM(h,e.u_texsize),u_pixel_coord_upper:new c.bM(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(h,e.u_pixel_coord_lower),u_scale:new c.bL(h,e.u_scale),u_fade:new c.b8(h,e.u_fade)}),fill:(h,e)=>({u_fill_translate:new c.bM(h,e.u_fill_translate)}),fillPattern:(h,e)=>({u_image:new c.bH(h,e.u_image),u_texsize:new c.bM(h,e.u_texsize),u_pixel_coord_upper:new c.bM(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(h,e.u_pixel_coord_lower),u_scale:new c.bL(h,e.u_scale),u_fade:new c.b8(h,e.u_fade),u_fill_translate:new c.bM(h,e.u_fill_translate)}),fillOutline:(h,e)=>({u_world:new c.bM(h,e.u_world),u_fill_translate:new c.bM(h,e.u_fill_translate)}),fillOutlinePattern:(h,e)=>({u_world:new c.bM(h,e.u_world),u_image:new c.bH(h,e.u_image),u_texsize:new c.bM(h,e.u_texsize),u_pixel_coord_upper:new c.bM(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(h,e.u_pixel_coord_lower),u_scale:new c.bL(h,e.u_scale),u_fade:new c.b8(h,e.u_fade),u_fill_translate:new c.bM(h,e.u_fill_translate)}),circle:(h,e)=>({u_camera_to_center_distance:new c.b8(h,e.u_camera_to_center_distance),u_scale_with_map:new c.bH(h,e.u_scale_with_map),u_pitch_with_map:new c.bH(h,e.u_pitch_with_map),u_extrude_scale:new c.bM(h,e.u_extrude_scale),u_device_pixel_ratio:new c.b8(h,e.u_device_pixel_ratio),u_globe_extrude_scale:new c.b8(h,e.u_globe_extrude_scale),u_translate:new c.bM(h,e.u_translate)}),collisionBox:(h,e)=>({u_pixel_extrude_scale:new c.bM(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_viewport_size:new c.bM(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new c.bI(h,e.u_color),u_overlay:new c.bH(h,e.u_overlay),u_overlay_scale:new c.b8(h,e.u_overlay_scale)}),depth:Bo,clippingMask:Bo,heatmap:(h,e)=>({u_extrude_scale:new c.b8(h,e.u_extrude_scale),u_intensity:new c.b8(h,e.u_intensity),u_globe_extrude_scale:new c.b8(h,e.u_globe_extrude_scale)}),heatmapTexture:(h,e)=>({u_matrix:new c.bJ(h,e.u_matrix),u_world:new c.bM(h,e.u_world),u_image:new c.bH(h,e.u_image),u_color_ramp:new c.bH(h,e.u_color_ramp),u_opacity:new c.b8(h,e.u_opacity)}),hillshade:(h,e)=>({u_image:new c.bH(h,e.u_image),u_latrange:new c.bM(h,e.u_latrange),u_exaggeration:new c.b8(h,e.u_exaggeration),u_altitudes:new c.bS(h,e.u_altitudes),u_azimuths:new c.bS(h,e.u_azimuths),u_accent:new c.bI(h,e.u_accent),u_method:new c.bH(h,e.u_method),u_shadows:new c.bR(h,e.u_shadows),u_highlights:new c.bR(h,e.u_highlights)}),hillshadePrepare:(h,e)=>({u_matrix:new c.bJ(h,e.u_matrix),u_image:new c.bH(h,e.u_image),u_dimension:new c.bM(h,e.u_dimension),u_zoom:new c.b8(h,e.u_zoom),u_unpack:new c.bK(h,e.u_unpack)}),line:(h,e)=>({u_translation:new c.bM(h,e.u_translation),u_ratio:new c.b8(h,e.u_ratio),u_device_pixel_ratio:new c.b8(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_translation:new c.bM(h,e.u_translation),u_ratio:new c.b8(h,e.u_ratio),u_device_pixel_ratio:new c.b8(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(h,e.u_units_to_pixels),u_image:new c.bH(h,e.u_image),u_image_height:new c.b8(h,e.u_image_height)}),linePattern:(h,e)=>({u_translation:new c.bM(h,e.u_translation),u_texsize:new c.bM(h,e.u_texsize),u_ratio:new c.b8(h,e.u_ratio),u_device_pixel_ratio:new c.b8(h,e.u_device_pixel_ratio),u_image:new c.bH(h,e.u_image),u_units_to_pixels:new c.bM(h,e.u_units_to_pixels),u_scale:new c.bL(h,e.u_scale),u_fade:new c.b8(h,e.u_fade)}),lineSDF:(h,e)=>({u_translation:new c.bM(h,e.u_translation),u_ratio:new c.b8(h,e.u_ratio),u_device_pixel_ratio:new c.b8(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.bM(h,e.u_units_to_pixels),u_patternscale_a:new c.bM(h,e.u_patternscale_a),u_patternscale_b:new c.bM(h,e.u_patternscale_b),u_sdfgamma:new c.b8(h,e.u_sdfgamma),u_image:new c.bH(h,e.u_image),u_tex_y_a:new c.b8(h,e.u_tex_y_a),u_tex_y_b:new c.b8(h,e.u_tex_y_b),u_mix:new c.b8(h,e.u_mix)}),raster:(h,e)=>({u_tl_parent:new c.bM(h,e.u_tl_parent),u_scale_parent:new c.b8(h,e.u_scale_parent),u_buffer_scale:new c.b8(h,e.u_buffer_scale),u_fade_t:new c.b8(h,e.u_fade_t),u_opacity:new c.b8(h,e.u_opacity),u_image0:new c.bH(h,e.u_image0),u_image1:new c.bH(h,e.u_image1),u_brightness_low:new c.b8(h,e.u_brightness_low),u_brightness_high:new c.b8(h,e.u_brightness_high),u_saturation_factor:new c.b8(h,e.u_saturation_factor),u_contrast_factor:new c.b8(h,e.u_contrast_factor),u_spin_weights:new c.bL(h,e.u_spin_weights),u_coords_top:new c.bK(h,e.u_coords_top),u_coords_bottom:new c.bK(h,e.u_coords_bottom)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new c.bH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(h,e.u_is_size_feature_constant),u_size_t:new c.b8(h,e.u_size_t),u_size:new c.b8(h,e.u_size),u_camera_to_center_distance:new c.b8(h,e.u_camera_to_center_distance),u_pitch:new c.b8(h,e.u_pitch),u_rotate_symbol:new c.bH(h,e.u_rotate_symbol),u_aspect_ratio:new c.b8(h,e.u_aspect_ratio),u_fade_change:new c.b8(h,e.u_fade_change),u_label_plane_matrix:new c.bJ(h,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(h,e.u_coord_matrix),u_is_text:new c.bH(h,e.u_is_text),u_pitch_with_map:new c.bH(h,e.u_pitch_with_map),u_is_along_line:new c.bH(h,e.u_is_along_line),u_is_variable_anchor:new c.bH(h,e.u_is_variable_anchor),u_texsize:new c.bM(h,e.u_texsize),u_texture:new c.bH(h,e.u_texture),u_translation:new c.bM(h,e.u_translation),u_pitched_scale:new c.b8(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new c.bH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(h,e.u_is_size_feature_constant),u_size_t:new c.b8(h,e.u_size_t),u_size:new c.b8(h,e.u_size),u_camera_to_center_distance:new c.b8(h,e.u_camera_to_center_distance),u_pitch:new c.b8(h,e.u_pitch),u_rotate_symbol:new c.bH(h,e.u_rotate_symbol),u_aspect_ratio:new c.b8(h,e.u_aspect_ratio),u_fade_change:new c.b8(h,e.u_fade_change),u_label_plane_matrix:new c.bJ(h,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(h,e.u_coord_matrix),u_is_text:new c.bH(h,e.u_is_text),u_pitch_with_map:new c.bH(h,e.u_pitch_with_map),u_is_along_line:new c.bH(h,e.u_is_along_line),u_is_variable_anchor:new c.bH(h,e.u_is_variable_anchor),u_texsize:new c.bM(h,e.u_texsize),u_texture:new c.bH(h,e.u_texture),u_gamma_scale:new c.b8(h,e.u_gamma_scale),u_device_pixel_ratio:new c.b8(h,e.u_device_pixel_ratio),u_is_halo:new c.bH(h,e.u_is_halo),u_translation:new c.bM(h,e.u_translation),u_pitched_scale:new c.b8(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new c.bH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bH(h,e.u_is_size_feature_constant),u_size_t:new c.b8(h,e.u_size_t),u_size:new c.b8(h,e.u_size),u_camera_to_center_distance:new c.b8(h,e.u_camera_to_center_distance),u_pitch:new c.b8(h,e.u_pitch),u_rotate_symbol:new c.bH(h,e.u_rotate_symbol),u_aspect_ratio:new c.b8(h,e.u_aspect_ratio),u_fade_change:new c.b8(h,e.u_fade_change),u_label_plane_matrix:new c.bJ(h,e.u_label_plane_matrix),u_coord_matrix:new c.bJ(h,e.u_coord_matrix),u_is_text:new c.bH(h,e.u_is_text),u_pitch_with_map:new c.bH(h,e.u_pitch_with_map),u_is_along_line:new c.bH(h,e.u_is_along_line),u_is_variable_anchor:new c.bH(h,e.u_is_variable_anchor),u_texsize:new c.bM(h,e.u_texsize),u_texsize_icon:new c.bM(h,e.u_texsize_icon),u_texture:new c.bH(h,e.u_texture),u_texture_icon:new c.bH(h,e.u_texture_icon),u_gamma_scale:new c.b8(h,e.u_gamma_scale),u_device_pixel_ratio:new c.b8(h,e.u_device_pixel_ratio),u_is_halo:new c.bH(h,e.u_is_halo),u_translation:new c.bM(h,e.u_translation),u_pitched_scale:new c.b8(h,e.u_pitched_scale)}),background:(h,e)=>({u_opacity:new c.b8(h,e.u_opacity),u_color:new c.bI(h,e.u_color)}),backgroundPattern:(h,e)=>({u_opacity:new c.b8(h,e.u_opacity),u_image:new c.bH(h,e.u_image),u_pattern_tl_a:new c.bM(h,e.u_pattern_tl_a),u_pattern_br_a:new c.bM(h,e.u_pattern_br_a),u_pattern_tl_b:new c.bM(h,e.u_pattern_tl_b),u_pattern_br_b:new c.bM(h,e.u_pattern_br_b),u_texsize:new c.bM(h,e.u_texsize),u_mix:new c.b8(h,e.u_mix),u_pattern_size_a:new c.bM(h,e.u_pattern_size_a),u_pattern_size_b:new c.bM(h,e.u_pattern_size_b),u_scale_a:new c.b8(h,e.u_scale_a),u_scale_b:new c.b8(h,e.u_scale_b),u_pixel_coord_upper:new c.bM(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bM(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.b8(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_texture:new c.bH(h,e.u_texture),u_ele_delta:new c.b8(h,e.u_ele_delta),u_fog_matrix:new c.bJ(h,e.u_fog_matrix),u_fog_color:new c.bI(h,e.u_fog_color),u_fog_ground_blend:new c.b8(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.b8(h,e.u_fog_ground_blend_opacity),u_horizon_color:new c.bI(h,e.u_horizon_color),u_horizon_fog_blend:new c.b8(h,e.u_horizon_fog_blend),u_is_globe_mode:new c.b8(h,e.u_is_globe_mode)}),terrainDepth:(h,e)=>({u_ele_delta:new c.b8(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_texture:new c.bH(h,e.u_texture),u_terrain_coords_id:new c.b8(h,e.u_terrain_coords_id),u_ele_delta:new c.b8(h,e.u_ele_delta)}),projectionErrorMeasurement:(h,e)=>({u_input:new c.b8(h,e.u_input),u_output_expected:new c.b8(h,e.u_output_expected)}),atmosphere:(h,e)=>({u_sun_pos:new c.bL(h,e.u_sun_pos),u_atmosphere_blend:new c.b8(h,e.u_atmosphere_blend),u_globe_position:new c.bL(h,e.u_globe_position),u_globe_radius:new c.b8(h,e.u_globe_radius),u_inv_proj_matrix:new c.bJ(h,e.u_inv_proj_matrix)}),sky:(h,e)=>({u_sky_color:new c.bI(h,e.u_sky_color),u_horizon_color:new c.bI(h,e.u_horizon_color),u_horizon:new c.bM(h,e.u_horizon),u_horizon_normal:new c.bM(h,e.u_horizon_normal),u_sky_horizon_blend:new c.b8(h,e.u_sky_horizon_blend),u_sky_blend:new c.b8(h,e.u_sky_blend)})};class ec{constructor(e,i,a){this.context=e;const o=e.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class tc{constructor(e,i,a,o){this.length=i.length,this.attributes=a,this.itemSize=i.bytesPerElement,this.dynamicDraw=o,this.context=e;const u=e.gl;this.buffer=u.createBuffer(),e.bindVertexBuffer.set(this.buffer),u.bufferData(u.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let a=0;a<this.attributes.length;a++){const o=i.attributes[this.attributes[a].name];o!==void 0&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,i,a){for(let o=0;o<this.attributes.length;o++){const u=this.attributes[o],f=i.attributes[u.name];f!==void 0&&e.vertexAttribPointer(f,u.components,e[Fo[u.type]],!1,this.itemSize,u.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sn extends Nt{getDefault(){return c.b7.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Oo extends Nt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class jo extends Nt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class No extends Nt{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ic extends Nt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Vo extends Nt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ds extends Nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Zo extends Nt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ph extends Nt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class fh extends Nt{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class mh extends Nt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class gh extends Nt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class rc extends Nt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class _h extends Nt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class nc extends Nt{getDefault(){return c.b7.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Na extends Nt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Va extends Nt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class Za extends Nt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Uo extends Nt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ps extends Nt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ua extends Nt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ms extends Nt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Nr extends Nt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class sc extends Nt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ac extends Nt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Go extends Nt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class fs extends Nt{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ga extends Nt{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const a=this.gl;Fe(a)?a.bindVertexArray(e):(i=a.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class $a extends Nt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ia extends Nt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class qa extends Nt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ha extends Nt{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class Ps extends Ha{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Is extends Ha{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class oc extends Ha{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Wa="Framebuffer is not complete";class Et{constructor(e,i,a,o,u){this.context=e,this.width=i,this.height=a;const f=e.gl,g=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new Ps(e,g),o)this.depthAttachment=u?new oc(e,g):new Is(e,g);else if(u)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error(Wa)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Ka{constructor(e){var i,a;if(this.gl=e,this.clearColor=new Sn(this),this.clearDepth=new Oo(this),this.clearStencil=new jo(this),this.colorMask=new No(this),this.depthMask=new ic(this),this.stencilMask=new Vo(this),this.stencilFunc=new ds(this),this.stencilOp=new Zo(this),this.stencilTest=new ph(this),this.depthRange=new fh(this),this.depthTest=new mh(this),this.depthFunc=new gh(this),this.blend=new rc(this),this.blendFunc=new _h(this),this.blendColor=new nc(this),this.blendEquation=new Na(this),this.cullFace=new Va(this),this.cullFaceSide=new Za(this),this.frontFace=new Uo(this),this.program=new ps(this),this.activeTexture=new Ua(this),this.viewport=new Ms(this),this.bindFramebuffer=new Nr(this),this.bindRenderbuffer=new sc(this),this.bindTexture=new ac(this),this.bindVertexBuffer=new Go(this),this.bindElementBuffer=new fs(this),this.bindVertexArray=new Ga(this),this.pixelStoreUnpack=new $a(this),this.pixelStoreUnpackPremultiplyAlpha=new ia(this),this.pixelStoreUnpackFlipY=new qa(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Fe(e)){this.HALF_FLOAT=e.HALF_FLOAT;const o=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:o==null?void 0:o.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:o==null?void 0:o.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const o=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=o==null?void 0:o.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new ec(this,e,i)}createVertexBuffer(e,i,a){return new tc(this,e,i,a)}createRenderbuffer(e,i,a){const o=this.gl,u=o.createRenderbuffer();return this.bindRenderbuffer.set(u),o.renderbufferStorage(o.RENDERBUFFER,e,i,a),this.bindRenderbuffer.set(null),u}createFramebuffer(e,i,a,o){return new Et(this,e,i,a,o)}clear({color:e,depth:i,stencil:a}){const o=this.gl;let u=0;e&&(u|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(u|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),a!==void 0&&(u|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),o.clear(u)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bE(e.blendFunction,Ot.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Fe(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return Fe(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Xa;function $o(h,e,i,a,o){const u=h.context,f=h.transform,g=u.gl,y=h.useProgram("collisionBox"),b=[];let T=0,P=0;for(let K=0;K<a.length;K++){const J=a[K],ie=e.getTile(J).getBucket(i);if(!ie)continue;const te=o?ie.textCollisionBox:ie.iconCollisionBox,re=ie.collisionCircleArray;re.length>0&&(b.push({circleArray:re,circleOffset:P,coord:J}),T+=re.length/4,P=T),te&&y.draw(u,g.LINES,mt.disabled,$.disabled,h.colorModeForRenderPass(),It.disabled,ch(h.transform),h.style.map.terrain&&h.style.map.terrain.getTerrainData(J),f.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,null,h.transform.zoom,null,null,te.collisionVertexBuffer)}if(!o||!b.length)return;const M=h.useProgram("collisionCircle"),z=new c.bT;z.resize(4*T),z._trim();let R=0;for(const K of b)for(let J=0;J<K.circleArray.length/4;J++){const ie=4*J,te=K.circleArray[ie+0],re=K.circleArray[ie+1],le=K.circleArray[ie+2],se=K.circleArray[ie+3];z.emplace(R++,te,re,le,se,0),z.emplace(R++,te,re,le,se,1),z.emplace(R++,te,re,le,se,2),z.emplace(R++,te,re,le,se,3)}(!Xa||Xa.length<2*T)&&(Xa=function(K){const J=2*K,ie=new c.bV;ie.resize(J),ie._trim();for(let te=0;te<J;te++){const re=6*te;ie.uint16[re+0]=4*te+0,ie.uint16[re+1]=4*te+1,ie.uint16[re+2]=4*te+2,ie.uint16[re+3]=4*te+2,ie.uint16[re+4]=4*te+3,ie.uint16[re+5]=4*te+0}return ie}(T));const W=u.createIndexBuffer(Xa,!0),H=u.createVertexBuffer(z,c.bU.members,!0);for(const K of b){const J=Oa(h.transform);M.draw(u,g.TRIANGLES,mt.disabled,$.disabled,h.colorModeForRenderPass(),It.disabled,J,h.style.map.terrain&&h.style.map.terrain.getTerrainData(K.coord),null,i.id,H,W,c.aJ.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,h.transform.zoom,null,null,null)}H.destroy(),W.destroy()}const ra=c.ad(new Float32Array(16));function yh(h,e,i,a,o,u){const{horizontalAlign:f,verticalAlign:g}=c.aE(h);return new c.P((-(f-.5)*e/o+a[0])*u,(-(g-.5)*i/o+a[1])*u)}function vh(h,e,i,a,o,u){const f=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let g=a.mult(u);i||(g=g.rotate(-o));const y=f.add(g);return Me(y.x,y.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const g=Vt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),y=Math.atan(g.y/g.x)+(g.x<0?Math.PI:0);return h.add(a.rotate(y))}return h.add(a)}function lc(h,e,i,a,o,u,f,g,y,b,T,P){const M=h.text.placedSymbolArray,z=h.text.dynamicLayoutVertexArray,R=h.icon.dynamicLayoutVertexArray,W={};z.clear();for(let H=0;H<M.length;H++){const K=M.get(H),J=K.hidden||!K.crossTileID||h.allowVerticalPlacement&&!K.placedOrientation?null:a[K.crossTileID];if(J){const ie=new c.P(K.anchorX,K.anchorY),te={getElevation:P,width:o.width,height:o.height,pitchedLabelPlaneMatrix:u,pitchWithMap:i,transform:o,tileAnchorPoint:ie,translation:b,unwrappedTileID:T},re=i?bt(ie.x,ie.y,te):Vt(ie.x,ie.y,te),le=Ft(o.cameraToCenterDistance,re.signedDistanceFromCamera);let se=c.am(h.textSizeData,g,K)*le/c.ay;i&&(se*=h.tilePixelRatio/f);const{width:_e,height:Ee,anchor:Te,textOffset:Se,textBoxScale:Pe}=J,Ke=yh(Te,_e,Ee,Se,Pe,se),We=o.getPitchedTextCorrection(ie.x+b[0],ie.y+b[1],T),Ve=vh(re.point,te,e,Ke,-o.bearingInRadians,We),tt=h.allowVerticalPlacement&&K.placedOrientation===c.al.vertical?Math.PI/2:0;for(let wt=0;wt<K.numGlyphs;wt++)c.as(z,Ve,tt);y&&K.associatedIconIndex>=0&&(W[K.associatedIconIndex]={shiftedAnchor:Ve,angle:tt})}else Kr(K.numGlyphs,z)}if(y){R.clear();const H=h.icon.placedSymbolArray;for(let K=0;K<H.length;K++){const J=H.get(K);if(J.hidden)Kr(J.numGlyphs,R);else{const ie=W[K];if(ie)for(let te=0;te<J.numGlyphs;te++)c.as(R,ie.shiftedAnchor,ie.angle);else Kr(J.numGlyphs,R)}}h.icon.dynamicLayoutVertexBuffer.updateData(R)}h.text.dynamicLayoutVertexBuffer.updateData(z)}function bh(h,e,i){return i.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ya(h,e,i,a,o,u,f,g,y,b,T,P,M){const z=h.context,R=z.gl,W=h.transform,H=g==="map",K=y==="map",J=g!=="viewport"&&i.layout.get("symbol-placement")!=="point",ie=H&&!K&&!J,te=!i.layout.get("symbol-sort-key").isConstant();let re=!1;const le=h.getDepthModeForSublayer(0,mt.ReadOnly),se=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[],Ee=W.getCircleRadiusCorrection();for(const Te of a){const Se=e.getTile(Te),Pe=Se.getBucket(i);if(!Pe)continue;const Ke=o?Pe.text:Pe.icon;if(!Ke||!Ke.segments.get().length||!Ke.hasVisibleVertices)continue;const We=Ke.programConfigurations.get(i.id),Ve=o||Pe.sdfIcons,tt=o?Pe.textSizeData:Pe.iconSizeData,wt=K||W.pitch!==0,Rt=h.useProgram(bh(Ve,o,Pe),We),ci=c.ak(tt,W.zoom),Yt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Te);let hi,ui,Qt,Zt,Fi=[0,0],Gi=null;if(o)ui=Se.glyphAtlasTexture,Qt=R.LINEAR,hi=Se.glyphAtlasTexture.size,Pe.iconsInText&&(Fi=Se.imageAtlasTexture.size,Gi=Se.imageAtlasTexture,Zt=wt||h.options.rotating||h.options.zooming||tt.kind==="composite"||tt.kind==="camera"?R.LINEAR:R.NEAREST);else{const Ai=i.layout.get("icon-size").constantOr(0)!==1||Pe.iconsNeedLinear;ui=Se.imageAtlasTexture,Qt=Ve||h.options.rotating||h.options.zooming||Ai||wt?R.LINEAR:R.NEAREST,hi=Se.imageAtlasTexture.size}const Qi=c.az(Se,1,h.transform.zoom),Ut=at(H,h.transform,Qi),qn=c.K();c.an(qn,Ut);const pn=gt(K,H,h.transform,Qi),Hn=c.aA(W,Se,u,f),_s=W.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),ya=se&&Pe.hasTextData(),Wn=i.layout.get("icon-text-fit")!=="none"&&ya&&Pe.hasIconData();if(J){const Ai=h.style.map.terrain?(vr,ii)=>h.style.map.terrain.getElevation(Te,vr,ii):null,ki=i.layout.get("text-rotation-alignment")==="map";Mt(Pe,h,o,Ut,qn,K,b,ki,Te.toUnwrapped(),W.width,W.height,Hn,Ai)}const ys=o&&se||Wn,Er=J||ys?ra:K?Ut:h.transform.clipSpaceToPixelsMatrix,Kn=Ve&&i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mn;Mn=Ve?Pe.iconsInText?ja(tt.kind,ci,ie,K,J,ys,h,Er,pn,Hn,hi,Fi,Ee):Jl(tt.kind,ci,ie,K,J,ys,h,Er,pn,Hn,o,hi,0,Ee):Cs(tt.kind,ci,ie,K,J,ys,h,Er,pn,Hn,o,hi,Ee);const Xn={program:Rt,buffers:Ke,uniformValues:Mn,projectionData:_s,atlasTexture:ui,atlasTextureIcon:Gi,atlasInterpolation:Qt,atlasInterpolationIcon:Zt,isSDF:Ve,hasHalo:Kn};if(te&&Pe.canOverlap){re=!0;const Ai=Ke.segments.get();for(const ki of Ai)_e.push({segments:new c.aJ([ki]),sortKey:ki.sortKey,state:Xn,terrainData:Yt})}else _e.push({segments:Ke.segments,sortKey:0,state:Xn,terrainData:Yt})}re&&_e.sort((Te,Se)=>Te.sortKey-Se.sortKey);for(const Te of _e){const Se=Te.state;if(z.activeTexture.set(R.TEXTURE0),Se.atlasTexture.bind(Se.atlasInterpolation,R.CLAMP_TO_EDGE),Se.atlasTextureIcon&&(z.activeTexture.set(R.TEXTURE1),Se.atlasTextureIcon&&Se.atlasTextureIcon.bind(Se.atlasInterpolationIcon,R.CLAMP_TO_EDGE)),Se.isSDF){const Pe=Se.uniformValues;Se.hasHalo&&(Pe.u_is_halo=1,na(Se.buffers,Te.segments,i,h,Se.program,le,T,P,Pe,Se.projectionData,Te.terrainData)),Pe.u_is_halo=0}na(Se.buffers,Te.segments,i,h,Se.program,le,T,P,Se.uniformValues,Se.projectionData,Te.terrainData)}}function na(h,e,i,a,o,u,f,g,y,b,T){const P=a.context;o.draw(P,P.gl.TRIANGLES,u,f,g,It.backCCW,y,T,b,i.id,h.layoutVertexBuffer,h.indexBuffer,e,i.paint,a.transform.zoom,h.programConfigurations.get(i.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Ja(h,e,i,a,o){const u=h.context,f=u.gl,g=$.disabled,y=new Ot([f.ONE,f.ONE],c.b7.transparent,[!0,!0,!0,!0]),b=e.getBucket(i);if(!b)return;const T=a.key;let P=i.heatmapFbos.get(T);P||(P=Qa(u,e.tileSize,e.tileSize),i.heatmapFbos.set(T,P)),u.bindFramebuffer.set(P.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:c.b7.transparent});const M=b.programConfigurations.get(i.id),z=h.useProgram("heatmap",M,!o),R=h.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),W=h.style.map.terrain.getTerrainData(a);z.draw(u,f.TRIANGLES,mt.disabled,g,y,It.disabled,us(e,h.transform.zoom,i.paint.get("heatmap-intensity"),1),W,R,i.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,i.paint,h.transform.zoom,M)}function qo(h,e,i,a,o){const u=h.context,f=u.gl,g=h.transform;u.setColorMode(h.colorModeForRenderPass());const y=Ho(u,e),b=i.key,T=e.heatmapFbos.get(b);if(!T)return;u.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,T.colorAttachment.get()),u.activeTexture.set(f.TEXTURE1),y.bind(f.LINEAR,f.CLAMP_TO_EDGE);const P=g.getProjectionData({overscaledTileID:i,applyTerrainMatrix:o,applyGlobeMatrix:!a});h.useProgram("heatmapTexture").draw(u,f.TRIANGLES,mt.disabled,$.disabled,h.colorModeForRenderPass(),It.disabled,Gl(h,e,0,1),null,P,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,g.zoom),T.destroy(),e.heatmapFbos.delete(b)}function Qa(h,e,i){var a,o;const u=h.gl,f=u.createTexture();u.bindTexture(u.TEXTURE_2D,f),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR);const g=(a=h.HALF_FLOAT)!==null&&a!==void 0?a:u.UNSIGNED_BYTE,y=(o=h.RGBA16F)!==null&&o!==void 0?o:u.RGBA;u.texImage2D(u.TEXTURE_2D,0,y,e,i,0,u.RGBA,g,null);const b=h.createFramebuffer(e,i,!1,!1);return b.colorAttachment.set(f),b}function Ho(h,e){return e.colorRampTexture||(e.colorRampTexture=new ge(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function sa(h,e,i,a,o){if(!i||!a||!a.imageAtlas)return;const u=a.imageAtlas.patternPositions;let f=u[i.to.toString()],g=u[i.from.toString()];if(!f&&g&&(f=g),!g&&f&&(g=f),!f||!g){const y=o.getPaintProperty(e);f=u[y],g=u[y]}f&&g&&h.setConstantPatternPositions(f,g)}function aa(h,e,i,a,o,u,f,g){const y=h.context.gl,b="fill-pattern",T=i.paint.get(b),P=T&&T.constantOr(1),M=i.getCrossfadeParameters();let z,R,W,H,K;const J=h.transform,ie=i.paint.get("fill-translate"),te=i.paint.get("fill-translate-anchor");f?(R=P&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=y.LINES):(R=P?"fillPattern":"fill",z=y.TRIANGLES);const re=T.constantOr(null);for(const le of a){const se=e.getTile(le);if(P&&!se.patternsLoaded())continue;const _e=se.getBucket(i);if(!_e)continue;const Ee=_e.programConfigurations.get(i.id),Te=h.useProgram(R,Ee),Se=h.style.map.terrain&&h.style.map.terrain.getTerrainData(le);P&&(h.context.activeTexture.set(y.TEXTURE0),se.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),Ee.updatePaintBuffers(M)),sa(Ee,b,re,se,i);const Pe=J.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!g,applyTerrainMatrix:!0}),Ke=c.aA(J,se,ie,te);if(f){H=_e.indexBuffer2,K=_e.segments2;const Ve=[y.drawingBufferWidth,y.drawingBufferHeight];W=R==="fillOutlinePattern"&&P?Qs(h,M,se,Ve,Ke):Ro(Ve,Ke)}else H=_e.indexBuffer,K=_e.segments,W=P?Zl(h,M,se,Ke):{u_fill_translate:Ke};const We=h.stencilModeForClipping(le);Te.draw(h.context,z,o,We,u,It.backCCW,W,Se,Pe,i.id,_e.layoutVertexBuffer,H,K,i.paint,h.transform.zoom,Ee)}}function oa(h,e,i,a,o,u,f,g){const y=h.context,b=y.gl,T="fill-extrusion-pattern",P=i.paint.get(T),M=P.constantOr(1),z=i.getCrossfadeParameters(),R=i.paint.get("fill-extrusion-opacity"),W=P.constantOr(null),H=h.transform;for(const K of a){const J=e.getTile(K),ie=J.getBucket(i);if(!ie)continue;const te=h.style.map.terrain&&h.style.map.terrain.getTerrainData(K),re=ie.programConfigurations.get(i.id),le=h.useProgram(M?"fillExtrusionPattern":"fillExtrusion",re);M&&(h.context.activeTexture.set(b.TEXTURE0),J.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),re.updatePaintBuffers(z));const se=H.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!g,applyTerrainMatrix:!0});sa(re,T,W,J,i);const _e=c.aA(H,J,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),Ee=i.paint.get("fill-extrusion-vertical-gradient"),Te=M?hn(h,Ee,R,_e,K,z,J):Fa(h,Ee,R,_e);le.draw(y,y.gl.TRIANGLES,o,u,f,It.backCCW,Te,te,se,i.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,i.paint,h.transform.zoom,re,h.style.map.terrain&&ie.centroidVertexBuffer)}}function Wo(h,e,i,a,o,u,f,g,y){var b;const T=h.style.projection,P=h.context,M=h.transform,z=P.gl,R=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],W=h.useProgram("hillshade",null,!1,R),H=!h.options.moving;for(const K of a){const J=e.getTile(K),ie=J.fbo;if(!ie)continue;const te=T.getMeshFromTileID(P,K.canonical,g,!0,"raster"),re=(b=h.style.map.terrain)===null||b===void 0?void 0:b.getTerrainData(K);P.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ie.colorAttachment.get());const le=M.getProjectionData({overscaledTileID:K,aligned:H,applyGlobeMatrix:!y,applyTerrainMatrix:!0});W.draw(P,z.TRIANGLES,u,o[K.overscaledZ],f,It.backCCW,$l(h,J,i),re,le,i.id,te.vertexBuffer,te.indexBuffer,te.segments)}}const la=[new c.P(0,0),new c.P(c.Z,0),new c.P(c.Z,c.Z),new c.P(0,c.Z)];function eo(h,e,i,a,o,u,f,g,y=!1,b=!1){const T=a[a.length-1].overscaledZ,P=h.context,M=P.gl,z=h.useProgram("raster"),R=h.transform,W=h.style.projection,H=h.colorModeForRenderPass(),K=!h.options.moving;for(const J of a){const ie=h.getDepthModeForSublayer(J.overscaledZ-T,i.paint.get("raster-opacity")===1?mt.ReadWrite:mt.ReadOnly,M.LESS),te=e.getTile(J);te.registerFadeDuration(i.paint.get("raster-fade-duration"));const re=e.findLoadedParent(J,0),le=e.findLoadedSibling(J),se=cc(te,re||le||null,e,i,h.transform,h.style.map.terrain);let _e,Ee;const Te=i.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;P.activeTexture.set(M.TEXTURE0),te.texture.bind(Te,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),P.activeTexture.set(M.TEXTURE1),re?(re.texture.bind(Te,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,re.tileID.overscaledZ-te.tileID.overscaledZ),Ee=[te.tileID.canonical.x*_e%1,te.tileID.canonical.y*_e%1]):te.texture.bind(Te,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),te.texture.useMipmap&&P.extTextureFilterAnisotropic&&h.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Se=h.style.map.terrain&&h.style.map.terrain.getTerrainData(J),Pe=R.getProjectionData({overscaledTileID:J,aligned:K,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),Ke=Xl(Ee||[0,0],_e||1,se,i,g),We=W.getMeshFromTileID(P,J.canonical,u,f,"raster");z.draw(P,M.TRIANGLES,ie,o?o[J.overscaledZ]:$.disabled,H,y?It.frontCCW:It.backCCW,Ke,Se,Pe,i.id,We.vertexBuffer,We.indexBuffer,We.segments)}}function cc(h,e,i,a,o,u){const f=a.paint.get("raster-fade-duration");if(!u&&f>0){const g=Le.now(),y=(g-h.timeAdded)/f,b=e?(g-e.timeAdded)/f:-1,T=i.getSource(),P=ye(o,{tileSize:T.tileSize,roundZoom:T.roundZoom}),M=!e||Math.abs(e.tileID.overscaledZ-P)>Math.abs(h.tileID.overscaledZ-P),z=M&&h.refreshedUponExpiration?1:c.ae(M?y:1-b,0,1);return h.refreshedUponExpiration&&y>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}const to=new c.b7(1,0,0,1),Ko=new c.b7(0,1,0,1),hc=new c.b7(0,0,1,1),uc=new c.b7(1,0,1,1),io=new c.b7(0,1,1,1);function ro(h,e,i,a){ca(h,0,e+i/2,h.transform.width,i,a)}function dc(h,e,i,a){ca(h,e-i/2,0,i,h.transform.height,a)}function ca(h,e,i,a,o,u){const f=h.context,g=f.gl;g.enable(g.SCISSOR_TEST),g.scissor(e*h.pixelRatio,i*h.pixelRatio,a*h.pixelRatio,o*h.pixelRatio),f.clear({color:u}),g.disable(g.SCISSOR_TEST)}function xi(h,e,i){const a=h.context,o=a.gl,u=h.useProgram("debug"),f=mt.disabled,g=$.disabled,y=h.colorModeForRenderPass(),b="$debug",T=h.style.map.terrain&&h.style.map.terrain.getTerrainData(i);a.activeTexture.set(o.TEXTURE0);const P=e.getTileByID(i.key).latestRawTileData,M=Math.floor((P&&P.byteLength||0)/1024),z=e.getTile(i).tileSize,R=512/Math.min(z,512)*(i.overscaledZ/h.transform.zoom)*.5;let W=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(W+=` => ${i.overscaledZ}`),function(K,J){K.initDebugOverlayCanvas();const ie=K.debugOverlayCanvas,te=K.context.gl,re=K.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,ie.width,ie.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(J,5,5),re.strokeText(J,5,5),K.debugOverlayTexture.update(ie),K.debugOverlayTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE)}(h,`${W} ${M}kB`);const H=h.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});u.draw(a,o.TRIANGLES,f,g,Ot.alphaBlended,It.disabled,Ul(c.b7.transparent,R),null,H,b,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),u.draw(a,o.LINE_STRIP,f,g,y,It.disabled,Ul(c.b7.red),T,H,b,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function $n(h,e,i,a){const{isRenderingGlobe:o}=a,u=h.context,f=u.gl,g=h.transform,y=h.colorModeForRenderPass(),b=h.getDepthModeFor3D(),T=h.useProgram("terrain");u.bindFramebuffer.set(null),u.viewport.set([0,0,h.width,h.height]);for(const P of i){const M=e.getTerrainMesh(P.tileID),z=h.renderToTexture.getTexture(P),R=e.getTerrainData(P.tileID);u.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,z.texture);const W=e.getMeshFrameDelta(g.zoom),H=g.calculateFogMatrix(P.tileID.toUnwrapped()),K=lh(W,H,h.style.sky,g.pitch,o),J=g.getProjectionData({overscaledTileID:P.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});T.draw(u,f.TRIANGLES,b,$.disabled,y,It.backCCW,K,R,J,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}function Ir(h,e){if(!e.mesh){const i=new c.aI;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const a=new c.aK;a.emplaceBack(0,1,2),a.emplaceBack(0,2,3),e.mesh=new Nn(h.createVertexBuffer(i,ai.members),h.createIndexBuffer(a),c.aJ.simpleSegment(0,0,i.length,a.length))}return e.mesh}class Xo{constructor(e,i){this.context=new Ka(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=fe.maxUnderzooming+fe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new On}resize(e,i,a){if(this.width=Math.floor(e*a),this.height=Math.floor(i*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const o of this.style._order)this.style._layers[o].resize()}setup(){const e=this.context,i=new c.aI;i.emplaceBack(0,0),i.emplaceBack(c.Z,0),i.emplaceBack(0,c.Z),i.emplaceBack(c.Z,c.Z),this.tileExtentBuffer=e.createVertexBuffer(i,ai.members),this.tileExtentSegments=c.aJ.simpleSegment(0,0,4,2);const a=new c.aI;a.emplaceBack(0,0),a.emplaceBack(c.Z,0),a.emplaceBack(0,c.Z),a.emplaceBack(c.Z,c.Z),this.debugBuffer=e.createVertexBuffer(a,ai.members),this.debugSegments=c.aJ.simpleSegment(0,0,4,5);const o=new c.b_;o.emplaceBack(0,0,0,0),o.emplaceBack(c.Z,0,c.Z,0),o.emplaceBack(0,c.Z,0,c.Z),o.emplaceBack(c.Z,c.Z,c.Z,c.Z),this.rasterBoundsBuffer=e.createVertexBuffer(o,ah.members),this.rasterBoundsSegments=c.aJ.simpleSegment(0,0,4,2);const u=new c.aI;u.emplaceBack(0,0),u.emplaceBack(c.Z,0),u.emplaceBack(0,c.Z),u.emplaceBack(c.Z,c.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(u,ai.members),this.rasterBoundsSegmentsPosOnly=c.aJ.simpleSegment(0,0,4,5);const f=new c.aI;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,ai.members),this.viewportSegments=c.aJ.simpleSegment(0,0,4,2);const g=new c.b$;g.emplaceBack(0),g.emplaceBack(1),g.emplaceBack(3),g.emplaceBack(2),g.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(g);const y=new c.aK;y.emplaceBack(1,0,2),y.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(y);const b=this.context.gl;this.stencilClearMode=new $({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.tileExtentMesh=new Nn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.K();c.bQ(a,0,this.width,this.height,0,0,1),c.M(a,a,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const o={mainMatrix:a,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,mt.disabled,this.stencilClearMode,Ot.disabled,It.disabled,null,null,o,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const o=this.context;o.setColorMode(Ot.disabled),o.setDepthMode(mt.disabled);const u={};for(const f of i)u[f.key]=this.nextStencilID++;this._renderTileMasks(u,i,a,!0),this._renderTileMasks(u,i,a,!1),this._tileClippingMaskIDs=u}_renderTileMasks(e,i,a,o){const u=this.context,f=u.gl,g=this.style.projection,y=this.transform,b=this.useProgram("clippingMask");for(const T of i){const P=e[T.key],M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),z=g.getMeshFromTileID(this.context,T.canonical,o,!0,"stencil"),R=y.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!a,applyTerrainMatrix:!0});b.draw(u,f.TRIANGLES,mt.disabled,new $({func:f.ALWAYS,mask:0},P,255,f.KEEP,f.KEEP,f.REPLACE),Ot.disabled,a?It.disabled:It.backCCW,null,M,R,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,a=this.style.projection,o=this.transform,u=this.useProgram("depth"),f=this.getDepthModeFor3D(),g=ce(o,{tileSize:o.tileSize});for(const y of g){const b=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y),T=a.getMeshFromTileID(this.context,y.canonical,!0,!0,"raster"),P=o.getProjectionData({overscaledTileID:y,applyGlobeMatrix:!0,applyTerrainMatrix:!0});u.draw(e,i.TRIANGLES,f,$.disabled,Ot.disabled,It.backCCW,null,b,P,"$clipping",T.vertexBuffer,T.indexBuffer,T.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new $({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new $({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,a=e.sort((f,g)=>g.overscaledZ-f.overscaledZ),o=a[a.length-1].overscaledZ,u=a[0].overscaledZ-o+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();const f={};for(let g=0;g<u;g++)f[g+o]=new $({func:i.GEQUAL,mask:255},g+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=u,[f,a]}return[{[o]:$.disabled},a]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,a=e.sort((f,g)=>g.overscaledZ-f.overscaledZ),o=a[a.length-1].overscaledZ,u=a[0].overscaledZ-o+1;if(this.clearStencil(),u>1){const f={},g={};for(let y=0;y<u;y++)f[y+o]=new $({func:i.GREATER,mask:255},u+1+y,255,i.KEEP,i.KEEP,i.REPLACE),g[y+o]=new $({func:i.GREATER,mask:255},1+y,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*u+1,[f,g,a]}return this.nextStencilID=3,[{[o]:new $({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[o]:new $({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ot([e.CONSTANT_COLOR,e.ONE],new c.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ot.unblended:Ot.alphaBlended}getDepthModeForSublayer(e,i,a){if(!this.opaquePassEnabledForLayer())return mt.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new mt(a||this.context.gl.LEQUAL,i,[o,o])}getDepthModeFor3D(){return new mt(this.context.gl.LEQUAL,mt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var a,o;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Le.now()),this.imageManager.beginFrame();const u=this.style._order,f=this.style.sourceCaches,g={},y={},b={},T={isRenderingToTexture:!1,isRenderingGlobe:((a=e.projection)===null||a===void 0?void 0:a.transitionState)>0};for(const M in f){const z=f[M];z.used&&z.prepare(this.context),g[M]=z.getVisibleCoordinates(!1),y[M]=g[M].slice().reverse(),b[M]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<u.length;M++)if(this.style._layers[u[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of u){const z=this.style._layers[M];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const R=y[z.source];(z.type==="custom"||R.length)&&this.renderLayer(this,f[z.source],z,R,T)}if((o=this.style.projection)===null||o===void 0||o.updateGPUdependent({context:this.context,useProgram:M=>this.useProgram(M)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?c.b7.black:c.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,z){const R=M.context,W=R.gl,H=((le,se,_e)=>{const Ee=Math.cos(se.rollInRadians),Te=Math.sin(se.rollInRadians),Se=ue(se),Pe=se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:le.properties.get("sky-color"),u_horizon_color:le.properties.get("horizon-color"),u_horizon:[(se.width/2-Se*Te)*_e,(se.height/2+Se*Ee)*_e],u_horizon_normal:[-Te,Ee],u_sky_horizon_blend:le.properties.get("sky-horizon-blend")*se.height/2*_e,u_sky_blend:Pe}})(z,M.style.map.transform,M.pixelRatio),K=new mt(W.LEQUAL,mt.ReadWrite,[0,1]),J=$.disabled,ie=M.colorModeForRenderPass(),te=M.useProgram("sky"),re=Ir(R,z);te.draw(R,W.TRIANGLES,K,J,ie,It.disabled,H,null,void 0,"sky",re.vertexBuffer,re.indexBuffer,re.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[u[this.currentLayer]],z=f[M.source],R=g[M.source];this._renderTileClippingMasks(M,R,!1),this.renderLayer(this,z,M,R,T)}this.renderPass="translucent";let P=!1;for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const M=this.style._layers[u[this.currentLayer]],z=f[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M,T))continue;this.opaquePassEnabledForLayer()||P||(P=!0,T.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const R=(M.type==="symbol"?b:y)[M.source];this._renderTileClippingMasks(M,g[M.source],!!this.renderToTexture),this.renderLayer(this,z,M,R,T)}if(T.isRenderingGlobe&&function(M,z,R){const W=M.context,H=W.gl,K=M.useProgram("atmosphere"),J=new mt(H.LEQUAL,mt.ReadOnly,[0,1]),ie=M.transform,te=function(Pe,Ke){const We=Pe.properties.get("position"),Ve=[-We.x,-We.y,-We.z],tt=c.ad(new Float64Array(16));return Pe.properties.get("anchor")==="map"&&(c.a_(tt,tt,Ke.rollInRadians),c.a$(tt,tt,-Ke.pitchInRadians),c.a_(tt,tt,Ke.bearingInRadians),c.a$(tt,tt,Ke.center.lat*Math.PI/180),c.bp(tt,tt,-Ke.center.lng*Math.PI/180)),c.bZ(Ve,Ve,tt),Ve}(R,M.transform),re=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=z.properties.get("atmosphere-blend")*re.projectionTransition;if(le===0)return;const se=Ii(ie.worldSize,ie.center.lat),_e=ie.inverseProjectionMatrix,Ee=new Float64Array(4);Ee[3]=1,c.at(Ee,Ee,ie.modelViewProjectionMatrix),Ee[0]/=Ee[3],Ee[1]/=Ee[3],Ee[2]/=Ee[3],Ee[3]=1,c.at(Ee,Ee,_e),Ee[0]/=Ee[3],Ee[1]/=Ee[3],Ee[2]/=Ee[3],Ee[3]=1;const Te=((Pe,Ke,We,Ve,tt)=>({u_sun_pos:Pe,u_atmosphere_blend:Ke,u_globe_position:We,u_globe_radius:Ve,u_inv_proj_matrix:tt}))(te,le,[Ee[0],Ee[1],Ee[2]],se,_e),Se=Ir(W,z);K.draw(W,H.TRIANGLES,J,$.disabled,Ot.alphaBlended,It.disabled,Te,null,null,"atmosphere",Se.vertexBuffer,Se.indexBuffer,Se.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const M=function(z,R){let W=null;const H=Object.values(z._layers).flatMap(te=>te.source&&!te.isHidden(R)?[z.sourceCaches[te.source]]:[]),K=H.filter(te=>te.getSource().type==="vector"),J=H.filter(te=>te.getSource().type!=="vector"),ie=te=>{(!W||W.getSource().maxzoom<te.getSource().maxzoom)&&(W=te)};return K.forEach(te=>ie(te)),W||J.forEach(te=>ie(te)),W}(this.style,this.transform.zoom);M&&function(z,R,W){for(let H=0;H<W.length;H++)xi(z,R,W[H])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const z=M.transform.padding;ro(M,M.transform.height-(z.top||0),3,to),ro(M,z.bottom||0,3,Ko),dc(M,z.left||0,3,hc),dc(M,M.transform.width-(z.right||0),3,uc);const R=M.transform.centerPoint;(function(W,H,K,J){ca(W,H-1,K-10,2,20,J),ca(W,H-10,K-1,20,2,J)})(M,R.x,M.transform.height-R.y,io)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let o=this.terrainFacilitator.dirty;o||(o=e?!c.c0(i,a):!c.c1(i,a)),o||(o=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),o&&(c.c2(i,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(u,f){const g=u.context,y=g.gl,b=u.transform,T=Ot.unblended,P=new mt(y.LEQUAL,mt.ReadWrite,[0,1]),M=f.sourceCache.getRenderableTiles(),z=u.useProgram("terrainDepth");g.bindFramebuffer.set(f.getFramebuffer("depth").framebuffer),g.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),g.clear({color:c.b7.transparent,depth:1});for(const R of M){const W=f.getTerrainMesh(R.tileID),H=f.getTerrainData(R.tileID),K=b.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),J={u_ele_delta:f.getMeshFrameDelta(b.zoom)};z.draw(g,y.TRIANGLES,P,$.disabled,T,It.backCCW,J,H,K,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain),function(u,f){const g=u.context,y=g.gl,b=u.transform,T=Ot.unblended,P=new mt(y.LEQUAL,mt.ReadWrite,[0,1]),M=f.getCoordsTexture(),z=f.sourceCache.getRenderableTiles(),R=u.useProgram("terrainCoords");g.bindFramebuffer.set(f.getFramebuffer("coords").framebuffer),g.viewport.set([0,0,u.width/devicePixelRatio,u.height/devicePixelRatio]),g.clear({color:c.b7.transparent,depth:1}),f.coordsIndex=[];for(const W of z){const H=f.getTerrainMesh(W.tileID),K=f.getTerrainData(W.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,M.texture);const J={u_terrain_coords_id:(255-f.coordsIndex.length)/255,u_texture:0,u_ele_delta:f.getMeshFrameDelta(b.zoom)},ie=b.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(g,y.TRIANGLES,P,$.disabled,T,It.backCCW,J,K,ie,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),f.coordsIndex.push(W.tileID.key)}g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height])}(this,this.style.map.terrain))}renderLayer(e,i,a,o,u){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(o||[]).length)&&(this.id=a.id,c.c3(a)?function(f,g,y,b,T,P){if(f.renderPass!=="translucent")return;const{isRenderingToTexture:M}=P,z=$.disabled,R=f.colorModeForRenderPass();(y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,H,K,J,ie,te,re,le,se){const _e=H.transform,Ee=H.style.map.terrain,Te=ie==="map",Se=te==="map";for(const Pe of W){const Ke=J.getTile(Pe),We=Ke.getBucket(K);if(!We||!We.text||!We.text.segments.get().length)continue;const Ve=c.ak(We.textSizeData,_e.zoom),tt=c.az(Ke,1,H.transform.zoom),wt=at(Te,H.transform,tt),Rt=K.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(Ve){const ci=Math.pow(2,_e.zoom-Ke.tileID.overscaledZ),Yt=Ee?(hi,ui)=>Ee.getElevation(Pe,hi,ui):null;lc(We,Te,Se,se,_e,wt,ci,Ve,Rt,c.aA(_e,Ke,re,le),Pe.toUnwrapped(),Yt)}}}(b,f,y,g,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),T),y.paint.get("icon-opacity").constantOr(1)!==0&&Ya(f,g,y,b,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),z,R,M),y.paint.get("text-opacity").constantOr(1)!==0&&Ya(f,g,y,b,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),z,R,M),g.map.showCollisionBoxes&&($o(f,g,y,b,!0),$o(f,g,y,b,!1))}(e,i,a,o,this.style.placement.variableOffsets,u):c.c4(a)?function(f,g,y,b,T){if(f.renderPass!=="translucent")return;const{isRenderingToTexture:P}=T,M=y.paint.get("circle-opacity"),z=y.paint.get("circle-stroke-width"),R=y.paint.get("circle-stroke-opacity"),W=!y.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(z.constantOr(1)===0||R.constantOr(1)===0))return;const H=f.context,K=H.gl,J=f.transform,ie=f.getDepthModeForSublayer(0,mt.ReadOnly),te=$.disabled,re=f.colorModeForRenderPass(),le=[],se=J.getCircleRadiusCorrection();for(let _e=0;_e<b.length;_e++){const Ee=b[_e],Te=g.getTile(Ee),Se=Te.getBucket(y);if(!Se)continue;const Pe=y.paint.get("circle-translate"),Ke=y.paint.get("circle-translate-anchor"),We=c.aA(J,Te,Pe,Ke),Ve=Se.programConfigurations.get(y.id),tt=f.useProgram("circle",Ve),wt=Se.layoutVertexBuffer,Rt=Se.indexBuffer,ci=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Ee),Yt={programConfiguration:Ve,program:tt,layoutVertexBuffer:wt,indexBuffer:Rt,uniformValues:ea(f,Te,y,We,se),terrainData:ci,projectionData:J.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!P,applyTerrainMatrix:!0})};if(W){const hi=Se.segments.get();for(const ui of hi)le.push({segments:new c.aJ([ui]),sortKey:ui.sortKey,state:Yt})}else le.push({segments:Se.segments,sortKey:0,state:Yt})}W&&le.sort((_e,Ee)=>_e.sortKey-Ee.sortKey);for(const _e of le){const{programConfiguration:Ee,program:Te,layoutVertexBuffer:Se,indexBuffer:Pe,uniformValues:Ke,terrainData:We,projectionData:Ve}=_e.state;Te.draw(H,K.TRIANGLES,ie,te,re,It.backCCW,Ke,We,Ve,y.id,Se,Pe,_e.segments,y.paint,f.transform.zoom,Ee)}}(e,i,a,o,u):c.c5(a)?function(f,g,y,b,T){if(y.paint.get("heatmap-opacity")===0)return;const P=f.context,{isRenderingToTexture:M,isRenderingGlobe:z}=T;if(f.style.map.terrain){for(const R of b){const W=g.getTile(R);g.hasRenderableParent(R)||(f.renderPass==="offscreen"?Ja(f,W,y,R,z):f.renderPass==="translucent"&&qo(f,y,R,M,z))}P.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(R,W,H,K){const J=R.context,ie=J.gl,te=R.transform,re=$.disabled,le=new Ot([ie.ONE,ie.ONE],c.b7.transparent,[!0,!0,!0,!0]);(function(se,_e,Ee){const Te=se.gl;se.activeTexture.set(Te.TEXTURE1),se.viewport.set([0,0,_e.width/4,_e.height/4]);let Se=Ee.heatmapFbos.get(c.bW);Se?(Te.bindTexture(Te.TEXTURE_2D,Se.colorAttachment.get()),se.bindFramebuffer.set(Se.framebuffer)):(Se=Qa(se,_e.width/4,_e.height/4),Ee.heatmapFbos.set(c.bW,Se))})(J,R,H),J.clear({color:c.b7.transparent});for(let se=0;se<K.length;se++){const _e=K[se];if(W.hasRenderableParent(_e))continue;const Ee=W.getTile(_e),Te=Ee.getBucket(H);if(!Te)continue;const Se=Te.programConfigurations.get(H.id),Pe=R.useProgram("heatmap",Se),Ke=te.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),We=te.getCircleRadiusCorrection();Pe.draw(J,ie.TRIANGLES,mt.disabled,re,le,It.backCCW,us(Ee,te.zoom,H.paint.get("heatmap-intensity"),We),null,Ke,H.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,H.paint,te.zoom,Se)}J.viewport.set([0,0,R.width,R.height])}(f,g,y,b):f.renderPass==="translucent"&&function(R,W){const H=R.context,K=H.gl;H.setColorMode(R.colorModeForRenderPass());const J=W.heatmapFbos.get(c.bW);J&&(H.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,J.colorAttachment.get()),H.activeTexture.set(K.TEXTURE1),Ho(H,W).bind(K.LINEAR,K.CLAMP_TO_EDGE),R.useProgram("heatmapTexture").draw(H,K.TRIANGLES,mt.disabled,$.disabled,R.colorModeForRenderPass(),It.disabled,Gl(R,W,0,1),null,null,W.id,R.viewportBuffer,R.quadTriangleIndexBuffer,R.viewportSegments,W.paint,R.transform.zoom))}(f,y)}(e,i,a,o,u):c.c6(a)?function(f,g,y,b,T){if(f.renderPass!=="translucent")return;const{isRenderingToTexture:P}=T,M=y.paint.get("line-opacity"),z=y.paint.get("line-width");if(M.constantOr(1)===0||z.constantOr(1)===0)return;const R=f.getDepthModeForSublayer(0,mt.ReadOnly),W=f.colorModeForRenderPass(),H=y.paint.get("line-dasharray"),K=y.paint.get("line-pattern"),J=K.constantOr(1),ie=y.paint.get("line-gradient"),te=y.getCrossfadeParameters(),re=J?"linePattern":H?"lineSDF":ie?"lineGradient":"line",le=f.context,se=le.gl,_e=f.transform;let Ee=!0;for(const Te of b){const Se=g.getTile(Te);if(J&&!Se.patternsLoaded())continue;const Pe=Se.getBucket(y);if(!Pe)continue;const Ke=Pe.programConfigurations.get(y.id),We=f.context.program.get(),Ve=f.useProgram(re,Ke),tt=Ee||Ve.program!==We,wt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Te),Rt=K.constantOr(null);if(Rt&&Se.imageAtlas){const Qt=Se.imageAtlas,Zt=Qt.patternPositions[Rt.to.toString()],Fi=Qt.patternPositions[Rt.from.toString()];Zt&&Fi&&Ke.setConstantPatternPositions(Zt,Fi)}const ci=_e.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Yt=_e.getPixelScale(),hi=J?Wl(f,Se,y,Yt,te):H?Kl(f,Se,y,Yt,H,te):ie?Hl(f,Se,y,Yt,Pe.lineClipsArray.length):ta(f,Se,y,Yt);if(J)le.activeTexture.set(se.TEXTURE0),Se.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Ke.updatePaintBuffers(te);else if(H&&(tt||f.lineAtlas.dirty))le.activeTexture.set(se.TEXTURE0),f.lineAtlas.bind(le);else if(ie){const Qt=Pe.gradients[y.id];let Zt=Qt.texture;if(y.gradientVersion!==Qt.version){let Fi=256;if(y.stepInterpolant){const Gi=g.getSource().maxzoom,Qi=Te.canonical.z===Gi?Math.ceil(1<<f.transform.maxZoom-Te.canonical.z):1;Fi=c.ae(c.bX(Pe.maxLineLength/c.Z*1024*Qi),256,le.maxTextureSize)}Qt.gradient=c.bY({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:Fi,image:Qt.gradient||void 0,clips:Pe.lineClipsArray}),Qt.texture?Qt.texture.update(Qt.gradient):Qt.texture=new ge(le,Qt.gradient,se.RGBA),Qt.version=y.gradientVersion,Zt=Qt.texture}le.activeTexture.set(se.TEXTURE0),Zt.bind(y.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}const ui=f.stencilModeForClipping(Te);Ve.draw(le,se.TRIANGLES,R,ui,W,It.disabled,hi,wt,ci,y.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,y.paint,f.transform.zoom,Ke,Pe.layoutVertexBuffer2),Ee=!1}}(e,i,a,o,u):c.c7(a)?function(f,g,y,b,T){const P=y.paint.get("fill-color"),M=y.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const{isRenderingToTexture:z}=T,R=f.colorModeForRenderPass(),W=y.paint.get("fill-pattern"),H=f.opaquePassEnabledForLayer()&&!W.constantOr(1)&&P.constantOr(c.b7.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===H){const K=f.getDepthModeForSublayer(1,f.renderPass==="opaque"?mt.ReadWrite:mt.ReadOnly);aa(f,g,y,b,K,R,!1,z)}if(f.renderPass==="translucent"&&y.paint.get("fill-antialias")){const K=f.getDepthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,mt.ReadOnly);aa(f,g,y,b,K,R,!0,z)}}(e,i,a,o,u):c.c8(a)?function(f,g,y,b,T){const P=y.paint.get("fill-extrusion-opacity");if(P===0)return;const{isRenderingToTexture:M}=T;if(f.renderPass==="translucent"){const z=new mt(f.context.gl.LEQUAL,mt.ReadWrite,f.depthRangeFor3D);if(P!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))oa(f,g,y,b,z,$.disabled,Ot.disabled,M),oa(f,g,y,b,z,f.stencilModeFor3D(),f.colorModeForRenderPass(),M);else{const R=f.colorModeForRenderPass();oa(f,g,y,b,z,$.disabled,R,M)}}}(e,i,a,o,u):c.c9(a)?function(f,g,y,b,T){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const{isRenderingToTexture:P}=T,M=f.context,z=f.style.projection.useSubdivision,R=f.getDepthModeForSublayer(0,mt.ReadOnly),W=f.colorModeForRenderPass();if(f.renderPass==="offscreen")(function(H,K,J,ie,te,re,le){const se=H.context,_e=se.gl;for(const Ee of J){const Te=K.getTile(Ee),Se=Te.dem;if(!Se||!Se.data||!Te.needsHillshadePrepare)continue;const Pe=Se.dim,Ke=Se.stride,We=Se.getPixels();if(se.activeTexture.set(_e.TEXTURE1),se.pixelStoreUnpackPremultiplyAlpha.set(!1),Te.demTexture=Te.demTexture||H.getTileTexture(Ke),Te.demTexture){const tt=Te.demTexture;tt.update(We,{premultiply:!1}),tt.bind(_e.NEAREST,_e.CLAMP_TO_EDGE)}else Te.demTexture=new ge(se,We,_e.RGBA,{premultiply:!1}),Te.demTexture.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);se.activeTexture.set(_e.TEXTURE0);let Ve=Te.fbo;if(!Ve){const tt=new ge(se,{width:Pe,height:Pe,data:null},_e.RGBA);tt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Ve=Te.fbo=se.createFramebuffer(Pe,Pe,!0,!1),Ve.colorAttachment.set(tt.texture)}se.bindFramebuffer.set(Ve.framebuffer),se.viewport.set([0,0,Pe,Pe]),H.useProgram("hillshadePrepare").draw(se,_e.TRIANGLES,te,re,le,It.disabled,hh(Te.tileID,Se),null,null,ie.id,H.rasterBoundsBuffer,H.quadTriangleIndexBuffer,H.rasterBoundsSegments),Te.needsHillshadePrepare=!1}})(f,g,b,y,R,$.disabled,W),M.viewport.set([0,0,f.width,f.height]);else if(f.renderPass==="translucent")if(z){const[H,K,J]=f.stencilConfigForOverlapTwoPass(b);Wo(f,g,y,J,H,R,W,!1,P),Wo(f,g,y,J,K,R,W,!0,P)}else{const[H,K]=f.getStencilConfigForOverlapAndUpdateStencilID(b);Wo(f,g,y,K,H,R,W,!1,P)}}(e,i,a,o,u):c.ca(a)?function(f,g,y,b,T){if(f.renderPass!=="translucent"||y.paint.get("raster-opacity")===0||!b.length)return;const{isRenderingToTexture:P}=T,M=g.getSource(),z=f.style.projection.useSubdivision;if(M instanceof mr)eo(f,g,y,b,null,!1,!1,M.tileCoords,M.flippedWindingOrder,P);else if(z){const[R,W,H]=f.stencilConfigForOverlapTwoPass(b);eo(f,g,y,H,R,!1,!0,la,!1,P),eo(f,g,y,H,W,!0,!0,la,!1,P)}else{const[R,W]=f.getStencilConfigForOverlapAndUpdateStencilID(b);eo(f,g,y,W,R,!1,!0,la,!1,P)}}(e,i,a,o,u):c.cb(a)?function(f,g,y,b,T){const P=y.paint.get("background-color"),M=y.paint.get("background-opacity");if(M===0)return;const{isRenderingToTexture:z}=T,R=f.context,W=R.gl,H=f.style.projection,K=f.transform,J=K.tileSize,ie=y.paint.get("background-pattern");if(f.isPatternMissing(ie))return;const te=!ie&&P.a===1&&M===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==te)return;const re=$.disabled,le=f.getDepthModeForSublayer(0,te==="opaque"?mt.ReadWrite:mt.ReadOnly),se=f.colorModeForRenderPass(),_e=f.useProgram(ie?"backgroundPattern":"background"),Ee=b||ce(K,{tileSize:J,terrain:f.style.map.terrain});ie&&(R.activeTexture.set(W.TEXTURE0),f.imageManager.bind(f.context));const Te=y.getCrossfadeParameters();for(const Se of Ee){const Pe=K.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Ke=ie?dh(M,f,ie,{tileID:Se,tileSize:J},Te):uh(M,P),We=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Se),Ve=H.getMeshFromTileID(R,Se.canonical,!1,!0,"raster");_e.draw(R,W.TRIANGLES,le,re,se,It.backCCW,Ke,We,Pe,y.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}(e,0,a,o,u):c.cc(a)&&function(f,g,y,b){const{isRenderingGlobe:T}=b,P=f.context,M=y.implementation,z=f.style.projection,R=f.transform,W=R.getProjectionDataForCustomLayer(T),H={farZ:R.farZ,nearZ:R.nearZ,fov:R.fov*Math.PI/180,modelViewProjectionMatrix:R.modelViewProjectionMatrix,projectionMatrix:R.projectionMatrix,shaderData:{variantName:z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${z.shaderPreludeCode.vertexSource}`,define:z.shaderDefine},defaultProjectionData:W},K=M.renderingMode?M.renderingMode:"2d";if(f.renderPass==="offscreen"){const J=M.prerender;J&&(f.setCustomLayerDefaults(),P.setColorMode(f.colorModeForRenderPass()),J.call(M,P.gl,H),P.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),P.setColorMode(f.colorModeForRenderPass()),P.setStencilMode($.disabled);const J=K==="3d"?f.getDepthModeFor3D():f.getDepthModeForSublayer(0,mt.ReadOnly);P.setDepthMode(J),M.render(P.gl,H),P.setDirty(),f.setBaseState(),P.bindFramebuffer.set(null)}}(e,0,a,u))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!i||!a}useProgram(e,i,a=!1,o=[]){this.cache=this.cache||{};const u=!!this.style.map.terrain,f=this.style.projection,g=a?yi.projectionMercator:f.shaderPreludeCode,y=a?Tn:f.shaderDefine,b=e+(i?i.cacheKey:"")+`/${a?Pt:f.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(u?"/terrain":"")+(o?`/${o.join("/")}`:"");return this.cache[b]||(this.cache[b]=new Da(this.context,yi[e],i,Ql[e],this._showOverdrawInspector,u,g,y,o)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ge(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function ha(h,e){let i,a=!1,o=null,u=null;const f=()=>{o=null,a&&(h.apply(u,i),o=setTimeout(f,e),a=!1)};return(...g)=>(a=!0,u=this,i=g,o||f(),o)}class Yo{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(a=o)}),(a&&a[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:a,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const a=i.join("/");let o=a;o.split("&").length>0&&(o=o.split("&")[0]),this._hashName&&(o=`${this._hashName}=${a}`);let u=window.location.hash.replace(o,"");u.startsWith("#&")?u=u.slice(0,1)+u.slice(2):u==="#"&&(u="");let f=window.location.href.replace(/(#.+)?$/,u);f=f.replace("&&","&"),window.history.replaceState(window.history.state,null,f)},this._updateHash=ha(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,o=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,o),f=Math.round(i.lng*u)/u,g=Math.round(i.lat*u)/u,y=this._map.getBearing(),b=this._map.getPitch();let T="";if(T+=e?`/${f}/${g}/${a}`:`${a}/${g}/${f}`,(y||b)&&(T+="/"+Math.round(10*y)/10),b&&(T+=`/${Math.round(b)}`),this._hashName){const P=this._hashName;let M=!1;const z=window.location.hash.slice(1).split("&").map(R=>{const W=R.split("=")[0];return W===P?(M=!0,`${W}=${T}`):R}).filter(R=>R);return M||z.push(`${P}=${T}`),`#${z.join("&")}`}return`#${T}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.Q(+e[2],+e[1])}catch{return!1}const i=+e[0],a=+(e[3]||0),o=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&a>=-180&&a<=180&&o>=this._map.getMinPitch()&&o<=this._map.getMaxPitch()}}const un={linearity:.3,easing:c.cd(0,0,.3,1)},Jo=c.e({deceleration:2500,maxSpeed:1400},un),ua=c.e({deceleration:20,maxSpeed:1400},un),Qo=c.e({deceleration:1e3,maxSpeed:360},un),pc=c.e({deceleration:1e3,maxSpeed:90},un),fc=c.e({deceleration:1e3,maxSpeed:360},un);class mc{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Le.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=Le.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)i.zoom+=u.zoomDelta||0,i.bearing+=u.bearingDelta||0,i.pitch+=u.pitchDelta||0,i.roll+=u.rollDelta||0,u.panDelta&&i.pan._add(u.panDelta),u.around&&(i.around=u.around),u.pinchAround&&(i.pinchAround=u.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(i.pan.mag()){const u=As(i.pan.mag(),a,c.e({},Jo,e||{})),f=i.pan.mult(u.amount/i.pan.mag()),g=this._map.cameraHelper.handlePanInertia(f,this._map.transform);o.center=g.easingCenter,o.offset=g.easingOffset,Es(o,u)}if(i.zoom){const u=As(i.zoom,a,ua);o.zoom=this._map.transform.zoom+u.amount,Es(o,u)}if(i.bearing){const u=As(i.bearing,a,Qo);o.bearing=this._map.transform.bearing+c.ae(u.amount,-179,179),Es(o,u)}if(i.pitch){const u=As(i.pitch,a,pc);o.pitch=this._map.transform.pitch+u.amount,Es(o,u)}if(i.roll){const u=As(i.roll,a,fc);o.roll=this._map.transform.roll+c.ae(u.amount,-179,179),Es(o,u)}if(o.zoom||o.bearing){const u=i.pinchAround===void 0?i.around:i.pinchAround;o.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),c.e(o,{noMoveStart:!0})}}function Es(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function As(h,e,i){const{maxSpeed:a,linearity:o,deceleration:u}=i,f=c.ae(h*o/(e/1e3),-a,a),g=Math.abs(f)/(u*o);return{easing:i.easing,duration:1e3*g,amount:f*(g/2)}}class Bi extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a,o={}){a=a instanceof MouseEvent?a:new MouseEvent(e,a);const u=ne.mousePos(i.getCanvas(),a),f=i.unproject(u);super(e,c.e({point:u,lngLat:f,originalEvent:a},o)),this._defaultPrevented=!1,this.target=i}}class ks extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){const o=e==="touchend"?a.changedTouches:a.touches,u=ne.touchPos(i.getCanvasContainer(),o),f=u.map(y=>i.unproject(y)),g=u.reduce((y,b,T,P)=>y.add(b.div(P.length)),new c.P(0,0));super(e,{points:u,point:g,lngLats:f,lngLat:i.unproject(g),originalEvent:a}),this._defaultPrevented=!1}}class el extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class gc{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new el(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new Bi(e.type,this._map,e))}mouseup(e){this._map.fire(new Bi(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new Bi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Bi(e.type,this._map,e))}mouseover(e){this._map.fire(new Bi(e.type,this._map,e))}mouseout(e){this._map.fire(new Bi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ks(e.type,this._map,e))}touchmove(e){this._map.fire(new ks(e.type,this._map,e))}touchend(e){this._map.fire(new ks(e.type,this._map,e))}touchcancel(e){this._map.fire(new ks(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _c{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Bi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Bi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zs{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class tl{constructor(e,i){this._map=e,this._tr=new zs(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(ne.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const a=i;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const o=this._startPos;this._lastPos=a,this._box||(this._box=ne.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const u=Math.min(o.x,a.x),f=Math.max(o.x,a.x),g=Math.min(o.y,a.y),y=Math.max(o.y,a.y);ne.setTransform(this._box,`translate(${u}px,${g}px)`),this._box.style.width=f-u+"px",this._box.style.height=y-g+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const a=this._startPos,o=i;if(this.reset(),ne.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:e})),{cameraAnimation:u=>u.fitScreenCoordinates(a,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ne.remove(this._box),this._box=null),ne.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new c.l(e,{originalEvent:i}))}}function no(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);const i={};for(let a=0;a<h.length;a++)i[h[a].identifier]=e[a];return i}class yc{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(o){const u=new c.P(0,0);for(const f of o)u._add(f);return u.div(o.length)}(i),this.touches=no(a,i)))}touchmove(e,i,a){if(this.aborted||!this.centroid)return;const o=no(a,i);for(const u in this.touches){const f=o[u];(!f||f.dist(this.touches[u])>30)&&(this.aborted=!0)}}touchend(e,i,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}class Ls{constructor(e){this.singleTap=new yc(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,a){this.singleTap.touchstart(e,i,a)}touchmove(e,i,a){this.singleTap.touchmove(e,i,a)}touchend(e,i,a){const o=this.singleTap.touchend(e,i,a);if(o){const u=e.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(o)<30;if(u&&f||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class vc{constructor(e){this._tr=new zs(e),this._zoomIn=new Ls({numTouches:1,numTaps:2}),this._zoomOut=new Ls({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,a){this._zoomIn.touchstart(e,i,a),this._zoomOut.touchstart(e,i,a)}touchmove(e,i,a){this._zoomIn.touchmove(e,i,a),this._zoomOut.touchmove(e,i,a)}touchend(e,i,a){const o=this._zoomIn.touchend(e,i,a),u=this._zoomOut.touchend(e,i,a),f=this._tr;return o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:f.zoom+1,around:f.unproject(o)},{originalEvent:e})}):u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:f.zoom-1,around:f.unproject(u)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const o=Array.isArray(i)?i[0]:i;return!this._moved&&o.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=o,this._move(a,o))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ne.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Yr={0:1,2:2};class Rs{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=ne.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,a){const o=Yr[a];return i.buttons===void 0||(i.buttons&o)!==o}(e,this._eventButton)}isValidEndEvent(e){return ne.mouseButton(e)===this._eventButton}}class Jr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Ds{constructor(e=new Rs({checkCorrectEvent:()=>!0}),i=new Jr){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,a){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?a(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const so=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}};class xh{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,a){return this._calculateTransform(e,i,a)}touchmove(e,i,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,i,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,a){this._calculateTransform(e,i,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,a){a.length>0&&(this._active=!0);const o=no(a,i),u=new c.P(0,0),f=new c.P(0,0);let g=0;for(const b in o){const T=o[b],P=this._touches[b];P&&(u._add(T),f._add(T.sub(P)),g++,o[b]=T)}if(this._touches=o,this._shouldBePrevented(g)||!f.mag())return;const y=f.div(g);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(g),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,a){if(!this._firstTwoTouches)return;e.preventDefault();const[o,u]=this._firstTwoTouches,f=ao(a,i,o),g=ao(a,i,u);if(!f||!g)return;const y=this._aroundCenter?null:f.add(g).div(2);return this._move([f,g],y,e)}touchend(e,i,a){if(!this._firstTwoTouches)return;const[o,u]=this._firstTwoTouches,f=ao(a,i,o),g=ao(a,i,u);f&&g||(this._active&&ne.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ao(h,e,i){for(let a=0;a<h.length;a++)if(h[a].identifier===i)return e[a]}function rl(h,e){return Math.log(h/e)/Math.LN2}class Bs extends il{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(rl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rl(this._distance,a),pinchAround:i}}}function dn(h,e){return 180*h.angleWith(e)/Math.PI}class Je extends il{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,a){const o=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dn(this._vector,o),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,a=dn(e,this._startVector);return Math.abs(a)<i}}function oo(h){return Math.abs(h.y)>Math.abs(h.x)}class lo extends il{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,a){super.touchstart(e,i,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,oo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const o=e[0].sub(this._lastPoints[0]),u=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(o,u,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+u.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,a){if(this._valid!==void 0)return this._valid;const o=e.mag()>=2,u=i.mag()>=2;if(!o&&!u)return;if(!o||!u)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const f=e.y>0==i.y>0;return oo(e)&&oo(i)&&f}}const bc={panStep:100,bearingStep:15,pitchStep:10};class Fs{constructor(e){this._tr=new zs(e);const i=bc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,a=0,o=0,u=0,f=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),u=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),u=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),f=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(a=0,o=0),{cameraAnimation:g=>{const y=this._tr;g.easeTo({duration:300,easeId:"keyboardHandler",easing:da,zoom:i?Math.round(y.zoom)+i*(e.shiftKey?2:1):y.zoom,bearing:y.bearing+a*this._bearingStep,pitch:y.pitch+o*this._pitchStep,offset:[-u*this._panStep,-f*this._panStep],center:y.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function da(h){return h*(2-h)}const nl=4.000244140625;class At{constructor(e,i){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new zs(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=Le.now(),o=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,i!==0&&i%nl==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=ne.mousePos(this._map.getCanvas(),e),a=this._tr;this._aroundPoint=this._aroundCenter?a.transform.locationToScreenPoint(c.Q.convert(a.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const g=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=g),typeof this._targetZoom=="number"&&(this._targetZoom+=g)}if(this._delta!==0){const g=this._type==="wheel"&&Math.abs(this._delta)>nl?this._wheelZoomRate:this._defaultZoomRate;let y=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&y!==0&&(y=1/y);const b=typeof this._targetZoom!="number"?e.scale:c.ac(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),c.ah(b*y)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,a=this._startZoom,o=this._easing;let u,f=!1;if(this._type==="wheel"&&a&&o){const g=Le.now()-this._lastWheelEventTime,y=Math.min((g+5)/200,1),b=o(y);u=c.B.number(a,i,b),y<1?this._frameId||(this._frameId=!0):f=!0}else u=i,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=u,{noInertia:!0,needsRenderFrame:!f,zoomDelta:u-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=c.cf;if(this._prevEase){const a=this._prevEase,o=(Le.now()-a.start)/a.duration,u=a.easing(o+.01)-a.easing(o),f=.27/Math.sqrt(u*u+1e-4)*.01,g=Math.sqrt(.0729-f*f);i=c.cd(f,g,.25,1)}return this._prevEase={start:Le.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class co{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wh{constructor(e){this._tr=new zs(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl{constructor(){this._tap=new Ls({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,a){if(!this._swipePoint)if(this._tapTime){const o=i[0],u=e.timeStamp-this._tapTime<500,f=this._tapPoint.dist(o)<30;u&&f?a.length>0&&(this._swipePoint=o,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,i,a)}touchmove(e,i,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const o=i[0],u=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(e,i,a)}touchend(e,i,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const o=this._tap.touchend(e,i,a);o&&(this._tapTime=e.timeStamp,this._tapPoint=o)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xc{constructor(e,i,a){this._el=e,this._mousePan=i,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wc{constructor(e,i,a,o){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=a,this._mouseRoll=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class al{constructor(e,i,a,o){this._el=e,this._touchZoom=i,this._touchRotate=a,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ho{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ne.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),o=document.createElement("div");o.className="maplibregl-desktop-message",o.textContent=i,this._container.appendChild(o);const u=document.createElement("div");u.className="maplibregl-mobile-message",u.textContent=a,this._container.appendChild(u),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ne.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const pa=h=>h.zoom||h.drag||h.roll||h.pitch||h.rotate;class Th extends c.l{}function uo(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta||h.rollDelta}class Sh{constructor(e,i){this.handleWindowEvent=o=>{this.handleEvent(o,`${o.type}Window`)},this.handleEvent=(o,u)=>{if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const f=o.type==="renderFrame"?void 0:o,g={needsRenderFrame:!1},y={},b={};for(const{handlerName:M,handler:z,allowed:R}of this._handlers){if(!z.isEnabled())continue;let W;if(this._blockedByActive(b,R,M))z.reset();else if(z[u||o.type]){if(c.cg(o,u||o.type)){const H=ne.mousePos(this._map.getCanvas(),o);W=z[u||o.type](o,H)}else if(c.ch(o,u||o.type)){const H=this._getMapTouches(o.touches),K=ne.touchPos(this._map.getCanvas(),H);W=z[u||o.type](o,K,H)}else c.ci(u||o.type)||(W=z[u||o.type](o));this.mergeHandlerResult(g,y,W,M,f),W&&W.needsRenderFrame&&this._triggerRenderFrame()}(W||z.isActive())&&(b[M]=z)}const T={};for(const M in this._previousActiveHandlers)b[M]||(T[M]=f);this._previousActiveHandlers=b,(Object.keys(T).length||uo(g))&&(this._changes.push([g,y,T]),this._triggerRenderFrame()),(Object.keys(b).length||uo(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:P}=g;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mc(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[o,u,f]of this._listeners)ne.addEventListener(o,u,o===document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(const[e,i,a]of this._listeners)ne.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const i=this._map,a=i.getCanvasContainer();this._add("mapEvent",new gc(i,e));const o=i.boxZoom=new tl(i,e);this._add("boxZoom",o),e.interactive&&e.boxZoom&&o.enable();const u=i.cooperativeGestures=new ho(i,e.cooperativeGestures);this._add("cooperativeGestures",u),e.cooperativeGestures&&u.enable();const f=new vc(i),g=new wh(i);i.doubleClickZoom=new co(g,f),this._add("tapZoom",f),this._add("clickZoom",g),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const y=new sl;this._add("tapDragZoom",y);const b=i.touchPitch=new lo(i);this._add("touchPitch",b),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const T=()=>i.project(i.getCenter()),P=function({enable:te,clickTolerance:re,aroundCenter:le=!0,minPixelCenterThreshold:se=100,rotateDegreesPerPixelMoved:_e=.8},Ee){const Te=new Rs({checkCorrectEvent:Se=>ne.mouseButton(Se)===0&&Se.ctrlKey||ne.mouseButton(Se)===2&&!Se.ctrlKey});return new hr({clickTolerance:re,move:(Se,Pe)=>{const Ke=Ee();if(le&&Math.abs(Ke.y-Se.y)>se)return{bearingDelta:c.ce(new c.P(Se.x,Pe.y),Pe,Ke)};let We=(Pe.x-Se.x)*_e;return le&&Pe.y<Ke.y&&(We=-We),{bearingDelta:We}},moveStateManager:Te,enable:te,assignEvents:so})}(e,T),M=function({enable:te,clickTolerance:re,pitchDegreesPerPixelMoved:le=-.5}){const se=new Rs({checkCorrectEvent:_e=>ne.mouseButton(_e)===0&&_e.ctrlKey||ne.mouseButton(_e)===2});return new hr({clickTolerance:re,move:(_e,Ee)=>({pitchDelta:(Ee.y-_e.y)*le}),moveStateManager:se,enable:te,assignEvents:so})}(e),z=function({enable:te,clickTolerance:re,rollDegreesPerPixelMoved:le=.3},se){const _e=new Rs({checkCorrectEvent:Ee=>ne.mouseButton(Ee)===2&&Ee.ctrlKey});return new hr({clickTolerance:re,move:(Ee,Te)=>{const Se=se();let Pe=(Te.x-Ee.x)*le;return Te.y<Se.y&&(Pe=-Pe),{rollDelta:Pe}},moveStateManager:_e,enable:te,assignEvents:so})}(e,T);i.dragRotate=new wc(e,P,M,z),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",M,["mouseRotate","mouseRoll"]),this._add("mouseRoll",z,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const R=function({enable:te,clickTolerance:re}){const le=new Rs({checkCorrectEvent:se=>ne.mouseButton(se)===0&&!se.ctrlKey});return new hr({clickTolerance:re,move:(se,_e)=>({around:_e,panDelta:_e.sub(se)}),activateOnStart:!0,moveStateManager:le,enable:te,assignEvents:so})}(e),W=new xh(e,i);i.dragPan=new xc(a,R,W),this._add("mousePan",R),this._add("touchPan",W,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const H=new Je,K=new Bs;i.touchZoomRotate=new al(a,K,H,y),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const J=i.scrollZoom=new At(i,()=>this._triggerRenderFrame());this._add("scrollZoom",J,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const ie=i.keyboard=new Fs(i);this._add("keyboard",ie),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new _c(i))}_add(e,i,a){this._handlers.push({handlerName:e,handler:i,allowed:a}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pa(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,a){for(const o in e)if(o!==a&&(!i||i.indexOf(o)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const a of e)this._el.contains(a.target)&&i.push(a);return i}mergeHandlerResult(e,i,a,o,u){if(!a)return;c.e(e,a);const f={handlerName:o,originalEvent:a.originalEvent||u};a.zoomDelta!==void 0&&(i.zoom=f),a.panDelta!==void 0&&(i.drag=f),a.rollDelta!==void 0&&(i.roll=f),a.pitchDelta!==void 0&&(i.pitch=f),a.bearingDelta!==void 0&&(i.rotate=f)}_applyChanges(){const e={},i={},a={};for(const[o,u,f]of this._changes)o.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(o.panDelta)),o.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+o.pitchDelta),o.rollDelta&&(e.rollDelta=(e.rollDelta||0)+o.rollDelta),o.around!==void 0&&(e.around=o.around),o.pinchAround!==void 0&&(e.pinchAround=o.pinchAround),o.noInertia&&(e.noInertia=o.noInertia),c.e(i,u),c.e(a,f);this._updateMapTransform(e,i,a),this._changes=[]}_updateMapTransform(e,i,a){const o=this._map,u=o._getTransformForUpdate(),f=o.terrain;if(!(uo(e)||f&&this._terrainMovement))return this._fireEvents(i,a,!0);o._stop(!0);let{panDelta:g,zoomDelta:y,bearingDelta:b,pitchDelta:T,rollDelta:P,around:M,pinchAround:z}=e;z!==void 0&&(M=z),M=M||o.transform.centerPoint,f&&!u.isPointOnMapSurface(M)&&(M=u.centerPoint);const R={panDelta:g,zoomDelta:y,rollDelta:P,pitchDelta:T,bearingDelta:b,around:M};this._map.cameraHelper.useGlobeControls&&!u.isPointOnMapSurface(M)&&(M=u.centerPoint);const W=M.distSqr(u.centerPoint)<.01?u.center:u.screenPointToLocation(g?M.sub(g):M);f?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(R,u),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?u.setCenter(u.screenPointToLocation(u.centerPoint.sub(g))):this._map.cameraHelper.handleMapControlsPan(R,u,W):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(R,u,W))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(R,u),this._map.cameraHelper.handleMapControlsPan(R,u,W)),o._applyUpdatedTransform(u),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,a,!0)}_fireEvents(e,i,a){const o=pa(this._eventsInProgress),u=pa(e),f={};for(const P in e){const{originalEvent:M}=e[P];this._eventsInProgress[P]||(f[`${P}start`]=M),this._eventsInProgress[P]=e[P]}!o&&u&&this._fireEvent("movestart",u.originalEvent);for(const P in f)this._fireEvent(P,f[P]);u&&this._fireEvent("move",u.originalEvent);for(const P in e){const{originalEvent:M}=e[P];this._fireEvent(P,M)}const g={};let y;for(const P in this._eventsInProgress){const{handlerName:M,originalEvent:z}=this._eventsInProgress[P];this._handlersById[M].isActive()||(delete this._eventsInProgress[P],y=i[M]||z,g[`${P}end`]=y)}for(const P in g)this._fireEvent(P,g[P]);const b=pa(this._eventsInProgress),T=(o||u)&&!b;if(T&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const P=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&P.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(P)}if(a&&T){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;!P||!P.essential&&Le.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:y})),M(this._map.getBearing())&&this._map.resetNorth()):(M(P.bearing||this._map.getBearing())&&(P.bearing=0),P.freezeElevation=!0,this._map.easeTo(P,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new c.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Th("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ch extends c.E{constructor(e,i,a){super(),this._renderFrameCallback=()=>{const o=Math.min((Le.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new c.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},i),a)}panTo(e,i,a){return this.easeTo(c.e({center:e},i),a)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,a){return this.easeTo(c.e({zoom:e},i),a)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.l("movestart",i)).fire(new c.l("move",i)).fire(new c.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,a){return this.easeTo(c.e({bearing:e},i),a)}resetNorth(e,i){return this.rotateTo(0,c.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=Gt.convert(e).adjustAntiMeridian();const a=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,i)}_cameraForBoxAndBearing(e,i,a,o){const u={top:0,bottom:0,right:0,left:0};if(typeof(o=c.e({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const b=o.padding;o.padding={top:b,bottom:b,right:b,left:b}}const f=c.e(u,o.padding);o.padding=f;const g=this.transform,y=new Gt(e,i);return this.cameraHelper.cameraForBoxAndBearing(o,f,y,a,g)}fitBounds(e,i,a){return this._fitInternal(this.cameraForBounds(e,i),i,a)}fitScreenCoordinates(e,i,a,o,u){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(i)),a,o),o,u)}_fitInternal(e,i,a){return e?(delete(i=c.e(e,i)).padding,i.linear?this.easeTo(i,a):this.flyTo(i,a)):this}jumpTo(e,i){this.stop();const a=this._getTransformForUpdate();let o=!1,u=!1,f=!1;const g=a.zoom;this.cameraHelper.handleJumpToCenterZoom(a,e);const y=a.zoom!==g;return"elevation"in e&&a.elevation!==+e.elevation&&a.setElevation(+e.elevation),"bearing"in e&&a.bearing!==+e.bearing&&(o=!0,a.setBearing(+e.bearing)),"pitch"in e&&a.pitch!==+e.pitch&&(u=!0,a.setPitch(+e.pitch)),"roll"in e&&a.roll!==+e.roll&&(f=!0,a.setRoll(+e.roll)),e.padding==null||a.isPaddingEqual(e.padding)||a.setPadding(e.padding),this._applyUpdatedTransform(a),this.fire(new c.l("movestart",i)).fire(new c.l("move",i)),y&&this.fire(new c.l("zoomstart",i)).fire(new c.l("zoom",i)).fire(new c.l("zoomend",i)),o&&this.fire(new c.l("rotatestart",i)).fire(new c.l("rotate",i)).fire(new c.l("rotateend",i)),u&&this.fire(new c.l("pitchstart",i)).fire(new c.l("pitch",i)).fire(new c.l("pitchend",i)),f&&this.fire(new c.l("rollstart",i)).fire(new c.l("roll",i)).fire(new c.l("rollend",i)),this.fire(new c.l("moveend",i))}calculateCameraOptionsFromTo(e,i,a,o=0){const u=c.$.fromLngLat(e,i),f=c.$.fromLngLat(a,o),g=f.x-u.x,y=f.y-u.y,b=f.z-u.z,T=Math.hypot(g,y,b);if(T===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(g,y),M=c.ah(this.transform.cameraToCenterDistance/T/this.transform.tileSize),z=180*Math.atan2(g,-y)/Math.PI;let R=180*Math.acos(P/T)/Math.PI;return R=b<0?90-R:90+R,{center:f.toLngLat(),elevation:o,zoom:M,pitch:R,bearing:z}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,a,o,u){const f=this.transform.calculateCenterFromCameraLngLatAlt(e,i,a,o);return{center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:a,pitch:o,roll:u}}easeTo(e,i){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.cf},e)).animate===!1||!e.essential&&Le.prefersReducedMotion)&&(e.duration=0);const a=this._getTransformForUpdate(),o=this.getBearing(),u=a.pitch,f=a.roll,g="bearing"in e?this._normalizeBearing(e.bearing,o):o,y="pitch"in e?+e.pitch:u,b="roll"in e?this._normalizeBearing(e.roll,f):f,T="padding"in e?e.padding:a.padding,P=c.P.convert(e.offset);let M,z;e.around&&(M=c.Q.convert(e.around),z=a.locationToScreenPoint(M));const R={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},W=this.cameraHelper.handleEaseTo(a,{bearing:g,pitch:y,roll:b,padding:T,around:M,aroundPoint:z,offsetAsPoint:P,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||o!==g,this._pitching=this._pitching||y!==u,this._rolling=this._rolling||b!==f,this._padding=!a.isPaddingEqual(T),this._zooming=this._zooming||W.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,R),this.terrain&&this._prepareElevation(W.elevationCenter),this._ease(H=>{W.easeFunc(H),this.terrain&&!e.freezeElevation&&this._updateElevation(H),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},H=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,H)},e),this}_prepareEase(e,i,a={}){this._moving=!0,i||a.moving||this.fire(new c.l("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.l("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.l("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.l("pitchstart",e)),this._rolling&&!a.rolling&&this.fire(new c.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(i-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(c.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),a=e.getCameraAltitude(),o=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(a<o){const u=this.calculateCameraOptionsFromTo(i,o,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(o=>this._elevateCameraIfInsideTerrain(o)),this.transformCameraUpdate&&i.push(o=>this.transformCameraUpdate(o)),!i.length)return;const a=e.clone();for(const o of i){const u=a.clone(),{center:f,zoom:g,roll:y,pitch:b,bearing:T,elevation:P}=o(u);f&&u.setCenter(f),P!==void 0&&u.setElevation(P),g!==void 0&&u.setZoom(g),y!==void 0&&u.setRoll(y),b!==void 0&&u.setPitch(b),T!==void 0&&u.setBearing(T),a.apply(u)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.l("move",e)),this._zooming&&this.fire(new c.l("zoom",e)),this._rotating&&this.fire(new c.l("rotate",e)),this._pitching&&this.fire(new c.l("pitch",e)),this._rolling&&this.fire(new c.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const a=this._zooming,o=this._rotating,u=this._pitching,f=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,a&&this.fire(new c.l("zoomend",e)),o&&this.fire(new c.l("rotateend",e)),u&&this.fire(new c.l("pitchend",e)),f&&this.fire(new c.l("rollend",e)),this.fire(new c.l("moveend",e))}flyTo(e,i){if(!e.essential&&Le.prefersReducedMotion){const Pe=c.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Pe,i)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cf},e);const a=this._getTransformForUpdate(),o=a.bearing,u=a.pitch,f=a.roll,g=a.padding,y="bearing"in e?this._normalizeBearing(e.bearing,o):o,b="pitch"in e?+e.pitch:u,T="roll"in e?this._normalizeBearing(e.roll,f):f,P="padding"in e?e.padding:a.padding,M=c.P.convert(e.offset);let z=a.centerPoint.add(M);const R=a.screenPointToLocation(z),W=this.cameraHelper.handleFlyTo(a,{bearing:y,pitch:b,roll:T,padding:P,locationAtOffset:R,offsetAsPoint:M,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let H=e.curve;const K=Math.max(a.width,a.height),J=K/W.scaleOfZoom,ie=W.pixelPathLength;typeof W.scaleOfMinZoom=="number"&&(H=Math.sqrt(K/W.scaleOfMinZoom/ie*2));const te=H*H;function re(Pe){const Ke=(J*J-K*K+(Pe?-1:1)*te*te*ie*ie)/(2*(Pe?J:K)*te*ie);return Math.log(Math.sqrt(Ke*Ke+1)-Ke)}function le(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function se(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}const _e=re(!1);let Ee=function(Pe){return se(_e)/se(_e+H*Pe)},Te=function(Pe){return K*((se(_e)*(le(Ke=_e+H*Pe)/se(Ke))-le(_e))/te)/ie;var Ke},Se=(re(!0)-_e)/H;if(Math.abs(ie)<2e-6||!isFinite(Se)){if(Math.abs(K-J)<1e-6)return this.easeTo(e,i);const Pe=J<K?-1:1;Se=Math.abs(Math.log(J/K))/H,Te=()=>0,Ee=Ke=>Math.exp(Pe*H*Ke)}return e.duration="duration"in e?+e.duration:1e3*Se/("screenSpeed"in e?+e.screenSpeed/H:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==y,this._pitching=b!==u,this._rolling=T!==f,this._padding=!a.isPaddingEqual(P),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(W.targetCenter),this._ease(Pe=>{const Ke=Pe*Se,We=1/Ee(Ke),Ve=Te(Ke);this._rotating&&a.setBearing(c.B.number(o,y,Pe)),this._pitching&&a.setPitch(c.B.number(u,b,Pe)),this._rolling&&a.setRoll(c.B.number(f,T,Pe)),this._padding&&(a.interpolatePadding(g,P,Pe),z=a.centerPoint.add(M)),W.easeFunc(Pe,We,Ve,z),this.terrain&&!e.freezeElevation&&this._updateElevation(Pe),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,i)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,i,a){a.animate===!1||a.duration===0?(e(1),i()):(this._easeStart=Le.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=c.aL(e,-180,180);const a=Math.abs(e-i);return Math.abs(e-360-i)<a&&(e-=360),Math.abs(e+360-i)<a&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.Q.convert(e),this.transform.tileZoom):null}}const Cn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ti{constructor(e=Cn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ne.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ne.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ne.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ne.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const a=this._map._getUIString(`AttributionControl.${i}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(o=>typeof o!="string"?"":o)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}const i=this._map.style.sourceCaches;for(const o in i){const u=i[o];if(u.used||u.usedForTerrain){const f=u.getSource();f.attribution&&e.indexOf(f.attribution)<0&&e.push(f.attribution)}}e=e.filter(o=>String(o).trim()),e.sort((o,u)=>o.length-u.length),e=e.filter((o,u)=>{for(let f=u+1;f<e.length;f++)if(e[f].indexOf(o)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=ne.sanitize(a),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class fa{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ne.create("div","maplibregl-ctrl");const i=ne.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ne.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ol{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,a=i?this._queue.concat(i):this._queue;for(const o of a)if(o.id===e)return void(o.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const a of i)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Tc=c.aG([{name:"a_pos3d",type:"Int16",components:3}]);class Sc extends c.E{constructor(e){super(),this._lastTilesetChange=Le.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const a={};for(const o of ce(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))a[o.key]=!0,this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.terrainRttPosMatrix32f=new Float64Array(16),c.bQ(o.terrainRttPosMatrix32f,0,c.Z,c.Z,0,0,1),this._tiles[o.key]=new Fr(o,this.tileSize),this._lastTilesetChange=Le.now());for(const o in this._tiles)a[o]||delete this._tiles[o]}freeRtt(e){for(const i in this._tiles){const a=this._tiles[i];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const a of this._renderableTilesKeys){const o=this._tiles[a].tileID,u=e.clone(),f=c.b2();if(o.canonical.equals(e.canonical))c.bQ(f,0,c.Z,c.Z,0,0,1);else if(o.canonical.isChildOf(e.canonical)){const g=o.canonical.z-e.canonical.z,y=o.canonical.x-(o.canonical.x>>g<<g),b=o.canonical.y-(o.canonical.y>>g<<g),T=c.Z>>g;c.bQ(f,0,T,T,0,0,1),c.L(f,f,[-y*T,-b*T,0])}else{if(!e.canonical.isChildOf(o.canonical))continue;{const g=e.canonical.z-o.canonical.z,y=e.canonical.x-(e.canonical.x>>g<<g),b=e.canonical.y-(e.canonical.y>>g<<g),T=c.Z>>g;c.bQ(f,0,c.Z,c.Z,0,0,1),c.L(f,f,[y*T,b*T,0]),c.M(f,f,[1/2**g,1/2**g,0])}}u.terrainRttPosMatrix32f=new Float32Array(f),i[a]=u}return i}_getTerrainCoordsForTileRanges(e,i){const a={};for(const o of this._renderableTilesKeys){const u=this._tiles[o].tileID;if(!this._isWithinTileRanges(u,i))continue;const f=e.clone(),g=c.b2();if(u.canonical.z===e.canonical.z){const y=e.canonical.x-u.canonical.x,b=e.canonical.y-u.canonical.y;c.bQ(g,0,c.Z,c.Z,0,0,1),c.L(g,g,[y*c.Z,b*c.Z,0])}else if(u.canonical.z>e.canonical.z){const y=u.canonical.z-e.canonical.z,b=u.canonical.x-(u.canonical.x>>y<<y),T=u.canonical.y-(u.canonical.y>>y<<y),P=e.canonical.x-(u.canonical.x>>y),M=e.canonical.y-(u.canonical.y>>y),z=c.Z>>y;c.bQ(g,0,z,z,0,0,1),c.L(g,g,[-b*z+P*c.Z,-T*z+M*c.Z,0])}else{const y=e.canonical.z-u.canonical.z,b=e.canonical.x-(e.canonical.x>>y<<y),T=e.canonical.y-(e.canonical.y>>y<<y),P=(e.canonical.x>>y)-u.canonical.x,M=(e.canonical.y>>y)-u.canonical.y,z=c.Z<<y;c.bQ(g,0,z,z,0,0,1),c.L(g,g,[b*c.Z+P*z,T*c.Z+M*z,0])}f.terrainRttPosMatrix32f=new Float32Array(g),a[o]=f}return a}getSourceTile(e,i){const a=this.sourceCache._source;let o=e.overscaledZ-this.deltaZoom;if(o>a.maxzoom&&(o=a.maxzoom),o<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(o).key);let u=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!u||!u.dem)&&i)for(;o>=a.minzoom&&(!u||!u.dem);)u=this.sourceCache.getTileByID(e.scaledTo(o--).key);return u}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class Cc{constructor(e,i,a){this._meshCache={},this.painter=e,this.sourceCache=new Sc(i),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,a,o=c.Z){var u;if(!(i>=0&&i<o&&a>=0&&a<o))return 0;const f=this.getTerrainData(e),g=(u=f.tile)===null||u===void 0?void 0:u.dem;if(!g)return 0;const y=c.cj([],[i/o*c.Z,a/o*c.Z],f.u_terrain_matrix),b=[y[0]*g.dim,y[1]*g.dim],T=Math.floor(b[0]),P=Math.floor(b[1]),M=b[0]-T,z=b[1]-P;return g.get(T,P)*(1-M)*(1-z)+g.get(T+1,P)*M*(1-z)+g.get(T,P+1)*(1-M)*z+g.get(T+1,P+1)*M*z}getElevationForLngLatZoom(e,i){if(!c.ck(i,e.wrap()))return 0;const{tileID:a,mercatorX:o,mercatorY:u}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(a,o%c.Z,u%c.Z,c.Z)}getElevation(e,i,a,o=c.Z){return this.getDEMElevation(e,i,a,o)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const o=this.painter.context,u=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ge(o,u,o.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ge(o,new c.R({width:1,height:1}),o.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ad([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const o=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new ge(o,i.dem.getPixels(),o.gl.RGBA,{premultiply:!1}),i.demTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const a=i&&i+i.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const o=this.sourceCache.sourceCache._source.maxzoom;let u=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=o?u=e.canonical.z-o:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const f=e.canonical.x-(e.canonical.x>>u<<u),g=e.canonical.y-(e.canonical.y>>u<<u),y=c.cl(new Float64Array(16),[1/(c.Z<<u),1/(c.Z<<u),0]);c.L(y,y,[f*c.Z,g*c.Z,0]),this._demMatrixCache[e.key]={matrix:y,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,a=i.width/devicePixelRatio,o=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===o||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ge(i.context,{width:a,height:o,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ge(i.context,{width:a,height:o,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(a,o,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,a,o))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let u=0,f=0;u<this._coordsTextureSize;u++)for(let g=0;g<this._coordsTextureSize;g++,f+=4)i[f+0]=255&g,i[f+1]=255&u,i[f+2]=g>>8<<4|u>>8,i[f+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),o=new ge(e,a,e.gl.RGBA,{premultiply:!1});return o.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=o,o}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),a=this.painter.context,o=a.gl,u=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),f=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),g=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),o.readPixels(u,g-f-1,1,1,o.RGBA,o.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null);const y=i[0]+(i[2]>>4<<8),b=i[1]+((15&i[2])<<8),T=this.coordsIndex[255-i[3]],P=T&&this.sourceCache.getTileByID(T);if(!P)return null;const M=this._coordsTextureSize,z=(1<<P.tileID.canonical.z)*M;return new c.$((P.tileID.canonical.x*M+y)/z+P.tileID.wrap,(P.tileID.canonical.y*M+b)/z,this.getElevation(P.tileID,y,b,M))}depthAtPoint(e){const i=new Uint8Array(4),a=this.painter.context,o=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),o.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,o.RGBA,o.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const a=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,o=a&&e.canonical.y===0,u=a&&e.canonical.y===(1<<e.canonical.z)-1,f=`m_${o?"n":""}_${u?"s":""}`;if(this._meshCache[f])return this._meshCache[f];const g=this.painter.context,y=new c.cm,b=new c.aK,T=this.meshSize,P=c.Z/T,M=T*T;for(let se=0;se<=T;se++)for(let _e=0;_e<=T;_e++)y.emplaceBack(_e*P,se*P,0);for(let se=0;se<M;se+=T+1)for(let _e=0;_e<T;_e++)b.emplaceBack(_e+se,T+_e+se+1,T+_e+se+2),b.emplaceBack(_e+se,T+_e+se+2,_e+se+1);const z=y.length,R=z+(T+1),W=(T+1)*T,H=o?c.b9:0,K=o?0:1,J=u?c.ba:c.Z,ie=u?0:1;for(let se=0;se<=T;se++)y.emplaceBack(se*P,H,K);for(let se=0;se<=T;se++)y.emplaceBack(se*P,J,ie);for(let se=0;se<T;se++)b.emplaceBack(W+se,R+se,R+se+1),b.emplaceBack(W+se,R+se+1,W+se+1),b.emplaceBack(0+se,z+se+1,z+se),b.emplaceBack(0+se,0+se+1,z+se+1);const te=y.length,re=te+2*(T+1);for(const se of[0,1])for(let _e=0;_e<=T;_e++)for(const Ee of[0,1])y.emplaceBack(se*c.Z,_e*P,Ee);for(let se=0;se<2*T;se+=2)b.emplaceBack(te+se,te+se+1,te+se+3),b.emplaceBack(te+se,te+se+3,te+se+2),b.emplaceBack(re+se,re+se+3,re+se+1),b.emplaceBack(re+se,re+se+2,re+se+3);const le=new Nn(g.createVertexBuffer(y,Tc.members),g.createIndexBuffer(b),c.aJ.simpleSegment(0,0,y.length,b.length));return this._meshCache[f]=le,le}getMeshFrameDelta(e){return 2*Math.PI*c.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var a;const{tileID:o}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(a=this.getMinMaxElevation(o).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return i&&i.dem&&(a.minElevation=i.dem.min*this.exaggeration,a.maxElevation=i.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,i){const a=c.$.fromLngLat(e.wrap()),o=(1<<i)*c.Z,u=a.x*o,f=a.y*o,g=Math.floor(u/c.Z),y=Math.floor(f/c.Z);return{tileID:new c.Y(i,0,i,g,y),mercatorX:u,mercatorY:f}}}class Mh{constructor(e,i,a){this._context=e,this._size=i,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new ge(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(a.texture),{id:e,fbo:i,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const yr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class po{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new Mh(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(i)),this._coordsAscending={};for(const a in e.sourceCaches){this._coordsAscending[a]={};const o=e.sourceCaches[a].getVisibleCoordinates(),u=e.sourceCaches[a].getSource(),f=u instanceof mr?u.terrainTileRanges:null;for(const g of o){const y=this.terrain.sourceCache.getTerrainCoords(g,f);for(const b in y)this._coordsAscending[a][b]||(this._coordsAscending[a][b]=[]),this._coordsAscending[a][b].push(y[b])}}this._coordsAscendingStr={};for(const a of e._order){const o=e._layers[a],u=o.source;if(yr[o.type]&&!this._coordsAscendingStr[u]){this._coordsAscendingStr[u]={};for(const f in this._coordsAscending[u])this._coordsAscendingStr[u][f]=this._coordsAscending[u][f].map(g=>g.key).sort().join()}}for(const a of this._renderableTiles)for(const o in this._coordsAscendingStr){const u=this._coordsAscendingStr[o][a.tileID.key];u&&u!==a.rttCoords[o]&&(a.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const a=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),o=e.type,u=this.painter,f=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(yr[o]&&(this._prevType&&yr[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!f))return!0;if(yr[this._prevType]||yr[o]&&f){this._prevType=o;const g=this._stacks.length-1,y=this._stacks[g]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&($n(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[g]){const P=this.pool.getObjectForId(b.rtt[g].id);if(P.stamp===b.rtt[g].stamp){this.pool.useObject(P);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),b.rtt[g]={id:T.id,stamp:T.stamp},u.context.bindFramebuffer.set(T.fbo.framebuffer),u.context.clear({color:c.b7.transparent,stencil:0}),u.currentStencilSource=void 0;for(let P=0;P<y.length;P++){const M=u.style._layers[y[P]],z=M.source?this._coordsAscending[M.source][b.tileID.key]:[b.tileID];u.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),u._renderTileClippingMasks(M,z,!0),u.renderLayer(u,u.style.sourceCaches[M.source],M,z,a),M.source&&(b.rttCoords[M.source]=this._coordsAscendingStr[M.source][b.tileID.key])}}return $n(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects(),yr[o]}return!1}}const nt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ht=me,ma={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Cn,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},ll={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class cl{constructor(e,i,a=!1){this.mousedown=u=>{this.startMove(u,ne.mousePos(this.element,u)),ne.addEventListener(window,"mousemove",this.mousemove),ne.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=u=>{this.move(u,ne.mousePos(this.element,u))},this.mouseup=u=>{this._rotatePitchHanlder.dragEnd(u),this.offTemp()},this.touchstart=u=>{u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ne.touchPos(this.element,u.targetTouches)[0],this.startMove(u,this._startPos),ne.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ne.addEventListener(window,"touchend",this.touchend))},this.touchmove=u=>{u.targetTouches.length!==1?this.reset():(this._lastPos=ne.touchPos(this.element,u.targetTouches)[0],this.move(u,this._lastPos))},this.touchend=u=>{u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const o=new Ds;this._rotatePitchHanlder=new hr({clickTolerance:3,move:(u,f)=>{const g=i.getBoundingClientRect(),y=new c.P((g.bottom-g.top)/2,(g.right-g.left)/2);return{bearingDelta:c.ce(new c.P(u.x,f.y),f,y),pitchDelta:a?-.5*(f.y-u.y):void 0}},moveStateManager:o,enable:!0,assignEvents:()=>{}}),this.map=e,ne.addEventListener(i,"mousedown",this.mousedown),ne.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),ne.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),ne.disableDrag()}move(e,i){const a=this.map,{bearingDelta:o,pitchDelta:u}=this._rotatePitchHanlder.dragMove(e,i)||{};o&&a.setBearing(a.getBearing()+o),u&&a.setPitch(a.getPitch()+u)}off(){const e=this.element;ne.removeEventListener(e,"mousedown",this.mousedown),ne.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ne.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ne.removeEventListener(window,"touchend",this.touchend),ne.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ne.enableDrag(),ne.removeEventListener(window,"mousemove",this.mousemove),ne.removeEventListener(window,"mouseup",this.mouseup),ne.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ne.removeEventListener(window,"touchend",this.touchend)}}let Ei;function hl(h,e,i,a=!1){if(a||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return h==null?void 0:h.wrap();const o=new c.Q(h.lng,h.lat);if(h=new c.Q(h.lng,h.lat),e){const u=new c.Q(h.lng-360,h.lat),f=new c.Q(h.lng+360,h.lat),g=i.locationToScreenPoint(h).distSqr(e);i.locationToScreenPoint(u).distSqr(e)<g?h=u:i.locationToScreenPoint(f).distSqr(e)<g&&(h=f)}for(;Math.abs(h.lng-i.center.lng)>180;){const u=i.locationToScreenPoint(h);if(u.x>=0&&u.y>=0&&u.x<=i.width&&u.y<=i.height)break;h.lng>i.center.lng?h.lng-=360:h.lng+=360}return h.lng!==o.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(h))?h:o}const Vr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Mc(h,e,i){const a=h.classList;for(const o in Vr)a.remove(`maplibregl-${i}-anchor-${o}`);a.add(`maplibregl-${i}-anchor-${e}`)}class ms extends c.E{constructor(e){if(super(),this._onKeyPress=i=>{const a=i.code,o=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&o!==32&&o!==13||this.togglePopup()},this._onMapClick=i=>{const a=i.originalEvent.target,o=this._element;this._popup&&(a===o||o.contains(a))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!a)&&this._map.once("render",this._update),this._lngLat=hl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let o="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?o=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(o=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let u="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?u="rotateX(0deg)":this._pitchAlignment==="map"&&(u=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),ne.setTransform(this._element,`${Vr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${u} ${o}`),Le.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ne.create("div");const i=ne.createNS("http://www.w3.org/2000/svg","svg"),a=41,o=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${a}px`),i.setAttributeNS(null,"width",`${o}px`),i.setAttributeNS(null,"viewBox",`0 0 ${o} ${a}`);const u=ne.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"stroke","none"),u.setAttributeNS(null,"stroke-width","1"),u.setAttributeNS(null,"fill","none"),u.setAttributeNS(null,"fill-rule","evenodd");const f=ne.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill-rule","nonzero");const g=ne.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(3.0, 29.0)"),g.setAttributeNS(null,"fill","#000000");const y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const K of y){const J=ne.createNS("http://www.w3.org/2000/svg","ellipse");J.setAttributeNS(null,"opacity","0.04"),J.setAttributeNS(null,"cx","10.5"),J.setAttributeNS(null,"cy","5.80029008"),J.setAttributeNS(null,"rx",K.rx),J.setAttributeNS(null,"ry",K.ry),g.appendChild(J)}const b=ne.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill",this._color);const T=ne.createNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),b.appendChild(T);const P=ne.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const M=ne.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(M);const z=ne.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),z.setAttributeNS(null,"fill","#FFFFFF");const R=ne.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=ne.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const H=ne.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#FFFFFF"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962"),R.appendChild(W),R.appendChild(H),f.appendChild(g),f.appendChild(b),f.appendChild(P),f.appendChild(z),f.appendChild(R),i.appendChild(f),i.setAttributeNS(null,"height",a*this._scale+"px"),i.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(i),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),Mc(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ne.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,a;const o=(i=this._map)===null||i===void 0?void 0:i.terrain,u=this._map.transform.isLocationOccluded(this._lngLat);if(!o||u){const z=u?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==z&&(this._element.style.opacity=z))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const f=this._map,g=f.terrain.depthAtPoint(this._pos),y=f.terrain.getElevationForLngLatZoom(this._lngLat,f.transform.tileZoom);if(f.transform.lngLatToCameraDepth(this._lngLat,y)-g<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/f.transform.pixelsPerMeter,T=Math.sin(f.getPitch()*Math.PI/180)*b,P=f.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),M=f.transform.lngLatToCameraDepth(this._lngLat,y+T)-P>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const gi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let li=0,Os=!1;const ga={maxWidth:100,unit:"metric"};function _a(h,e,i){const a=i&&i.maxWidth||100,o=h._container.clientHeight/2,u=h._container.clientWidth/2,f=h.unproject([u-a/2,o]),g=h.unproject([u+a/2,o]),y=Math.round(h.project(g).x-h.project(f).x),b=Math.min(a,y,h._container.clientWidth),T=f.distanceTo(g);if(i&&i.unit==="imperial"){const P=3.2808*T;P>5280?gs(e,b,P/5280,h._getUIString("ScaleControl.Miles")):gs(e,b,P,h._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?gs(e,b,T/1852,h._getUIString("ScaleControl.NauticalMiles")):T>=1e3?gs(e,b,T/1e3,h._getUIString("ScaleControl.Kilometers")):gs(e,b,T,h._getUIString("ScaleControl.Meters"))}function gs(h,e,i,a){const o=function(u){const f=Math.pow(10,`${Math.floor(u)}`.length-1);let g=u/f;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(y){const b=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*b)/b}(g),f*g}(i);h.style.width=e*(o/i)+"px",h.innerHTML=`${o}&nbsp;${a}`}const ul={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},dl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function js(h){if(h){if(typeof h=="number"){const e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,h),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-h),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(h,0),right:new c.P(-h,0)}}if(h instanceof c.P||Array.isArray(h)){const e=c.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(h.center||[0,0]),top:c.P.convert(h.top||[0,0]),"top-left":c.P.convert(h["top-left"]||[0,0]),"top-right":c.P.convert(h["top-right"]||[0,0]),bottom:c.P.convert(h.bottom||[0,0]),"bottom-left":c.P.convert(h["bottom-left"]||[0,0]),"bottom-right":c.P.convert(h["bottom-right"]||[0,0]),left:c.P.convert(h.left||[0,0]),right:c.P.convert(h.right||[0,0])}}return js(new c.P(0,0))}const pl=me;x.AJAXError=c.cq,x.Event=c.l,x.Evented=c.E,x.LngLat=c.Q,x.MercatorCoordinate=c.$,x.Point=c.P,x.addProtocol=c.cr,x.config=c.a,x.removeProtocol=c.cs,x.AttributionControl=ti,x.BoxZoomHandler=tl,x.CanvasSource=gn,x.CooperativeGesturesHandler=ho,x.DoubleClickZoomHandler=co,x.DragPanHandler=xc,x.DragRotateHandler=wc,x.EdgeInsets=as,x.FullscreenControl=class extends c.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ne.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=ne.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ne.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=ts,x.GeolocateControl=class extends c.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new c.Q(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,o=this._map.getBearing(),u=c.e({bearing:o},this.options.fitBoundsOptions),f=Gt.fromLngLat(i,a);this._map.fitBounds(f,u,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new c.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Os)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=ne.create("button","maplibregl-ctrl-geolocate",this._container),ne.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ms({element:this._dotElement}),this._circleElement=ne.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ms({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},gi,h)}onAdd(h){return this._map=h,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(Ei!==void 0&&!e)return Ei;if(window.navigator.permissions===void 0)return Ei=!!window.navigator.geolocation,Ei;try{Ei=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ei=!!window.navigator.geolocation}return Ei})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ne.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,li=0,Os=!1}_isOutOfMapMaxBounds(h){const e=this._map.getMaxBounds(),i=h.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),e=h.getSouthEast(),i=h.getNorthEast(),a=e.distanceTo(i),o=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":li--,Os=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),li++,li>1?(h={maximumAge:6e5,timeout:0},Os=!0):(h=this.options.positionOptions,Os=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.GlobeControl=class{constructor(){this._toggleProjection=()=>{var h;const e=(h=this._map.getProjection())===null||h===void 0?void 0:h.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var h;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((h=this._map.getProjection())===null||h===void 0?void 0:h.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(h){return this._map=h,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ne.create("button","maplibregl-ctrl-globe",this._container),ne.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ne.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},x.Hash=Yo,x.ImageSource=mr,x.KeyboardHandler=Fs,x.LngLatBounds=Gt,x.LogoControl=fa,x.Map=class extends Ch{constructor(h){var e,i;c.cn.mark(c.co.create);const a=Object.assign(Object.assign(Object.assign({},ma),h),{canvasContextAttributes:Object.assign(Object.assign({},ma.canvasContextAttributes),h.canvasContextAttributes)});if(a.minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const o=new ln,u=new Zn;if(a.minZoom!==void 0&&o.setMinZoom(a.minZoom),a.maxZoom!==void 0&&o.setMaxZoom(a.maxZoom),a.minPitch!==void 0&&o.setMinPitch(a.minPitch),a.maxPitch!==void 0&&o.setMaxPitch(a.maxPitch),a.renderWorldCopies!==void 0&&o.setRenderWorldCopies(a.renderWorldCopies),super(o,u,{bearingSnap:a.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ol,this._controls=[],this._mapId=c.a4(),this._contextLost=g=>{g.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:g}))},this._contextRestored=g=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:g}))},this._onMapScroll=g=>{if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=a.interactive,this._maxTileCacheSize=a.maxTileCacheSize,this._maxTileCacheZoomLevels=a.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},a.canvasContextAttributes),this._trackResize=a.trackResize===!0,this._bearingSnap=a.bearingSnap,this._centerClampedToGround=a.centerClampedToGround,this._refreshExpiredTiles=a.refreshExpiredTiles===!0,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions===!0,this._collectResourceTiming=a.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},nt),a.locale),this._clickTolerance=a.clickTolerance,this._overridePixelRatio=a.pixelRatio,this._maxCanvasSize=a.maxCanvasSize,this.transformCameraUpdate=a.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=a.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ce.addThrottleControl(()=>this.isMoving()),this._requestManager=new be(a.transformRequest),typeof a.container=="string"){if(this._container=document.getElementById(a.container),!this._container)throw new Error(`Container '${a.container}' not found.`)}else{if(!(a.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=a.container}if(a.maxBounds&&this.setMaxBounds(a.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let g=!1;const y=ha(b=>{this._trackResize&&!this._removed&&(this.resize(b),this.redraw())},50);this._resizeObserver=new ResizeObserver(b=>{g?y(b):g=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Sh(this,a),this._hash=a.hash&&new Yo(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,roll:a.roll}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,c.e({},a.fitBoundsOptions,{duration:0}))));const f=typeof a.style=="string"||((i=(e=a.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,f),this._localIdeographFontFamily=a.localIdeographFontFamily,this._validateStyle=a.validateStyle,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new ti(typeof a.attributionControl=="boolean"?void 0:a.attributionControl)),a.maplibreLogo&&this.addControl(new fa,a.logoPosition),this.on("style.load",()=>{if(f||this._resizeTransform(),this.transform.unmodified){const g=c.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(g)}}),this.on("data",g=>{this._update(g.dataType==="style"),this.fire(new c.l(`${g.dataType}data`,g))}),this.on("dataloading",g=>{this.fire(new c.l(`${g.dataType}dataloading`,g))}),this.on("dataabort",g=>{this.fire(new c.l("sourcedataabort",g))})}_getMapId(){return this._mapId}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=h.onAdd(this);this._controls.push(h);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(i,a.firstChild):a.appendChild(i),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,i,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,i,a)}resize(h,e=!0){const[i,a]=this._containerDimensions(),o=this._getClampedPixelRatio(i,a);if(this._resizeCanvas(i,a,o),this.painter.resize(i,a,o),this.painter.overLimit()){const f=this.painter.context.gl;this._maxCanvasSize=[f.drawingBufferWidth,f.drawingBufferHeight];const g=this._getClampedPixelRatio(i,a);this._resizeCanvas(i,a,g),this.painter.resize(i,a,g)}this._resizeTransform(e);const u=!this._moving;return u&&(this.stop(),this.fire(new c.l("movestart",h)).fire(new c.l("move",h))),this.fire(new c.l("resize",h)),u&&this.fire(new c.l("moveend",h)),this}_resizeTransform(h=!0){var e;const[i,a]=this._containerDimensions();this.transform.resize(i,a,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,a,h)}_getClampedPixelRatio(h,e){const{0:i,1:a}=this._maxCanvasSize,o=this.getPixelRatio(),u=h*o,f=e*o;return Math.min(u>i?i/u:1,f>a?a/f:1)*o}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(Gt.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.setMinZoom(h),this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.setMaxZoom(h),this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.setMinPitch(h),this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(h>=this.transform.minPitch)return this.transform.setMaxPitch(h),this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.setRenderWorldCopies(h),this._update()}project(h){return this.transform.locationToScreenPoint(c.Q.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.screenPointToLocation(c.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,i){if(h==="mouseenter"||h==="mouseover"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:u=>{const f=e.filter(y=>this.getLayer(y)),g=f.length!==0?this.queryRenderedFeatures(u.point,{layers:f}):[];g.length?a||(a=!0,i.call(this,new Bi(h,this,u.originalEvent,{features:g}))):a=!1},mouseout:()=>{a=!1}}}}if(h==="mouseleave"||h==="mouseout"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:f=>{const g=e.filter(y=>this.getLayer(y));(g.length!==0?this.queryRenderedFeatures(f.point,{layers:g}):[]).length?a=!0:a&&(a=!1,i.call(this,new Bi(h,this,f.originalEvent)))},mouseout:f=>{a&&(a=!1,i.call(this,new Bi(h,this,f.originalEvent)))}}}}{const a=o=>{const u=e.filter(g=>this.getLayer(g)),f=u.length!==0?this.queryRenderedFeatures(o.point,{layers:u}):[];f.length&&(o.features=f,i.call(this,o),delete o.features)};return{layers:e,listener:i,delegates:{[h]:a}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,i){if(!this._delegatedListeners||!this._delegatedListeners[h])return;const a=this._delegatedListeners[h];for(let o=0;o<a.length;o++){const u=a[o];if(u.listener===i&&u.layers.length===e.length&&u.layers.every(f=>e.includes(f))){for(const f in u.delegates)this.off(f,u.delegates[f]);return void a.splice(o,1)}}}on(h,e,i){if(i===void 0)return super.on(h,e);const a=typeof e=="string"?[e]:e,o=this._createDelegatedListener(h,a,i);this._saveDelegatedListener(h,o);for(const u in o.delegates)this.on(u,o.delegates[u]);return{unsubscribe:()=>{this._removeDelegatedListener(h,a,i)}}}once(h,e,i){if(i===void 0)return super.once(h,e);const a=typeof e=="string"?[e]:e,o=this._createDelegatedListener(h,a,i);for(const u in o.delegates){const f=o.delegates[u];o.delegates[u]=(...g)=>{this._removeDelegatedListener(h,a,i),f(...g)}}this._saveDelegatedListener(h,o);for(const u in o.delegates)this.once(u,o.delegates[u]);return this}off(h,e,i){return i===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let i;const a=h instanceof c.P||Array.isArray(h),o=a?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:h)||{},o instanceof c.P||typeof o[0]=="number")i=[c.P.convert(o)];else{const u=c.P.convert(o[0]),f=c.P.convert(o[1]);i=[u,new c.P(f.x,u.y),f,new c.P(u.x,f.y),u]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){var i,a;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,e));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new Lo(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,o):this.style.loadJSON(h,e,o),this):((a=(i=this.style)===null||i===void 0?void 0:i.projection)===null||a===void 0||a.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Lo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){const i=this._requestManager.transformRequest(h,"Style");c.j(i,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.k(a))})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(i){c.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){const e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new c.k(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const a=this.style._layers[i];a.type==="hillshade"&&a.source===h.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Cc(this.painter,e,h),this.painter.renderToTexture=new po(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var a;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==h.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((a=i.source)===null||a===void 0?void 0:a.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const e in h){const i=h[e]._tiles;for(const a in i){const o=i[a];if(o.state!=="loaded"&&o.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}setSourceTileLodParams(h,e,i){if(i){const a=this.getSource(i);if(!a)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);a.calculateTileZoom=oe(Math.max(1,h),Math.max(1,e))}else for(const a in this.style.sourceCaches)this.style.sourceCaches[a].getSource().calculateTileZoom=oe(Math.max(1,h),Math.max(1,e));return this._update(!0),this}refreshTiles(h,e){const i=this.style.sourceCaches[h];if(!i)throw new Error(`There is no source cache with ID "${h}", cannot refresh tile`);e===void 0?i.reload():i.refreshTiles(e.map(a=>new c.a1(a.z,a.x,a.y)))}addImage(h,e,i={}){const{pixelRatio:a=1,sdf:o=!1,stretchX:u,stretchY:f,content:g,textFitWidth:y,textFitHeight:b}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:P,data:M}=e,z=e;return this.style.addImage(h,{data:new c.R({width:T,height:P},new Uint8Array(M)),pixelRatio:a,stretchX:u,stretchY:f,content:g,textFitWidth:y,textFitHeight:b,sdf:o,version:0,userImage:z}),z.onAdd&&z.onAdd(this,h),this}}{const{width:T,height:P,data:M}=Le.getImageData(e);this.style.addImage(h,{data:new c.R({width:T,height:P},M),pixelRatio:a,stretchX:u,stretchY:f,content:g,textFitWidth:y,textFitHeight:b,sdf:o,version:0})}}updateImage(h,e){const i=this.style.getImage(h);if(!i)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?Le.getImageData(e):e,{width:o,height:u,data:f}=a;if(o===void 0||u===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==i.data.width||u!==i.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const g=!(e instanceof HTMLImageElement||c.b(e));return i.data.replace(f,g),this.style.updateImage(h,i),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return Ce.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,i){return this.style.setLayerZoomRange(h,e,i),this._update(!0)}setFilter(h,e,i={}){return this.style.setFilter(h,e,i),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,i,a={}){return this.style.setPaintProperty(h,e,i,a),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,i,a={}){return this.style.setLayoutProperty(h,e,i,a),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,i,a=>{a||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,i=>{i||this._update(!0)}),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(h,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const e=this._canvasContainer=ne.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ne.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),a=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],a);const o=this._controlContainer=ne.create("div","maplibregl-control-container",h),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{u[f]=ne.create("div",`maplibregl-ctrl-${f} `,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,i){this._canvas.width=Math.floor(i*h),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const h=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:h},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,h):this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h),!i){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new Xo(i,this.transform),Re.testSupport(i)}migrateProjection(h,e){super.migrateProjection(h,e),this.painter.transform=h,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){var e,i,a,o,u;const f=this._idleTriggered?this._fadeDuration:0,g=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,M=Le.now();this.style.zoomHistory.update(P,M);const z=new c.C(P,{now:M,fadeDuration:f,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=z.crossFadingFactor();R===1&&R===this._crossFadingFactor||(y=!0,this._crossFadingFactor=R),this.style.update(z)}const b=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==g;(a=this.style.projection)===null||a===void 0||a.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((o=this.style.projection)===null||o===void 0?void 0:o.transitionState,(u=this.style.projection)===null||u===void 0?void 0:u.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||b)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,f,this._crossSourceCollisions,b),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cn.mark(c.co.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const T=this._sourcesDirty||this._styleDirty||this._placementDirty;return T||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,c.cn.mark(c.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ce.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ne.remove(this._canvasContainer),ne.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cn.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Le.frame(this._frameRequest,h=>{c.cn.frame(h),this._frameRequest=null;try{this._render(h)}catch(e){if(!c.cp(e)&&!function(i){return i.message===Wa}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return ht}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),this.style.setProjection(h),this._update(!0)}},x.MapMouseEvent=Bi,x.MapTouchEvent=ks,x.MapWheelEvent=el,x.Marker=ms,x.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const a=this._map._getUIString(`NavigationControl.${i}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},ll,h),this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),ne.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),ne.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=ne.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ne.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){const i=ne.create("button",h,this._container);return i.type="button",i.addEventListener("click",e),i}},x.Popup=class extends c.E{constructor(h){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&ne.remove(this._content),this._container&&(ne.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ne.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ne.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const f of this.options.className.split(" "))this._container.classList.add(f);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=hl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let a=this.options.anchor;const o=js(this.options.offset);if(!a){const f=this._container.offsetWidth,g=this._container.offsetHeight;let y;y=i.y+o.bottom.y<g?["top"]:i.y>this._map.transform.height-g?["bottom"]:[],i.x<f/2?y.push("left"):i.x>this._map.transform.width-f/2&&y.push("right"),a=y.length===0?"bottom":y.join("-")}let u=i.add(o[a]);this.options.subpixelPositioning||(u=u.round()),ne.setTransform(this._container,`${Vr[a]} translate(${u.x}px,${u.y}px)`),Mc(this._container,a,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(ul),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=c.Q.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const e=document.createDocumentFragment(),i=document.createElement("body");let a;for(i.innerHTML=h;a=i.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ne.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=ne.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(dl);h&&h.focus()}},x.RasterDEMTileSource=es,x.RasterTileSource=Tr,x.ScaleControl=class{constructor(h){this._onMove=()=>{_a(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,_a(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ga),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ne.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=At,x.Style=Lo,x.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ne.create("button","maplibregl-ctrl-terrain",this._container),ne.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ne.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=lo,x.TwoFingersTouchRotateHandler=Je,x.TwoFingersTouchZoomHandler=Bs,x.TwoFingersTouchZoomRotateHandler=al,x.VectorTileSource=an,x.VideoSource=Br,x.addSourceType=(h,e)=>c._(void 0,void 0,void 0,function*(){if(Hr(h))throw new Error(`A source type called "${h}" already exists.`);((i,a)=>{_n[i]=a})(h,e)}),x.clearPrewarmedResources=function(){const h=pr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release($r),pr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.createTileMesh=vt,x.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return Cr().getRTLTextPluginStatus()},x.getVersion=function(){return pl},x.getWorkerCount=function(){return Vi.workerCount},x.getWorkerUrl=function(){return c.a.WORKER_URL},x.importScriptInWorkers=function(h){return ni().broadcast("IS",h)},x.prewarm=function(){fr().acquire($r)},x.setMaxParallelImageRequests=function(h){c.a.MAX_PARALLEL_IMAGE_REQUESTS=h},x.setRTLTextPlugin=function(h,e){return Cr().setRTLTextPlugin(h,e)},x.setWorkerCount=function(h){Vi.workerCount=h},x.setWorkerUrl=function(h){c.a.WORKER_URL=h}});var q=D;return q})}(ih)),ih.exports}var gg=mg();const qs=pg(gg);var Hc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tf(O){return O&&O.__esModule&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O}var jl={exports:{}};jl.exports;var Lp;function _g(){return Lp||(Lp=1,function(O,C){var D=200,N="__lodash_hash_undefined__",L=1,q=2,x=9007199254740991,c="[object Arguments]",me="[object Array]",Ze="[object AsyncFunction]",Ue="[object Boolean]",He="[object Date]",Le="[object Error]",ne="[object Function]",Re="[object GeneratorFunction]",st="[object Map]",ft="[object Number]",zt="[object Null]",Dt="[object Object]",Tt="[object Promise]",Ce="[object Proxy]",be="[object RegExp]",ke="[object Set]",he="[object String]",ge="[object Symbol]",Ae="[object Undefined]",Oe="[object WeakMap]",Ye="[object ArrayBuffer]",rt="[object DataView]",ut="[object Float32Array]",St="[object Float64Array]",Mi="[object Int8Array]",Ht="[object Int16Array]",Ti="[object Int32Array]",yt="[object Uint8Array]",xr="[object Uint8ClampedArray]",wr="[object Uint16Array]",$r="[object Uint32Array]",Vi=/[\\^$.*+?()[\]{}|]/g,mn=/^\[object .+?Constructor\]$/,pr=/^(?:0|[1-9]\d*)$/,xt={};xt[ut]=xt[St]=xt[Mi]=xt[Ht]=xt[Ti]=xt[yt]=xt[xr]=xt[wr]=xt[$r]=!0,xt[c]=xt[me]=xt[Ye]=xt[Ue]=xt[rt]=xt[He]=xt[Le]=xt[ne]=xt[st]=xt[ft]=xt[Dt]=xt[be]=xt[ke]=xt[he]=xt[Oe]=!1;var fr=typeof Hc=="object"&&Hc&&Hc.Object===Object&&Hc,Bt=typeof self=="object"&&self&&self.Object===Object&&self,ni=fr||Bt||Function("return this")(),rr=C&&!C.nodeType&&C,qr=rr&&!0&&O&&!O.nodeType&&O,nr=qr&&qr.exports===rr,Ki=nr&&fr.process,Zi=function(){try{return Ki&&Ki.binding&&Ki.binding("util")}catch{}}(),Gt=Zi&&Zi.isTypedArray;function Dr($,de){for(var Fe=-1,et=$==null?0:$.length,$t=0,vt=[];++Fe<et;){var qt=$[Fe];de(qt,Fe,$)&&(vt[$t++]=qt)}return vt}function an($,de){for(var Fe=-1,et=de.length,$t=$.length;++Fe<et;)$[$t+Fe]=de[Fe];return $}function Tr($,de){for(var Fe=-1,et=$==null?0:$.length;++Fe<et;)if(de($[Fe],Fe,$))return!0;return!1}function es($,de){for(var Fe=-1,et=Array($);++Fe<$;)et[Fe]=de(Fe);return et}function ts($){return function(de){return $(de)}}function mr($,de){return $.has(de)}function Br($,de){return $==null?void 0:$[de]}function gn($){var de=-1,Fe=Array($.size);return $.forEach(function(et,$t){Fe[++de]=[$t,et]}),Fe}function _n($,de){return function(Fe){return $(de(Fe))}}function Hr($){var de=-1,Fe=Array($.size);return $.forEach(function(et){Fe[++de]=et}),Fe}var Ln=Array.prototype,Rn=Function.prototype,Wr=Object.prototype,Cr=ni["__core-js_shared__"],Fr=Rn.toString,Li=Wr.hasOwnProperty,yn=function(){var $=/[^.]+$/.exec(Cr&&Cr.keys&&Cr.keys.IE_PROTO||"");return $?"Symbol(src)_1."+$:""}(),gr=Wr.toString,sr=RegExp("^"+Fr.call(Li).replace(Vi,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mr=nr?ni.Buffer:void 0,ue=ni.Symbol,F=ni.Uint8Array,j=Wr.propertyIsEnumerable,G=Ln.splice,Y=ue?ue.toStringTag:void 0,oe=Object.getOwnPropertySymbols,U=Mr?Mr.isBuffer:void 0,ye=_n(Object.keys,Object),ce=yi(ni,"DataView"),fe=yi(ni,"Map"),xe=yi(ni,"Promise"),pe=yi(ni,"Set"),De=yi(ni,"WeakMap"),qe=yi(Object,"create"),Xe=vi(ce),at=vi(fe),gt=vi(xe),pt=vi(pe),Me=vi(De),Ft=ue?ue.prototype:void 0,Ct=Ft?Ft.valueOf:void 0;function Mt($){var de=-1,Fe=$==null?0:$.length;for(this.clear();++de<Fe;){var et=$[de];this.set(et[0],et[1])}}function dt(){this.__data__=qe?qe(null):{},this.size=0}function Be($){var de=this.has($)&&delete this.__data__[$];return this.size-=de?1:0,de}function lt($){var de=this.__data__;if(qe){var Fe=de[$];return Fe===N?void 0:Fe}return Li.call(de,$)?de[$]:void 0}function _t($){var de=this.__data__;return qe?de[$]!==void 0:Li.call(de,$)}function si($,de){var Fe=this.__data__;return this.size+=this.has($)?0:1,Fe[$]=qe&&de===void 0?N:de,this}Mt.prototype.clear=dt,Mt.prototype.delete=Be,Mt.prototype.get=lt,Mt.prototype.has=_t,Mt.prototype.set=si;function Vt($){var de=-1,Fe=$==null?0:$.length;for(this.clear();++de<Fe;){var et=$[de];this.set(et[0],et[1])}}function ar(){this.__data__=[],this.size=0}function bt($){var de=this.__data__,Fe=bs(de,$);if(Fe<0)return!1;var et=de.length-1;return Fe==et?de.pop():G.call(de,Fe,1),--this.size,!0}function Dn($){var de=this.__data__,Fe=bs(de,$);return Fe<0?void 0:de[Fe][1]}function is($){return bs(this.__data__,$)>-1}function vn($,de){var Fe=this.__data__,et=bs(Fe,$);return et<0?(++this.size,Fe.push([$,de])):Fe[et][1]=de,this}Vt.prototype.clear=ar,Vt.prototype.delete=bt,Vt.prototype.get=Dn,Vt.prototype.has=is,Vt.prototype.set=vn;function Pr($){var de=-1,Fe=$==null?0:$.length;for(this.clear();++de<Fe;){var et=$[de];this.set(et[0],et[1])}}function Kr(){this.size=0,this.__data__={hash:new Mt,map:new(fe||Vt),string:new Mt}}function bn($){var de=jn(this,$).delete($);return this.size-=de?1:0,de}function fi($){return jn(this,$).get($)}function _r($){return jn(this,$).has($)}function Jt($,de){var Fe=jn(this,$),et=Fe.size;return Fe.set($,de),this.size+=Fe.size==et?0:1,this}Pr.prototype.clear=Kr,Pr.prototype.delete=bn,Pr.prototype.get=fi,Pr.prototype.has=_r,Pr.prototype.set=Jt;function on($){var de=-1,Fe=$==null?0:$.length;for(this.__data__=new Pr;++de<Fe;)this.add($[de])}function Bn($){return this.__data__.set($,N),this}function Hs($){return this.__data__.has($)}on.prototype.add=on.prototype.push=Bn,on.prototype.has=Hs;function or($){var de=this.__data__=new Vt($);this.size=de.size}function Xr(){this.__data__=new Vt,this.size=0}function Ea($){var de=this.__data__,Fe=de.delete($);return this.size=de.size,Fe}function Ws($){return this.__data__.get($)}function Aa($){return this.__data__.has($)}function Fn($,de){var Fe=this.__data__;if(Fe instanceof Vt){var et=Fe.__data__;if(!fe||et.length<D-1)return et.push([$,de]),this.size=++Fe.size,this;Fe=this.__data__=new Pr(et)}return Fe.set($,de),this.size=Fe.size,this}or.prototype.clear=Xr,or.prototype.delete=Ea,or.prototype.get=Ws,or.prototype.has=Aa,or.prototype.set=Fn;function ka($,de){var Fe=bi($),et=!Fe&&mi($),$t=!Fe&&!et&&ln($),vt=!Fe&&!et&&!$t&&ei($),qt=Fe||et||$t||vt,oi=qt?es($.length,String):[],Si=oi.length;for(var Kt in $)Li.call($,Kt)&&!(qt&&(Kt=="length"||$t&&(Kt=="offset"||Kt=="parent")||vt&&(Kt=="buffer"||Kt=="byteLength"||Kt=="byteOffset")||Tn(Kt,Si)))&&oi.push(Kt);return oi}function bs($,de){for(var Fe=$.length;Fe--;)if(Pi($[Fe][0],de))return Fe;return-1}function ko($,de,Fe){var et=de($);return bi($)?et:an(et,Fe($))}function rs($){return $==null?$===void 0?Ae:zt:Y&&Y in Object($)?Lt($):Vn($)}function Ks($){return Ot($)&&rs($)==c}function xs($,de,Fe,et,$t){return $===de?!0:$==null||de==null||!Ot($)&&!Ot(de)?$!==$&&de!==de:xn($,de,Fe,et,xs,$t)}function xn($,de,Fe,et,$t,vt){var qt=bi($),oi=bi(de),Si=qt?me:ai($),Kt=oi?me:ai(de);Si=Si==c?Dt:Si,Kt=Kt==c?Dt:Kt;var Ri=Si==Dt,Di=Kt==Dt,jt=Si==Kt;if(jt&&ln($)){if(!ln(de))return!1;qt=!0,Ri=!1}if(jt&&!Ri)return vt||(vt=new or),qt||ei($)?ws($,de,Fe,et,$t,vt):zo($,de,Si,Fe,et,$t,vt);if(!(Fe&L)){var Ii=Ri&&Li.call($,"__wrapped__"),Ui=Di&&Li.call(de,"__wrapped__");if(Ii||Ui){var Ji=Ii?$.value():$,Xt=Ui?de.value():de;return vt||(vt=new or),$t(Ji,Xt,Fe,et,vt)}}return jt?(vt||(vt=new or),ns($,de,Fe,et,$t,vt)):!1}function Xs($){if(!Zn($)||ss($))return!1;var de=lr($)?sr:mn;return de.test(vi($))}function za($){return Ot($)&&Yi($.length)&&!!xt[rs($)]}function wn($){if(!as($))return ye($);var de=[];for(var Fe in Object($))Li.call($,Fe)&&Fe!="constructor"&&de.push(Fe);return de}function ws($,de,Fe,et,$t,vt){var qt=Fe&L,oi=$.length,Si=de.length;if(oi!=Si&&!(qt&&Si>oi))return!1;var Kt=vt.get($);if(Kt&&vt.get(de))return Kt==de;var Ri=-1,Di=!0,jt=Fe&q?new on:void 0;for(vt.set($,de),vt.set(de,$);++Ri<oi;){var Ii=$[Ri],Ui=de[Ri];if(et)var Ji=qt?et(Ui,Ii,Ri,de,$,vt):et(Ii,Ui,Ri,$,de,vt);if(Ji!==void 0){if(Ji)continue;Di=!1;break}if(jt){if(!Tr(de,function(Xt,Or){if(!mr(jt,Or)&&(Ii===Xt||$t(Ii,Xt,Fe,et,vt)))return jt.push(Or)})){Di=!1;break}}else if(!(Ii===Ui||$t(Ii,Ui,Fe,et,vt))){Di=!1;break}}return vt.delete($),vt.delete(de),Di}function zo($,de,Fe,et,$t,vt,qt){switch(Fe){case rt:if($.byteLength!=de.byteLength||$.byteOffset!=de.byteOffset)return!1;$=$.buffer,de=de.buffer;case Ye:return!($.byteLength!=de.byteLength||!vt(new F($),new F(de)));case Ue:case He:case ft:return Pi(+$,+de);case Le:return $.name==de.name&&$.message==de.message;case be:case he:return $==de+"";case st:var oi=gn;case ke:var Si=et&L;if(oi||(oi=Hr),$.size!=de.size&&!Si)return!1;var Kt=qt.get($);if(Kt)return Kt==de;et|=q,qt.set($,de);var Ri=ws(oi($),oi(de),et,$t,vt,qt);return qt.delete($),Ri;case ge:if(Ct)return Ct.call($)==Ct.call(de)}return!1}function ns($,de,Fe,et,$t,vt){var qt=Fe&L,oi=On($),Si=oi.length,Kt=On(de),Ri=Kt.length;if(Si!=Ri&&!qt)return!1;for(var Di=Si;Di--;){var jt=oi[Di];if(!(qt?jt in de:Li.call(de,jt)))return!1}var Ii=vt.get($);if(Ii&&vt.get(de))return Ii==de;var Ui=!0;vt.set($,de),vt.set(de,$);for(var Ji=qt;++Di<Si;){jt=oi[Di];var Xt=$[jt],Or=de[jt];if(et)var os=qt?et(Or,Xt,jt,de,$,vt):et(Xt,Or,jt,$,de,vt);if(!(os===void 0?Xt===Or||$t(Xt,Or,Fe,et,vt):os)){Ui=!1;break}Ji||(Ji=jt=="constructor")}if(Ui&&!Ji){var ls=$.constructor,Ts=de.constructor;ls!=Ts&&"constructor"in $&&"constructor"in de&&!(typeof ls=="function"&&ls instanceof ls&&typeof Ts=="function"&&Ts instanceof Ts)&&(Ui=!1)}return vt.delete($),vt.delete(de),Ui}function On($){return ko($,It,Nn)}function jn($,de){var Fe=$.__data__;return Pt(de)?Fe[typeof de=="string"?"string":"hash"]:Fe.map}function yi($,de){var Fe=Br($,de);return Xs(Fe)?Fe:void 0}function Lt($){var de=Li.call($,Y),Fe=$[Y];try{$[Y]=void 0;var et=!0}catch{}var $t=gr.call($);return et&&(de?$[Y]=Fe:delete $[Y]),$t}var Nn=oe?function($){return $==null?[]:($=Object($),Dr(oe($),function(de){return j.call($,de)}))}:mt,ai=rs;(ce&&ai(new ce(new ArrayBuffer(1)))!=rt||fe&&ai(new fe)!=st||xe&&ai(xe.resolve())!=Tt||pe&&ai(new pe)!=ke||De&&ai(new De)!=Oe)&&(ai=function($){var de=rs($),Fe=de==Dt?$.constructor:void 0,et=Fe?vi(Fe):"";if(et)switch(et){case Xe:return rt;case at:return st;case gt:return Tt;case pt:return ke;case Me:return Oe}return de});function Tn($,de){return de=de??x,!!de&&(typeof $=="number"||pr.test($))&&$>-1&&$%1==0&&$<de}function Pt($){var de=typeof $;return de=="string"||de=="number"||de=="symbol"||de=="boolean"?$!=="__proto__":$===null}function ss($){return!!yn&&yn in $}function as($){var de=$&&$.constructor,Fe=typeof de=="function"&&de.prototype||Wr;return $===Fe}function Vn($){return gr.call($)}function vi($){if($!=null){try{return Fr.call($)}catch{}try{return $+""}catch{}}return""}function Pi($,de){return $===de||$!==$&&de!==de}var mi=Ks(function(){return arguments}())?Ks:function($){return Ot($)&&Li.call($,"callee")&&!j.call($,"callee")},bi=Array.isArray;function Wt($){return $!=null&&Yi($.length)&&!lr($)}var ln=U||Un;function Xi($,de){return xs($,de)}function lr($){if(!Zn($))return!1;var de=rs($);return de==ne||de==Re||de==Ze||de==Ce}function Yi($){return typeof $=="number"&&$>-1&&$%1==0&&$<=x}function Zn($){var de=typeof $;return $!=null&&(de=="object"||de=="function")}function Ot($){return $!=null&&typeof $=="object"}var ei=Gt?ts(Gt):za;function It($){return Wt($)?ka($):wn($)}function mt(){return[]}function Un(){return!1}O.exports=Xi}(jl,jl.exports)),jl.exports}var yg=_g(),vg=Tf(yg);function Ou(O,C,D){const N={id:[C,D,"circle"].join("_"),source:C,type:"circle",paint:{"circle-color":O,"circle-radius":2},filter:["==","$type","Point"]};return D&&(N["source-layer"]=D),N}function ju(O,C,D,N){const L={id:[D,N,"polygon"].join("_"),source:D,type:"fill",paint:{"fill-color":O,"fill-antialias":!0,"fill-outline-color":O},filter:["==","$type","Polygon"]};return N&&(L["source-layer"]=N),L}function Nu(O,C,D){const N={id:[C,D,"line"].join("_"),source:C,layout:{"line-join":"round","line-cap":"round"},type:"line",paint:{"line-color":O},filter:["==","$type","LineString"]};return D&&(N["source-layer"]=D),N}function bg(O,C){const D=[],N=[],L=[];function q(x){return{circle:C(x,.8),line:C(x,.6),polygon:C(x,.3),polygonOutline:C(x,.6),default:C(x,1)}}return Object.keys(O).forEach(x=>{const c=O[x];if(!c||c.length===0){const me=q(x);N.push(Ou(me.circle,x)),L.push(Nu(me.line,x)),D.push(ju(me.polygon,me.polygonOutline,x))}else c.forEach(me=>{const Ze=q(me);N.push(Ou(Ze.circle,x,me)),L.push(Nu(Ze.line,x,me)),D.push(ju(Ze.polygon,Ze.polygonOutline,x,me))})}),D.concat(L).concat(N)}function xg(O,C,D){D=Object.assign({backgroundColor:"#fff"},D);const N={id:"background",type:"background",paint:{"background-color":D.backgroundColor}},L={};return Object.keys(O.sources).forEach(q=>{const x=O.sources[q];(x.type==="vector"||x.type==="geojson")&&(L[q]=x)}),Object.assign(O,{layers:[N].concat(C),sources:L})}var Rp={polygonLayer:ju,lineLayer:Nu,circleLayer:Ou,generateInspectStyle:xg,generateColoredLayers:bg};class wg{constructor(C){C=Object.assign({show:!0,onToggle(){}},C),this._btn=this.createButton(),this._btn.onclick=C.onToggle,this.elem=this.createContainer(this._btn,C.show)}createButton(){const C=document.createElement("button");return C.className="maplibregl-ctrl-icon maplibregl-ctrl-inspect",C.type="button",C.title="Toggle Inspect",C.setAttribute("aria-label","Toggle Inspect"),C}createContainer(C,D){const N=document.createElement("div");return N.className="maplibregl-ctrl maplibregl-ctrl-group",N.appendChild(C),D||(N.style.display="none"),N}setInspectIcon(){this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-inspect"}setMapIcon(){this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-map"}}function Tg(O){return typeof O>"u"||O===null?O:O instanceof Date?O.toLocaleString():typeof O=="object"||typeof O=="number"||typeof O=="string"?O.toString():O}function yu(O,C){return`<div class="maplibregl-inspect_property"><div class="maplibregl-inspect_property-name">${O}</div><div class="maplibregl-inspect_property-value">${Tg(C)}</div></div>`}function Sg(O){return`<div class="maplibregl-inspect_layer">${O}</div>`}function Cg(O){const C=Sg(O.layer["source-layer"]||O.layer.source),D=yu("$id",O.id),N=yu("$type",O.geometry.type),L=Object.keys(O.properties).map(q=>yu(q,O.properties[q]));return[C,D,N].concat(L).join("")}function Mg(O){return O.map(C=>`<div class="maplibregl-inspect_feature">${Cg(C)}</div>`).join("")}function Pg(O){return`<div class="maplibregl-inspect_popup">${Mg(O)}</div>`}var Nl={exports:{}},Ig=Nl.exports,Dp;function Eg(){return Dp||(Dp=1,function(O,C){(function(D,N){{var L=N();O.exports&&(C=O.exports=L),C.randomColor=L}})(Ig,function(){var D=null,N={};zt();var L=[],q=function(he){if(he=he||{},he.seed!==void 0&&he.seed!==null&&he.seed===parseInt(he.seed,10))D=he.seed;else if(typeof he.seed=="string")D=be(he.seed);else{if(he.seed!==void 0&&he.seed!==null)throw new TypeError("The seed value must be an integer or string");D=null}var ge,Ae,Oe;if(he.count!==null&&he.count!==void 0){for(var Ye=he.count,rt=[],ut=0;ut<he.count;ut++)L.push(!1);for(he.count=null;Ye>rt.length;){var St=q(he);D!==null&&(he.seed=D),rt.push(St)}return he.count=Ye,rt}return ge=x(he),Ae=c(ge,he),Oe=me(ge,Ae,he),Ze([ge,Ae,Oe],he)};function x(he){if(L.length>0){var ge=ke(he.hue),Ae=Re(ge),Oe=(ge[1]-ge[0])/L.length,Ye=parseInt((Ae-ge[0])/Oe);L[Ye]===!0?Ye=(Ye+2)%L.length:L[Ye]=!0;var rt=(ge[0]+Ye*Oe)%359,ut=(ge[0]+(Ye+1)*Oe)%359;return ge=[rt,ut],Ae=Re(ge),Ae<0&&(Ae=360+Ae),Ae}else{var ge=He(he.hue);return Ae=Re(ge),Ae<0&&(Ae=360+Ae),Ae}}function c(he,ge){if(ge.hue==="monochrome")return 0;if(ge.luminosity==="random")return Re([0,100]);var Ae=Le(he),Oe=Ae[0],Ye=Ae[1];switch(ge.luminosity){case"bright":Oe=55;break;case"dark":Oe=Ye-10;break;case"light":Ye=55;break}return Re([Oe,Ye])}function me(he,ge,Ae){var Oe=Ue(he,ge),Ye=100;switch(Ae.luminosity){case"dark":Ye=Oe+20;break;case"light":Oe=(Ye+Oe)/2;break;case"random":Oe=0,Ye=100;break}return Re([Oe,Ye])}function Ze(he,ge){switch(ge.format){case"hsvArray":return he;case"hslArray":return Ce(he);case"hsl":var Ae=Ce(he);return"hsl("+Ae[0]+", "+Ae[1]+"%, "+Ae[2]+"%)";case"hsla":var Oe=Ce(he),ut=ge.alpha||Math.random();return"hsla("+Oe[0]+", "+Oe[1]+"%, "+Oe[2]+"%, "+ut+")";case"rgbArray":return Dt(he);case"rgb":var Ye=Dt(he);return"rgb("+Ye.join(", ")+")";case"rgba":var rt=Dt(he),ut=ge.alpha||Math.random();return"rgba("+rt.join(", ")+", "+ut+")";default:return st(he)}}function Ue(he,ge){for(var Ae=ne(he).lowerBounds,Oe=0;Oe<Ae.length-1;Oe++){var Ye=Ae[Oe][0],rt=Ae[Oe][1],ut=Ae[Oe+1][0],St=Ae[Oe+1][1];if(ge>=Ye&&ge<=ut){var Mi=(St-rt)/(ut-Ye),Ht=rt-Mi*Ye;return Mi*ge+Ht}}return 0}function He(he){if(typeof parseInt(he)=="number"){var ge=parseInt(he);if(ge<360&&ge>0)return[ge,ge]}if(typeof he=="string"){if(N[he]){var Ae=N[he];if(Ae.hueRange)return Ae.hueRange}else if(he.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var Oe=Tt(he)[0];return[Oe,Oe]}}return[0,360]}function Le(he){return ne(he).saturationRange}function ne(he){he>=334&&he<=360&&(he-=360);for(var ge in N){var Ae=N[ge];if(Ae.hueRange&&he>=Ae.hueRange[0]&&he<=Ae.hueRange[1])return N[ge]}return"Color not found"}function Re(he){if(D===null){var ge=.618033988749895,Ae=Math.random();return Ae+=ge,Ae%=1,Math.floor(he[0]+Ae*(he[1]+1-he[0]))}else{var Oe=he[1]||1,Ye=he[0]||0;D=(D*9301+49297)%233280;var rt=D/233280;return Math.floor(Ye+rt*(Oe-Ye))}}function st(he){var ge=Dt(he);function Ae(Ye){var rt=Ye.toString(16);return rt.length==1?"0"+rt:rt}var Oe="#"+Ae(ge[0])+Ae(ge[1])+Ae(ge[2]);return Oe}function ft(he,ge,Ae){var Oe=Ae[0][0],Ye=Ae[Ae.length-1][0],rt=Ae[Ae.length-1][1],ut=Ae[0][1];N[he]={hueRange:ge,lowerBounds:Ae,saturationRange:[Oe,Ye],brightnessRange:[rt,ut]}}function zt(){ft("monochrome",null,[[0,0],[100,0]]),ft("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),ft("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),ft("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),ft("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),ft("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),ft("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),ft("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function Dt(he){var ge=he[0];ge===0&&(ge=1),ge===360&&(ge=359),ge=ge/360;var Ae=he[1]/100,Oe=he[2]/100,Ye=Math.floor(ge*6),rt=ge*6-Ye,ut=Oe*(1-Ae),St=Oe*(1-rt*Ae),Mi=Oe*(1-(1-rt)*Ae),Ht=256,Ti=256,yt=256;switch(Ye){case 0:Ht=Oe,Ti=Mi,yt=ut;break;case 1:Ht=St,Ti=Oe,yt=ut;break;case 2:Ht=ut,Ti=Oe,yt=Mi;break;case 3:Ht=ut,Ti=St,yt=Oe;break;case 4:Ht=Mi,Ti=ut,yt=Oe;break;case 5:Ht=Oe,Ti=ut,yt=St;break}var xr=[Math.floor(Ht*255),Math.floor(Ti*255),Math.floor(yt*255)];return xr}function Tt(he){he=he.replace(/^#/,""),he=he.length===3?he.replace(/(.)/g,"$1$1"):he;var ge=parseInt(he.substr(0,2),16)/255,Ae=parseInt(he.substr(2,2),16)/255,Oe=parseInt(he.substr(4,2),16)/255,Ye=Math.max(ge,Ae,Oe),rt=Ye-Math.min(ge,Ae,Oe),ut=Ye?rt/Ye:0;switch(Ye){case ge:return[60*((Ae-Oe)/rt%6)||0,ut,Ye];case Ae:return[60*((Oe-ge)/rt+2)||0,ut,Ye];case Oe:return[60*((ge-Ae)/rt+4)||0,ut,Ye]}}function Ce(he){var ge=he[0],Ae=he[1]/100,Oe=he[2]/100,Ye=(2-Ae)*Oe;return[ge,Math.round(Ae*Oe/(Ye<1?Ye:2-Ye)*1e4)/100,Ye/2*100]}function be(he){for(var ge=0,Ae=0;Ae!==he.length&&!(ge>=Number.MAX_SAFE_INTEGER);Ae++)ge+=he.charCodeAt(Ae);return ge}function ke(he){if(isNaN(he)){if(typeof he=="string"){if(N[he]){var Ae=N[he];if(Ae.hueRange)return Ae.hueRange}else if(he.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var Oe=Tt(he)[0];return ne(Oe).hueRange}}}else{var ge=parseInt(he);if(ge<360&&ge>0)return ne(he).hueRange}return[0,360]}return q})}(Nl,Nl.exports)),Nl.exports}var Ag=Eg(),kg=Tf(Ag);function zg(O,C){let D="bright",N;return/water|ocean|lake|sea|river/.test(O)&&(N="blue"),/state|country|place/.test(O)&&(N="pink"),/road|highway|transport|streets/.test(O)&&(N="orange"),/contour|building|earth/.test(O)&&(N="monochrome"),/building/.test(O)&&(D="dark"),/earth/.test(O)&&(D="light"),/contour|landuse/.test(O)&&(N="yellow"),/wood|forest|park|landcover|land|natural/.test(O)&&(N="green"),`rgba(${kg({luminosity:D,hue:N,seed:O,format:"rgbArray"}).join(", ")}, ${C||"1"})`}var Lg={brightColor:zg};function Rg(O){return O.metadata&&O.metadata["maplibregl-inspect:inspect"]}function Dg(O){return Object.assign(O,{metadata:Object.assign({},O.metadata,{"maplibregl-inspect:inspect":!0})})}class $u{constructor(C){if(this._onSourceChange=N=>{if(N.sourceDataType==="visibility"||!N.isSourceLoaded)return;const L=Object.assign({},this.sources);this._setSourcesFromMap(),!vg(L,this.sources)&&Object.keys(this.sources).length>0&&setTimeout(()=>this.render(),1e3)},this._onStyleChange=()=>{const N=this._map.getStyle();Rg(N)||(this._originalStyle=N)},this._onRightClick=()=>{!this.options.showMapPopupOnHover&&!this.options.showInspectMapPopupOnHover&&!this.options.blockHoverPopupOnClick&&this._popup&&this._popup.remove()},this._onMousemove=N=>{if(this._showInspectMap){if(!this.options.showInspectMapPopup||N.type==="mousemove"&&!this.options.showInspectMapPopupOnHover)return;N.type==="click"&&this.options.showInspectMapPopupOnHover&&this.options.blockHoverPopupOnClick&&(this._popupBlocked=!this._popupBlocked)}else{if(!this.options.showMapPopup||N.type==="mousemove"&&!this.options.showMapPopupOnHover)return;N.type==="click"&&this.options.showMapPopupOnHover&&this.options.blockHoverPopupOnClick&&(this._popupBlocked=!this._popupBlocked)}if(!this._popupBlocked&&this._popup){let L;this.options.selectThreshold===0?L=N.point:L=[[N.point.x-this.options.selectThreshold,N.point.y+this.options.selectThreshold],[N.point.x+this.options.selectThreshold,N.point.y-this.options.selectThreshold]];const q=this._map.queryRenderedFeatures(L,this.options.queryParameters)||[];if(this._map.getCanvas().style.cursor=q.length?"pointer":"",!q.length)this._popup.remove();else{this._popup.setLngLat(N.lngLat);const x=this.options.renderPopup(q);typeof x=="string"?this._popup.setHTML(x):this._popup.setDOMContent(x),this._popup.addTo(this._map)}}},!(this instanceof $u))throw new Error("MaplibreInspect needs to be called with the new keyword");let D=null;window.maplibregl?D=new window.maplibregl.Popup({closeButton:!1,closeOnClick:!1}):C.popup||console.error("Maplibre GL JS can not be found. Make sure to include it or pass an initialized MaplibreGL Popup to MaplibreInspect if you are using moduleis."),this.options=Object.assign({showInspectMap:!1,showInspectButton:!0,showInspectMapPopup:!0,showMapPopup:!1,showMapPopupOnHover:!0,showInspectMapPopupOnHover:!0,blockHoverPopupOnClick:!1,backgroundColor:"#fff",assignLayerColor:Lg.brightColor,buildInspectStyle:Rp.generateInspectStyle,renderPopup:Pg,popup:D,selectThreshold:5,useInspectStyle:!0,queryParameters:{},sources:{},toggleCallback(){},manageStyleOutside:!1},C),this.sources=this.options.sources,this.assignLayerColor=this.options.assignLayerColor,this._popup=this.options.popup,this._popupBlocked=!1,this._showInspectMap=this.options.showInspectMap,this._toggle=new wg({show:this.options.showInspectButton,onToggle:()=>this.toggleInspector()})}toggleInspector(){this._showInspectMap=!this._showInspectMap,this._popupBlocked=!1,this.options.toggleCallback(this._showInspectMap),this.render()}_inspectStyle(){const C=Rp.generateColoredLayers(this.sources,this.assignLayerColor);return this.options.buildInspectStyle(this._map.getStyle(),C,{backgroundColor:this.options.backgroundColor})}render(){this._showInspectMap?(this.options.useInspectStyle&&this._map.setStyle(Dg(this._inspectStyle())),this._toggle.setMapIcon()):this._originalStyle&&(this._popup&&this._popup.remove(),this.options.useInspectStyle&&this._map.setStyle(this._originalStyle),this._toggle.setInspectIcon())}_setSourcesFromMap(){const C=Object.keys(this._map.getStyle().sources);Object.keys(this._map.style.sourceCaches).forEach(D=>{const N=this._map.style.sourceCaches[D]||{_source:{}},L=N._source.vectorLayerIds;L?this.sources[D]=L:N._source.type==="geojson"&&(this.sources[D]=[])}),Object.keys(this.sources).forEach(D=>{C.indexOf(D)===-1&&delete this.sources[D]})}setOriginalStyle(C){this._originalStyle=C,this._setSourcesFromMap()}onAdd(C){return this._map=C,Object.keys(this.sources).length===0&&(C.on("tiledata",this._onSourceChange),C.on("sourcedata",this._onSourceChange)),C.on("styledata",this._onStyleChange),C.on("load",this._onStyleChange),C.on("mousemove",this._onMousemove),C.on("click",this._onMousemove),C.on("contextmenu",this._onRightClick),this._toggle.elem}onRemove(){this._map.off("styledata",this._onStyleChange),this._map.off("load",this._onStyleChange),this._map.off("tiledata",this._onSourceChange),this._map.off("sourcedata",this._onSourceChange),this._map.off("mousemove",this._onMousemove),this._map.off("click",this._onMousemove),this._map.off("contextmenu",this._onRightClick);const C=this._toggle.elem;C.parentNode.removeChild(C),this._map=void 0}}function vu(O,C,D,N){function L(q){return q instanceof D?q:new D(function(x){x(q)})}return new(D||(D=Promise))(function(q,x){function c(Ue){try{Ze(N.next(Ue))}catch(He){x(He)}}function me(Ue){try{Ze(N.throw(Ue))}catch(He){x(He)}}function Ze(Ue){Ue.done?q(Ue.value):L(Ue.value).then(c,me)}Ze((N=N.apply(O,C||[])).next())})}var Wc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nh(O){return O&&O.__esModule&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O}var bu,Bp;function Sf(){if(Bp)return bu;Bp=1,bu=C;var O=Object.prototype.hasOwnProperty;function C(){for(var D={},N=0;N<arguments.length;N++){var L=arguments[N];for(var q in L)O.call(L,q)&&(D[q]=L[q])}return D}return bu}var xu={exports:{}},Fp;function Bg(){return Fp||(Fp=1,function(O,C){(function(){var D={};O.exports=D,D.simpleFilter=function(N,L){return L.filter(function(q){return D.test(N,q)})},D.test=function(N,L){return D.match(N,L)!==null},D.match=function(N,L,q){q=q||{};var x=0,c=[],me=L.length,Ze=0,Ue=0,He=q.pre||"",Le=q.post||"",ne=q.caseSensitive&&L||L.toLowerCase(),Re;N=q.caseSensitive&&N||N.toLowerCase();for(var st=0;st<me;st++)Re=L[st],ne[st]===N[x]?(Re=He+Re+Le,x+=1,Ue+=1+Ue):Ue=0,Ze+=Ue,c[c.length]=Re;return x===N.length?(Ze=ne===N?1/0:Ze,{rendered:c.join(""),score:Ze}):null},D.filter=function(N,L,q){return!L||L.length===0?[]:typeof N!="string"?L:(q=q||{},L.reduce(function(x,c,me,Ze){var Ue=c;q.extract&&(Ue=q.extract(c));var He=D.match(N,Ue,q);return He!=null&&(x[x.length]={string:He.rendered,score:He.score,index:me,original:c}),x},[]).sort(function(x,c){var me=c.score-x.score;return me||x.index-c.index}))}})()}(xu)),xu.exports}var wu,Op;function Fg(){if(Op)return wu;Op=1;var O=function(C){return this.component=C,this.items=[],this.active=C.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,C.el.parentNode.insertBefore(this.wrapper,C.el.nextSibling),this};return O.prototype.show=function(){this.element.style.display="block"},O.prototype.hide=function(){this.element.style.display="none"},O.prototype.add=function(C){this.items.push(C)},O.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},O.prototype.isEmpty=function(){return!this.items.length},O.prototype.isVisible=function(){return this.element.style.display==="block"},O.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var C=0;C<this.items.length;C++)this.drawItem(this.items[C],this.active===C);this.show()},O.prototype.drawItem=function(C,D){var N=document.createElement("li"),L=document.createElement("a");D&&(N.className+=" active"),L.innerHTML=C.string,N.appendChild(L),this.element.appendChild(N),N.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),N.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,C)}).bind(this))},O.prototype.handleMouseUp=function(C){this.selectingListItem=!1,this.component.value(C.original),this.clear(),this.draw()},O.prototype.move=function(C){this.active=C,this.draw()},O.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},O.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},O.prototype.drawError=function(C){var D=document.createElement("li");D.innerHTML=C,this.element.appendChild(D),this.show()},wu=O,wu}var Tu,jp;function Og(){if(jp)return Tu;jp=1;var O=Sf(),C=Bg(),D=Fg(),N=function(L,q,x){return x=x||{},this.options=O({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},x),this.el=L,this.data=q||[],this.list=new D(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(c){this.handleKeyUp(c.keyCode,c)}).bind(this),!1),this.el.addEventListener("keydown",(function(c){this.handleKeyDown(c)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(c){this.handlePaste(c)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return N.prototype.handleKeyUp=function(L,q){if(!(L===40||L===38||L===27||L===9)){if(L===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),q.stopPropagation());return}this.handleInputChange(this.el.value)}},N.prototype.handleKeyDown=function(L){switch(L.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&L.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},N.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},N.prototype.handlePaste=function(L){if(L.clipboardData)this.handleInputChange(L.clipboardData.getData("Text"));else{var q=this;setTimeout(function(){q.handleInputChange(L.target.value)},100)}},N.prototype.handleInputChange=function(L){if(this.query=this.normalize(L),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(q){for(var x=0;x<q.length&&(this.list.add(q[x]),x!==this.options.limit-1);x++);this.list.draw()}).bind(this))},N.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},N.prototype.update=function(L){this.data=L,this.handleKeyUp()},N.prototype.clear=function(){this.data=[],this.list.clear()},N.prototype.normalize=function(L){return L=L.toLowerCase(),L},N.prototype.match=function(L,q){return L.indexOf(q)>-1},N.prototype.value=function(L){if(this.selected=L,this.el.value=this.getItemValue(L||{place_name:this.query}),document.createEvent){var q=document.createEvent("HTMLEvents");q.initEvent("change",!0,!1),this.el.dispatchEvent(q)}else this.el.fireEvent("onchange")},N.prototype.getCandidates=function(L){var q={pre:"<strong>",post:"</strong>",extract:(function(c){return this.getItemValue(c)}).bind(this)},x;this.options.filter?(x=C.filter(this.query,this.data,q),x=x.map((function(c){return{original:c.original,string:this.render(c.original,c.string)}}).bind(this))):x=this.data.map((function(c){var me=this.render(c);return{original:c,string:me}}).bind(this)),L(x)},N.prototype.getItemValue=function(L){return L},N.prototype.render=function(L,q){if(q)return q;for(var x=L.original?this.getItemValue(L.original):this.getItemValue(L),c=this.normalize(x),me=c.lastIndexOf(this.query);me>-1;){var Ze=me+this.query.length;x=x.slice(0,me)+"<strong>"+x.slice(me,Ze)+"</strong>"+x.slice(Ze),me=c.slice(0,me).lastIndexOf(this.query)}return x},N.prototype.renderError=function(L){this.list.drawError(L)},Tu=N,Tu}var Su,Np;function jg(){if(Np)return Su;Np=1;var O=Og();return Su=O,typeof window<"u"&&(window.Suggestions=O),Su}var Ng=jg(),Vg=nh(Ng),rh={exports:{}},Zg=rh.exports,Vp;function Ug(){return Vp||(Vp=1,function(O){(function(C,D,N){O.exports?O.exports=N():C[D]=N()})(Zg,"subtag",function(){var C="",D=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function N(me){return me.match(D)||[]}function L(me){return N(me).filter(function(Ze,Ue){return Ze&&Ue})}function q(me){return me=N(me),{language:me[1]||C,extlang:me[2]||C,script:me[3]||C,region:me[4]||C}}function x(me,Ze,Ue){Object.defineProperty(me,Ze,{value:Ue,enumerable:!0})}function c(me,Ze,Ue){function He(Le){return N(Le)[me]||C}x(He,"pattern",Ze),x(q,Ue,He)}return c(1,/^[a-zA-Z]{2,3}$/,"language"),c(2,/^[a-zA-Z]{3}$/,"extlang"),c(3,/^[a-zA-Z]{4}$/,"script"),c(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),x(q,"split",L),q})}(rh)),rh.exports}var Gg=Ug(),$g=nh(Gg),Cu,Zp;function qg(){if(Zp)return Cu;Zp=1;var O="Expected a function",C=NaN,D="[object Symbol]",N=/^\s+|\s+$/g,L=/^[-+]0x[0-9a-f]+$/i,q=/^0b[01]+$/i,x=/^0o[0-7]+$/i,c=parseInt,me=typeof Wc=="object"&&Wc&&Wc.Object===Object&&Wc,Ze=typeof self=="object"&&self&&self.Object===Object&&self,Ue=me||Ze||Function("return this")(),He=Object.prototype,Le=He.toString,ne=Math.max,Re=Math.min,st=function(){return Ue.Date.now()};function ft(be,ke,he){var ge,Ae,Oe,Ye,rt,ut,St=0,Mi=!1,Ht=!1,Ti=!0;if(typeof be!="function")throw new TypeError(O);ke=Ce(ke)||0,zt(he)&&(Mi=!!he.leading,Ht="maxWait"in he,Oe=Ht?ne(Ce(he.maxWait)||0,ke):Oe,Ti="trailing"in he?!!he.trailing:Ti);function yt(Bt){var ni=ge,rr=Ae;return ge=Ae=void 0,St=Bt,Ye=be.apply(rr,ni),Ye}function xr(Bt){return St=Bt,rt=setTimeout(Vi,ke),Mi?yt(Bt):Ye}function wr(Bt){var ni=Bt-ut,rr=Bt-St,qr=ke-ni;return Ht?Re(qr,Oe-rr):qr}function $r(Bt){var ni=Bt-ut,rr=Bt-St;return ut===void 0||ni>=ke||ni<0||Ht&&rr>=Oe}function Vi(){var Bt=st();if($r(Bt))return mn(Bt);rt=setTimeout(Vi,wr(Bt))}function mn(Bt){return rt=void 0,Ti&&ge?yt(Bt):(ge=Ae=void 0,Ye)}function pr(){rt!==void 0&&clearTimeout(rt),St=0,ge=ut=Ae=rt=void 0}function xt(){return rt===void 0?Ye:mn(st())}function fr(){var Bt=st(),ni=$r(Bt);if(ge=arguments,Ae=this,ut=Bt,ni){if(rt===void 0)return xr(ut);if(Ht)return rt=setTimeout(Vi,ke),yt(ut)}return rt===void 0&&(rt=setTimeout(Vi,ke)),Ye}return fr.cancel=pr,fr.flush=xt,fr}function zt(be){var ke=typeof be;return!!be&&(ke=="object"||ke=="function")}function Dt(be){return!!be&&typeof be=="object"}function Tt(be){return typeof be=="symbol"||Dt(be)&&Le.call(be)==D}function Ce(be){if(typeof be=="number")return be;if(Tt(be))return C;if(zt(be)){var ke=typeof be.valueOf=="function"?be.valueOf():be;be=zt(ke)?ke+"":ke}if(typeof be!="string")return be===0?be:+be;be=be.replace(N,"");var he=q.test(be);return he||x.test(be)?c(be.slice(2),he?2:8):L.test(be)?C:+be}return Cu=ft,Cu}var Hg=qg(),Wg=nh(Hg),Kg=Sf(),zn=nh(Kg),Kc={exports:{}},Up;function Xg(){if(Up)return Kc.exports;Up=1;var O=typeof Reflect=="object"?Reflect:null,C=O&&typeof O.apply=="function"?O.apply:function(be,ke,he){return Function.prototype.apply.call(be,ke,he)},D;O&&typeof O.ownKeys=="function"?D=O.ownKeys:Object.getOwnPropertySymbols?D=function(be){return Object.getOwnPropertyNames(be).concat(Object.getOwnPropertySymbols(be))}:D=function(be){return Object.getOwnPropertyNames(be)};function N(Ce){console&&console.warn&&console.warn(Ce)}var L=Number.isNaN||function(be){return be!==be};function q(){q.init.call(this)}Kc.exports=q,Kc.exports.once=zt,q.EventEmitter=q,q.prototype._events=void 0,q.prototype._eventsCount=0,q.prototype._maxListeners=void 0;var x=10;function c(Ce){if(typeof Ce!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ce)}Object.defineProperty(q,"defaultMaxListeners",{enumerable:!0,get:function(){return x},set:function(Ce){if(typeof Ce!="number"||Ce<0||L(Ce))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ce+".");x=Ce}}),q.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},q.prototype.setMaxListeners=function(be){if(typeof be!="number"||be<0||L(be))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+be+".");return this._maxListeners=be,this};function me(Ce){return Ce._maxListeners===void 0?q.defaultMaxListeners:Ce._maxListeners}q.prototype.getMaxListeners=function(){return me(this)},q.prototype.emit=function(be){for(var ke=[],he=1;he<arguments.length;he++)ke.push(arguments[he]);var ge=be==="error",Ae=this._events;if(Ae!==void 0)ge=ge&&Ae.error===void 0;else if(!ge)return!1;if(ge){var Oe;if(ke.length>0&&(Oe=ke[0]),Oe instanceof Error)throw Oe;var Ye=new Error("Unhandled error."+(Oe?" ("+Oe.message+")":""));throw Ye.context=Oe,Ye}var rt=Ae[be];if(rt===void 0)return!1;if(typeof rt=="function")C(rt,this,ke);else for(var ut=rt.length,St=Re(rt,ut),he=0;he<ut;++he)C(St[he],this,ke);return!0};function Ze(Ce,be,ke,he){var ge,Ae,Oe;if(c(ke),Ae=Ce._events,Ae===void 0?(Ae=Ce._events=Object.create(null),Ce._eventsCount=0):(Ae.newListener!==void 0&&(Ce.emit("newListener",be,ke.listener?ke.listener:ke),Ae=Ce._events),Oe=Ae[be]),Oe===void 0)Oe=Ae[be]=ke,++Ce._eventsCount;else if(typeof Oe=="function"?Oe=Ae[be]=he?[ke,Oe]:[Oe,ke]:he?Oe.unshift(ke):Oe.push(ke),ge=me(Ce),ge>0&&Oe.length>ge&&!Oe.warned){Oe.warned=!0;var Ye=new Error("Possible EventEmitter memory leak detected. "+Oe.length+" "+String(be)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ye.name="MaxListenersExceededWarning",Ye.emitter=Ce,Ye.type=be,Ye.count=Oe.length,N(Ye)}return Ce}q.prototype.addListener=function(be,ke){return Ze(this,be,ke,!1)},q.prototype.on=q.prototype.addListener,q.prototype.prependListener=function(be,ke){return Ze(this,be,ke,!0)};function Ue(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function He(Ce,be,ke){var he={fired:!1,wrapFn:void 0,target:Ce,type:be,listener:ke},ge=Ue.bind(he);return ge.listener=ke,he.wrapFn=ge,ge}q.prototype.once=function(be,ke){return c(ke),this.on(be,He(this,be,ke)),this},q.prototype.prependOnceListener=function(be,ke){return c(ke),this.prependListener(be,He(this,be,ke)),this},q.prototype.removeListener=function(be,ke){var he,ge,Ae,Oe,Ye;if(c(ke),ge=this._events,ge===void 0)return this;if(he=ge[be],he===void 0)return this;if(he===ke||he.listener===ke)--this._eventsCount===0?this._events=Object.create(null):(delete ge[be],ge.removeListener&&this.emit("removeListener",be,he.listener||ke));else if(typeof he!="function"){for(Ae=-1,Oe=he.length-1;Oe>=0;Oe--)if(he[Oe]===ke||he[Oe].listener===ke){Ye=he[Oe].listener,Ae=Oe;break}if(Ae<0)return this;Ae===0?he.shift():st(he,Ae),he.length===1&&(ge[be]=he[0]),ge.removeListener!==void 0&&this.emit("removeListener",be,Ye||ke)}return this},q.prototype.off=q.prototype.removeListener,q.prototype.removeAllListeners=function(be){var ke,he,ge;if(he=this._events,he===void 0)return this;if(he.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):he[be]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete he[be]),this;if(arguments.length===0){var Ae=Object.keys(he),Oe;for(ge=0;ge<Ae.length;++ge)Oe=Ae[ge],Oe!=="removeListener"&&this.removeAllListeners(Oe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(ke=he[be],typeof ke=="function")this.removeListener(be,ke);else if(ke!==void 0)for(ge=ke.length-1;ge>=0;ge--)this.removeListener(be,ke[ge]);return this};function Le(Ce,be,ke){var he=Ce._events;if(he===void 0)return[];var ge=he[be];return ge===void 0?[]:typeof ge=="function"?ke?[ge.listener||ge]:[ge]:ke?ft(ge):Re(ge,ge.length)}q.prototype.listeners=function(be){return Le(this,be,!0)},q.prototype.rawListeners=function(be){return Le(this,be,!1)},q.listenerCount=function(Ce,be){return typeof Ce.listenerCount=="function"?Ce.listenerCount(be):ne.call(Ce,be)},q.prototype.listenerCount=ne;function ne(Ce){var be=this._events;if(be!==void 0){var ke=be[Ce];if(typeof ke=="function")return 1;if(ke!==void 0)return ke.length}return 0}q.prototype.eventNames=function(){return this._eventsCount>0?D(this._events):[]};function Re(Ce,be){for(var ke=new Array(be),he=0;he<be;++he)ke[he]=Ce[he];return ke}function st(Ce,be){for(;be+1<Ce.length;be++)Ce[be]=Ce[be+1];Ce.pop()}function ft(Ce){for(var be=new Array(Ce.length),ke=0;ke<be.length;++ke)be[ke]=Ce[ke].listener||Ce[ke];return be}function zt(Ce,be){return new Promise(function(ke,he){function ge(Oe){Ce.removeListener(be,Ae),he(Oe)}function Ae(){typeof Ce.removeListener=="function"&&Ce.removeListener("error",ge),ke([].slice.call(arguments))}Tt(Ce,be,Ae,{once:!0}),be!=="error"&&Dt(Ce,ge,{once:!0})})}function Dt(Ce,be,ke){typeof Ce.on=="function"&&Tt(Ce,"error",be,ke)}function Tt(Ce,be,ke,he){if(typeof Ce.on=="function")he.once?Ce.once(be,ke):Ce.on(be,ke);else if(typeof Ce.addEventListener=="function")Ce.addEventListener(be,function ge(Ae){he.once&&Ce.removeEventListener(be,ge),ke(Ae)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ce)}return Kc.exports}var Yg=Xg();const Gp={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Jg={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},Qg={en:"No results found",de:"Keine Ergebnisse gefunden"},e_={en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen"};var Rl={placeholder:Jg,errorNoResults:Qg,errorConnectionFailed:e_};const t_=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class i_{constructor(C,D){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:N=>N.text!==void 0?N.text:N.place_name,render:function(N){if(!N.geometry){const q=N.text,x=q.toLowerCase().indexOf(this.query.toLowerCase()),c=this.query.length,me=q.substring(0,x),Ze=q.substring(x,x+c),Ue=q.substring(x+c);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+me+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+Ze+"</span>"+Ue+"</div></div></div>"}const L=N.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+L[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+L.splice(1,L.length).join(",")+"</div></div></div>"},popupRender:N=>{const L=N.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+L[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+L.splice(1,L.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new Yg.EventEmitter,this.options=zn({},this.options,D),this.fresh=!0,this.lastSelected=null,this.geocoderApi=C}addTo(C){function D(N,L){if(!document.body.contains(L))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const q=N.onAdd();L.appendChild(q)}if(C instanceof HTMLElement)D(this,C);else if(typeof C=="string"){const N=document.querySelectorAll(C);if(N.length===0)throw new Error("Element "+C+"not found.");if(N.length>1)throw new Error("Geocoder can only be added to a single html element");D(this,N[0])}else if("addControl"in C)C.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(C){if(C&&typeof C!="string"&&(this._map=C),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const D=this.container=document.createElement("div");D.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const N=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Wg(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const L=document.createElement("div");L.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const q=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(q),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),L.appendChild(this._clearEl),L.appendChild(this._loadingEl),D.appendChild(N),D.appendChild(this._inputEl),D.appendChild(L),this._typeahead=new Vg(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),D}createIcon(C,D){const N=document.createElementNS("http://www.w3.org/2000/svg","svg");if(N.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+C),N.setAttribute("viewBox","0 0 18 18"),N.setAttribute("xml:space","preserve"),N.setAttribute("width","18"),N.setAttribute("height","18"),"innerHTML"in N)N.innerHTML=D;else{const L=document.createElement("div");L.innerHTML="<svg>"+D.valueOf().toString()+"</svg>";const q=L.firstChild,x=q.firstChild;N.appendChild(x)}return N}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(C){const D=(C.clipboardData||window.clipboardData).getData("text");D.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(D)}_onKeyDown(C){if(C.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(C),this._inputEl.blur();const q=this._inputEl.value;if(!q)return this.fresh=!0,C.keyCode!==9&&this.clear(C),this._clearEl.style.display="none";if(!(C.metaKey||[9,27,37,39,38,40].indexOf(C.keyCode)!==-1)){if(C.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(q);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(q,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}q.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(q)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(C){this.options.clearOnBlur&&this._clearOnBlur(C),this.options.collapsed&&this._collapse()}_onChange(){const C=this._typeahead.selected;if(C&&!C.geometry)C.placeId?this._geocode(C.placeId,!0,!0):this._geocode(C.text,!0);else if(C&&JSON.stringify(C)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let D;if(this._removeResultMarkers(),C.properties&&Gp[C.properties.short_code])D=zn({},this.options.flyTo),this._map&&this._map.fitBounds(Gp[C.properties.short_code].bbox,D);else if(C.bbox){const N=C.bbox;D=zn({},this.options.flyTo),this._map&&this._map.fitBounds([[N[0],N[1]],[N[2],N[3]]],D)}else{const N={zoom:this.options.zoom};D=zn({},N,this.options.flyTo),C.center?D.center=C.center:C.geometry&&C.geometry.type&&C.geometry.type==="Point"&&C.geometry.coordinates&&(D.center=C.geometry.coordinates),this._map&&this._map.flyTo(D)}}this.options.marker&&this._maplibregl&&this._handleMarker(C),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(C),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:C})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((N,L)=>(this.options[L]&&(["countries","types","language"].indexOf(L)>-1?N[L]=this.options[L].split(/[\s,]+/):N[L]=this.options[L],L==="proximity"&&this.options[L]&&typeof this.options[L].longitude=="number"&&typeof this.options[L].latitude=="number"&&(N[L]=[this.options[L].longitude,this.options[L].latitude])),N),{})}_geocode(C){return vu(this,arguments,void 0,function*(D,N=!1,L=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:D});const q=this._getConfigForRequest(),x=this._createGeocodeRequest(q,D,N,L),c=this.options.localGeocoder?this.options.localGeocoder(D)||[]:[];try{const me=yield x;yield this._handleGeocodeResponse(me,q,D,N,c)}catch(me){this._handleGeocodeErrorResponse(me,c)}return x})}_createGeocodeRequest(C,D,N,L){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&t_.test(D)?this._createReverseGeocodeRequest(D,C):(C.query=D,this.geocoderApi.getSuggestions?N?this.geocoderApi.searchByPlaceId&&L?this.geocoderApi.searchByPlaceId(C):this.geocoderApi.forwardGeocode(C):this.geocoderApi.getSuggestions(C):this.geocoderApi.forwardGeocode(C))}_createReverseGeocodeRequest(C,D){const N=C.split(/[\s(,)?]+/).map(L=>parseFloat(L)).reverse();return D.query=N,D.limit=1,"proximity"in D&&delete D.proximity,this.geocoderApi.reverseGeocode(D)}_handleGeocodeResponse(C,D,N,L,q){return vu(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let x={};C?x=C:x={type:"FeatureCollection",features:[]},x.config=D,this.fresh&&(this.fresh=!1),x.features=x.features?q.concat(x.features):q;const c=this.options.externalGeocoder?this.options.externalGeocoder(N,x.features,D)||Promise.resolve([]):Promise.resolve([]);try{const Ze=yield c;x.features=x.features?Ze.concat(x.features):Ze}catch{}this.options.filter&&x.features.length&&(x.features=x.features.filter(this.options.filter));let me=[];"suggestions"in x?me=x.suggestions:"place"in x?me=[x.place]:me=x.features,me.length?(this._clearEl.style.display="block",this._typeahead.update(me),(!this.options.showResultsWhileTyping||L)&&this.options.showResultMarkers&&(x.features.length>0||"place"in x)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",x)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",x))})}_handleGeocodeErrorResponse(C,D){this._loadingEl.style.display="none",D.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(D)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:D}),this._eventEmitter.emit("error",{error:C})}_clear(C){C&&C.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(C){this._clear(C),this._inputEl.focus()}_clearOnBlur(C){C.relatedTarget&&this._clear(C)}_onQueryResult(C){if(!("features"in C)||!C.features.length)return;const D=C.features[0];this._typeahead.selected=D,this._inputEl.value=D.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const C=this._map.getCenter().wrap();this.setProximity({longitude:C.lng,latitude:C.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(C){return vu(this,void 0,void 0,function*(){const D=yield this._geocode(C);this._onQueryResult(D)})}_renderError(){const C=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(C)}_renderNoResults(){const C=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(C)}_renderMessage(C){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(C)}_localize(C){const D=$g.language(this.options.language.split(",")[0]);return this.options.language&&(Rl!=null&&Rl[C][D])?Rl[C][D]:Rl[C].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const C=this._typeahead.data.filter(D=>typeof D!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const N=zn({},{padding:100},this.options.flyTo),L=new this._maplibregl.LngLatBounds;for(const q of C)L.extend(q.geometry.coordinates);this._map.fitBounds(L,N)}return C.length>0&&this._maplibregl&&this._handleResultMarkers(C),this}setInput(C){return this._inputEl.value=C,this._typeahead.selected=null,this._typeahead.clear(),C.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(C),this}setProximity(C){return this.options.proximity=C,this}getProximity(){return this.options.proximity}setRenderFunction(C){return C&&typeof C=="function"&&(this._typeahead.render=C),this}getRenderFunction(){return this._typeahead.render}setLanguage(C){return this.options.language=C||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(C){return this.options.zoom=C,this}getFlyTo(){return this.options.flyTo}setFlyTo(C){return this.options.flyTo=C,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(C){return this.placeholder=C||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(C){return this.options.bbox=C,this}getCountries(){return this.options.countries}setCountries(C){return this.options.countries=C,this}getTypes(){return this.options.types}setTypes(C){return this.options.types=C,this}getMinLength(){return this.options.minLength}setMinLength(C){return this.options.minLength=C,this._typeahead&&(this._typeahead.options.minLength=C),this}getLimit(){return this.options.limit}setLimit(C){return this.options.limit=C,this._typeahead&&(this._typeahead.options.limit=C),this}getFilter(){return this.options.filter}setFilter(C){return this.options.filter=C,this}setGeocoderApi(C){return this.geocoderApi=C,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(C){if(!this._map)return;this._removeMarker();const N=zn({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(N);let L;if(this.options.popup){const x=zn({},{},this.options.popup);L=new this._maplibregl.Popup(x).setHTML(this.options.popupRender(C))}return C.center?(this.mapMarker.setLngLat(C.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(L)):C.geometry&&C.geometry.type&&C.geometry.type==="Point"&&C.geometry.coordinates&&(this.mapMarker.setLngLat(C.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(L)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(C){if(!this._map)return;this._removeResultMarkers();let N=zn({},{color:"#4668F2"},this.options.showResultMarkers);for(const L of C){let q;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(q=this.options.showResultMarkers.element.cloneNode(!0),N=zn(N,{element:q}));const x=new this._maplibregl.Marker(zn({},N,{element:q}));let c;if(this.options.popup){const Ze=zn({},{},this.options.popup);c=new this._maplibregl.Popup(Ze).setHTML(this.options.popupRender(L))}L.center?(x.setLngLat(L.center).addTo(this._map),this.options.popup&&x.setPopup(c)):L.geometry&&L.geometry.type&&L.geometry.type==="Point"&&L.geometry.coordinates&&(x.setLngLat(L.geometry.coordinates).addTo(this._map),this.options.popup&&x.setPopup(c)),this.resultMarkers.push(x)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(C){C.remove()}),this.resultMarkers=[])}on(C,D){return this._eventEmitter.on(C,D),this}once(C){return new Promise(D=>{this._eventEmitter.once(C,D)})}off(C,D){return this._eventEmitter.removeListener(C,D),this}}function Cf(O,C){const D={type:C.source.type||"vector"};if(D.type=="vector")D.tiles=["https://"+Fu+".mobidata-bw.de/geoserver/gwc/service/wmts/rest/"+C.source.layer+"/"+C.source.style+"/WebMercatorQuadx2/{z}/{y}/{x}?format=application/vnd.mapbox-vector-tile"],D.minzoom=4,D.maxzoom=15,D.bounds&&(D.bounds=C.source.bounds);else if(D.type=="raster"){const N=C.source.cql?"cql_filter="+encodeURIComponent(C.source.cql):"";D.tiles=["https://"+Fu+".mobidata-bw.de/geoserver/ows?SERVICE=WMS&REQUEST=GetMap&VERSION=1.3.0&LAYERS="+C.source.layer+"&FORMAT=image/png&TRANSPARENT=true&CRS=EPSG:3857&WIDTH=512&HEIGHT=512&"+N+"&BBOX={bbox-epsg-3857}"],D.tileSize=512,D.maxzoom=24}else D.type=="geojson"&&(D.data=C.source.data,D.buffer&&(D.buffer=C.source.buffer),D.tolerance&&(D.tolerance=C.source.tolerance));O.addSource(C.id,D)}function Mf(O,C){const D={circle:{"circle-radius":C.circleRadius||5,"circle-color":C.color,"circle-opacity":.8,"circle-stroke-color":C.circleStrokeColor||"black","circle-stroke-width":C.circleStrokeWidth||.5},line:{"line-color":C.color,"line-width":C.lineWidth||1.5,"line-opacity":C.lineOpacity||1},fill:{"fill-color":C.color,"fill-opacity":C.fillOpacity||.9,"fill-outline-color":C.fillOutlineColor||"black"},raster:{"raster-resampling":"nearest"}};C.color=="#fffb05"||C.color=="white"?D.circle["circle-opacity"]=1:D.circle["circle-opacity"]=.8,C.color=="black"&&(D.circle["circle-stroke-color"]="white");const N={id:C.id,type:C.type||"circle",source:C.source,"source-layer":C.sourceLayer||"",layout:{visibility:C.visibility||"visible"},paint:D[C.type||"circle"]};C.filter&&(N.filter=C.filter),C.fillSortKey&&(N.layout["fill-sort-key"]=C.fillSortKey),O.addLayer(N)}let $p,Io=null;function r_(O,{basemapSources:C,basemapLayers:D}){const N="<a href='https://maplibre.org/' target='_blank'>MapLibre</a>",L="<a href='https://www.openstreetmap.org/copyright' target='_blank'>© OpenStreetMap Mitwirkende</a>",q="<a href='https://www.maptiler.com/copyright/' target='_blank'>© MapTiler</a>",c={streets:{img:`${$s}img/basemaps/streets.png`,style:"https://tiles.mobidata-bw.de/styles/streets/style.json",title:"Straßen",attribution:`<div class='maplibregl-ctrl-attrib-inner'> ${N} | ${L} ${q} </div>`},bicycle:{img:`${$s}img/basemaps/bicycle.png`,style:"https://tiles.mobidata-bw.de/styles/bicycle/style.json",title:"Fahrrad",attribution:`<div class='maplibregl-ctrl-attrib-inner'> ${N} | ${L} ${q} </div>`},darkmatter:{img:`${$s}img/basemaps/darkmatter.png`,style:"https://tiles.mobidata-bw.de/styles/darkmatter/style.json",title:"Dunkelmodus",attribution:`<div class='maplibregl-ctrl-attrib-inner'> ${N} | ${L} ${q} </div>`},aerialphotos:{img:`${$s}img/basemaps/aerialphotos.png`,style:"https://tiles.mobidata-bw.de/styles/aerialphotos/style.json",title:"Luftbild",attribution:`<div class='maplibregl-ctrl-attrib-inner'> ${N} | ${L} ${q} <a href='https://www.lgl-bw.de/' target='_blank'>© LGL-BW</a> </div>`},basemap:{img:`${$s}img/basemaps/basemap.png`,style:"https://sgx.geodatenzentrum.de/gdz_basemapde_vektor/styles/bm_web_top.json",title:"Geländemodell",attribution:`<div class='maplibregl-ctrl-attrib-inner'> ${N} </div>`}};Io=new qs.AttributionControl({compact:!0,customAttribution:c.streets.attribution}),O.addControl(Io);let me=Object.keys(c)[0];class Ze{constructor(He){switch(this._options={...He},this._container=document.createElement("div"),this._container.classList.add("maplibregl-ctrl"),this._container.classList.add("maplibregl-ctrl-basemaps"),this._container.classList.add("closed"),this._options.expandDirection||"right"){case"top":this._container.classList.add("reverse");case"down":this._container.classList.add("column");break;case"left":this._container.classList.add("reverse");case"right":this._container.classList.add("row")}this._container.addEventListener("mouseenter",()=>{this._container.classList.remove("closed")}),this._container.addEventListener("mouseleave",()=>{this._container.classList.add("closed")})}onAdd(He){this._map=He;const Le=this._options.basemaps;return Object.keys(Le).forEach(ne=>{const Re=Le[ne],st=document.createElement("img");st.src=Re.img,st.classList.add("basemap"),st.dataset.id=ne,st.title=Re.title,st.addEventListener("click",()=>{const ft=this._container.querySelector(".active");ft&&ft.classList.remove("active"),st.classList.add("active"),He.setStyle(Re.style),Io!=null&&He.removeControl(Io),Io=new qs.AttributionControl({compact:!0,customAttribution:Re.attribution}),He.addControl(Io),Re.title=="Dunkelmodus"?(D[0].paint["fill-color"]="white",D[1].paint["line-color"]="white"):(D[0].paint["fill-color"]="black",D[1].paint["line-color"]="black")}),st.classList.add("hidden"),this._container.appendChild(st),this._options.initialBasemap.id===ne&&st.classList.add("active")}),this._container}onRemove(){var He;(He=this._container.parentNode)==null||He.removeChild(this._container),delete this._map}}O.setStyle(c[me].style),O.on("styledata",()=>{setTimeout(()=>{C.forEach(Ue=>{O.getSource(Ue.id)||(Ue.id=="shape"?O.addSource(Ue.id,Ue.source):Cf(O,Ue))}),D.forEach(Ue=>{O.getLayer(Ue.id)||(Ue.id=="fillShape"||Ue.id=="lineShape"?O.addLayer(Ue):Mf(O,Ue))})},100)}),$p=new Ze({basemaps:c,initialBasemap:{id:me}}),O.addControl($p,"bottom-left")}function Gr(O,C,D,N){C.forEach(L=>{O.on("click",L.id,q=>{const x=q.features[0],c=x.geometry;let me;c.type==="Point"?me=c.coordinates:me=[q.lngLat.lng,q.lngLat.lat];const Ze=x.properties;new qs.Popup().setLngLat(me).setHTML(D(Ze)).addTo(O)}),O.on("mouseenter",L.id,()=>{O.getCanvas().style.cursor="pointer"}),O.on("mouseleave",L.id,()=>{O.getCanvas().style.cursor=""})})}function qp(O,C,D){O.on("mousemove",N=>{const L=C.filter(q=>O.getLayer(q.id)&&O.getLayoutProperty(q.id,"visibility")!=="none");O.getCanvas().style.cursor=L.length>0?"pointer":"normal"}),O.on("click",async N=>{const L=C.filter(He=>O.getLayer(He.id)&&O.getLayoutProperty(He.id,"visibility")!=="none");if(L.length===0)return;const q=O.getBounds(),x=O.getContainer().getBoundingClientRect(),c=[q.getSouth(),q.getWest(),q.getNorth(),q.getEast()].join(","),me=O.project(N.lngLat),Ze=L.map(async He=>{const Le={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",LAYERS:He.layer,QUERY_LAYERS:He.layer,STYLES:He.style,BBOX:c,CRS:"EPSG:4326",WIDTH:x.width,HEIGHT:x.height,FORMAT:"image/png",INFO_FORMAT:"application/json",i:Math.round(me.x),j:Math.round(me.y),buffer:5};He.cql&&(Le.CQL_FILTER=He.cql);const Re=`https://api.mobidata-bw.de/geoserver/ows?${Object.keys(Le).map(st=>`${encodeURIComponent(st)}=${encodeURIComponent(Le[st])}`).join("&")}`;try{return await(await fetch(Re)).json()}catch(st){return console.error("GetFeatureInfo-Fehler:",st),null}});(await Promise.all(Ze)).forEach(He=>{if(He.features.length>0){const Le=He.features[0].properties;new qs.Popup().setLngLat(N.lngLat).setHTML(D(Le)).addTo(O)}})})}const pi=new qs.Map({container:"map",center:[9,48.68],zoom:window.innerWidth<577?6:7.1,minZoom:4,maxBounds:[[-21.4,35.1],[40.9,72.4]],attributionControl:!1}),Hp={type:"geojson",data:`${$s}data/boundaries/shapesBadenWuerttemberg.geojson`},Wp={id:"fillShape",type:"fill",source:"shape",paint:{"fill-color":"black","fill-opacity":.1}},Kp={id:"lineShape",type:"line",source:"shape",paint:{"line-color":"black","line-width":2}};function n_(O){O.addControl(new $u({popup:new qs.Popup({closeButton:!1,closeOnClick:!1})}),"top-left"),O.addControl(new qs.NavigationControl({showZoom:!(window.innerWidth<577),showCompass:!0,visualizePitch:!0}),"top-left")}function s_(O){const C={forwardGeocode:async D=>{const N=[];try{const me=`${1.5},${55.3},16,${45.7}`,Ze=`https://nominatim.openstreetmap.org/search?q=${D.query}&format=geojson&polygon_geojson=1&addressdetails=1&viewbox=${me}`,He=await(await fetch(Ze)).json();for(const Le of He.features){const ne=[Le.bbox[0]+(Le.bbox[2]-Le.bbox[0])/2,Le.bbox[1]+(Le.bbox[3]-Le.bbox[1])/2],Re={type:"Feature",geometry:{type:"Point",coordinates:ne},place_name:Le.properties.display_name,properties:Le.properties,text:Le.properties.display_name,place_type:["place"],center:ne};N.push(Re)}}catch(L){console.error(`Failed to forwardGeocode with error: ${L}`)}return{features:N}}};O.addControl(new i_(C,{maplibregl:qs,language:"de",showResultsWhileTyping:!0,popup:!0}),"top-left")}const Lr={NO_REALTIME_INFORMATION:{label:"Keine Echtzeitinformationen",subGroup:"Belegung",filter:["any",["all",["==",["get","parking_object"],"site"],["==",["get","realtime_free_capacity"],null]],["all",["==",["get","parking_object"],"spot"],["any",["==",["get","realtime_status"],"UNKNOWN"],["==",["get","has_realtime_data"],!1]]]],color:"#615fdf"},OUTDATED_REALTIME_INFORMATION:{label:"Veraltete Echtzeitinformationen",subGroup:"Belegung",filter:["==",["get","realtime_data_outdated"],!0],color:"#cacaca"},VERY_LOW_AVAILABILITY_OR_CLOSED:{label:"Sehr geringe Verfügbarkeit / Geschlossen",subGroup:"Belegung",filter:["any",["all",["==",["get","parking_object"],"site"],["any",["==",["get","realtime_opening_status"],"CLOSED"],["all",[">=",["get","realtime_free_capacity"],0],["<=",["/",["*",1,["get","realtime_free_capacity"]],["case",["has","realtime_capacity"],["get","realtime_capacity"],["get","capacity"]]],.02],["!=",["get","realtime_opening_status"],"CLOSED"]]],["!=",["get","realtime_data_outdated"],!0]],["all",["==",["get","parking_object"],"spot"],["==",["get","realtime_status"],"TAKEN"]]],color:"#ed0000"},LOW_AVAILABILITY:{label:"Geringe Verfügbarkeit",subGroup:"Belegung",filter:["all",["==",["get","parking_object"],"site"],["all",[">=",["/",["*",1,["get","realtime_free_capacity"]],["case",["has","realtime_capacity"],["get","realtime_capacity"],["get","capacity"]]],.02],["<=",["/",["*",1,["get","realtime_free_capacity"]],["case",["has","realtime_capacity"],["get","realtime_capacity"],["get","capacity"]]],.2]],["!=",["get","realtime_opening_status"],"CLOSED"],["!=",["get","realtime_data_outdated"],!0]],color:"#dfab27"},HIGH_AVAILABILITY:{label:"Hohe Verfügbarkeit",subGroup:"Belegung",filter:["any",["all",["==",["get","parking_object"],"site"],[">=",["/",["*",1,["get","realtime_free_capacity"]],["case",["has","realtime_capacity"],["get","realtime_capacity"],["get","capacity"]]],.2],["!=",["get","realtime_opening_status"],"CLOSED"],["!=",["get","realtime_data_outdated"],!0]],["all",["==",["get","parking_object"],"spot"],["==",["get","realtime_status"],"AVAILABLE"]]],color:"#059b02"}},a_={layer:"MobiData-BW:park-api_car_buildings",style:"MobiData-BW:mdbw_park-api_parking-object",bounds:[5.9,45.8,17,54.8]},Dl={source:"sourceParkApiCarBuildings",sourceLayer:"park-api_car_buildings",group:"Parkplätze und Parkbauten"},Xp=[{id:"layersParkApiCarBuildingsOccupancy_NoRealtimeInformation",...Lr.NO_REALTIME_INFORMATION,...Dl},{id:"layersParkApiCarBuildingsOccupancy_OutdatedRealtimeInformation",...Lr.OUTDATED_REALTIME_INFORMATION,...Dl},{id:"layersParkApiCarBuildingsOccupancy_VeryLowAvailabilityOrClosed",...Lr.VERY_LOW_AVAILABILITY_OR_CLOSED,...Dl},{id:"layersParkApiCarBuildingsOccupancy_LowAvailability",...Lr.LOW_AVAILABILITY,...Dl},{id:"layersParkApiCarBuildingsOccupancy_HighAvailability",...Lr.HIGH_AVAILABILITY,...Dl}],o_={layer:"MobiData-BW:park-api_car_on-street",style:"MobiData-BW:mdbw_park-api_parking-object",bounds:[6.7,47.6,9.5,51.4]},Bl={source:"sourceParkApiCarOnStreet",sourceLayer:"park-api_car_on-street",group:"Straßen-Parkplätze"},Yp=[{id:"parkApiCarOnStreetOccupancy_NoRealtimeInformation",...Lr.NO_REALTIME_INFORMATION,...Bl},{id:"parkApiCarOnStreetOccupancy_OutdatedRealtimeInformation",...Lr.OUTDATED_REALTIME_INFORMATION,...Bl},{id:"parkApiCarOnStreetOccupancy_VeryLowAvailabilityOrClosed",...Lr.VERY_LOW_AVAILABILITY_OR_CLOSED,...Bl},{id:"parkApiCarOnStreetOccupancy_LowAvailability",...Lr.LOW_AVAILABILITY,...Bl},{id:"parkApiCarOnStreetOccupancy_HighAvailability",...Lr.HIGH_AVAILABILITY,...Bl}],l_={layer:"MobiData-BW:park-api_bicycle",style:"MobiData-BW:mdbw_park-api_parking-object",bounds:[7.1,47.5,13.5,53.8]},Fl={source:"sourceParkApiBicycle",sourceLayer:"park-api_bicycle",group:"Fahrradabstellanlagen"},Jp=[{id:"parkApiBicycleOccupancy_NoRealtimeInformation",...Lr.NO_REALTIME_INFORMATION,...Fl},{id:"parkApiBicycleOccupancy_OutdatedRealtimeInformation",...Lr.OUTDATED_REALTIME_INFORMATION,...Fl},{id:"parkApiBicycleOccupancy_VeryLowAvailabilityOrClosed",...Lr.VERY_LOW_AVAILABILITY_OR_CLOSED,...Fl},{id:"parkApiBicycleOccupancy_LowAvailability",...Lr.LOW_AVAILABILITY,...Fl},{id:"parkApiBicycleOccupancy_HighAvailability",...Lr.HIGH_AVAILABILITY,...Fl}],c_={layer:"MobiData-BW:sharing_vehicles",style:"MobiData-BW:mdbw_sharing_vehicles_default",bounds:[4,45.8,13.5,54.6]},Ia={source:"sourceSharingVehicles",sourceLayer:"sharing_vehicles",label:"Free-Floating-Fahrzeuge",filter:O=>["==",["get","form_factor"],O],color:"#91FFFF"},Xc=["any",["==",["get","feed_id"],"oekostadt_renningen"],["==",["get","feed_id"],"gruene-flotte_freiburg"],["==",["get","feed_id"],"swu2go"],["==",["get","feed_id"],"conficars_ulm"],["==",["get","feed_id"],"naturenergie_sharing"],["==",["get","feed_id"],"coono"],["match",["slice",["get","feed_id"],0,10],"stadtmobil",!0,!1],["match",["slice",["get","feed_id"],0,8],"teilauto",!0,!1]],sn={NO_REALTIME_DATA:{label:"Station ohne Echtzeitdaten",filter:Xc,color:"#615fdf"},OUTDATED_REALTIME_DATA:{label:"Station mit veralteten Echtzeitdaten",filter:["all",["!",Xc],["==",["get","realtime_data_outdated"],!0]],color:"#cacaca"},FREE:{label:"Station mit freien Fahrzeugen",filter:["all",["!",Xc],["any",["!",["has","realtime_data_outdated"]],["==",["get","realtime_data_outdated"],!1]],[">",["get","num_vehicles_available"],0]],color:"#fffb05"},OCCUPIED:{label:"Station ohne freie Fahrzeuge",filter:["all",["!",Xc],["any",["!",["has","realtime_data_outdated"]],["==",["get","realtime_data_outdated"],!1]],["==",["get","num_vehicles_available"],0]],color:"#ffb805"}},h_={layer:"MobiData-BW:sharing_stations_car",style:"MobiData-BW:mdbw_sharing_stations_default",bounds:[6,45.8,14.3,54.3]},Yc={source:"sourceSharingStationsCar",sourceLayer:"sharing_stations_car",group:"Carsharing"},Qp=[{id:"sharingCar_Vehicles",group:"Carsharing",...Ia,filter:["==",["get","form_factor"],"car"]},{id:"sharingCar_StationsNoRealtimeData",...sn.NO_REALTIME_DATA,...Yc},{id:"sharingCar_StationsOutdatedRealtimeData",...sn.OUTDATED_REALTIME_DATA,...Yc},{id:"sharingCar_StationsOccupied",...sn.OCCUPIED,...Yc},{id:"sharingCar_StationsFree",...sn.FREE,...Yc}],u_={layer:"MobiData-BW:sharing_stations_bicycle",style:"MobiData-BW:mdbw_sharing_stations_default",bounds:[6,45.8,13.5,54.6]},Mu={source:"sourceSharingStationsBicycle",sourceLayer:"sharing_stations_bicycle",group:"Bikesharing"},ef=[{id:"sharingBicycle_VehiclesBicycle",group:"Bikesharing",...Ia,filter:Ia.filter("bicycle")},{id:"sharingBicycle_StationsOutdatedRealtimeData",...sn.OUTDATED_REALTIME_DATA,...Mu},{id:"sharingBicycle_StationsOccupied",...sn.OCCUPIED,...Mu},{id:"sharingBicycle_StationsFree",...sn.FREE,...Mu}],d_={layer:"MobiData-BW:sharing_stations_scooters_standing",style:"MobiData-BW:mdbw_sharing_stations_default",bounds:[4.3,46.9,9.9,50]},Pu={source:"sourceSharingStationsScooter",sourceLayer:"sharing_stations_scooters_standing",group:"E-Scooter-Sharing"},tf=[{id:"sharingScooter_Vehicles",group:"E-Scooter-Sharing",...Ia,filter:Ia.filter("scooter")},{id:"sharingScooter_StationsOccupied",...sn.OCCUPIED,...Pu},{id:"sharingScooter_StationsFree",...Pu,...sn.FREE,...Pu}],p_={layer:"MobiData-BW:sharing_stations_cargo_bicycle",style:"MobiData-BW:mdbw_sharing_stations_default",bounds:[1.8,45.8,10.4,54.6]},Jc={source:"sourceSharingStationsCargoBicycle",sourceLayer:"sharing_stations_cargo_bicycle",group:"Lastenrad-Sharing"},rf=[{id:"sharingCargoBicycleVehicles",group:"Lastenrad-Sharing",...Ia,filter:Ia.filter("cargo_bicycle")},{id:"sharingCargoBicycle_StationsNoRealtimeData",...sn.NO_REALTIME_DATA,...Jc},{id:"sharingCargoBicycle_StationsOutdatedRealtimeData",...sn.OUTDATED_REALTIME_DATA,...Jc},{id:"sharingCargoBicycle_StationsOccupied",...sn.OCCUPIED,...Jc},{id:"sharingCargoBicycle_StationsFree",...sn.FREE,...Jc}],f_={layer:"MobiData-BW:charge_points",style:"MobiData-BW:mdbw_charge_points_dynamic",bounds:[5.2,47.2,15.8,55.7]},Iu={source:"sourceChargePoints",sourceLayer:"charge_points",group:"E-Ladesäulen",circleRadius:["interpolate",["linear"],["zoom"],6,4,12,5]},nf=[{id:"chargePointsPower_Normal",label:"Ladesäule",subGroup:"Ladeleistung",filter:["<=",["get","max_electric_power"],22e3],color:"#08a4a7",...Iu},{id:"chargePointsPower_Fast",label:"Schnellladesäule",subGroup:"Ladeleistung",filter:[">",["get","max_electric_power"],22e3],color:"#91FFFF",...Iu},{id:"chargePointsPower_Unknown",label:"Unbekannte Ladeleistung",subGroup:"Ladeleistung",filter:["==",["get","max_electric_power"],null],color:"#cacaca",...Iu}],m_={layer:"MobiData-BW:radvis_cycle_network",style:"MobiData-BW:mdbw_radvis_cn_all",bounds:[7.5,47.5,10.2,49.6]},Eu={type:"line",source:"sourceRadvis",sourceLayer:"radvis_cycle_network",group:"Radnetze",lineWidth:["interpolate",["linear"],["zoom"],6,2,12,3]},sf=[{id:"radvis_KommunalesNetz",label:"Kommunales Netz",filter:["case",[">=",["zoom"],12],["all",["==",["get","ext_bw_kommunetz"],1],["!=",["get","ext_bw_kreisnetz"],1],["!=",["get","ext_bw_landesnetz"],1]],!1],color:"#0020aa",visibility:"none",...Eu},{id:"radvis_Kreisnetz",label:"Kreisnetz",filter:["case",[">=",["zoom"],10],["all",["==",["get","ext_bw_kreisnetz"],1],["!=",["get","ext_bw_landesnetz"],1]],!1],color:"#008001",visibility:"none",...Eu},{id:"radvis_RadNetzBw",label:"RadNETZ BW",filter:["==",["get","ext_bw_landesnetz"],1],color:"#ff7f00",...Eu}],g_={layer:"MobiData-BW:transit_stops",style:"MobiData-BW:mdbw_transit_stops_default",bounds:[-9.1,38.7,30.5,56.9]},__={layer:"MobiData-BW:transit_stations_with_served_routes",style:"MobiData-BW:mdbw_transit_stations_default",bounds:[-9.1,38.7,30.5,56.9]},Eo={type:"raster",layer:"MobiData-BW:transit_shapes_with_routes"},wi=[{id:"sourceTransitShapes_Bus",cql:"route_type = '3'",...Eo},{id:"sourceTransitShapes_Regionalverkehr",cql:"route_type = '2'",...Eo},{id:"sourceTransitShapes_StrassenStadtBahn",cql:"route_type = '0'",...Eo},{id:"sourceTransitShapes_UBahn",cql:"route_type = '1'",...Eo},{id:"sourceTransitShapes_Faehre",cql:"route_type = '4'",...Eo},{id:"sourceTransitShapes_Seilbahn",cql:"route_type = '7'",...Eo}],af={source:"sourceTransitStops",sourceLayer:"transit_stops",group:"Haltesteige",circleRadius:["interpolate",["linear"],["zoom"],6,4,12,5]},Qc={source:"sourceTransitStations",sourceLayer:"transit_stations_with_served_routes",group:"Bahnhöfe und Haltestellen",circleRadius:["interpolate",["linear"],["zoom"],6,4,12,5],visibility:"none"},Ao={type:"raster",group:"ÖPNV-Linien",layer:"MobiData-BW:transit_shapes_with_routes",style:"mdbw_transit_routes_default",visibility:"none"},of=[{id:"transitStops_Haltestelle",label:"Haltestelle",filter:["any",["==",["get","location_type"],"stop"],["==",["get","location_type"],null]],color:"#f1c40f",...af},{id:"transitStops_Bahnhof",label:"Bahnhof",...af,filter:["==",["get","location_type"],"station"],color:"#27ae60"}],lf=[{id:"transitStations_Bushaltestelle",label:"Bushaltestelle",filter:["==",["get","prio_route_type"],3],color:"#d9c022",...Qc},{id:"transitStations_Bahnhof",label:"Bahnhof",filter:["==",["get","prio_route_type"],2],color:"#e4010b",...Qc},{id:"transitStations_StrassenUBahnHaltestelle",label:"Straßen-/U-Bahn-Haltestelle",filter:["==",["get","prio_route_type"],0],color:"#0065b0",...Qc},{id:"transitStations_Faehranleger",label:"Fähranleger",filter:["==",["get","prio_route_type"],4],color:"#FF7F24",...Qc}],cf=[{id:"transitShapes_Bus",label:"Bus",source:wi[0].id,cql:wi[0].cql,color:"#a7007e",...Ao},{id:"transitShapes_Regionalverkehr",label:"Regionalverkehr",source:wi[1].id,cql:wi[1].cql,color:"#666666",...Ao},{id:"transitShapes_StrassenStadtBahn",label:"Straßen- und Stadtbahn",source:wi[2].id,cql:wi[2].cql,color:"#0065B0",...Ao},{id:"transitShapes_UBahn",label:"U-Bahn",source:wi[3].id,cql:wi[3].cql,color:"#0065B0",...Ao},{id:"transitShapes_Faehre",label:"Fähre",source:wi[4].id,cql:wi[4].cql,color:"#FF7F24",...Ao},{id:"transitShapes_Seilbahn",label:"Seilbahn",source:wi[5].id,cql:wi[5].cql,color:"#FF0000",...Ao}],y_={type:"raster",layer:"MobiData-BW:roadworks"},hf=[{id:"roadworks",label:"Baustellen",group:"Baustellen",type:"raster",source:"sourceRoadworks",layer:"MobiData-BW:roadworks",style:"mdbw_traffic_roadworks_default"}],v_={type:"geojson",data:"https://www.mobidata-bw.de/karten_geojsons/maps/count_car/SVZ-Zaehlstellen_231011_augmented_SVZ2023.geojson"},Au={source:"sourceCountCar",group:"Straßenverkehrszählung"},uf=[{id:"countCarTemporary",label:"Temporäre Zählstellen",filter:["case",["<",["zoom"],10],["all",["==",["get","zstart"],"TM"],["==",["get","klasse"],"A"]],["==",["get","zstart"],"TM"]],color:"#7D97DD",...Au},{id:"countCarPermanent",label:"Dauerzählstellen",filter:["case",["<",["zoom"],10],["all",["==",["get","zstart"],"DZ"],["==",["get","klasse"],"A"]],["==",["get","zstart"],"DZ"]],color:"#FF5050",...Au},{id:"countCarManual",label:"Manuelle Zählstellen",filter:["case",["<",["zoom"],10],["all",["==",["get","zstart"],"MZ"],["==",["get","klasse"],"A"]],["==",["get","zstart"],"MZ"]],color:"#fffb05",...Au}],b_={type:"geojson",data:"https://www.mobidata-bw.de/karten_geojsons/maps/count_bicycle/fahrradzaehler_tageswerten_gesamt.geojson"},Ol={source:"sourceCountBicycle",group:"Fahrradzählstellen"},df=[{id:"countBicycle1",label:"bis 100 Tsd.",filter:["<=",["get","2024_ALL"],1e5],color:"#ffe600",...Ol},{id:"countBicycle2",label:"100 - 500 Tsd.",filter:["all",[">",["get","2024_ALL"],1e5],["<=",["get","2024_ALL"],5e5]],color:"#f6b500",...Ol},{id:"countBicycle3",label:"500 Tsd. - 1 Mio.",filter:["all",[">",["get","2024_ALL"],5e5],["<=",["get","2024_ALL"],1e6]],color:"#e78300",...Ol},{id:"countBicycle4",label:"1-2 Mio.",filter:["all",[">",["get","2024_ALL"],1e6],["<=",["get","2024_ALL"],2e6]],color:"#d25000",...Ol},{id:"countBicycle5",label:"über 2 Mio.",filter:[">",["get","2024_ALL"],2e6],color:"#b70101",...Ol}],x_={type:"geojson",data:"https://www.mobidata-bw.de/karten_geojsons/maps/pedestrian_crossings/footway.geojson"},w_={type:"geojson",data:"https://www.mobidata-bw.de/karten_geojsons/maps/pedestrian_crossings/marked.geojson"},T_={type:"geojson",data:"https://www.mobidata-bw.de/karten_geojsons/maps/pedestrian_crossings/uncontrolled.geojson"},S_={type:"geojson",data:"https://www.mobidata-bw.de/karten_geojsons/maps/pedestrian_crossings/zebra.geojson"},eh={group:"Fußgängerüberwege"},pf=[{id:"uncontrolled",label:"Uncontrolled",source:"sourceUncontrolled",color:"#C4001F",...eh},{id:"footway",label:"Footway",source:"sourceFootway",color:"#75b9a2",...eh},{id:"marked",label:"Marked",source:"sourceMarked",color:"#ffe280",...eh},{id:"zebra",label:"Zebra",source:"sourceZebra",color:"#366491",...eh}];function Pf(O){const C=O.replace(" ","T").replace(/(\.\d{3})\d+/,"$1")+"Z",D=new Date(C),N=D.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"2-digit"}),L=D.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return{date:N,time:L}}function Rr(O){const C=`${$s}img/popup/${O}`;return`
    <th>
      <img
        src="${C}.svg"
        alt="Logo von ${O}"
        class="image"
        style="visibility:hidden"
        onload="this.style.visibility='visible'"
        onerror="
          this.onerror = null;
          this.src = '${C}.png';
          this.alt = 'Logo von ${O}'
        "
      />
    </th>
  `}function ff(O){const C=O.capacity,D=O.realtime_capacity,N=O.realtime_free_capacity;if(N&&C&&(C!=0||D!=0)){const L=document.getElementById("anchor-"+O.id);if(L){const q='<td rowspan="7"><canvas id="canvas-'+O.id+'" width="110" height="96"></canvas></td>';L.outerHTML=q;const x=document.getElementById("canvas-"+O.id),c=x.getContext("2d"),me=D||C,Ze=N/me,Ue=(me-N)/me,He=(Ze*100).toFixed(0)+"%",Le=(Ue*100).toFixed(0)+"%",ne=(Ze*100).toFixed(0)+"%";let Re=Ze*2,st=(1-Ze)*2;const ft=["#5ce75c","#8B0000"],zt=[He,Le],Dt=[Math.PI*Re,Math.PI*st],Tt=1;let Ce=-Math.PI/2,be=Ce;const ke=x.width/2-10,he=x.height/2+7,ge=40;for(let Ae=0;Ae<Dt.length;Ae++){Ce=be,be=be+Dt[Ae];const Oe=(Ce+be)/2,Ye=Math.cos(Oe)*Tt,rt=Math.sin(Oe)*Tt;c.beginPath(),c.fillStyle=ft[Ae%ft.length],c.moveTo(ke+Ye,he+rt),c.arc(ke+Ye,he+rt,ge,Ce,be),c.lineTo(ke+Ye,he+rt),c.fill(),st!==2&&st!==0&&(c.strokeStyle="white",c.lineWidth=.5,c.stroke());let ut=ke+Math.cos(Oe)*(ge-18),St=he+Math.sin(Oe)*(ge-18);c.fillStyle="white",c.font="bold 11px Arial",c.textAlign="center",me===N||N===0?c.fillText(ne,ke,he):((Ze<.15&&Ae===0||Ue<.15&&Ae===1)&&(c.fillStyle="black",ut=ke+Math.cos(Oe)*(ge+5),St=he+Math.sin(Oe)*(ge+5)),c.fillText(zt[Ae],ut,St))}}}}function ku(O){ff(O);const{parking_object:C,realtime_data_updated_at:D,realtime_data_outdated:N,has_realtime_data:L,source_id:q,id:x,name:c,operator_name:me,type:Ze,purpose:Ue,address:He,park_and_ride_type:Le,realtime_opening_status:ne,capacity:Re,capacity_disabled:st,capacity_woman:ft,capacity_family:zt,capacity_charging:Dt,capacity_carsharing:Tt,realtime_capacity:Ce,realtime_free_capacity:be,public_url:ke,photo_url:he,realtime_status:ge,restriction_type:Ae,restriction_hours:Oe,restriction_max_stay:Ye}=O;let rt,ut;D&&({date:rt,time:ut}=Pf(D));let St=new Map;St={2:"Stadt Freiburg im Breisgau",3:"Stadt Heidelberg",6:"DB BahnPark",7:"Parkraumgesellschaft Baden-Württemberg mbH",8:"Stadt Neckarsulm",9:"Verband Region Stuttgart",10:"Stadt Pforzheim",11:"Stadt Reutlingen",12:"Stadt Karlsruhe",15:"Stadt Reutlingen",16:"Verkehrsministerium Baden-Württemberg",21:"Stadt Karlsruhe",22:"Stadt Ellwangen",23:"Stadt Buchen",24:"Stadt Bietigheim-Bissingen",25:"Verkehrsministerium Baden-Württemberg",26:"APCOA PARKING",27:"Stadt Herrenberg",28:"RadVIS",29:"Goldbeck",30:"Open-Data-Plattform Schweiz",31:"Kienzler",33:"Kienzler",34:"Kienzler",35:"Kienzler",36:"Kienzler",37:"Stadt Konstanz",38:"NVBW",39:"NVBW",40:"Verband Region Stuttgart",41:"Verband Region Stuttgart",42:"Verband Region Stuttgart",43:"Verband Region Stuttgart",44:"PARK SERVICE HÜFNER",45:"Stadt Herrenberg",47:"Stadt Konstanz",48:"Stadt Mannheim",49:"VELOBRIX",50:"Verkehrsverbund Rhein-Neckar",51:"Stadt Friedrichshafen",51:"Stadt Friedrichshafen",52:"Stadt Freiburg im Breisgau",53:"Stadt Freiburg im Breisgau",54:"Stadt Ulm"};let Mi="",Ht="";for(let yt in St)q==yt&&(Mi+=Rr(St[yt]),Ht+=`<td class="attContent">${St[yt]}</td>`);const Ti="<table>                <tr>"+Mi+(c?'<th class="title">'+c+"</th>":"")+"</table><br><table>"+(Ht==""?"":'<tr>            <td class="att">Datengeber</td>'+Ht+"</tr>")+(!me||me=="-"||me==""?"":'<tr>            <td class="att">Betreiber</td>            <td class="attContent">'+me+"</td>        </tr> ")+(Ze?'<tr>            <td class="att">Typ</td>'+(Ze=="ON_STREET"?'<td class="attContent">Straßenparkplatz</td>':"")+(Ze=="OFF_STREET_PARKING_GROUND"?'<td class="attContent">Parkplatz abseits der Straße</td>':"")+(Ze=="CAR_PARK"?'<td class="attContent">Parkhaus</td>':"")+(Ze=="UNDERGROUND"?'<td class="attContent">Tiefgarage</td>':"")+(Ze=="WALL_LOOPS"?'<td class="attContent">Vorderradhalter</td>':"")+(Ze=="SAFE_WALL_LOOPS"?'<td class="attContent">Vorderradhalter mit Sicherung</td>':"")+(Ze=="STANDS"?'<td class="attContent">Anlehnbügel</td>':"")+(Ze=="LOCKERS"&&Ue=="BIKE"?'<td class="attContent">Fahrradschrank</td>':"")+(Ze=="LOCKERS"&&Ue=="ITEM"||Ze=="LOCKBOX"?'<td class="attContent">Schließfach</td>':"")+(Ze=="SHED"?'<td class="attContent">Sammelanlage</td>':"")+(Ze=="TWO_TIER"?'<td class="attContent">Zweistock-Abstellanlage</td>':"")+(Ze=="BUILDING"?'<td class="attContent">Parkhaus</td>':"")+(Ze=="FLOOR"?'<td class="attContent">Abstellfläche</td>':"")+(Ze=="OTHER"?'<td class="attContent">Sonstige</td>':"")+"</tr>":"")+(!He||He==""?"":'<tr>                <td class="att">Adresse</td>                <td class="attContent">'+He+"</td>            </tr>")+(Le?'<tr>            <td class="att">P+R-Typ</td>'+(Le=="CARPOOL"?'<td class="attContent">Fahrgemeinschaft</td>':"")+(Le=="TRAIN"?'<td class="attContent">Bahn</td>':"")+(Le=="BUS"?'<td class="attContent">Bus</td>':"")+(Le=="TRAM"?'<td class="attContent">Straßenbahn</td>':"")+(Le=="YES"?'<td class="attContent">ja</td>':"")+(Le=="NO"?'<td class="attContent">nein</td>':"")+"</tr>":"")+(ne?'<tr>            <td class="att">Status</td>'+(ne=="OPEN"?'<td class="attContent">geöffnet</td>':"")+(ne=="CLOSED"?'<td class="attContent">geschlossen</td>':"")+(ne=="UNKNOWN"?'<td class="attContent">unbekannt</td>':"")+"</tr>":"")+(D?'<tr>            <td class="att">Stand Echtzeitinformationen</td>'+(N?'<td class="attContent outDated">'+rt+", "+ut+"</td>":'<td class="attContent">'+rt+", "+ut+"</td>")+"</tr>":"")+'</tr>            </table>            <br>            <div class="title title2">Parkplätze</div>            <div id="divParkingSites">                <div>                    <div id="anchor-'+x+'"></div>                </div>                <div id="divTable">                    <table>                        <tr>'+(C=="spot"?'<td class="att">alle (frei/gesamt)</td>'+(ge=="AVAILABLE"?'<td class="attContent">1 / 1</td>':"")+(ge=="TAKEN"?'<td class="attContent">0 / 1</td>':"")+(ge=="UNKNOWN"?'<td class="attContent">- / 1</td>':"")+(L==!1?'<td class="attContent">- / 1</td>':"")+"</tr><tr>"+(Ae?'<tr>                    <td class="att">Parkberechtigte</td>'+(Ae==""?'<td class="attContent">alle</td>':"")+(Ae.match("DISABLED")?'<td class="attContent">Behinderte</td>':"")+(Ae.match("CHARGING")?'<td class="attContent">zum Laden</td>':"")+(Ae.match("FAMILY")?'<td class="attContent">Familien</td>':"")+"</tr>":"")+(Oe?'<tr>                        <td class="att">Parkzeiten</td>                        <td class="attContent">'+Oe+"</td>                    </tr>":"")+(Ye?'<tr>                        <td class="att">Max. Parkdauer</td>                        <td class="attContent">'+Ye+"</td>                    </tr>":""):(!Re&&!Ce?"":'<td class="att2">alle (frei/gesamt)</td>')+('<td class="attContent2">'+((be||"-")+" / "+(!Ce&&!Re?"-":Ce||Re))+"</td>")+"</tr>"+(!st||st=="0"?"":'<tr>                        <td class="att2">für Behinderte</td>                        <td class="attContent2">'+st+"</td>                    </tr>")+(!ft||ft=="0"?"":'<tr>                        <td class="att2">für Frauen</td>                        <td class="attContent2">'+ft+"</td>                    </tr>")+(!zt||zt=="0"?"":'<tr>                        <td class="att2">für Familien</td>                        <td class="attContent2">'+zt+"</td>                     </tr>")+(!Dt||Dt=="0"?"":'<tr>                        <td class="att2">mit Lademöglichkeit</td>                        <td class="attContent2">'+Dt+"</td>                    </tr>")+(!Tt||Tt=="0"?"":'<tr>                        <td class="att2">für Carsharing</td>                        <td class="attContent2">'+Tt+"</td>"))+'</tr>            </table>                </div>            </div>            <table id="divURLs">                <tr>'+(ke?'<td class="attContentLink"><a href="'+ke+'" target="_blank">&#10149 Datengeber<a></td>':"")+(ke?`<td class="attContentLink"><a href="https://api.mobidata-bw.de/park-api/api/public/v3/parking-${C}s/`+x+'" class="photoMargin" target="_blank">&#10149 ParkAPI<a></td>':`<td class="attContentLink"><a href="https://api.mobidata-bw.de/park-api/api/public/v3/parking-${C}s/`+x+'" target="_blank">&#10149 ParkAPI<a></td>')+(he?'<td class="attContentLink"><a href="'+he+'" class="photoMargin" target="_blank">&#10149 Foto<a></td>':"")+"</tr>            </table>";return setTimeout(()=>{ff(O)},0),Ti}const zu=["stadtmobil_stuttgart","stadtmobil_karlsruhe","stadtmobil_suedbaden","stadtmobil_rhein-neckar","teilauto_neckar-alb","teilauto_biberach","oekostadt_renningen","gruene-flotte_freiburg","swu2go","conficars_ulm","naturenergie_sharing","coono"],Lu=["regiorad_stuttgart","callabike","callabike_ice","zeo_bruchsal","publibike_ch","velospot_ch","share_birrer_ch","zem_ch","edrivecarsharing_ch","mulhouse","nancy","mobility_ch"],Ru=["regiorad_stuttgart","callabike","callabike_ice","pickebike_basel","carvelo2go_ch"];async function C_(O){return fetch("https://api.mobidata-bw.de/sharing/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query station {
              station(id: "${O}") {
                id
                name {
                  translation {
                    language
                    value
                  }
                }
                shortName {
                  translation {
                    language
                    value
                  }
                }
                lat
                lon
                region {
                  name
                }
                capacity
                vehicleTypesCapacity {
                  vehicleTypes {
                    id
                    formFactor
                    propulsionType
                    maxRangeMeters
                    name {
                      translation {
                        language
                        value
                      }
                    }
                    returnConstraint
                  }
                  count
                }
                address
                postCode
                rentalMethods
                isValetStation
                isChargingStation
                isVirtualStation
                numVehiclesAvailable
                vehicleTypesAvailable {
                  vehicleType {
                    id
                    formFactor
                    propulsionType
                    maxRangeMeters
                    name {
                      translation {
                        language
                        value
                      }
                    }
                    returnConstraint
                  }
                  count
                }
                numDocksAvailable
                isInstalled
                isRenting
                isReturning
                lastReported
              }
            }
          `,operationName:"station",path:"/graphql"})}).then(C=>C.json()).then(C=>{const D=new Blob([JSON.stringify(C,null,2)],{type:"application/json"});return URL.createObjectURL(D)}).catch(C=>console.error("Fehler:",C))}async function M_(O){return fetch("https://api.mobidata-bw.de/sharing/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
            query vehicle {             
              vehicle(id: "${O}") {
                id
                lat
                lon
                isReserved
                isDisabled
                vehicleType {
                  id
                  formFactor
                  propulsionType
                  maxRangeMeters
                  name {
                    translation {
                      language
                      value
                    }
                  }
                  returnConstraint
                }
                currentRangeMeters
                currentFuelPercent
              }
            }
            `,operationName:"vehicle",path:"/graphql"})}).then(C=>C.json()).then(C=>{const D=new Blob([JSON.stringify(C,null,2)],{type:"application/json"});return URL.createObjectURL(D)}).catch(C=>console.error("Fehler:",C))}function th(O){const{feed_id:C,station_id:D,vehicle_id:N,name:L,capacity:q,num_vehicles_available:x,propulsion_type:c,current_fuel_percent:me,current_range_meters:Ze,max_range_meters:Ue,rental_uris_web:He,rental_uris_ios:Le,rental_uris_android:ne,last_reported:Re,realtime_data_outdated:st}=O;let ft,zt;Re&&({date:ft,time:zt}=Pf(Re));const Dt=["nextbike","callabike","pickebike","donkey","dott","voi","bolt","lime","bird","zeus","zeo","stadtmobil"],Tt=Rr(C);let Ce="";Dt.forEach(function(ge){C.match(ge)&&(Ce+=Rr(ge))});let be="";for(const ge in zu)C==zu[ge]&&(be+=zu[ge]);let ke="",he="";for(const ge in Lu)C==Lu[ge]&&(ke+=`station_id == '${Lu[ge]}'`);for(const ge in Ru)C==Ru[ge]&&(he+=`vehicle_id == '${Ru[ge]}'`);return setTimeout(()=>{const ge=document.getElementById("placeholderStation");ge&&C_(D).then(Oe=>{ge.setAttribute("href",Oe)});const Ae=document.getElementById("placeholderVehicle");Ae&&M_(N).then(Oe=>{Ae.setAttribute("href",Oe)})},0),"<table>                <tr>"+(C=="velospot_ch"||C=="publibike_ch"?Rr("velospot_publibike"):C.match("herrenberg")?Rr("Stadt Herrenberg"):"<th>"+(Ce||Tt)+"</th>")+'<th class="title">'+C+"</th></tr>    </table><br><table>"+(L?'<tr>      <td class="att">Name</td>      <td class="attContent">'+L+"</td>    </tr>":"")+(N?'<tr>        <td class="att">Fahrzeug-ID</td>        <td class="attContent attContentSharingIds">'+N+"</td>      </tr>":"")+(D?'<tr>        <td class="att">Stations-ID</td>        <td class="attContent attContentSharingIds">'+D+"</td>      </tr>":"")+(q?'<tr>      <td class="att">Kapazität</td>      <td class="attContent">'+parseInt(q)+"</td>    </tr>":"")+(x?'<td class="att">Verfügbare Fahrzeuge</td>':"")+(C==be?'<td class="attContent"><i>keine Echtzeitdaten</i></td>':x?'<td class="attContent">'+x+"</td>":"")+"</tr><tr>"+(c?'<td class="att">Antriebsart</td>':"")+(c=="electric"?'<td class="attContent">elektrisch</td>':"")+(c=="electric_assist"?'<td class="attContent">elektrische Unterstützung</td>':"")+(c=="human"?'<td class="attContent">ohne Elektrifizierung</td>':"")+"</tr>"+(me?'<tr>      <td class="att">Aktueller Ladestand</td>'+(C=="nextbike_eh"||C=="nextbike_ch"?'<td class="attContent">'+(me*1).toFixed(0)+"%</td>":'<td class="attContent">'+(me*100).toFixed(0)+"%</td>")+"</tr>":"")+(!Ze||c=="human"?"":'<tr>      <td class="att">Aktuelle Reichweite</td>      <td class="attContent">'+(Ze/1e3).toFixed(0)+"km</td>    </tr>")+(!Ue||c=="human"?"":'<tr>      <td class="att">Max. Reichweite</td>      <td class="attContent">'+(Ue/1e3).toFixed(0)+"km</td>    </tr>")+"<tr>"+(!He&&!ne&&!Le?"":'<td class="att">Buchung</td>')+('<td class="attContent">'+(He?'<a href="'+He+'" target="_blank">Web</a>':"")+((!He||!ne?"":", ")+(ne==null?"":'<a href="'+ne+'" target="_blank">Android</a>'))+((ne?", ":"")+(Le?'<a href="'+Le+'" target="_blank">IOS</a>':""))+"</td>")+(!Re||C==be?"":'<tr>        <td class="att">Stand Echtzeitdaten</td>'+(st?'<td class="attContent outDated">'+ft+", "+zt:'<td class="attContent">'+ft+", "+zt+"</td>")+"</tr>")+"</tr>            </table><table>                <tr>"+(D?'<td class="attContentLink"><a href="https://api.mobidata-bw.de/sharing/gbfs/'+C+'/station_status" target="_blank">&#10149 GBFS-Feed<a></td>':"")+(N?'<td class="attContentLink"><a href="https://api.mobidata-bw.de/sharing/gbfs/'+C+'/free_bike_status" target="_blank">&#10149 GBFS-Feed<a></td>':"")+(!D||ke?"":'<td class="attContentLink"><a id="placeholderStation" class="photoMargin" target="_blank">&#10149 Station (GraphQL)</a></td>')+(!N||he?"":'<td class="attContentLink"><a id="placeholderVehicle" class="photoMargin" target="_blank">&#10149 Fahrzeug (GraphQL)</a></td>')+"</tr>            </table>"}function P_(O){const C=document.querySelector("#canvas-"+O.id);if(C){const D=C.getContext("2d"),N=O.chargepoint_static_count+O.chargepoint_unknown_count,L=O.chargepoint_available_count,q=O.chargepoint_charging_count,x=O.chargepoint_inoperative_count+O.chargepoint_outoforder_count,me=[N+L+q+x,N,L,q,x];let Ze=0;for(let Ce in me)Ze<me[Ce]&&(Ze=me[Ce]);const Ue=C.height,He=C.width,Le=15,ne=4,Re=Ue-Le,st=1.5,ft=Ue-Le-st,zt=He/5.2,Tt=(Re-12)/Ze;D.beginPath(),D.moveTo(1.5,0),D.lineWidth=st,D.lineTo(1.5,Re),D.lineTo(He,Re),D.stroke();for(let Ce in me){const be=["#006eaf","#ffcc00","#5ce75c","#8B0000","#3a4044"],ke=["gesamt","unbekannt","verfügbar","belegt","nicht nutzbar"];D.fillStyle=be[Ce],D.fillRect(3+Ce*zt+1*Ce,ft,zt,-me[Ce]*Tt),D.font="11px, Arial",D.fillStyle="black",Ce==0?(D.fillText(me[Ce],28,Re-ne-me[Ce]*Tt),D.fillText(ke[Ce],13,Ue-2)):Ce==1?(D.fillText(me[Ce],87,Re-ne-me[Ce]*Tt),D.fillText(ke[Ce],66,Ue-2)):Ce==2?(D.fillText(me[Ce],146,Re-ne-me[Ce]*Tt),D.fillText(ke[Ce],127,Ue-2)):Ce==3?(D.fillText(me[Ce],205,Re-ne-me[Ce]*Tt),D.fillText(ke[Ce],194,Ue-2)):Ce==4&&(D.fillText(me[Ce],264,Re-ne-me[Ce]*Tt),D.fillText(ke[Ce],238,Ue-2))}}}function I_(O){const C=O.id,D=O.source,N=O.name,L=O.address,q=O.max_electric_power,x=O.operator_name;let c=new Map;c={bnetza:"Bundesnetzagentur",bnetza_api:"Bundesnetzagentur",chargecloud_stuttgart:"Stadtwerke Stuttgart",chargecloud_pforzheim:"Stadtwerke Pforzheim",ochp_albwerk:"AlbWerk",heilbronn_neckarbogen:"Stadtwerke Heilbronn",opendata_swiss:"Open-Data-Plattform Schweiz"};let me="",Ze="";for(let He in c)D==He&&(me+=Rr(c[He]),Ze+=`<td class="attContent">${c[He]}</td>`);const Ue="<table>                <tr>"+me+'<th class="title">'+L+'</th>                </tr>            </table><br><table>                <tr>                    <td class="att">Datengeber</td>'+Ze+"</tr>"+(!x||x==""?"":'<tr>        <td class="att">Betreiber</td>        <td class="attContent">'+x+"</td>        </tr>")+(N?'<tr>            <td class="att">Name</td>            <td class="attContent">'+N+"</td>            </tr>":"")+(q?'<tr>                <td class="att">Max. Ladeleistung</td>                <td class="attContent">'+(q/1e3).toLocaleString("de-DE")+"kW</td>            </tr>":"")+'</table>            <br>            <div class="title title2">Belegung Ladepunkte</div>            <br>            <table>                <tr>                    <td><canvas id="canvas-'+C+'" width="300" height="100" /></td>                </tr>            </table><table>                <tr>                    <td class="attContentLink"><a href="https://'+Fu+".mobidata-bw.de/ocpdb/api/public/v1/locations/"+C+'" target="_blank">&#10149 Open ChargePoint DataBase<a></td>                </tr>            </table>';return setTimeout(()=>{P_(O)},0),Ue}function E_(O){const{routenname:C,routen_id:D,str_name:N,fuehrung:L,richtung:q,belag:x,laenge:c,licht:me,breite:Ze,lage:Ue,b_pflicht:He,bewertung:Le,baulast:ne,status:Re,tempo:st}=O;return"<table>                <tr>"+(C?'<th class="title">'+C+"</th>":'<th class="title"><i>Routenname nicht vorhanden</i></th>')+"</tr>            </table><br><table>"+(D?'<tr>                <td class="att">Routen-ID</td>                <td class="attContent">'+D+"</td>            </tr>":"")+(N?'<tr>                <td class="att">Straßenname-ID</td>                <td class="attContent">'+N+"</td>            </tr>":"")+(L?'<tr>            <td class="att">Führungsform</td>'+(L=="100"?'<td class="attContent">Radverkehr auf Fahrbahn (Mischverkehr mit KFZ)</td>':"")+(L=="101"?'<td class="attContent">Fahrradstraße</td>':"")+(L=="102"?'<td class="attContent">Mehrzweckstreifen</td>':"")+(L=="103"?'<td class="attContent">Schutzstreifen</td>':"")+(L=="104"?'<td class="attContent">Radverkehr auf Fahrbahnen mit Straßenbahn</td>':"")+(L=="105"?'<td class="attContent">Spielstraße</td>':"")+(L=="200"?'<td class="attContent">Radfahrstreifen</td>':"")+(L=="300"?'<td class="attContent">baulich angelegte Radwege</td>':"")+(L=="301"?'<td class="attContent">Einrichtungsradwege</td>':"")+(L=="302"?'<td class="attContent">Zweirichtungsradwege</td>':"")+(L=="400"?'<td class="attContent">Führung mit Fußgängerverkehr</td>':"")+(L=="401"?'<td class="attContent">gemeinsamer Geh- und Radweg (StVO 240)</td>':"")+(L=="402"?'<td class="attContent">Führung mit Fußgängerverkehr Radfahrer frei (StVO 239)</td>':"")+(L=="403"?'<td class="attContent">Fußgängerzone</td>':"")+(L=="404"?'<td class="attContent">Gehweg (Schiebestrecke)</td>':"")+(L=="405"?'<td class="attContent">Gehweg (Radverkehr frei)</td>':"")+(L=="500"?'<td class="attContent">sonstige Wege</td>':"")+(L=="501"?'<td class="attContent">Wirtschaftsweg</td>':"")+(L=="502"?'<td class="attContent">Forstweg</td>':"")+(L=="503"?'<td class="attContent">Feldweg</td>':"")+(L=="504"?'<td class="attContent">Deichweg</td>':"")+(L=="505"?'<td class="attContent">Betriebsweg an Bundeswasserstraßen</td>':"")+(L=="506"?'<td class="attContent">Treppe</td>':"")+(L=="600"?'<td class="attContent">maschinenbetriebene Verbindungen</td>':"")+(L=="601"?'<td class="attContent">Fähre</td>':"")+(L=="602"?'<td class="attContent">Schienen- bzw. Seilbahnbetrieb</td>':"")+(L=="900"?'<td class="attContent">unbekannt</td>':"")+"</tr>":"")+(q?'<tr>            <td class="att">Fahrtrichtung</td>'+(q=="1"?'<td class="attContent">beide Richtungen</td>':"")+(q=="2"?'<td class="attContent">in Geometrierichtung</td>':"")+(q=="3"?'<td class="attContent">gegen Geometrierichtung</td>':"")+(q=="9"?'<td class="attContent">unbekannt</td>':"")+"</tr>":"")+(x?'<tr>            <td class="att">Oberflächenart</td>'+(x=="100"?'<td class="attContent">befestigte Oberfläche</td>':"")+(x=="110"?'<td class="attContent">Deckschicht aus Asphalt</td>':"")+(x=="120"?'<td class="attContent">Deckschicht aus Beton</td>':"")+(x=="130"?'<td class="attContent">Pflaster</td>':"")+(x=="131"?'<td class="attContent">Betonpflaster</td>':"")+(x=="132"?'<td class="attContent">Kopf-/Natursteinpflaster</td>':"")+(x=="140"?'<td class="attContent">Platten</td>':"")+(x=="141"?'<td class="attContent">Betonplatten</td>':"")+(x=="142"?'<td class="attContent">Natursteinplatten</td>':"")+(x=="143"?'<td class="attContent">sonstige Platten</td>':"")+(x=="200"?'<td class="attContent">wassergebundener Belag</td>':"")+(x=="201"?'<td class="attContent">feiner Splittbelag</td>':"")+(x=="202"?'<td class="attContent">grober Schotter</td>':"")+(x=="300"?'<td class="attContent">ungebundener/naturnaher Belag</td>':"")+(x=="400"?'<td class="attContent">Holz</td>':"")+(x=="500"?'<td class="attContent">Metall</td>':"")+(x=="900"?'<td class="attContent">unbekannt</td>':"")+"</tr>":"")+(c?'<tr>            <td class="att">Länge-ID</td>            <td class="attContent">'+c+"m</td>        </tr>":"")+(me?'<tr>            <td class="att">Beleuchtung</td>'+(me=="0"?'<td class="attContent">unbeleuchtet</td>':"")+(me=="1"?'<td class="attContent">beleuchtet</td>':"")+(me=="2"?'<td class="attContent">Retroreflektierende Randmarkierung</td>':"")+"</tr>":"")+(Ze?'<tr>            <td class="att">Breite</td>            <td class="attContent">'+Ze+"cm</td>        </tr>":"")+"<tr>"+(Ue?'<tr>            <td class="att">Ortslage</td>'+(Ue=="1"?'<td class="attContent">innerorts</td>':"")+(Ue=="2"?'<td class="attContent">außerorts</td>':"")+"</tr>":"")+(He?'<tr>            <td class="att">Benutzungspflicht</td>            <td class="attContent">'+He+"</td>        </tr>":"")+(Le?'<tr>            <td class="att">Bewertung</td>'+(Le=="1"?'<td class="attContent">neuwertig / sehr guter Zustand</td>':"")+(Le=="2"?'<td class="attContent">guter Zustand</td>':"")+(Le=="3"?'<td class="attContent">mittlerer Zustand</td>':"")+(Le=="4"?'<td class="attContent">unzureichender Zustand / Anlass zur Beobachtung/Analyse</td>':"")+(Le=="5"?'<td class="attContent">unbefahrbar</td>':"")+(Le=="9"?'<td class="attContent">nicht bewertet</td>':"")+"</tr>":"")+(ne?'<tr>            <td class="att">Zuständgkeit</td>'+(ne=="1"?'<td class="attContent">Bund</td>':"")+(ne=="2"?'<td class="attContent">Land</td>':"")+(ne=="3"?'<td class="attContent">Kreis</td>':"")+(ne=="4"?'<td class="attContent">Gemeinde</td>':"")+(ne=="5"?'<td class="attContent">Dritte</td>':"")+(ne=="9"?'<td class="attContent">unbekannt</td>':"")+"</tr>":"")+(Re?'<tr>            <td class="att">Status</td>'+(Re=="10"?'<td class="attContent">befahrbar</td>':"")+(Re=="20"?'<td class="attContent">in Bau</td>':"")+(Re=="30"?'<td class="attContent">in Planung</td>':"")+(Re=="40"?'<td class="attContent">gesperrt</td>':"")+(Re=="41"?'<td class="attContent">dauerhaft gesperrt</td>':"")+(Re=="42"?'<td class="attContent">saisonal gesperrt</td>':"")+(Re=="43"?'<td class="attContent">gesperrt mit Enddatum</td>':"")+"</tr>":"")+(st?'<tr>            <td class="att">Geschwindigkeit</td>            <td class="attContent">'+st+"km/h</td>        </tr>":"")+'</table><table>                <tr>                    <td class="attContentLink"><a href="https://www.balm.bund.de/SharedDocs/ExterneLinks/DE/Download/BALM_Dokumentation_Nationales-Datenmodell_Geodaten-Radverkehrsinfrastruktur.pdf?__blob=publicationFile&v=1" target="_blank">&#10149 zur Datenschema-Dokumentation<a></td>                </tr>            </table>'}function A_(O){const{stop_name:C,stop_id:D,wheelchair_boarding:N,location_type:L}=O,q=D.split("_")[0],x="https://www.efa-bw.de/rtMonitor/XSLT_DM_REQUEST?itdLPxx_banner=mobidatabw.png&itdLPxx_branding=mobidatabw&locationServerActive=1&stateless=1&sRaLP=1&itdLPxx_generalInfo=false&mode=direct&type_dm=any&itdLPxx_stopname=false&itdLPxx_genICS=false&itdLPxx_stopICS=false&itdLPxx_depLineICS=false&itdLPxx_depStopICS=false&itdLPxx_hint=false&itdLPxx_useRealtime=true",c="https://www.efa-bw.de/rtMonitor/XSLT_DM_REQUEST?itdLPxx_banner=mobidatabw.png&itdLPxx_branding=mobidatabw&locationServerActive=1&stateless=1&sRaLP=1&itdLPxx_generalInfo=false&mode=direct&type_dm=any&itdLPxx_stopname=false&itdLPxx_genICS=false&itdLPxx_stopICS=false&itdLPxx_depLineICS=false&itdLPxx_depStopICS=false&itdLPxx_hint=false&itdLPxx_useRealtime=true&itdDateTimeDepArr=arr";return"<table>                <tr>"+Rr("Piktogramm_Haltestelle")+'<th class="title">'+C+'</th>                </tr>            </table><br><table>                <tr>                    <td class="att">Haltesteig-ID</td>                    <td class="attContent">'+D+"</td>                </tr>"+(N=="accessible"?'<tr>                <td class="att" > Barrierefreiheit</td >                <td class="attContent">Rollstuhl-Einstiegsmöglichkeit</td>            </tr>':"")+'<tr>            </table><table>                <tr>                    <td colspan="2" class="attContentLink"><a href="https://api.mobidata-bw.de/gtfs/stops?stop_id=eq.'+D+'" target="_blank">&#10149 Haltestelle/Station<a></td>                </tr><tr>'+(L=="station"?'<td class="attContentLink"><a href="'+x+"&name_dm="+q+'" target="_blank">&#10149 Abfahrtsmonitor<a></td><td class="attContentLink"><a href="'+c+"&name_dm="+q+'" target="_blank">&#10149 Ankunftsmonitor<a></td>':'<td class="attContentLink"><a href="'+x+"&name_dm="+D+'" target="_blank">&#10149 Abfahrtsmonitor<a></td><td class="attContentLink"><a href="'+c+"&name_dm="+D+'" target="_blank">&#10149 Ankunftsmonitor<a></td>')+"</tr>            </table>"}function k_(O){const{prio_route_type:C,station_name:D,station_id:N}=O;return"<table>                <tr>"+(C=="0"?Rr("Piktogramm_U_Bahn"):"")+(C=="2"?Rr("Piktogramm_Bahn"):"")+(C=="3"?Rr("Piktogramm_Bus"):"")+'<th class="title">'+D+'</th>                </tr>            </table><br><table>                <tr>                    <td class="att">Haltestellen-ID</td>                    <td class="attContent">'+N+"</td>               </tr>            </table>"}function z_(O){const{route_names:C,route_ids:D,agency_id:N,agency_name:L,agency_url:q}=O,x={rab:{teilnetz:"Regionalverkehr Alb-Bodensee",teilnetzBeschreibung:"",datengeber:"Regionalverkehr Alb-Bodensee",verkehrsmittel:"Bus"},rbs:{teilnetz:"Regional Bus Stuttgart",teilnetzBeschreibung:"",datengeber:"Regional Bus Stuttgart",verkehrsmittel:"Bus"},sbg:{teilnetz:"Südbadenbus",teilnetzBeschreibung:"",datengeber:"Südbadenbus",verkehrsmittel:"Bus"},ovf:{teilnetz:"Ominbusverkehr Franken",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"},rvs:{teilnetz:"Südwestbus",teilnetzBeschreibung:"",datengeber:"Südwestbus",verkehrsmittel:"Bus"},vvs:{teilnetz:"Verkehrsverbund Stuttgart",teilnetzBeschreibung:"",datengeber:"Verkehrsverbund Stuttgart",verkehrsmittel:"Regionalverkehr, Straßen-/S-/U-Bahn, Bus"},vrn:{teilnetz:"Verkehrsverbund Rhein-Neckar",teilnetzBeschreibung:"",datengeber:"Verkehrsverbund Rhein-Neckar",verkehrsmittel:"Straßen-/S-/U-Bahn, Bus, Fähre, Seilbahn"},tub:{teilnetz:"Verkehrsverbund Neckar-Alb-Donau",teilnetzBeschreibung:"",datengeber:"Verkehrsverbund Neckar-Alb-Donau",verkehrsmittel:"Regionalverkehr, Bus"},din:{teilnetz:"Donau-Iller-Nahverkehrsverbund",teilnetzBeschreibung:"DING übernimmt Datenlieferung für den Heidenheimer Tarifverbund",datengeber:"Donau-Iller-Nahverkehrsverbund",verkehrsmittel:"Straßen-/S-/U-Bahn, Bus"},kvv:{teilnetz:"Karlsruher Verkehrsverbund",teilnetzBeschreibung:"",datengeber:"Karlsruher Verkehrsverbund",verkehrsmittel:"Straßen-/S-/U-Bahn, Bus"},bod:{teilnetz:"Bodensee-Oberschwaben-Verkehrsverbund",teilnetzBeschreibung:"",datengeber:"Bodensee-Oberschwaben-Verkehrsverbund",verkehrsmittel:"Regionalverkehr, Bus"},hnv:{teilnetz:"Heilbronner Hohenloher Haller Nahverkehr",teilnetzBeschreibung:"",datengeber:"Heilbronner Hohenloher Haller Nahverkehr",verkehrsmittel:"Regionalverkehr, Straßen-/S-/U-Bahn, Bus"},oam:{teilnetz:"OstalbMobil",teilnetzBeschreibung:"",datengeber:"OstalbMobil",verkehrsmittel:"Bus"},tvv:{teilnetz:"Move (TUTicket)",teilnetzBeschreibung:"ehemals TUTicket",datengeber:"Move (TUTicket)",verkehrsmittel:"Bus"},vsb:{teilnetz:"Move (VSB)",teilnetzBeschreibung:"ehemals Verkehrsverbund Schwarzwald-Baar",datengeber:"Landratsamt Schwarzwald-Baar-Kreis",verkehrsmittel:"Bus"},vvr:{teilnetz:"Move (VVR)",teilnetzBeschreibung:"ehemals Verkehrsverbund Rottweil",datengeber:"Move (VVR)",verkehrsmittel:"Bus"},cw:{teilnetz:"Verkehrsgesellschaft Calw",teilnetzBeschreibung:"",datengeber:"Verkehrsgesellschaft Calw",verkehrsmittel:"Bus"},tgo:{teilnetz:"Tarifverbund Ortenau",teilnetzBeschreibung:"",datengeber:"Tarifverbund Ortenau",verkehrsmittel:"Bus"},vhb:{teilnetz:"Verkehrsverbund Hegau-Bodensee",teilnetzBeschreibung:"",datengeber:"Verkehrsverbund Hegau-Bodensee",verkehrsmittel:"Bus"},vpe:{teilnetz:"Verkehrsverbund Pforzheim-Enzkreis",teilnetzBeschreibung:"",datengeber:"Verkehrsverbund Pforzheim-Enzkreis",verkehrsmittel:"Bus"},vsh:{teilnetz:"Kreisverkehr Schwäbisch Hall",teilnetzBeschreibung:"",datengeber:"Kreisverkehr Schwäbisch Hall",verkehrsmittel:"Bus"},fds:{teilnetz:"Verkehrsgemeinschaft Freudenstadt",teilnetzBeschreibung:"",datengeber:"Verkehrsgemeinschaft Freudenstadt",verkehrsmittel:"Bus"},ddb:{teilnetz:"Verschiedene Eisenbahngesellschaften",teilnetzBeschreibung:"",datengeber:"Europäisches Fahrplanzentrum",verkehrsmittel:"Regionalverkehr, Straßen-/S-/U-Bahn"},swh:{teilnetz:"Nahverkehr Hohenlohekreis",teilnetzBeschreibung:"Der NVH ist tariflich Teil des HNV, bestellt im Hohenlohekreis als dessen Eigenbetrieb aber die Busverkehre",datengeber:"Nahverkehr Hohenlohekreis",verkehrsmittel:"Bus"},frb:{teilnetz:"Freiburger Verkehrs AG",teilnetzBeschreibung:"",datengeber:"Freiburger Verkehrs AG",verkehrsmittel:"Straßen-/S-/U-Bahn, Bus"},swg:{teilnetz:"SWEG",teilnetzBeschreibung:"",datengeber:"SWEG",verkehrsmittel:"Bus"},omp:{teilnetz:"Omnipart",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"},vu:{teilnetz:"Verkehrsgemeinschaft am Bayerischen Untermain",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"},gai:{teilnetz:"Omnibusverkehr Gairing und Omnibus Weidachstein",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"},ghu:{teilnetz:"Gute Reise Hauck",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"},grh:{teilnetz:"Grasmann-Reisen Gmbh",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"},als:{teilnetz:"Fluo Grand Est",teilnetzBeschreibung:"umfasst in der Region Grand Est das Elsass und Lothringen",datengeber:"Fluo Grand Est",verkehrsmittel:"Straßen-/S-/U-Bahn, Bus"},sbb:{teilnetz:"Schweizer Bundesbahn",teilnetzBeschreibung:"Landesweites Netz",datengeber:"Basler Verkehrsbetrieb",verkehrsmittel:"Regionalverkehr, Straßen-/S-/U-Bahn, Bus, Fähre"},bvb:{teilnetz:"Basler Verkehrsbetrieb",teilnetzBeschreibung:"",datengeber:"Basler Verkehrsbetrieb",verkehrsmittel:"Straßen-/S-/U-Bahn, Bus"},nvb:{teilnetz:"NVBW",teilnetzBeschreibung:"seitens der NVBW eingepflegte Linien",datengeber:"NVBW",verkehrsmittel:"Bus"},bus:{teilnetz:"Flix",teilnetzBeschreibung:"FlixBus und FlixTrain",datengeber:"DELFI",verkehrsmittel:"Regionalverkehr, Bus"},hn:{teilnetz:"Bürgerbusverkehre",teilnetzBeschreibung:"enthalten sind Bürgerbusverkehre, die nicht über Verkehrsverbünde abgebildet werden",datengeber:"Match Rider im Auftrag der Bürgerbus-Vereine",verkehrsmittel:"Bus"},nth:{teilnetz:"Verkehrsgemeinschaft Mittelthüringen",teilnetzBeschreibung:"Thüringer Landesnetz",datengeber:"Verkehrsgemeinschaft Mittelthüringen",verkehrsmittel:"Regionalverkehr"},rmv:{teilnetz:"Rhein-Main-Verkehrsverbund",teilnetzBeschreibung:"",datengeber:"Rhein-Main-Verkehrsverbund Servicegesellschaft",verkehrsmittel:"Bus"},vgn:{teilnetz:"Verkehrsverbund Großraum Nürnberg",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"},wvv:{teilnetz:"Würzburger Versorgungs- und Verkehrs-GmbH",teilnetzBeschreibung:"",datengeber:"DEFAS Bayern (Angebot der Bayerischen Eisenbahngesellschaft)",verkehrsmittel:"Bus"}},c=D.split("-")[0];let me="",Ze="",Ue="",He="";for(let Le in x)Le=Le.split("-")[0],c==Le&&(me+=x[Le].teilnetz,Ze+=x[Le].teilnetzBeschreibung,Ue+=x[Le].datengeber,He+=x[Le].verkehrsmittel);return"<table>                <tr>"+(me=="Verschiedene Eisenbahngesellschaften"||me==""?"":me=="Move (TUTicket)"||me=="Move (VSB)"||me=="Move (VVR)"?Rr("MOVE"):Rr(me))+'<th class="title">'+C+'</th>                </tr>            </table>        <br><table>                <tr>                    <td class="att">Linien-ID</td>                    <td class="attContent">'+D+'</td>                </tr><tr>                    <td class="att">Betreiber-ID</td>                    <td class="attContent">'+N+'</td>                </tr><tr>                    <td class="att">Betreibername</td>                    <td class="attContent">'+L+'</td>                </tr><tr>                    <td class="att">Betreiber-Webseite</td>                    <td class="attContent"><a href="'+q+'" target="_blank">Link</a></td>                </tr>            </table>'+(me==""?"":'<br><table>            <div class="title title2">Teilnetz</div>'+(me==Ue?'<tr>                <td class="att">Name/Datengeber</td>                <td class="attContent">'+me+"</td>            </tr>":"")+(me!=Ue?'<tr>                <td class="att">Name</td>                <td class="attContent">'+me+'</td>            </tr><tr>                <td class="att">Datengeber</td>                <td class="attContent">'+Ue+"</td>            </tr>":"")+(Ze==""?"":'<tr>                <td class="att">Beschreibung</td>                <td class="attContent">'+Ze+"</td>            </tr>")+'<tr>        <td class="att">Bus</td>'+(He.match("Bus")?'<td class="tdDatengeber">&#10003;</td>':'<td class="tdDatengeber">&#x2717;</td>')+'</tr><tr><td class="att">Regionalverkehr</td>'+(He.match("Regionalverkehr")?'<td class="tdDatengeber">&#10003;</td>':'<td class="tdDatengeber">&#x2717;</td>')+'</tr><tr><td class="att">Straßen-, S- oder U-Bahn</td>'+(He.match("Straßen-/S-/U-Bahn")?'<td class="tdDatengeber">&#10003;</td>':'<td class="tdDatengeber">&#x2717;</td>')+'</tr><tr><td class="att">Fähre</td>'+(He.match("Fähre")?'<td class="tdDatengeber">&#10003;</td>':'<td class="tdDatengeber">&#x2717;</td>')+'</tr><tr><td class="att">Seilbahn</td>'+(He.match("Seilbahn")?'<td class="tdDatengeber">&#10003;</td>':'<td class="tdDatengeber">&#x2717;</td>')+"</tr>    </table>")+'<table>                <tr>                    <td class="attContentLink"><a href="https://api.mobidata-bw.de/gtfs/routes?route_id=eq.'+D+'" target="_blank">&#10149 Linie<a></td>                    <td class="attContentLink"><a href="https://api.mobidata-bw.de/gtfs/trips?route_id=eq.'+D+'" class="photoMargin" target="_blank">&#10149 Fahrten<a></td>                </tr>            </table>'}function L_(O){const{street:C,direction:D,type:N,subtype:L,starttime:q,endtime:x,description:c}=O;return"<table>                    <tr>"+(C==null?"":'<th class="title">'+C+"</th>")+"</tr>                </table><br><table>                    <tr>"+(D==null?"":'<td class="att">Richtung</td>')+(D=="BOTH_DIRECTIONS"?'<td class="attContent">Beide Richtungen</td>':"")+(D=="ONE_DIRECTION"?'<td class="attContent">Eine Richtung</td>':"")+"</tr><tr>"+(N==null?"":'<td class="att">Einschränkung</td>')+(L=="ROAD_CLOSED_CONSTRUCTION"?'<td class="attContent">Straße gesperrt wegen Bauarbeiten</td>':(N=="ROAD_CLOSED"?'<td class="attContent">Straße gesperrt</td>':"")+(N=="CONSTRUCTION"?'<td class="attContent">Bauarbeiten</td>':""))+"</tr>"+(q==null?"":'<tr>            <td class="att">Beginn</td>            <td class="attContent">'+q+"</td>        </tr>")+(x==null?"":'<tr>            <td class="att">Ende</td>            <td class="attContent">'+x+"</td>            </tr>")+(c==null?"":'<tr>            <td class="att">Beschreibung</td>            <td class="attContent">'+c+"</td>         </tr>")+"</table>"}function R_(O){const C=O.klasse,D=O.nummer,N=O.svznr,L=O.RI,q=O.RII,x=O.DTV2023,c=O.DTVSV,me=O.zstart;return'<table>        <tr><th class="title">'+C+D+"</th></tr>    </table><br><table>"+(N==null?"":'<tr>                <td class="att">Zählstellen-Nr.</td>                <td class="attContent">'+N+"</td>            </tr>")+(L==null?"":'<tr>                <td class="att">Von</td>                <td class="attContent">'+L+"</td>            </tr>")+(q==null?"":'<tr>                <td class="att">Nach</td>                <td class="attContent">'+q+"</td>            </tr>")+(x==null?"":'<tr>                <td class="att">DTV KFZ</td>                <td class="attContent">'+x.toLocaleString()+"</td>            </tr>")+(c==null?"":'<tr>                <td class="att">DTV SV</td>                <td class="attContent">'+c.toLocaleString()+"</td>            </tr>")+'<tr>            <td class="att">Ergebnis aus Jahr</td>            <td class="attContent">2023</td>        </tr>    </table><table>        <tr>            <td class="attContentLink"><a href="https://www.mobidata-bw.de/dataset/endergebnisse_strassenverkehrszaehlung#daten&ressourcen" target="_blank">&#10149 Endergebnisse der SVZ</a></td>        </tr>'+(me=="DZ"?'<tr>            <td class="attContentLink"><a href="https://mobidata-bw.de/dataset/ergebnisse_ganglinien_dauerzaehlstellen#daten&ressourcen" target="_blank">&#10149 Ergebnisse der Dauerzählstellen</a></td>        </tr><tr>            <td class="attContentLink"><a href="https://mobidata-bw.de/dataset/stundenwerte_dauerzaehlstellen#daten&ressourcen" target="_blank">&#10149 Stundenwerte der Dauerzählstellen</a></td>        </tr>':"")+"</table > "}function D_(O){const C=document.getElementById("canvas-"+O.counter_site_id),D=C.getContext("2d"),N=2013,L=2024;let q=0;for(let ft=N;ft<=L;ft++)q<O[`${ft}_ALL`]&&(q=O[`${ft}_ALL`]);const x=C.height,c=C.width,me=15,Ze=4,Ue=x-me,He=1.5,Le=x-me-He,ne=c/13,st=(Ue-12)/q;if(O.ALL!=0&&O.ALL!=null){D.beginPath(),D.moveTo(1.5,0),D.lineWidth=He,D.lineTo(1.5,Ue),D.lineTo(c,Ue),D.stroke();for(let ft=N,zt=0;ft<=L;ft++,zt++){const Dt=`${ft}_ALL`,Tt=O[Dt],be=(Tt/1e6).toFixed(2).toString().replace(".",","),ge="'"+`${ft}`.toString().substring(2,5);let Ae;Tt<=1e5?Ae="#ffe600":Tt>1e5&&Tt<=5e5?Ae="#f6b500":Tt>5e5&&Tt<=1e6?Ae="#e78300":Tt>1e6&&Tt<=2e6?Ae="#d25000":Tt>2e6?Ae="#b70101":Ae="#cacaca",D.fillStyle=Ae,D.fillRect(3+zt+zt*ne,Le,ne,-O[Dt]*st),D.font="11px, Arial",D.fillStyle="black",Tt!=0&&D.fillText(be,5+zt*1+zt*ne,Ue-Ze-O[Dt]*st),D.fillText(ge,8+zt*1+zt*ne,x)}}else C.remove()}function B_(O){const C=O.domain_name,D=O.counter_site,N=O.counter_site_id,L=O.ALL,q='<table id="popupContentTableCountBicycle">                <tr>'+(C=="Stadt Freiburg"?Rr("Stadt Freiburg im Breisgau"):Rr(C))+'<th class="title">'+D+'</th>                </tr>            </table><br><table>                <tr>                    <td class="att">Datengeber</td>                    <td class="attContent">'+C+'</td>                </tr><tr>                    <td class="att">Zählstellen-ID</td>                    <td class="attContent">'+N+"</td>                </tr>            </table>"+(L?'<br><table>                <tr>                    <td class="title title2">Jährliche Zähldaten seit 2013 (in Mio.)</td>                </tr>            </table><table>                <tr>'+(L==0?'<td><i class="attContent">keine Zähldaten</i></td>':"")+"</table>":"")+'<table>                <tr>                    <td><canvas id="canvas-'+N+'" width="300" height="100" /></td>                <tr>            </table>            <table>                <tr>                    <td class="attContentLink"><a href="https://www.mobidata-bw.de/dataset/eco-counter-fahrradzahler#daten&ressourcen" target="_blank">&#10149 zu den Daten<a></td>                <tr>            </table>';return setTimeout(()=>{D_(O)},0),q}function F_(O){const C=O.id,D=O.id_2,N=O.check_date,L=O.check_da_1,q=O.check_da_2,x=O.check_da_3,c=O.check_da_4,me=O.check_da_5,Ze=O.survey_dat,Ue=O.highway,He=O.turning_circle,Le=O.kerb,ne=O.surface,Re=O.wheelchair,st=O.image;return"<table>                <tr>"+Rr("OpenStreetMap")+(C?'<th class="title">'+C+"</th>":"")+(D?'<th class="title">'+D+"</th>":"")+"</tr>            </table><br><table>                <tr>"+(!N&&!L&&!q&&!x&&!c&&!me&&!Ze?"":'<td class="att">Letze Überprüfung</td>')+(N?'<td class="attContent">'+N+"</td>":"")+(L?'<td class="attContent">'+L+"</td>":"")+(q?'<td class="attContent">'+q+"</td>":"")+(x?'<td class="attContent">'+x+"</td>":"")+(c?'<td class="attContent">'+c+"</td>":"")+(me?'<td class="attContent">'+me+"</td>":"")+(Ze?'<td class="attContent">'+Ze+"</td>":"")+"</tr><tr>"+(Ue?'<td class="att">Straßentyp</td>':"")+(Ue=="crossing"?'<td class="attContent">Fußgängerüberweg</td>':"")+(Ue=="footway"?'<td class="attContent">Gehweg</td>':"")+(Ue=="cycleway"?'<td class="attContent">Radweg</td>':"")+(Ue=="path"?'<td class="attContent">Wanderweg/Trampelpfad</td>':"")+(Ue=="proposed"?'<td class="attContent">Geplante, noch nicht gebaute Straße</td>':"")+(Ue=="service"?'<td class="attContent">Erschließungsweg</td>':"")+(Ue=="track"?'<td class="attContent">Wirtschafts-, Feld- oder Waldweg</td>':"")+(Ue=="pedestrian"?'<td class="attContent">Weg, Platz oder Straße ausschließlich für Fußgänger (z.B. Fußgängerzone)</td>':"")+(He=="turning_circle"?'<td class="attContent">Wendestelle</td>':"")+(He=="traffic_signals"?'<td class="attContent">Ampel</td>':"")+"</tr><tr>"+(Le?'<td class="att">Bordstein</td>':"")+(Le=="no"?'<td class="attContent">nein</td>':"")+(Le=="lowered"?'<td class="attContent">abgesenkt</td>':"")+(Le=="raised"?'<td class="attContent">erhöht</td>':"")+(Le=="flush"?'<td class="attContent">auf Straßenebene</td>':"")+"</tr><tr>"+(ne?'<td class="att">Oberfläche</td>':"")+(ne=="asphalt"?'<td class="attContent">Asphalt</td>':"")+(ne=="paving_stones"?'<td class="attContent">Pflastersteine</td>':"")+(ne=="sett"?'<td class="attContent">Behauenes Steinpflaster</td>':"")+(ne=="cobblestone"?'<td class="attContent">Kopfsteinpflaster</td>':"")+(ne=="cobblestone:flattened"?'<td class="attContent">Pflaster mit abgeflachten Steinen</td>':"")+(ne=="compacted"?'<td class="attContent">Verdichtete Deckschicht</td>':"")+(ne=="concrete"?'<td class="attContent">Beton</td>':"")+(ne=="concrete:plates"?'<td class="attContent">Betonplatten</td>':"")+(ne=="ground"?'<td class="attContent">Gewachsene, naturbelassene Oberfläche</td>':"")+(ne=="grass_paver"?'<td class="attContent">Rasengittersteine</td>':"")+(ne=="pebblestone"?'<td class="attContent">Kies</td>':"")+(ne=="unhewn_cobblestone"?'<td class="attContent">Rohes Kopfsteinpflaster</td>':"")+(ne=="unpaved"?'<td class="attContent">Ohne Straßenbelag</td>':"")+"</tr><tr>"+(Re?'<td class="att">Rollstuhlbefahrbarkeit</td>':"")+(Re=="yes"?'<td class="attContent">ja</td>':"")+(Re=="no"?'<td class="attContent">nein</td>':"")+(Re=="limited"?'<td class="attContent">begrenzt</td>':"")+"</tr>            </table><table>                <tr>"+(st?'<td class="attContentLink"><a href="'+st+'" target="_blank">&#10149 Foto</a></td>':"")+"</tr>            </table>"}function O_(O){let C=!1;for(let D=0;D<O.length;D++){if(!O[D].checked){C=!1;break}C=!0}return C}function j_(O,C){if(O.style.height=O.scrollHeight+"px",O.scrollHeight>50)O.style.height="36px",setTimeout(function(){var L=O.children;if(L.length>1&&L[C].style.display==="none")for(var q=C;q<L.length;q++)L[q].dataset.hidden||(L[q].style.display="block");else for(var q=C;q<L.length;q++)L[q].style.display="none";O.style.height="auto"},400);else{var D=O.children;if(D.length>1&&D[C].style.display==="none")for(var N=C;N<D.length;N++)D[N].dataset.hidden||(D[N].style.display="block");else for(var N=C;N<D.length;N++)D[N].style.display="none";O.style.height=O.scrollHeight+"px",setTimeout(function(){O.style.height="auto"},400)}}function mf(O,C){let D=C.reduce((me,Ze)=>[...me,Ze.id],[]),N=O,L=N.getStyle().layers,q=If(L),x=new URLSearchParams(window.location.search),c=[...x.keys()];return[...x.values()],c.map(function(me){D.indexOf(me)>-1&&(Vu(L,q,me)||N.setLayoutProperty(me,"visibility","visible"))}),c}function gf(O,C,D){let N=C===!0?"visible":"none";O.setLayoutProperty(D,"visibility",N)}function N_(O,C){let D=O.filter(function(N){return N.id===C.id});return!!D[0].paint&&D[0].paint}function If(O){return O.reduce((C,D)=>[...C,D.id],[])}function Vu(O,C,D){var N=C.indexOf(D);return!(N<0)&&O[N].layout.visibility==="visible"}class Vl{constructor(C){C=C||{},this._collapsed=!1,(C.options&&C.options.collapsed||C&&C.collapsed)&&(this._collapsed=!0),C.options&&C.options.addLayers&&(this._addLayers=!0),this._layers=C.layers.reverse().slice(),this._layerIds=this._layers.reduce((x,c)=>[...x,c.id],[]);let D=[],N=[];D=this._layers.reduce(function(x,c){return[...x,c.directory]},[]),this._directories=[...new Set(D)],N=this._layers.reduce(function(x,c){return c.group||(c.group="Operational Layers"),[...x,c.group]},[]),this._groups=[...new Set(N)];let L={};this._directories.forEach(function(x){C.layers.forEach(function(c){c.directory===x&&(L[c.directory]={})})}),this._layers.forEach(function(x){x.group||(x.group="Operational Layers"),L[x.directory][x.group]=[]}),this._layers.forEach(function(x){L[x.directory][x.group].push(x)});let q=this._layers.slice();this._layers.forEach(function(x){x.name||(x.name=x.id),x.metadata||(x.metadata={}),x.metadata.layers||(x.metadata.layers=[x.id]),x.children&&q.forEach(c=>{c.parent&&c.parent===x.id&&(x.metadata.layers=[...x.metadata.layers,c.id])})}),this._layerControlConfig=L}onAdd(C){this._map=C;let D=this;this._sources=[],this._container=C.getContainer(),this._div=$_(this._collapsed);const N=mf(this._map,this._layers);this._layers.forEach(L=>{L.parent&&N.includes(L.parent)&&(C.setLayoutProperty(L.id,"visibility","visible"),Zu(L.id,!0)),L.parent&&N.includes(L.id)&&!N.includes(L.parent)&&(C.setLayoutProperty(L.id,"visibility","none"),C.setLayoutProperty(L.parent,"visibility","none"),Zu(L.id,!1))}),this._activeLayers=mf(this._map,this._layers),this._mapLayers=this._map.getStyle().layers,this._mapLayerIds=If(this._mapLayers);for(let L in this._layerControlConfig){let q=L,x=0;this._layers.forEach(me=>{if(me.directory===L&&!me.parent){var Ze=Vu(this._mapLayers,this._mapLayerIds,me.id);Ze&&(x=x+1)}});let c=U_(q,x);for(let me in this._layerControlConfig[L]){let Ze=G_(me,this._layerControlConfig[L][me]),Ue=this._layerControlConfig[L][me];for(let He=0;He<Ue.length;He++){let Le=Ue[He],ne=N_(this._mapLayers,Le);!Le.legend&&ne&&(Le.simpleLegend=q_(ne));let Re;Re=Vu(this._mapLayers,this._mapLayerIds,Le.id);let{layerSelector:st,newSources:ft}=V_(this._map,Le,Re,this._sources);this._sources=ft,Ze.appendChild(st)}c.appendChild(Ze)}this._div.appendChild(c)}return this._collapsed&&(this._div.addEventListener("mouseenter",function(L){setTimeout(function(){L.target.classList.remove("collapsed")},0)}),this._div.addEventListener("mouseleave",function(L){L.target.classList.add("collapsed")})),this._div.addEventListener("click",function(L){if(L.target.dataset.layerControl){L.target.classList.remove("collapsed");return}if(L.target.className==="checkbox"){L.target.children[0].click();return}if(L.target.dataset.mapLayer){if(gf(C,L.target.checked,L.target.id),L.target.dataset.children){let q=document.querySelectorAll("[data-parent]");for(let x=0;x<q.length;x++)q[x].dataset.parent===L.target.id&&q[x].click()}return}if(L.target.dataset.mapLayer&&L.target.dataset.group!=!1){L.stopPropagation();let q=L.target.dataset.group,x=document.querySelectorAll("[data-group]");for(let c=0;c<x.length;c++)q!="false"&&x[c].dataset.group===q&&gf(C,L.target.checked,x[c].id);return}if(L.target.dataset.layergroup){let q=L.target.parentElement.querySelectorAll("[data-master-layer]");if(O_(q))for(let x=0;x<q.length;x++){let c=q[x];c.checked&&c.click()}else for(let x=0;x<q.length;x++)q[x].checked||q[x].click();return}if(L.target.dataset.directoryToggle){L.target.parentElement.children[2].style.display!="none"?L.target.parentElement.children[0].className="collapsed":L.target.parentElement.children[0].className="",j_(L.target.parentElement,2),setTimeout(function(){Q_(L.target.parentElement)||(window.location.hash=L.target.id)},410),setTimeout(function(){D._map.resize()},450);return}}),this._collapsed&&this._map.on("click",function(){D._div.classList.add("collapsed")}),this._map.on("zoomend",function(){let L=this;document.querySelectorAll("[data-master-layer]").forEach(function(x){x.dataset.minzoom&&x.dataset.minzoom>L.getZoom()?(x.parentElement.style.opacity="0.3",x.disabled=!0):(x.parentElement.style.opacity="1",x.disabled=!1)})}),this._div}onRemove(C){this._map=C,this._div.parentNode.removeChild(this._div),this._map=void 0}}function V_(O,C,D,N){let L=document.createElement("div");L.className="checkbox",L.title="Map Layer",C.hidden&&(L.style.display="none",L.dataset.hidden=!0);let q=document.createElement("input");q.name=C.name?C.name:C.id,q.type="checkbox",q.id=C.id,q.dataset.group=C.group?C.group:!1,C.metadata.lazyLoading&&C.metadata.source&&C.metadata.source.id&&C.metadata.source.type&&C.metadata.source.data&&(q.dataset.lazyLoading=!0,q.dataset.source=C.metadata.source.id,q.dataset.sourceType=C.metadata.source.type,q.dataset.sourceData=C.metadata.source.data,N.push(C.metadata.source.id)),C.minzoom&&(q.dataset.minzoom=C.minzoom),C.children&&(q.dataset.children=!0,q.dataset.masterLayer=!0),C.parent?q.dataset.parent=C.parent:q.dataset.masterLayer=!0,q.className="layer slide-toggle",q.dataset.mapLayer=!0,q.dataset.directory=C.directory?C.directory:"",D&&(q.checked=!0),_f(O,q),q.onclick=function(){_f(O,this),Zu(this.id,this.checked),H_(this),Z_(this)};let x=document.createElement("label");x.setAttribute("for",C.id);let c=document.createElement("div");if(x.innerHTML=C.name?C.name:C.id,x.dataset.layerToggle="true",L.appendChild(q),L.appendChild(x),C.metadata&&C.metadata.filterSchema){let me=document.createElement("span");me.style.float="right",me.style.height="20px",me.style.opacity=.3,me.innerHTML=Y_(),me.onclick=function(){W_(O,C)},me.onmouseenter=function(){this.style.opacity=1},me.onmouseleave=function(){this.style.opacity=.3},L.appendChild(me)}return L.appendChild(c),{layerSelector:L,newSources:N}}function _f(O,C){if(C.dataset.lazyLoading&&C.checked&&!C.dataset.sourceLoaded){const D=O.getSource(C.dataset.source);if(!D)return;if(!D._data.features.length){const N=J_(O);fetch(C.dataset.sourceData,{cache:"force-cache"}).then(L=>L.json()).then(L=>{const q=O.getSource(C.dataset.source);(q._data.features&&!q._data.features.length||q._data.geometries&&!q._data.geometries.length)&&O.getSource(C.dataset.source).setData(L),N.style.display="none",N.remove(),C.setAttribute("data-source-loaded",!0)})}}}function Z_(O){let C=O.closest(".mgl-layerControlDirectory"),D=C.querySelectorAll("[data-master-layer]"),N=0;D.forEach(function(L){L.checked&&(N=N+1)}),N>0?(C.children[1].children[0].innerHTML=N,C.children[1].children[0].style.display="block"):C.children[1].children[0].style.display="none"}function U_(O,C){let D=document.createElement("div");D.dataset.accordian=!0,D.style.backgroundColor="white",D.className="mgl-layerControlDirectory";let N=document.createElement("button");N.dataset.directoryToggle=!0,D.appendChild(N);let L=document.createElement("div");L.className="directory",L.id=O.replace(/ /g,"_"),L.innerText=O,L.dataset.name=O,L.dataset.directoryToggle=!0;var q=document.createElement("span");return q.style.background="#0d84b3",q.className="mgl-layerControlDirectoryCounter",q.style.display=C===0?"none":"block",q.innerText=C||"",q.style.float="right",q.style.color="white",q.style.padding="1px 4px 0",L.appendChild(q),D.appendChild(L),D}function G_(O,C,D){let N=document.createElement("div");N.style.margin="4px 0 4px 8px";let L=document.createElement("input");L.type="checkbox";let q="layerGroup_"+O.replace(/ /g,"_");L.id=q,L.style.display="none",L.dataset.layergroup=O;let x=document.createElement("label");return x.setAttribute("for",q),x.className="mgl-layerControlGroupHeading",x.textContent=O,N.appendChild(L),N.appendChild(x),N}function $_(O){let C=document.createElement("div");return C["aria-label"]="Layer Control",C.dataset.layerControl="true",C.className="mapboxgl-ctrl mapboxgl-ctrl-group mgl-layerControl",O&&C.classList.add("collapsed"),C}function q_(O){let C=Object.keys(O),D=!1;return C.indexOf("line-color")>-1&&Du(O["line-color"])&&(D=`<icon class='fa fa-minus' style='color:${O["line-color"]};margin-right:6px;'></icon>`),C.indexOf("fill-color")>-1&&Du(O["fill-color"])&&(D=`<icon class='fa fa-square' style='color:${O["fill-color"]};margin-right:6px;'></icon>`),C.indexOf("circle-color")>-1&&Du(O["circle-color"])&&(D=`<icon class='fa fa-circle' style='color:${O["circle-color"]};margin-right:6px;'></icon>`),D}function Du(O){return typeof O=="string"||O instanceof String}function Zu(O,C){let D=O,N=C,L=new URLSearchParams(window.location.search);if(N){if(L.set(D,!0),history.replaceState){let q=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+L.toString()+window.location.hash;window.history.replaceState({path:q},"",q)}}else if(L.delete(D),history.replaceState){let q=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+L.toString()+window.location.hash;window.history.replaceState({path:q},"",q)}}function H_(O){let C=O.parentElement.querySelectorAll("[data-layer-child-legend]"),D=O.checked?"block":"none";for(let N=0;N<C.length;N++)C[N].style.display=D}function W_(O,C){console.log(C);var D=C.id+"_FilterModal";if(document.getElementById(D))window.location.hash="#",window.location.hash=D;else{var N=document.createElement("div");N.id=D,N.classList="modal",N.style.alignItems="flex-start",N.innerHTML=`
    <a href="#close" class="modal-overlay" aria-label="Close" style="opacity: 0.8"></a>
    <div class="modal-container" style="width: 400px;">
      <div class="modal-header">
        <a href="#close" class="btn btn-clear float-right modal-close" aria-label="Close"></a>
        <div class="modal-title h4">
          <span>Filter ${C.name}</span>
        </div>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
      </div>
    </div>`;var L=document.createElement("form");L.innerHTML=`
      ${X_(C.metadata.filterSchema)}
      <br>
      <button type="submit" class="btn btn-primary">Submit</button>
      <button class="btn btn-outline" type="reset" style="float:right">Reset</button>
    `,L.addEventListener("submit",function(q){q.preventDefault(),window.location.hash="#";var x=K_(new FormData(L),C);console.log(x),x?C.metadata.layers.forEach(c=>{O.setFilter(c,x)}):C.metadata.layers.forEach(c=>{O.setFilter(c)})}),L.addEventListener("reset",function(q){C.metadata.layers.forEach(x=>{O.setFilter(x)})}),N.querySelector(".modal-body").appendChild(L),document.body.appendChild(N),window.location.hash="#",window.location.hash=D}}function K_(O,C){const D=[...O.keys()],N=[...O.values()];for(var L=[],q=0;q<D.length;q++){if(D[q].includes("operator")||!N[q])continue;let x=N[q];switch(C.metadata.filterSchema[D[q]].type==="date"&&C.metadata.filterSchema[D[q]].epoch&&(x=new Date(x+"T00:00:00").getTime()),console.log(x),C.metadata.filterSchema[D[q]].type){case"date":L.push([N[q+1],["get",D[q]],x]);break;case"number":L.push([N[q+1],["get",D[q]],Number(x)]);break;default:L.push(["==",["get",D[q]],x])}}return L.length<1?null:["all",...L]}function X_(O){let C="";for(let D in O){let N=D.replace(/_/g," ").toUpperCase();C+=`
    <div class="form-group">
      <label class="form-label" for="${D}">${N}</label>
      ${O[D].options?`<select id="${D}" class="form-select" name="${D}" ${O[D].required?'required="true"':""}>
          ${O[D].options.map(L=>`<option>${L}</option>`)}
         </select>`:`<input class="form-input" id="${D}" type="${O[D].type}" name="${D}"  ${O[D].readonly?'readonly="true"':""} ${O[D].required?'required="true"':""}>`}
      ${O[D].hint?`<p class="form-input-hint">${O[D].hint}</p>`:""}
    </div>
    `,(O[D].type==="date"||O[D].type==="number")&&(C+=`
      <div class="form-group">
        <label  class="form-label" for="${D}_operator">${N} OPERATOR</label>
        <select id="${D}_operator"  name="${D}_operator" class="form-select">
          <option>></option>
          <option>>=</option>
          <option>==</option>
          <option><=</option>
          <option><</option>
        </select>
      </div>
    `)}return C}function Y_(){return'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><path d="M0,0h24 M24,24H0" fill="none"/><path d="M4.25,5.61C6.27,8.2,10,13,10,13v6c0,0.55,0.45,1,1,1h2c0.55,0,1-0.45,1-1v-6c0,0,3.72-4.8,5.74-7.39 C20.25,4.95,19.78,4,18.95,4H5.04C4.21,4,3.74,4.95,4.25,5.61z"/><path d="M0,0h24v24H0V0z" fill="none"/></g></svg>'}function J_(O){const C=`<svg version="1.1" id="L9" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve">
      <path fill="#fff" d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
        <animateTransform 
          attributeName="transform" 
          attributeType="XML" 
          type="rotate"
          dur="0.6s" 
          from="0 50 50"
          to="360 50 50" 
          repeatCount="indefinite" />
    </path>
  </svg>`,D=document.createElement("div");D.style.position="absolute",D.style.top=0,D.style.left=0,D.style.bottom=0,D.style.zIndex=1,D.style.width="100%",D.style.background="rgba(255,255,255,0.5)";let N=document.createElement("div");return N.innerHTML=C,N.style.position="absolute",N.style.display="block",N.style.top="50%",N.style.left="50%",N.style.width="120px",N.style.height="120px",N.style.transform="translate(-50%, -50%)",D.appendChild(N),O.getContainer().appendChild(D),D}function Q_(O){var C=O.getBoundingClientRect(),D=C.top,N=C.bottom,L=D>=0&&N<=window.innerHeight;return L}Vl.prototype._initGroupSettings=function(){this._groupSettings||(this._groupSettings={},this._layers.forEach(O=>{const C=O.group||"Operational Layers";this._groupSettings[C]||(this._groupSettings[C]={excludeOtherGroups:!1,exclusiveWithinGroup:!1,excludeGroups:null})}),this._layers.forEach(O=>{const C=this._groupSettings[O.group||"Operational Layers"];O.exclusiveWithinGroup&&(C.exclusiveWithinGroup=!0),Array.isArray(O.excludeGroups)&&(C.excludeGroups=O.excludeGroups.slice())}),this._exclusiveAllGroups===!0?Object.keys(this._groupSettings).forEach(O=>this._groupSettings[O].excludeOtherGroups=!0):Array.isArray(this._exclusiveGroupsList)&&this._exclusiveGroupsList.forEach(O=>{this._groupSettings[O]&&(this._groupSettings[O].excludeOtherGroups=!0)}))};function ey(O){if(this._initGroupSettings(),O.target.dataset.layergroup){const L=O.target.dataset.layergroup,q=this._groupSettings[L]||{};setTimeout(()=>{if(q.excludeOtherGroups||Array.isArray(q.excludeGroups)){const x=q.excludeOtherGroups?Object.keys(this._groupSettings).filter(c=>c!==L):q.excludeGroups.slice();document.querySelectorAll("input[data-map-layer]").forEach(c=>{c.dataset.group&&x.includes(c.dataset.group)&&c.checked&&c.click()})}setTimeout(()=>{const{pathname:x,hash:c}=window.location;history.replaceState(null,"",x+c)},0)},0);return}let C=null,D=null,N=!1;if(O.target.dataset.mapLayer)C=O.target.dataset.group||null,D=O.target.dataset.subgroup||null,N=O.target.checked;else if(O.target.tagName==="LABEL"&&O.target.htmlFor){const L=document.getElementById(O.target.htmlFor);L&&L.dataset.mapLayer&&(C=L.dataset.group||null,D=L.dataset.subgroup||null,N=L.checked)}if(C&&N){const L=this._groupSettings[C]||{};if(L.excludeOtherGroups||Array.isArray(L.excludeGroups)){const q=L.excludeOtherGroups?Object.keys(this._groupSettings).filter(x=>x!==C):L.excludeGroups.slice();document.querySelectorAll("input[data-map-layer]").forEach(x=>{x.dataset.group&&q.includes(x.dataset.group)&&x.checked&&x.click()})}L.exclusiveWithinGroup&&D&&document.querySelectorAll(`input[data-map-layer][data-subgroup="${D}"]`).forEach(q=>{const x=O.target.dataset.mapLayer?O.target.id:O.target.htmlFor;q.id!==x&&q.checked&&q.click()}),setTimeout(()=>{const{pathname:q,hash:x}=window.location;history.replaceState(null,"",q+x)},0)}}(function(){const O=Vl.prototype.onAdd;Vl.prototype.onAdd=function(C){const D=O.call(this,C);return this._layers.forEach(N=>{const L=D.querySelector(`input#${CSS.escape(N.id)}[data-map-layer]`);L&&typeof N.subGroup=="string"&&N.subGroup&&(L.dataset.subgroup=N.subGroup)}),D.addEventListener("click",N=>{setTimeout(()=>ey.call(this,N),0)},!1),D}})();function ty(O){return`<svg width='10' height='11'>
                <circle r='4' cx='5' cy='5' class='legendCircle' fill='${O}' />
            </svg>`}function iy(O){return`<svg width='11' height='11'>
                <rect class='legendRectangle' fill='${O}' />
            </svg>`}function ry(O){return`<svg width='12' height='5'>
                <line x1='1' y1='2' x2='12' y2='2' class='legendLine' stroke='${O}' />
            </svg>`}function yf(O,C,D){return O.map(N=>{const{id:L,label:q,color:x,group:c,subGroup:me="",type:Ze,exclusiveWithinGroup:Ue,symbol:He}=N;let Le;c==="Baustellen"?Le=`<img class='legendIcon' src='${$s}img/controlElements/verkehrszeichen.svg'></img>`:c==="ÖPNV-Linien"||Ze==="line"?Le=ry(x):Ze==="fill"?Le=iy(x):Le=ty(x);const ne=N.legendColor==="none"?"":typeof He=="function"?He():Le;return{id:L,name:ne+q,group:c,subGroup:me,directory:C,exclusiveWithinGroup:Ue,metadata:{lazyLoading:!0,source:{id:N.source,type:"geojson",data:N.url}}}}).reverse()}let vf;function ny(O){const C={collapsed:!1,layers:yf(Uu,"Integrationsplattform")};O.addControl(new Vl(C),"top-right");const D={collapsed:!1,layers:yf(Gu,"Weitere Datensätze")};vf=new Vl(D),O.addControl(vf,"top-right"),document.getElementById("Weitere_Datensätze").parentElement.classList.add("config2")}let Bu,Uu,Gu;const bf=[],xf=[];window.addEventListener("DOMContentLoaded",()=>{r_(pi,{basemapSources:bf,basemapLayers:xf}),s_(pi),n_(pi),pi.on("load",()=>{pi.addSource("shape",Hp),pi.addLayer(Wp),pi.addLayer(Kp);const O=[{id:"sourceParkApiCarBuildings",source:a_},{id:"sourceParkApiCarOnStreet",source:o_},{id:"sourceParkApiBicycle",source:l_},{id:"sourceSharingVehicles",source:c_},{id:"sourceSharingStationsCar",source:h_},{id:"sourceSharingStationsBicycle",source:u_},{id:"sourceSharingStationsScooter",source:d_},{id:"sourceSharingStationsCargoBicycle",source:p_},{id:"sourceChargePoints",source:f_},{id:"sourceRadvis",source:m_},{id:"sourceTransitStops",source:g_},{id:"sourceTransitStations",source:__},{id:wi[0].id,source:wi[0]},{id:wi[1].id,source:wi[1]},{id:wi[2].id,source:wi[2]},{id:wi[3].id,source:wi[3]},{id:wi[4].id,source:wi[4]},{id:wi[5].id,source:wi[5]},{id:"sourceRoadworks",source:y_},{id:"sourceCountCar",source:v_},{id:"sourceCountBicycle",source:b_},{id:"sourceFootway",source:x_},{id:"sourceMarked",source:w_},{id:"sourceUncontrolled",source:T_},{id:"sourceZebra",source:S_}];O.forEach(C=>Cf(pi,C)),Uu=[...Xp,...Yp,...Jp,...Qp,...ef,...tf,...rf,...nf,...sf,...of,...lf,...cf,...hf],Gu=[...uf,...df,...pf],Bu=[...Uu,...Gu],Bu.forEach(C=>{C.source!="sourceParkApiCarBuildings"?C.visibility="none":C.visibility="visible",Mf(pi,C)}),ny(pi),bf.push({id:"shape",source:Hp},...O),xf.push(Wp,Kp,...Bu),Gr(pi,Xp,ku),Gr(pi,Yp,ku),Gr(pi,Jp,ku),Gr(pi,Qp,th),Gr(pi,ef,th),Gr(pi,tf,th),Gr(pi,rf,th),Gr(pi,nf,I_),Gr(pi,sf,E_),Gr(pi,of,A_),Gr(pi,lf,k_),Gr(pi,uf,R_),Gr(pi,df,B_),Gr(pi,pf,F_),qp(pi,cf,z_),qp(pi,hf,L_)})});
