var Dd=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);import{n as _i,a as Pd,l as Fd,g as Td,m as _d,d as Od,e as Bd,f as Nd,c as Gd}from"../../addControlLayers-BNYwWbh1.js";import{a as uo,s as Rd}from"../../layers-CzGvzCUU.js";import{p as jd}from"../../popupContent-CG-5M-I3.js";import{p as zd}from"../../popupImages-Ddgp1tju.js";/* empty css                   */import{b as Hd}from"../../layerSwitcherControl-CBuO2xpy.js";import{p as Ms}from"../../popups-Ke25GS6E.js";import"../../timeStamps-0NhGikBN.js";var L4=Dd((Je,Ue)=>{window.PUBLIC_PATH="/karten_dev/";const fe=new _i.Map({container:"map",center:[8.94,48.599],style:"https://tiles.mobidata-bw.de/styles/streets/style.json",zoom:12,minZoom:10,attributionControl:!1}),Jd={type:"geojson",data:"data/shapesHerrenberg.geojson"};var Ud=Object.defineProperty,Vd=(t,e,n)=>e in t?Ud(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,b=(t,e,n)=>Vd(t,typeof e!="symbol"?e+"":e,n);const uu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AYht+mLYpUHOwgopChOtlFRRxrFYpQIdQKrTqYXPoHTRqSFBdHwbXg4M9i1cHFWVcHV0EQ/AFxdnBSdJESv0sKLWK847iH97735e47QGhWmWaFEoCm22YmlRRz+VWx5xUhmmGMIi4zy5iTpDR8x9c9Any/i/Ms/7o/R79asBgQEIkTzDBt4g3imU3b4LxPHGVlWSU+J54w6YLEj1xXPH7jXHJZ4JlRM5uZJ44Si6UuVrqYlU2NeJo4pmo65Qs5j1XOW5y1ap2178lfGCnoK8tcpzWCFBaxBAkiFNRRQRU24rTrpFjI0HnSxz/s+iVyKeSqgJFjATVokF0/+B/87q1VnJr0kiJJIPziOB9jQM8u0Go4zvex47ROgOAzcKV3/LUmMPtJeqOjxY6AgW3g4rqjKXvA5Q4w9GTIpuxKQVpCsQi8n9E35YHBW6Bvzetb+xynD0CWepW+AQ4OgfESZa/7vLu3u2//1rT79wN2rHKoBaSKHQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAN1wAADdcBQiibeAAAAAd0SU1FB+gEBAUlKJesuC4AABWbSURBVHja7Z3fcxTHEce/t1ohYekA2QaBDBgocGLHNmW7Kg4pV9l5SeUleci/4b9H/0aeU3mJXXEF5yEmEOw4hgKFH7JBtpEQwhLS3eVhunV9w+7tHWh3e2Z7q64OyZJ18+Mz3+7pme4W7Bn6tBdXWwD4lYj3FMA0gCkAswCOAJihrw8AOAfgdwDOAmgDmKDf3YunB6ADYB3AdQB/BnANwEMAWwA2ANwH8Ii+3gSwA6BLv8vvvfWPD/VslPOflnVBLhQQYKQCiEl6zQCYB/AigGMA3gBwGMB+guQQgFfpfZKg2sunC2AbwCqA/9H7FoCfAKwA+ArAtwB+BHCPoNmmFwOzw6AAgMFigIyrFhMChgMERJu+PkJQHCNI5un7qfi9F+i9VUJf88TeBvCY3js06TcIih8Jkq9IUTZIde6R2myI3zNVMUBGAiOlST1NrwMAjgM4BeAtAUKbIJklxZim35WAJSXB4UPSlROcINkkRXlEcKwLcP4NYAnAHQJlk17bUlUMlIYDkgHGPpr8BwEcJWVYAPA2AXKcwGAza0ooRiL6s1Vx//Yy3rtCUbaEebVOYCwBuAJgmZTmOwBrBNETA6XBgAwBYw7ACYLhbYLjRYLlIP3MpOest2oAYhxgep5zvk0QrBEUPxIkVwia2wAeGCgNBGQEME4DeIcAOUHm1bRwztMaVWIv1WVHOOubZGbdJkAuAbhpoDQIELErlRSAcZq+nhNqMeEpReh91vOUpSNU5QGBcbMAlG5Tdr1aDYGjRROdYxZFYOzzHO4Y+8o3w3YIgCJQOLbSaYKatBoAR0JKsB/Ay2Q+nRkRjKaYoL0RQblBZtj3cPGWbQDdmCFpRQyGVI0DcFuybwL4FVx0+6SBMRYot+Ci9p8DuAq3dfwwdjVpRQxHCheoO0xKcY7geJNgaRsYY4GyTlBcJUiukbKswAUqd2KEpBUhHBM06WfgotznAVwgQE6TmbWffiYxMEYCpUsA/ETm1U0C5CKAy3DR+g36mU5MkLQiAsM3qeYJjg/pfZ6+P4X+wUEDYzxQOmRSPYSLyF8G8Cm934vR5GpFBEeWSXWB4DiGwXNSMDieCRJg8LzXtwTHxVhNrlZEcMzCRb59k+owgZOaauypmuwQCCsZJtcy3HZw8JCkEcHxCoB3AXxkJlUli2oqVHmGFqIZsRDdZUjai6vBBhXTwOHgo+gMx2/ofcEzqQyMvYfEP7YzhcGjOCBINgBshwpJGigciYBjwYPjFQFHYnCUDgovQKzi/rMsIAkuqJgGCscU+kfSz5NZxXDMmr9ROSS8YPmQsLrwUfqt0CBpBQrHS+SE/xzArwmSBYNDjfP+iJTjMoC/A/ianPgf4LaBg4GkFRAcLbjI9xyA1wH8Fu6G31m4yLjtVOmC5DFc5P063A3GvwD4D9yxlScIZHcrCQgO9jmOknK8Re9Hvd0Tg6N+5z0tGKtJAC1xDcEAeU44UuGQnyez6iz6x0ZsG1cfJBPon6A+65nCuwuadkiSQODIinMcMTiCgeTIsM0UzZCkyjvZh0PGOV4wOILwbydorBbQP67Cz24wMeO/GSAF6iE71o9z2G5VWJDIhc536u8A2Ggvrqp02lPFcEzBHV+wOEeckPBu1xYrSHtxVd1R+UQhHGxaHYA7bHghy7kzOIL0SfzNlgs0xge0+iOpwo7kTpyHCwaew2BaT4MjfCXxx3eFlKSrzR9RoyCe33EsZ4Wxs1XhQ5LkWAjHeONFk4okiuBIPL+DbwIexuCRdXvCh2SiYKwTLZAkSuDgSHnuqmJwRAlJnrWgJtKuxcSSAaU8v8Oe+CDJ8kdkALjZCuKZVi+jn7dqYGcDcWY19EsX5L3kz8YGiL9jyWmZXtZiaqVKVpFZuIyHfgfFYlrllSfojdFPdZZXqMIf4QVyDS5Dyjr6JRt6jQMk4wj7GfSPrquR2D2Cwi9BwAEyruxUpPI8ieROntbSC89rYp+luXAHlGurvbjaqiuAmNa8erANegIuV+5JuIyHIZtWWdnT/SI2G/DS4xT0Eacz4qPiecV7QuwzGR9p0xx4By5TCt8dqU1FagEkQz1O02uOvhdivMNP18n1N7LKoN2HuzwkA2S9HLOKt0NfR7+Sblb5t0mEm0aV2+rPh9t1q0haY4f46nEi0F2rvITPsoJTViHNFfTTdfZG6KcryC8gKitghZpvOGtO1K4ilQMygnqEMqhFJQOWMFgD0C/FvAWvDPOQnZ4HBJQsQX0VT9dQDLmUQ968qFVFUiUrRWjqIZ3tvFoaS/S1rCK74znrow42A8WmyAO4JNJchfc6ATKs5kkSCCSqVKRSQCJQDz+J8yMUly3z65Dv7nCNuhpSv3VF32yLv79GCnWL/nZW1Sz2VbRfMFOnIqmCFSIU9cjKSbsEV3WpsPDlOED4j/i9ngcM1xfMUjEG5Qypi8xRDOWQqFGRyjpJRM33w12a+RDAH+HO4cyhX15Zs0nVwWDOp4tk3txCTRVhCyr3noSLK8g7NbN4uq67tofLVT+gfv4TXJmFu3A1SirLq1W1giRkNx8lxzIE9fDriy8D+ALAJzR4XIqsllLJ9Hd6BMq25xc9FDtn/Nn44tmkYkh8FXkbwH8hEs/FaGLxsYJpsfuye3JT6UCxv8G1xLlozCcEyTKZW9vsY9QV8c0AhQOUm56pt4N+5vtp6DzO45/wXqA5M00K3qnKzKoEkIwj7bLBE8rh4AyBN5BdA6MDRak0BShyQ+GugGMD7tTsGfQzUmqFJGtBXYNLhF2Js55W2FiWzOMkmUep8YlSOLq0+t4H8E8AnwH4BoFUUVr/+FCvvbjKO2eP4M42bdFnfw3ABwDeo3HYr9Tc8k3ya7RjV5mzXvrkzEjEcIpeB5WaV9LneEjK8RmAfwD4EoMFK1Xnl2U1wWDJtC+pLZ9R2x5KE1GpmXVQzJtKEzykFa8E83B5Wo8rdc6lWbJBPsc1Uo5lAKu0CgdTyTXD5OLP/Q21ja+5tqHvZLBvebwFd4btB1KRbhUTt8qVoE2QtBWrh5++/yKZVWuhwZEBCgc416hNmTUFlapILXOnKvtfVoSSW4xanXJ/K3clZDhyIFlB9o5cB/puL9Y2f0r9IxnZ2Y8oVQ/2O4ZOnBjqfgtIhi0EmvwRX0WOoMLs8GlFELL/8QY1cEqZgkjTaikA02OvTcmsBWxS0QLG92L4mP9VuMOapQcNkwro5+uiL8LdX9CWW5cd1ydwRxtuwB0fuS9NjhjUI2N3S8Z5rlPbdytAKVkU/DIYfAemkpwFpQGSUd+j0oY9w2q6AXfQ7xLc2ard7c+Y4PAgkdvZt6jtuydnlZlZuQttmWZW2QriS+M8dAUHffW4icGTo1HCkQFJXvs1pRuqxVSvwsRi+/Yw9CWgzlIPjSto0/ugVTCXggSEG8WX8aehKzBYpB69mNUjwx8JQUUYkmkMJvcI1sSqvEGmHtGrSKULbimAZMQ/KpPEMdVjGy6qvESvRqnHEBXh/lhD/1CgFkgy51RZjnpSMnwyp9Nh6Ip/8Gnd7+CyjzRVPfJU5Ar1zSYqvKCkbU6V7YNwinttDro8cvEjXLCMt3UbpR4ZKsLbvpyuiFOk1t0nWVZJ6XdZkhIbw///FP00mZrMK44kf0sTYRM6zyHVsXBsop/wTp4k0GRmyVzFKGtuVXWaV5NzzubVFlwE+Su4Y+2aTAkNpuc99LNBbinqmxaeznYflpM+RFG0rJJsSqzDS2rQRPMqw8xiX4TzCWty1CudU0lD54LMUsLJ3Uw9rH8aD0hIK6RKhW1aHzVRQeS9D78EgT3WR40HRB7zXjH/o9AP4Qwujdzha6KJxSskV31qamBwlL6SfdT1+tAAacAE6JrvUeiLdJvcP4lNAnusjwwQe+wxQOyxxwCxp+qnZYDY4NuT3TeVnXkyQHROAG2HKLX1T2WnZg0QXYqh8Ri+iifnNqjWGiIGSEmQZF7kqiKdfkDzQvNtUAPEBl+FeaU1XVN0gGhLhKw9mbYW51xjuqZK51RSUUO0HekIoRyDBgXRmq6psiMwScl0azwUWGs6/QAddG2VwCo9RJmU3JDMY+UKQNGeM7juvtFYrqKWY/hlNlrrpZu8rPOaS1JX2Tey9LK2chWVz6lSAMm5dKMtjaVMp881uCebamYNqWWvqVxF7pwq67JbUlGDNtGvSqrFWfdrcJ+Azsq7VTvmM9QX2mrZS+f8Cc2p0hfcJLYGPYOjLmtwz9GuTaNURKjHPuoD7g9ttewrX3CrUpANhY66v2K+02AV0d4XtZnsZQOiOTuGv2qeplejVCRDPZ7qByWLRS1zqTRAAsnSZyoSRh/Ulg0zqYh8rVn6ilbPJGYVobYlAahHbfMoqZN8xSpyEv1t3yghEXDwtu5J5epRiyVSlYJoztLnq8gZAGfhIsi79yBigkT4HXzs/wi1+Yxi9ahlDpUKSEDZwmVk/RSACwDOwwXLZiP0R2R7F6itF6jt2tpbazb+pMIVQHO2cDY3+J7IeQAfAXiXJtALACZiUBFqAyvHArXxI2qzvBujqa21zZ+0xhVgjuzfnpLB8CeOVL/d08jtxdVOqDl8BRxDFwKF6lGbBVKlgoRQ0SnP9DgNF1WeClVJPDgOUptCMCVrrXhVuoKsf3yo115czasJOKtsxeLPMUE7OfMAzgF4Da48MuBKI2+1F1c7CCAjvOeQMxwL1KZz1MYZMQ7aqoHl1kysou+TihuaWVUW+kp7ye3PMwA+APA+gF/AHQEP4oJVxgWoY9SG96lNZyC2s6G3VF5tVXerPKXp1yW/A711yRmSabgt0PcA/B7AHwD8EsBxYZKojJOIOAebjMfps/+B2vIetW0aOpPDSd/jDmqq216Fky7NrG0yUZbo9aqYaD1lgySd9qPIrve+DHerbbu9uNrVYHIJ1WAVzNqtmifl0HpJTKqHnC9rqLiWfVrzivAzAC9Bb9odhmQ/nk40x6bLfTIBngDYoYWgclAEGPy59hEERzJ2q2aUmlXqLI7KAPFURNqUGp31PJ+kDeAVz66/DuAWOfEbVYOSA8YM3Db6SbgIub9bNaEcDt85H/BZq1x80pobzrsSh6ArJpIHSUvY85z04QaASwBuAridBwovEnsIBYaAcQJuG/cdcsRPoZ9CVHsCuDznfBM11ElMa+gAua/9Je2qvAz92Q1bos/YD2kTLKcJkCxQtmlguwQLxgXGA0ICO4F+fi8fjNP09RxBLe+Wa47jqHDOawEksJhIHiS+E+xPTgZliUB5SO3jK8d8TVQCM46C8c7UNL0O0N8+lQHGDClLijDKGKhxzutUkDz78qByMyvPL8kzb5Zo9WMT4Z5QlG0MJtPrFQDJGwSTAsp59DOyvE2AZIHRQlhpVVWFA1IlnXCWBnsf+kkCEAAkLRq0LFBepV069rX4mMQG3HmiUe5V+1kO2+jnFH4D/ZxeR2mBCRkMVc55bYAMiYmcFLZ9L6CBzQNlFm4Le4vMybcIDD50599r6OWolMxEz2lSOWUq+xbT4m+HCIY657xuBZGO2G2y2eVVz8kABzgLlCka3IO0EcHm1QaZRY9HVBAZpGQzi2Mycss25Az1/pyo1TmvFRChIk9ot+cmvU4EqiJ5oMidpin084TN0YTvjDD4/P+Y8pxtP+N6yHdVWD14PtTunNetILGqiA8KPFh4kCUw4+5iIRIoiubCbSg4q1db3EFcx/VV5AF9T9sp371QlUS8UmGKDXtNCuVIEF/h0cJ5UOf5tlThyhGTihSpC2BVrdSqR60K0kAVsScw9agdkBBWEHuaPfa1A2IqYuqhVT20KIipiKmH2jFXAYipiKmHRvXQpCCmIqYeKsdaDSCmIqYe2tRDm4KYiph6qBtjVYCMoCJdgyR4OLqhqIdGBclbYW7BHRXXVFfEnmczrXZoLG+FYCGoAyRDRW7AZQ65D+AnuBOw9oT5dGgM79OY3tCsHkD9Z7GKVOQR3LHnz9G/Mcf5nEK4Y23PoGm1BeB7AFdpTJcgcu1q/OAqs4jQShJkh9oz8oJ3lcZ2C0BXaxLwRHnHDpNkc9jDdMyDMpnVAuKVb5NOnTns4TvmA2OouYSEagURppY57HE65l3t9VXSADrYHHZzzE1BnsFhvwm9RXjsCdgxDwqQHKm+Ri8ztcwxN0CEw85JxW5mrUimIuaYN1ZBLDZijrkBsgedb5DUrh6dmBaxoAApiI2Yw67HtMo1g0NSjyAVpCA2UpTr1p5yAeFT2Pdi2UhJAx8M3kK8iH5cZIL+HVP2wVBMq8dwpR4u05gMbMWHph6h+iC+w75CA/IpvQ8rKWBPOXAUjkWIcAQLiICkcNUySCrxO+T2+0Uai29pbDqhwhE0IDHbvYE9WQFcLjcXvD8YNCDerpYFEOszrbKOAAUVEIxVQaSpZWe16jWt/IWpEzocUQBSIPVmall/GyAjntWqrRBkhOpRqNgxqEdUCjLCsXi7gbh3plVU0fJhTxrhIGZJ/2G4moBc+swCiM8OSKN2DWPyQfJMraf25U1Fnsu0ii5a3hhAMkytvMiuQfLsfkd00fJGASIgGbbamT/yfH5HVNHypvkgRfay+SN704/RRMsbpyCeP7Jj/khpfkcU0fJGAuKZWuaPlON3dGKGI3pAzB8xv8N8EPNHzO8wBTF/xPwOA8T8EfM7DJAA/JGm3h/hAGvj/Y7GAjKifd1poNPeE+rReL+j0YAU+CPLaGaWRpklZrnpfkfTFSTPH/kEwBc0QZrktEuzc5n64JMm+x3ySdHQZ/3jQ7324qqcGJxHK4Xb+uVt3wnEu/070kLRVDgaDUiOaZHCJZ07TO8MSYwFeoY55U01Nc3EyvFHRnFOe5HBMdJmRZPVo/GACEiGraSxQeLDkeeUd5sOhwEymtN+NzJzQ5qVd80pNx/keZx2floAjiP8pNhZO1Z/NafcAHnW1ZXhiGFnq0kqaSZWyU57oX0e2EQa2c8y9TBAxoUk9J2tkdtjcBgg40ASw86W7VgZIKVCMqrN3lMOh+1YmZNeDiRDdrYA4BUAs6IfW8rhsB0rA6SUyebvbOVB0lL6mSUctmNlgOy5imAIJNpiJMNiHQNwmHoYIGVDoi1GMrLfZHCYk16G0645RmKxDgNEHSRaYiQW6zBAVEGiKUZisQ4DRCUkGmIkFuswJ121415njMRiHQaI+mecGMleQlIEh8U6DBA1KoKKIRkLDlMPA6RJkBgcBohBYnAYIAbJeJAYHAaIQWJwGCAGyXiQGBwGiEGSA4nBYYAYJDmQGBwGiEGSAwkMDgPEIBkOicFhgBgkGZDM0L83DA4DxCDpP1xi4Sh9/R2ASwaHAdJkSPjuRgJgEv167QBwFcDfAPwLdhuw1sfug9QAiXDCH8Pd+Psa7v7GHXpdpu/do58xOGp6/g9eQPkxBqxc0wAAAABJRU5ErkJggg==",cu={draw:{marker:{type:"draw",eventType:"toggle",targetMode:"marker",settings:{exclusive:!0}},circle_marker:{type:"draw",eventType:"toggle",targetMode:"circle_marker",settings:{exclusive:!0}},text_marker:{type:"draw",eventType:"toggle",targetMode:"text_marker",settings:{exclusive:!0}},circle:{type:"draw",eventType:"toggle",targetMode:"circle",settings:{exclusive:!0}},line:{type:"draw",eventType:"toggle",targetMode:"line",settings:{exclusive:!0}},rectangle:{type:"draw",eventType:"toggle",targetMode:"rectangle",settings:{exclusive:!0}},polygon:{type:"draw",eventType:"toggle",targetMode:"polygon",settings:{exclusive:!0}},freehand:{type:"draw",eventType:"toggle",targetMode:"freehand",settings:{exclusive:!0}},custom_shape:{type:"draw",eventType:"toggle",targetMode:"custom_shape",settings:{exclusive:!0}}},edit:{drag:{type:"edit",eventType:"toggle",targetMode:"drag",settings:{exclusive:!0}},change:{type:"edit",eventType:"toggle",targetMode:"change",settings:{exclusive:!0}},rotate:{type:"edit",eventType:"toggle",targetMode:"rotate",settings:{exclusive:!0}},scale:{type:"edit",eventType:"toggle",targetMode:"scale",settings:{exclusive:!0}},copy:{type:"edit",eventType:"toggle",targetMode:"copy",settings:{exclusive:!0}},cut:{type:"edit",eventType:"toggle",targetMode:"cut",settings:{exclusive:!0}},split:{type:"edit",eventType:"toggle",targetMode:"split",settings:{exclusive:!0}},union:{type:"edit",eventType:"toggle",targetMode:"union",settings:{exclusive:!0}},difference:{type:"edit",eventType:"toggle",targetMode:"difference",settings:{exclusive:!0}},line_simplification:{type:"edit",eventType:"toggle",targetMode:"line_simplification",settings:{exclusive:!0}},lasso:{type:"edit",eventType:"toggle",targetMode:"lasso",settings:{exclusive:!0}},delete:{type:"edit",eventType:"toggle",targetMode:"delete",settings:{exclusive:!0}}},helper:{shape_markers:{type:"helper",eventType:"toggle",targetMode:"shape_markers",settings:{exclusive:!1,enabledBy:["drag","change","rotate","scale","line_simplification"]}},snapping:{type:"helper",eventType:"toggle",targetMode:"snapping",settings:{exclusive:!1}},pin:{type:"helper",eventType:"toggle",targetMode:"pin",settings:{exclusive:!1}},snap_guides:{type:"helper",eventType:"toggle",targetMode:"snap_guides",settings:{exclusive:!1}},measurements:{type:"helper",eventType:"toggle",targetMode:"measurements",settings:{exclusive:!1}},auto_trace:{type:"helper",eventType:"toggle",targetMode:"auto_trace",settings:{exclusive:!1}},geofencing:{type:"helper",eventType:"toggle",targetMode:"geofencing",settings:{exclusive:!1}},zoom_to_features:{type:"helper",eventType:"click",targetMode:"zoom_to_features",settings:{exclusive:!1}},click_to_edit:{type:"helper",eventType:"toggle",targetMode:"click_to_edit",settings:{exclusive:!1}}}},qd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path d="m22.775 29.562 6.75-6.75-5.625-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.626-5.55-6.75 6.75zm25.95 26.101 6.75-6.825-5.624-5.625-3.6 3.6-3.15-3.15 3.6-3.6-5.55-5.55-6.75 6.75zm.6-46.126 5.25 5.25ZM16.7 59.039H5v-11.7l14.55-14.551L2 15.237l13.05-13.2L32.75 19.661 46.1 6.312q.676-.676 1.5-.976.826-.3 1.65-.3.826 0 1.65.3.826.3 1.5.976l5.326 5.325q.675.675.975 1.5.3.825.3 1.65t-.3 1.65q-.3.825-.975 1.5l-13.35 13.35L62 48.913l-13.125 13.05-17.551-17.55Zm-7.2-4.5h5.25l29.476-29.552-5.25-5.25L9.5 49.288ZM41.6 22.361l-2.625-2.625 5.25 5.25Z"
          fill="currentColor"
          style="stroke-width:.0750028"/>
</svg>
`,du=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor"
            style="stroke-width:7"/>
    <circle cx="32" cy="32" r="5" fill="currentColor"/>
</svg>
`,Yd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <circle cx="32" cy="32" r="26" fill="currentColor" fill-opacity=".15" stroke="currentColor" style="stroke-width:7"/>
    <line x1="6" y1="32" x2="58" y2="32" stroke="currentColor" stroke-width="4" stroke-dasharray="3"/>
    <line x1="32" y1="6" x2="32" y2="58" stroke="currentColor" stroke-width="4" stroke-dasharray="3"/>
</svg>
`,Wd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path
            fill="currentColor"
            d="M32 61.4 19.85 49.42l3.28-3.235 6.634 6.542V34.205H10.98l6.26 6.174-3.279 3.234L2.185 32l11.852-11.686 3.28 3.234-6.336 6.247h18.783V11.273l-6.261 6.174-3.28-3.234L32 2.6l11.777 11.613-3.28 3.234-6.26-6.174v18.522h18.782l-6.26-6.174 3.279-3.234L61.815 32 50.038 43.613l-3.28-3.234 6.261-6.174H34.236v18.522l6.634-6.542 3.28 3.234z"
    />
</svg>
`,Zd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <line x1="8" y1="50" x2="24" y2="20" stroke="currentColor" stroke-width="8"/>
    <line x1="24" y1="20" x2="40" y2="54" stroke="currentColor" stroke-width="8"/>
    <line x1="40" y1="54" x2="54" y2="10" stroke="currentColor" stroke-width="8"/>
    <circle cx="8" cy="50" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="24" cy="20" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,$d=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M32 62.81s23.107-21.898 23.107-38.512a23.107 23.107 0 0 0-46.214 0C8.893 40.912 32 62.809 32 62.809m0-26.958a11.554 11.554 0 1 1 0-23.107 11.554 11.554 0 0 1 0 23.107"/>
</svg>
`,Kd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Polygon -->
    <polygon points="8,28 40,6 55,35 51,55 18,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="9" cy="28" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="40" cy="8" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="55" cy="35" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="50" cy="55" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="18" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,Xd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <!-- Rectangle -->
    <polygon points="10,10 54,10 54,54 10,54" fill="none" stroke="currentColor" stroke-width="8"/>

    <!-- Vertex Circles -->
    <circle cx="10" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="10" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="54" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
    <circle cx="10" cy="54" r="6" fill="white" stroke="currentColor" stroke-width="4.5"/>
</svg>
`,Qd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M39.063 42.14 22.288 28.12 7.96 44.603l11.338 9.854h9.059zm-3.498 12.317h25.941v5.465h-44.25L4.377 48.726a5.465 5.465 0 0 1-.542-7.711L34.311 5.958a5.465 5.465 0 0 1 7.712-.538l16.496 14.343a5.465 5.465 0 0 1 .541 7.709z"
          style="stroke-width:2.73262"/>
</svg>
`,eh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M58.709 17.724c-.3-.6-.601-.901-.902-1.502l-.3-.601c-.301-.601-.602-.902-.902-1.503l-.3-.601c-.301-.601-.602-.902-1.203-1.503l-.6-.901 8.414-9.317-13.825.3-13.824.301 1.502 13.524 1.503 13.524 9.617-10.819v.3l.3.602c.301.3.301.6.602.6l.3.602c0 .6 0 .901.3 1.202.903 2.104 1.804 4.208 2.105 6.311.6 4.208 0 8.716-1.804 12.623l-.6 1.202-.301.3-.902 1.503-.3.601c-.601.601-1.202 1.503-1.804 2.104-1.502 1.503-3.305 3.005-5.109 3.907-1.803 1.202-3.907 1.803-6.311 2.404-2.104.301-4.508.601-6.612.301-2.404-.3-4.508-.902-6.612-1.503-2.103-.901-3.907-2.104-5.71-3.606l-1.202-1.202-.601-.902-.601-.601c-.3-.3-.601-.601-.601-.902l-.902-1.202-.3-.3-.602-1.203c0-.3-.3-.3-.3-.6l-.902-1.503-.3-.601-.902-2.705q-.901-3.607-.901-7.213V27.04c0-.601 0-.901.3-1.202l.3-1.803.602-1.803c.901-2.405 2.103-4.509 3.606-6.612q2.254-3.156 5.41-5.41c.6-.3.901-1.202.3-1.803-.3-.3-.6-.601-.901-.601h-.601l-.3.3c-2.706 1.202-4.81 3.006-6.913 4.809-2.104 2.104-3.607 4.508-5.11 7.213-2.704 5.41-3.606 11.42-2.404 17.431.3 1.503.601 2.705.902 4.207l.902 2.405c.3.3.6.6.6 1.202l.602 1.202c0 .3.3.601.3.601l.902 1.503c.3.601.6.901.901 1.503l.301.6c.3.301.601.902.902 1.203l2.103 1.803c2.104 2.104 4.809 3.907 7.514 5.41q4.057 2.254 9.016 2.705c1.503.3 3.005.3 4.508.3 1.803 0 3.306 0 4.809-.3 3.005-.602 6.311-1.503 9.016-3.006l.6-.3c.602-.3.903-.601 1.504-.902l2.103-1.202c.601-.3.902-.601 1.203-.902l.6-.6a3.622 3.622 0 0 0 1.503-1.504l.3-.3c.902-.902 2.105-2.104 2.706-3.005l1.803-2.705 1.202-1.804c3.005-5.71 4.208-12.322 3.306-18.633-.601-3.306-1.503-6.612-3.005-9.317z"/>
</svg>
`,th=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor"
          stroke-width="3.8"
          d="m2.155 32.345 42.35-29.82M18.963 60.919l42.35-29.82M31.443 2.332l29.82 42.35M2.207 19.515l29.82 42.35"/>
</svg>
`,nh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="none" d="M0 0h24v24H0Z"/>
    <path fill="currentColor"
          d="M6.962 3.385h50.076a3.577 3.577 0 0 1 3.577 3.577v50.076a3.577 3.577 0 0 1-3.577 3.577H6.962a3.577 3.577 0 0 1-3.577-3.577V6.962a3.577 3.577 0 0 1 3.577-3.577Zm3.577 7.154v42.922h42.922V10.539Zm7.154 7.154h28.614v7.153H17.693Zm0 14.307h28.614v7.154H17.693Z"
          style="stroke-width:4"/>
</svg>
`,rh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M16.862 2.13 7.297 21.17a2.091 2.091 0 0 0-.193 1.288l4.107 24.166-7.618 13.15 3.619 2.096 7.997-13.804a2.091 2.091 0 0 0 .252-1.397l-4.119-24.235 9.256-18.428Zm40.876.255-1.25 2.49 2.668 1.341 1.25-2.49zm-2.593 5.16-2.68 5.337 2.668 1.341 2.682-5.338zm-4.022 8.007-2.682 5.338 2.67 1.34 2.681-5.337zm-18.67 5.83.055 6.984-11.118.087.056 7.242 11.12-.088.054 6.985 10.521-10.688zm18.927 2.817-2.945.5 1.001 5.89 2.945-.5zm1.502 8.835-2.945.5 1.001 5.89 2.945-.5zm1.502 8.834-2.945.5.74 4.355-.24.413 2.585 1.499.51-.881a1.494 1.494 0 0 0 .18-1zm-3.943 7.854-2.994 5.17 2.584 1.496 2.994-5.169zm-4.492 7.754-1.497 2.584 2.584 1.497 1.498-2.584z"/>
</svg>
`,ih=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.687.926a2.173 2.173 0 0 0-.433.045c-4.075.232-7.358 3.618-7.358 7.747 0 .084.01.164.012.246l-12.987 4.261a7.842 7.842 0 0 0-6.126-3.563 2.173 2.173 0 0 0-.424-.043 2.173 2.173 0 0 0-.435.044c-4.073.232-7.358 3.618-7.358 7.747 0 3.143 1.901 5.869 4.604 7.097L8.377 35.11a2.173 2.173 0 0 0-.028.007C4.274 35.35.99 38.736.99 42.865c0 4.277 3.514 7.791 7.791 7.791 2.497 0 4.727-1.201 6.157-3.048l12.887 6.235a7.67 7.67 0 0 0-.139 1.44c0 4.277 3.515 7.791 7.792 7.791 4.278 0 7.793-3.514 7.793-7.792a7.67 7.67 0 0 0-1.885-5.027l.508-1.05-3.263-1.579 4.505-29.969.888-.29-.368-1.122a7.78 7.78 0 0 0 2.28-1.018l.447 1.364 4.72-1.547-.774-2.359-2.522.826a7.73 7.73 0 0 0 1.672-4.793c0-4.132-3.288-7.52-7.368-7.748a2.173 2.173 0 0 0-.424-.044zm0 4.346a3.414 3.414 0 0 1 3.447 3.446 3.415 3.415 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.446-3.447 3.414 3.414 0 0 1 3.445-3.446zm20.076 3.725a1.242 1.242 0 0 0-.382.062l-1.612.528.578 1.76-.293 1.94 2.456.37.486-3.234a1.242 1.242 0 0 0-1.233-1.426Zm-4.354 1.364-4.72 1.548.775 2.36 4.719-1.548-.774-2.36zm-22.153 2.732a7.877 7.877 0 0 0 3.735 2.922l-.062.408-.397.13.26.793-4.255 28.298-3.818-1.847-1.082 2.235 3.718 1.798a7.841 7.841 0 0 0-3.543 2.147l-13.272-6.42c.02-.23.035-.458.035-.692 0-2.888-1.609-5.408-3.969-6.745l2.912-11.012c3.74-.562 6.645-3.81 6.645-7.698l-.001-.02 13.094-4.297zm-20.885.87a3.414 3.414 0 0 1 3.445 3.447 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm45.314 1.78-.738 4.912 2.456.37.738-4.912zM36.172 17.33l-1.793.588a1.242 1.242 0 0 0-.813.862l-.788 2.978 2.401.634.615-2.325 1.15-.377-.773-2.36zm22.405 5.781-.737 4.913 2.455.368.739-4.91zm-26.432 1.048-1.27 4.802 2.401.634 1.27-4.802zm25.325 6.32-.739 4.913 2.457.368.738-4.911-2.456-.37zm-27.23.882-1.27 4.802 2.402.634 1.27-4.801zm26.124 6.486-.739 4.91 2.455.37.74-4.912-2.457-.368zm-28.027.717-1.27 4.803 2.4.634 1.27-4.802-2.401-.634zm-19.555.856a3.414 3.414 0 0 1 3.446 3.446 3.414 3.414 0 0 1-3.446 3.447 3.414 3.414 0 0 1-3.445-3.447 3.414 3.414 0 0 1 3.445-3.446zm46.473 5.795-.739 4.91 2.456.37.74-4.911zm-11.124 5.072-1.082 2.236 4.47 2.164 1.083-2.237zm-8.651 1.55a3.414 3.414 0 0 1 3.445 3.446 3.414 3.414 0 0 1-3.445 3.447 3.414 3.414 0 0 1-3.447-3.447 3.414 3.414 0 0 1 3.446-3.446zm18.669.745-.358 2.378-2.953-1.428-1.083 2.236 4.472 2.163.541-1.117 1.228.183.608-4.046-2.455-.37z"/>
</svg>
`,oh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <circle cx="49.754" cy="50.219" r="10.098" fill="none" stroke="currentColor" stroke-width="5.1"/>
    <path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="4.491"
          d="M44.516 26.657H17.842l6.669-11.55 6.668-11.55 6.669 11.55Z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="4.683" d="M4.481 40.605h20.761v19.093H4.481z"/>
</svg>
`,ah=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path stroke="currentColor" fill="currentColor" stroke-width="2"
          d="M44.095 2.247a2.285 2.285 0 0 0-.135.04L12.025 12.762a2.285 2.285 0 0 0-1.497 1.588l-7.772 29.4a2.285 2.285 0 0 0 1.213 2.641L35.397 61.6a2.285 2.285 0 0 0 2.873-.754l22.64-32.582a2.285 2.285 0 0 0 .05-2.534L46.6 3.23a2.285 2.285 0 0 0-2.504-.982ZM43.7 7.182l12.203 19.12-5.167 1.76 1.052 3.09 2.031-.693L38.07 53.122l.01-1.375-3.262-.023-.034 4.5-27.13-13.127 6.975-26.38Zm3.946 21.932-6.18 2.105 1.052 3.09 6.18-2.105zm-9.27 3.157-2.329.793a1.632 1.632 0 0 0-1.105 1.534l-.03 4.068 3.265.024.02-2.91 1.232-.419zm-3.488 9.66-.047 6.529 3.264.023.048-6.528z"/>
</svg>
`,sh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="m41.478 7.967-.033 3.069c1.887.02 3.772.337 5.561.933l.97-2.913a21.337 21.337 0 0 0-6.498-1.09Zm-3.294.215a21.567 21.567 0 0 0-6.298 1.915l1.332 2.766a18.518 18.518 0 0 1 5.401-1.641zm12.836 2.155-1.402 2.73a18.497 18.497 0 0 1 4.572 3.312l2.16-2.179a21.548 21.548 0 0 0-5.331-3.863ZM22.783 13.06c-11.848 0-21.486 9.638-21.486 21.486 0 11.849 9.638 21.486 21.486 21.486a21.37 21.37 0 0 0 14.288-5.466c.003 0 .006 0 .009.002.04-.036.078-.075.117-.11l.077-.072a21.285 21.285 0 0 0 1.51-1.532 22.128 22.128 0 0 0 .867-1.025 19.557 19.557 0 0 1-.88-.095c-.196-.025-.389-.058-.582-.09-.097-.015-.194-.028-.29-.045a18.378 18.378 0 0 1-1.576-.359l-.118-.03c-7.753-2.172-13.422-9.271-13.422-17.728a18.34 18.34 0 0 1 5.867-13.478c.1-.093.199-.185.3-.276.153-.136.31-.268.467-.4.097-.08.193-.163.291-.242.255-.203.514-.402.78-.592a21.534 21.534 0 0 0-1.76-.592l-.018-.005c-.176-.05-.355-.095-.533-.141-.132-.035-.263-.073-.397-.105-.213-.051-.43-.095-.646-.14-.077-.016-.153-.035-.231-.05H26.9a21.37 21.37 0 0 0-4.118-.4Zm35.728 3.64-2.472 1.82a18.424 18.424 0 0 1 2.61 5.004l2.907-.986a21.474 21.474 0 0 0-3.045-5.839Zm3.864 9.034-3.022.534c.328 1.86.37 3.772.118 5.642l3.042.409a21.448 21.448 0 0 0-.138-6.585zm-3.496 8.943a18.539 18.539 0 0 1-2.416 5.104l2.543 1.72a21.586 21.586 0 0 0 2.815-5.952zM54.703 42a18.288 18.288 0 0 1-4.428 3.492l1.505 2.675a21.348 21.348 0 0 0 5.173-4.08zm-6.995 4.69a18.512 18.512 0 0 1-5.526 1.158l.163 3.065a21.56 21.56 0 0 0 6.444-1.35z"/>
</svg>
`,lh=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M44.698 2.661a1.644 1.644 0 0 1 2.328 0l9.866 9.866a1.644 1.644 0 0 1 0 2.329L24.004 47.744a1.644 1.644 0 0 1-.552.362L7.008 54.683a1.644 1.644 0 0 1-2.138-2.138l6.578-16.444a1.644 1.644 0 0 1 .362-.552zm-3.089 7.742 7.542 7.541 4.252-4.252-7.541-7.541zm5.216 9.866-7.54-7.54-21.378 21.376v.964h1.644a1.644 1.644 0 0 1 1.645 1.644v1.645h1.644a1.644 1.644 0 0 1 1.645 1.644v1.644h.963zM14.724 37.29l-.35.348L9.35 50.204l12.566-5.025.349-.35a1.644 1.644 0 0 1-1.07-1.538v-1.645h-1.644a1.644 1.644 0 0 1-1.644-1.644v-1.644h-1.644a1.644 1.644 0 0 1-1.54-1.07"/>
    <path stroke="currentColor" stroke-width="5.107"
          d="M6.298 59.53c3.44-1.692 6.88-3.384 10.558-4.319s7.594-1.111 11.719-.298c4.125.814 8.459 2.617 13.483 2.655 5.023.038 10.737-1.689 16.45-3.415"/>
</svg>
`,uh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M31.226 17.87c-4.69 0-8.532 3.832-8.532 8.508 0 1.812.58 3.495 1.558 4.88l5.932 10.255c.831 1.085 1.383.879 2.074-.058l6.543-11.135c.132-.24.236-.493.327-.753a8.396 8.396 0 0 0 .628-3.19c0-4.675-3.841-8.506-8.53-8.506zm0 3.987a4.5 4.5 0 0 1 4.532 4.52 4.5 4.5 0 0 1-4.532 4.521 4.5 4.5 0 0 1-4.534-4.52 4.5 4.5 0 0 1 4.533-4.52z"/>
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="6"
          stroke-width="5" d="M8.97 53.509 4.423 19.145 35.698 4.199l23.88 25.127L43.06 59.801Z"/>
</svg>
`,ch=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <ellipse cx="4.907" cy="-32.051" fill="none" stroke="currentColor" stroke-dasharray="13.7543, 6.87718"
             stroke-width="5.489" rx="20.4" ry="13.713" transform="matrix(-.71127 .70292 -.86047 -.5095 0 0)"/>
    <path fill="currentColor"
          d="M34.597 25.275a1.934 1.934 0 0 0-2.04 2.165l2.922 31.37c.188 1.523 1.989 2.235 3.165 1.249l6.169-5.004 2.765 4.79c1.59 2.756 4.115 3.431 6.87 1.841 2.756-1.59 3.433-4.114 1.841-6.87l-2.755-4.773 7.31-2.803c1.443-.525 1.728-2.44.503-3.365L35.64 25.66a1.93 1.93 0 0 0-1.042-.383z"/>
</svg>
`,dh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.947 25.554c-2.176 3.77-.867 8.656 2.903 10.832 2.126 1.229 4.607 1.346 6.757.539l8.252 12.152a7.79 7.79 0 0 0-.701 1.005c-2.176 3.77-.867 8.656 2.903 10.833 3.77 2.177 8.655.867 10.832-2.903 2.1-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.404-.181 7.955 7.955 0 0 0-6.086-.432l-8.348-12.292c.19-.252.369-.512.53-.79 1.457-2.526 1.339-5.537-.03-7.907l8.202-8.256c3.494 1.335 7.562.025 9.575-3.229l13.899 2.913c.266 2.435 1.634 4.721 3.899 6.03 3.77 2.176 8.655.866 10.832-2.904 2.101-3.64.93-8.294-2.543-10.572a2.211 2.211 0 0 0-.36-.26 2.211 2.211 0 0 0-.403-.181c-3.71-1.87-8.328-.556-10.429 3.083-.084.147-.155.297-.228.446l-13.5-2.83c-.053-2.55-1.329-5.023-3.58-6.499a2.211 2.211 0 0 0-.358-.259 2.211 2.211 0 0 0-.405-.181c-3.708-1.87-8.326-.556-10.428 3.083-1.61 2.79-1.307 6.19.486 8.652l-7.84 7.892a2.211 2.211 0 0 0-.094-.036c-3.71-1.87-8.328-.556-10.429 3.084zm3.83 2.211a3.473 3.473 0 0 1 4.79-1.282 3.472 3.472 0 0 1 1.284 4.789 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.79ZM23.656 8.173a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.789 1.284 3.475 3.475 0 0 1-1.284-4.791zm-.666 44.12a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791zm29.166-37.88a3.474 3.474 0 0 1 4.79-1.283 3.472 3.472 0 0 1 1.283 4.79 3.473 3.473 0 0 1-4.79 1.284 3.475 3.475 0 0 1-1.283-4.791z"/>
    <path fill="currentColor"
          d="M12.9 13.516c-.63.177-.685.37-.88.95l-1.069 3.18 2.995 1.006.844-2.506 2.074-.882-1.236-2.908zm19.209 5.25 4.378 4.554 2.277-2.19-4.379-4.554zm8.132 3.106 1.441 2.812 5.623-2.882-1.441-2.812zM5.448 46.082l3.144.304.608-6.29-3.145-.303zm4.623 3.728 5.762 2.592 1.297-2.88-5.762-2.593z"/>
</svg>
`,hh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.717 38.645a2.675 2.668 79.7 0 0-.307 3.769L16.754 60.55a2.675 2.668 79.7 0 0 3.76.312l41.769-35.508a2.675 2.668 79.7 0 0 .307-3.769L47.246 3.45a2.675 2.668 79.7 0 0-3.76-.312zm5.486 2.352 37.702-32.05 11.892 14.056-2.717 2.31-4.458-5.269-2.033 1.729 4.457 5.269-3.11 2.643-4.457-5.268-2.034 1.728 4.458 5.27-3.106 2.64-4.458-5.27-2.033 1.73 4.457 5.268-3.11 2.644-6.194-7.32-2.033 1.728 6.193 7.32-3.11 2.645-4.457-5.269-2.034 1.729 4.458 5.268-3.106 2.64-4.458-5.268-2.033 1.73 4.457 5.268-3.11 2.643-4.457-5.268-2.034 1.729 4.458 5.268-2.098 1.783z"/>
</svg>
`,fh=`<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 64 64">
    <path d="M7.839 34.833c-7.104-9.763-5.332-23.33 4.2-30.266C21.572-2.369 35.03.123 42.13 9.882L56.166 29.17c7.098 9.755 5.329 23.325-4.204 30.262-9.533 6.936-22.989 4.444-30.09-5.315L7.841 34.836Zm5.063-25.476c-6.079 5.766-7.006 15.598-1.634 22.98l.778 1.07 12.002-8.732zm3.43-2.495L27.476 22.18l12.002-8.733-.781-1.073c-5.37-7.38-15.01-9.522-22.367-5.512m25.643 10.014L14.54 36.836l10.762 14.79c5.818 7.997 16.653 9.842 24.163 4.378 7.51-5.465 9.088-16.342 3.267-24.342z"/>
</svg>
`,ph=`\uFEFF<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M42.012 2.106a4.092 4.092 0 0 0-5.741.735 4.092 4.092 0 0 0 .572 5.607L23.964 23.45a8.185 8.185 0 0 0-10.458 2.142l5.18 4.005 5.454 4.218L7.87 59.22a1.124 7.304 37.712 0 0 1.54 1.19l20.494-22.138 5.454 4.217 5.18 4.005a8.185 8.185 0 0 0-.558-10.66l11.277-16.24a4.092 4.092 0 0 0 5.572-.858 4.092 4.092 0 0 0-.735-5.74z"/>
</svg>
`,gh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor" stroke="currentColor">
        <path d="m37.62 5.028-.337.284-4.039 4.068 3.547 3.523L39.875 9.8l2.846.596 1.025-4.893-4.176-.877Zm9.995 6.393 9.787 2.053 1.026-4.895-9.787-2.05zm14.68 3.078 9.787 2.05 1.025-4.892-9.787-2.053zm-39.623 5.522 3.547 3.523 7.049-7.094-3.547-3.523zm-10.57 10.642 3.546 3.524 7.047-7.094-3.547-3.524zM1.529 41.306l3.55 3.523 7.046-7.096-3.547-3.523Zm70.977 4.027 3.91 3.115 3.44-4.387-1.118-6.55zM.947 48.319l5.617 8.274 4.137-2.809-5.617-8.273Zm62.211 8.744 3.91 3.116 6.233-7.82-3.91-3.116zM9.373 60.73l5.62 8.272 4.134-2.809-5.617-8.271zm44.438 8.067 3.91 3.115 6.232-7.82-3.91-3.117zM17.8 73.138l5.617 8.273 4.137-2.808-5.617-8.274zm26.662 7.388 3.91 3.116 6.232-7.82-3.91-3.116zm-18.236 5.022 5.617 8.273 4.136-2.81-5.617-8.272zm8.888 6.709 3.91 3.117 6.233-7.822-3.91-3.115z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="M22.672 20.02a3.5 3.5 0 0 0-2.506 1.034L-.514 41.872a3.5 3.5 0 0 0-.412 4.434L18 74.176a3.5 3.5 0 0 0 5.633.216l33.494-42.038a3.5 3.5 0 0 0-2.018-5.605l-31.742-6.654a3.5 3.5 0 0 0-.695-.074zm1.121 7.317 24.32 5.098-26.992 33.877L6.484 44.759Z"
              stroke-width="3"
              transform="translate(2.517 1.586) scale(.60827)"/>
        <path d="m78.734 7.668 2.61 11.396-18.145 4.154 2.705 11.816L84.05 30.88l2.609 11.396L100 21.011Z"
              stroke-width="3"
              transform="translate(1.586 1.586) scale(.60827)"/>
    </g>
</svg>
`,mh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor" fill-rule="evenodd"
          d="M19.435 3.417c-4.478 0-8.96 1.693-12.343 5.076-6.766 6.766-6.766 17.913 0 24.679h.006c2.754 2.749 5.563 5.561 8.357 8.357 1.857 1.859 3.696 3.696 5.553 5.553l.949.949 1.892 1.898 9.496-9.49-1.898-1.898-6.502-6.502c-2.796-2.797-5.6-5.606-8.363-8.362-1.65-1.653-1.652-4.042 0-5.694 1.653-1.653 4.047-1.653 5.7 0l8.357 8.362 6.502 6.502 1.898 1.893 9.49-9.49-1.893-1.893-6.507-6.502-8.357-8.362c-3.384-3.383-7.86-5.076-12.337-5.076Zm0 2.68c3.789 0 7.577 1.432 10.439 4.294l8.357 8.362-5.694 5.694-8.357-8.362a6.7 6.7 0 0 0-9.496 0 6.697 6.697 0 0 0 0 9.49c2.76 2.755 5.566 5.564 8.363 8.362l-5.694 5.694c-2.795-2.796-5.601-5.607-8.357-8.357H8.99c-5.724-5.724-5.724-15.16 0-20.883 2.861-2.862 6.655-4.294 10.444-4.294ZM57.709 29.03a4.266 4.266 0 0 0-4.268 4.268c0 1.594.881 2.973 2.176 3.707-.714 4.997-1.424 10.107-2.176 15.037-.934 0-1.792.309-2.495.818l-7.115-5.07a4.25 4.25 0 0 0 .115-.965 4.27 4.27 0 1 0-4.268 4.268 4.23 4.23 0 0 0 2.732-1.012l6.973 4.965a4.22 4.22 0 0 0-.215 1.269 4.27 4.27 0 0 0 4.273 4.268 4.266 4.266 0 0 0 4.268-4.268 4.247 4.247 0 0 0-1.657-3.356l2.208-15.446c2.095-.273 3.722-2.045 3.722-4.215a4.27 4.27 0 0 0-4.273-4.268z"
    />
</svg>
`,vh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <g fill="currentColor">
        <path d="m4.879 2.684-2.832 2.8L7.65 11.15l2.832-2.801Zm8.403 8.495-2.832 2.802 5.603 5.662 2.831-2.802zm8.404 8.494-2.832 2.8 5.602 5.664 2.832-2.802z"
        />
        <path d="M27.814 7.408a3.576 3.576 0 0 0-1.161-.176 3.2 3.2 0 0 0-.878.138l7.963 26.068L7.18 27.3c-.543 2.352 1.67 6.055 4.962 6.816l23.054 5.297 2.326 6.42c-2.27-.175-4.279 1.912-4.908 3.805-.535 1.698-.512 3.656.085 5.61.597 1.954 1.671 3.59 3.064 4.7 1.393 1.11 3.238 1.71 5.023 1.164 8.064-3.039 2.135-15.793.467-20.58 5.917 1.023 18.77 5.88 20.578-1.979.42-1.819-.306-3.616-1.509-4.929-1.203-1.313-2.909-2.27-4.9-2.73-1.99-.46-3.866-.547-5.602.303-1.737.849-3.768 2.642-3.468 4.73a6.17 6.17 0 0 0 .012.43l-6.563-1.794-6.88-22.632c-.702-2.297-3.445-3.99-5.108-4.523Zm26.824 26.88c1.36.315 2.472.99 3.116 1.692.644.703.795 1.307.684 1.79-.112.482-.511.956-1.399 1.305-.887.348-2.182.467-3.542.152-1.361-.314-2.472-.99-3.116-1.693-.644-.703-.797-1.304-.686-1.787.112-.482.513-.956 1.4-1.305a5.198 5.198 0 0 1 1.594-.327 6.98 6.98 0 0 1 1.949.173zM37.846 49.174c.333.069.71.25 1.13.585.746.594 1.497 1.654 1.905 2.99.408 1.335.379 2.635.092 3.545-.287.91-.731 1.34-1.205 1.484-.473.145-1.085.036-1.831-.558-.746-.594-1.496-1.655-1.904-2.99-.407-1.336-.378-2.637-.092-3.546.287-.91.732-1.342 1.206-1.486.118-.036.245-.057.38-.058.102 0 .207.011.319.034z"
        />
    </g>
</svg>
`,yh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M41.233 7.917c-5.5 0-10.519 2.077-14.328 5.482a21.443 21.443 0 0 0-4.138-.404c-11.88 0-21.544 9.664-21.544 21.544s9.664 21.544 21.544 21.544c5.5 0 10.519-2.077 14.328-5.482 1.34.263 2.722.404 4.138.404 11.88 0 21.544-9.664 21.544-21.544S53.113 7.917 41.233 7.917zm-9.969 6.791a21.61 21.61 0 0 1 5.598 3.499l-2.01 2.33a18.557 18.557 0 0 0-4.8-2.999Zm-7.927 2.765 2.557 1.714a18.558 18.558 0 0 0-2.396 5.128l-2.955-.86a21.614 21.614 0 0 1 2.794-5.982zm15.86 3.08a21.413 21.413 0 0 1 3.46 5.628l-2.839 1.188a18.357 18.357 0 0 0-2.963-4.817zm-19.334 6.142 3.053.399a18.348 18.348 0 0 0 .144 5.654l-3.027.552a21.407 21.407 0 0 1-.17-6.605Zm23.834 2.63a21.81 21.81 0 0 1 .548 3.263c.1 1.1.115 2.207.044 3.31l-3.07-.195c.12-1.888-.056-3.8-.511-5.64zm-19.918 6.172a18.37 18.37 0 0 0 2.64 5.003l-2.466 1.84a21.427 21.427 0 0 1-3.083-5.84Zm17.042 3.016 3.004.666a21.486 21.486 0 0 1-2.404 6.15l-2.66-1.547a18.434 18.434 0 0 0 2.06-5.27zm-12.535 4.124a18.554 18.554 0 0 0 4.6 3.302l-1.392 2.744a21.611 21.611 0 0 1-5.363-3.85Z"/>
</svg>
`,bh=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <path fill="currentColor"
          d="M1.585 1.585V13.75h5.17v1.52H8.58v-1.52h5.17V1.585Zm3.041 3.041h6.083v6.083H4.626Zm9.429 2.13V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0V8.58h3.65V6.755Zm5.475 0v1.597a1.521 1.521 0 0 0-.325.152l-15.686 9.758a1.52 1.52 0 0 0-.199 2.437l23.512 20.553a1.52 1.52 0 0 0 2.477-.78l4.212-17.037v.352h1.825v-3.65H55.42v1.524a1.52 1.52 0 0 0-.222-.296L43.002 8.741a1.521 1.521 0 0 0-.182-.16h2.259V6.754Zm5.475 0V8.58h3.65V6.755Zm5.474 0V8.58h3.65V6.755Zm3.042 2.432v3.65h1.825v-3.65Zm-13.752 2.549 10.757 11.137-3.57 14.446-20.087-17.559Zm13.752 2.926v3.65h1.825v-3.65ZM6.755 17.096v3.65H8.58v-3.65zm0 5.475v3.65h1.628a1.52 1.52 0 0 0 1.02.909l12.683 3.406 7.905 12.694c.168.27.417.481.712.602l13.39 4.576a1.52 1.52 0 0 0 1.157-2.814l-12.936-4.389L24.35 28.42a1.52 1.52 0 0 0-.896-.664L10.19 24.193a1.52 1.52 0 0 0-1.61.557v-2.178zm48.665 3.042v3.65h1.825v-3.65ZM6.755 28.046v3.65H8.58v-3.65zm48.665 3.042v3.65h1.825v-3.65ZM6.755 33.52v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65ZM6.755 38.996v3.65H8.58v-3.65zm48.665 3.041v3.65h1.825v-3.65zm-35.382.913c-3.454 0-6.287 2.833-6.287 6.287 0 3.076 2.248 5.654 5.179 6.183h-1.225v1.825h3.65V55.42h-.206c2.712-.5 4.777-2.796 5.055-5.59l.002-.002a1.52 1.52 0 0 0 0-1.18c-.314-3.168-2.922-5.698-6.168-5.698zM6.755 44.47v3.65H8.58v-3.65zm13.283 1.521a3.223 3.223 0 0 1 3.246 3.246 3.223 3.223 0 0 1-3.246 3.246 3.223 3.223 0 0 1-3.246-3.246 3.223 3.223 0 0 1 3.246-3.246zm35.382 1.52v2.738h-5.17v12.166h12.165V50.25h-5.17v-2.737ZM6.755 49.946v3.65H8.58v-3.65zm46.536 3.346h6.083v6.083H53.29ZM6.755 55.42v1.825h3.65V55.42H7.668Zm5.475 0v1.825h3.65V55.42zm10.95 0v1.825h3.65V55.42zm5.474 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42zm5.475 0v1.825h3.65V55.42z"/>
</svg>
`,re={marker:$d,circle:Yd,circle_marker:du,text_marker:nh,line:Zd,rectangle:Xd,polygon:Kd,freehand:lh,custom_shape:oh,drag:Wd,change:qd,rotate:eh,scale:gh,copy:ih,cut:ah,split:vh,delete:Qd,union:yh,difference:sh,line_simplification:dh,lasso:ch,snapping:mh,pin:ph,snap_guides:th,measurements:hh,auto_trace:rh,geofencing:uh,zoom_to_features:bh,click_to_edit:fh},wh=["mode_start","mode_started","mode_end","mode_ended"],Ge=t=>Object.keys(t),rr=t=>Object.values(t),rn=(t,e)=>e.includes(t);function Eh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Go={exports:{}},kh=Go.exports,xs;function Mh(){return xs||(xs=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(kh,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],o={},a=null;function s(M,D){var P=M[D];if(typeof P.bind=="function")return P.bind(M);try{return Function.prototype.bind.call(P,M)}catch{return function(){return Function.prototype.apply.apply(P,[M,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(M){return M==="debug"&&(M="log"),typeof console===n?!1:M==="trace"&&r?l:console[M]!==void 0?s(console,M):console.log!==void 0?s(console,"log"):e}function h(){for(var M=this.getLevel(),D=0;D<i.length;D++){var P=i[D];this[P]=D<M?e:this.methodFactory(P,M,this.name)}if(this.log=this.debug,typeof console===n&&M<this.levels.SILENT)return"No console available for logging"}function c(M){return function(){typeof console!==n&&(h.call(this),this[M].apply(this,arguments))}}function p(M,D,P){return u(M)||c.apply(this,arguments)}function m(M,D){var P=this,E,B,O,R="loglevel";typeof M=="string"?R+=":"+M:typeof M=="symbol"&&(R=void 0);function G(v){var y=(i[v]||"silent").toUpperCase();if(!(typeof window===n||!R)){try{window.localStorage[R]=y;return}catch{}try{window.document.cookie=encodeURIComponent(R)+"="+y+";"}catch{}}}function J(){var v;if(!(typeof window===n||!R)){try{v=window.localStorage[R]}catch{}if(typeof v===n)try{var y=window.document.cookie,S=encodeURIComponent(R),F=y.indexOf(S+"=");F!==-1&&(v=/^([^;]+)/.exec(y.slice(F+S.length+1))[1])}catch{}return P.levels[v]===void 0&&(v=void 0),v}}function d(){if(!(typeof window===n||!R)){try{window.localStorage.removeItem(R)}catch{}try{window.document.cookie=encodeURIComponent(R)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function f(v){var y=v;if(typeof y=="string"&&P.levels[y.toUpperCase()]!==void 0&&(y=P.levels[y.toUpperCase()]),typeof y=="number"&&y>=0&&y<=P.levels.SILENT)return y;throw new TypeError("log.setLevel() called with invalid level: "+v)}P.name=M,P.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},P.methodFactory=D||p,P.getLevel=function(){return O??B??E},P.setLevel=function(v,y){return O=f(v),y!==!1&&G(O),h.call(P)},P.setDefaultLevel=function(v){B=f(v),J()||P.setLevel(v,!1)},P.resetLevel=function(){O=null,d(),h.call(P)},P.enableAll=function(v){P.setLevel(P.levels.TRACE,v)},P.disableAll=function(v){P.setLevel(P.levels.SILENT,v)},P.rebuild=function(){if(a!==P&&(E=f(a.getLevel())),h.call(P),a===P)for(var v in o)o[v].rebuild()},E=f(a?a.getLevel():"WARN");var g=J();g!=null&&(O=f(g)),h.call(P)}a=new m,a.getLogger=function(M){if(typeof M!="symbol"&&typeof M!="string"||M==="")throw new TypeError("You must supply a name when creating a logger.");var D=o[M];return D||(D=o[M]=new m(M,a.methodFactory)),D};var A=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=A),a},a.getLoggers=function(){return o},a.default=a,a})}(Go)),Go.exports}var xh=Mh();const j=Eh(xh);class wa{isMarkerInstanceAvailable(){return this.markerInstance?!0:(j.error("Marker instance is not available"),!1)}}var ke=63710088e-1,hu={centimeters:ke*100,centimetres:ke*100,degrees:360/(2*Math.PI),feet:ke*3.28084,inches:ke*39.37,kilometers:ke/1e3,kilometres:ke/1e3,meters:ke,metres:ke,miles:ke/1609.344,millimeters:ke*1e3,millimetres:ke*1e3,nauticalmiles:ke/1852,radians:1,yards:ke*1.0936};function mt(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function zt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ss(t[0])||!Ss(t[1]))throw new Error("coordinates must contain numbers");return mt({type:"Point",coordinates:t},e,n)}function an(t,e,n={}){for(const r of t){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<r[r.length-1].length;i++)if(r[r.length-1][i]!==r[0][i])throw new Error("First and last Position are not equivalent.")}return mt({type:"Polygon",coordinates:t},e,n)}function pr(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return mt({type:"LineString",coordinates:t},e,n)}function xe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function Sh(t,e,n={}){return mt({type:"MultiLineString",coordinates:t},e,n)}function fu(t,e,n={}){return mt({type:"MultiPolygon",coordinates:t},e,n)}function pu(t,e="kilometers"){const n=hu[e];if(!n)throw new Error(e+" units is invalid");return t*n}function gu(t,e="kilometers"){const n=hu[e];if(!n)throw new Error(e+" units is invalid");return t/n}function Tn(t){return t%(2*Math.PI)*180/Math.PI}function be(t){return t%360*Math.PI/180}function mu(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return pu(gu(t,e),n)}function Ss(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Ea(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Zt(t,e,n){if(t!==null)for(var r,i,o,a,s,l,u,h=0,c=0,p,m=t.type,A=m==="FeatureCollection",M=m==="Feature",D=A?t.features.length:1,P=0;P<D;P++){u=A?t.features[P].geometry:M?t.geometry:t,p=u?u.type==="GeometryCollection":!1,s=p?u.geometries.length:1;for(var E=0;E<s;E++){var B=0,O=0;if(a=p?u.geometries[E]:u,a!==null){l=a.coordinates;var R=a.type;switch(h=n&&(R==="Polygon"||R==="MultiPolygon")?1:0,R){case null:break;case"Point":if(e(l,c,P,B,O)===!1)return!1;c++,B++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(e(l[r],c,P,B,O)===!1)return!1;c++,R==="MultiPoint"&&B++}R==="LineString"&&B++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-h;i++){if(e(l[r][i],c,P,B,O)===!1)return!1;c++}R==="MultiLineString"&&B++,R==="Polygon"&&O++}R==="Polygon"&&B++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(O=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-h;o++){if(e(l[r][i][o],c,P,B,O)===!1)return!1;c++}O++}B++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(Zt(a.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ut(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function Ah(t,e,n){var r=n;return Ut(t,function(i,o){o===0&&n===void 0?r=i:r=e(r,i,o)}),r}function xr(t,e){var n,r,i,o,a,s,l,u,h,c,p=0,m=t.type==="FeatureCollection",A=t.type==="Feature",M=m?t.features.length:1;for(n=0;n<M;n++){for(s=m?t.features[n].geometry:A?t.geometry:t,u=m?t.features[n].properties:A?t.properties:{},h=m?t.features[n].bbox:A?t.bbox:void 0,c=m?t.features[n].id:A?t.id:void 0,l=s?s.type==="GeometryCollection":!1,a=l?s.geometries.length:1,i=0;i<a;i++){if(o=l?s.geometries[i]:s,o===null){if(e(null,p,u,h,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,p,u,h,c)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<o.geometries.length;r++)if(e(o.geometries[r],p,u,h,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function Lh(t,e,n){var r=n;return xr(t,function(i,o,a,s,l){r=e(r,i,o,a,s,l)}),r}function Vt(t,e){xr(t,function(n,r,i,o,a){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(mt(n,i,{bbox:o,id:a}),r,0)===!1?!1:void 0}var l;switch(s){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<n.coordinates.length;u++){var h=n.coordinates[u],c={type:l,coordinates:h};if(e(mt(c,i),r,u)===!1)return!1}})}function At(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const n=[1/0,1/0,-1/0,-1/0];return Zt(t,r=>{n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}var vu=At;function ge(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function He(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Sr(t){return t.type==="Feature"?t.geometry:t}function As(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function Ch(t,e,n,r={}){const i=ge(t),o=be(i[0]),a=be(i[1]),s=be(n),l=gu(e,r.units),u=Math.asin(Math.sin(a)*Math.cos(l)+Math.cos(a)*Math.sin(l)*Math.cos(s)),h=o+Math.atan2(Math.sin(s)*Math.sin(l)*Math.cos(a),Math.cos(l)-Math.sin(a)*Math.sin(u)),c=Tn(h),p=Tn(u);return zt([c,p],r.properties)}function Ih(t,e,n={}){const r=n.steps||64,i=n.properties?n.properties:!Array.isArray(t)&&t.type==="Feature"&&t.properties?t.properties:{},o=[];for(let a=0;a<r;a++)o.push(Ch(t,e,a*-360/r,n).geometry.coordinates);return o.push(o[0]),an([o],i)}var Dh=Ih;function dt(t,e,n={}){var r=ge(t),i=ge(e),o=be(i[1]-r[1]),a=be(i[0]-r[0]),s=be(r[1]),l=be(i[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(l);return pu(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),n.units)}var Ph=dt;function Ro(t,e={}){const n=Sr(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),n.type){case"Polygon":return Fh(n,e);case"MultiPolygon":return Th(n,e);default:throw new Error("invalid poly")}}function Fh(t,e={}){const n=Sr(t).coordinates,r=e.properties?e.properties:t.type==="Feature"?t.properties:{};return yu(n,r)}function Th(t,e={}){const n=Sr(t).coordinates,r=e.properties?e.properties:t.type==="Feature"?t.properties:{},i=[];return n.forEach(o=>{i.push(yu(o,r))}),xe(i)}function yu(t,e){return t.length>1?Sh(t,e):pr(t[0],e)}var bu=typeof global=="object"&&global&&global.Object===Object&&global,_h=typeof self=="object"&&self&&self.Object===Object&&self,st=bu||_h||Function("return this")(),Xe=st.Symbol,wu=Object.prototype,Oh=wu.hasOwnProperty,Bh=wu.toString,Wn=Xe?Xe.toStringTag:void 0;function Nh(t){var e=Oh.call(t,Wn),n=t[Wn];try{t[Wn]=void 0;var r=!0}catch{}var i=Bh.call(t);return r&&(e?t[Wn]=n:delete t[Wn]),i}var Gh=Object.prototype,Rh=Gh.toString;function jh(t){return Rh.call(t)}var zh="[object Null]",Hh="[object Undefined]",Ls=Xe?Xe.toStringTag:void 0;function cn(t){return t==null?t===void 0?Hh:zh:Ls&&Ls in Object(t)?Nh(t):jh(t)}function vt(t){return t!=null&&typeof t=="object"}var Jh="[object Symbol]";function _n(t){return typeof t=="symbol"||vt(t)&&cn(t)==Jh}function Cn(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Pe=Array.isArray,Cs=Xe?Xe.prototype:void 0,Is=Cs?Cs.toString:void 0;function Eu(t){if(typeof t=="string")return t;if(Pe(t))return Cn(t,Eu)+"";if(_n(t))return Is?Is.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var Uh=/\s/;function Vh(t){for(var e=t.length;e--&&Uh.test(t.charAt(e)););return e}var qh=/^\s+/;function Yh(t){return t&&t.slice(0,Vh(t)+1).replace(qh,"")}function Ve(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Ds=NaN,Wh=/^[-+]0x[0-9a-f]+$/i,Zh=/^0b[01]+$/i,$h=/^0o[0-7]+$/i,Kh=parseInt;function Ps(t){if(typeof t=="number")return t;if(_n(t))return Ds;if(Ve(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Ve(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Yh(t);var n=Zh.test(t);return n||$h.test(t)?Kh(t.slice(2),n?2:8):Wh.test(t)?Ds:+t}function Oi(t){return t}var Xh="[object AsyncFunction]",Qh="[object Function]",ef="[object GeneratorFunction]",tf="[object Proxy]";function ka(t){if(!Ve(t))return!1;var e=cn(t);return e==Qh||e==ef||e==Xh||e==tf}var co=st["__core-js_shared__"],Fs=function(){var t=/[^.]+$/.exec(co&&co.keys&&co.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function nf(t){return!!Fs&&Fs in t}var rf=Function.prototype,of=rf.toString;function dn(t){if(t!=null){try{return of.call(t)}catch{}try{return t+""}catch{}}return""}var af=/[\\^$.*+?()[\]{}|]/g,sf=/^\[object .+?Constructor\]$/,lf=Function.prototype,uf=Object.prototype,cf=lf.toString,df=uf.hasOwnProperty,hf=RegExp("^"+cf.call(df).replace(af,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ff(t){if(!Ve(t)||nf(t))return!1;var e=ka(t)?hf:sf;return e.test(dn(t))}function pf(t,e){return t==null?void 0:t[e]}function hn(t,e){var n=pf(t,e);return ff(n)?n:void 0}var jo=hn(st,"WeakMap"),Ts=Object.create,gf=function(){function t(){}return function(e){if(!Ve(e))return{};if(Ts)return Ts(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function mf(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function vf(){}function yf(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var bf=800,wf=16,Ef=Date.now;function kf(t){var e=0,n=0;return function(){var r=Ef(),i=wf-(r-n);if(n=r,i>0){if(++e>=bf)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Mf(t){return function(){return t}}var pi=function(){try{var t=hn(Object,"defineProperty");return t({},"",{}),t}catch{}}(),xf=pi?function(t,e){return pi(t,"toString",{configurable:!0,enumerable:!1,value:Mf(e),writable:!0})}:Oi,Sf=kf(xf);function Af(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function Lf(t,e,n,r){for(var i=t.length,o=n+-1;++o<i;)if(e(t[o],o,t))return o;return-1}function Cf(t){return t!==t}function If(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function Df(t,e,n){return e===e?If(t,e,n):Lf(t,Cf,n)}function ku(t,e){var n=t==null?0:t.length;return!!n&&Df(t,e,0)>-1}var Pf=9007199254740991,Ff=/^(?:0|[1-9]\d*)$/;function Ma(t,e){var n=typeof t;return e=e??Pf,!!e&&(n=="number"||n!="symbol"&&Ff.test(t))&&t>-1&&t%1==0&&t<e}function Bi(t,e,n){e=="__proto__"&&pi?pi(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Ar(t,e){return t===e||t!==t&&e!==e}var Tf=Object.prototype,_f=Tf.hasOwnProperty;function Mu(t,e,n){var r=t[e];(!(_f.call(t,e)&&Ar(r,n))||n===void 0&&!(e in t))&&Bi(t,e,n)}function Of(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],l=void 0;l===void 0&&(l=t[s]),i?Bi(n,s,l):Mu(n,s,l)}return n}var _s=Math.max;function Bf(t,e,n){return e=_s(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=_s(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),mf(t,this,s)}}function xa(t,e){return Sf(Bf(t,e,Oi),t+"")}var Nf=9007199254740991;function Sa(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Nf}function Rn(t){return t!=null&&Sa(t.length)&&!ka(t)}function zo(t,e,n){if(!Ve(n))return!1;var r=typeof e;return(r=="number"?Rn(n)&&Ma(e,n.length):r=="string"&&e in n)?Ar(n[e],t):!1}function xu(t){return xa(function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=t.length>3&&typeof o=="function"?(i--,o):void 0,a&&zo(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e})}var Gf=Object.prototype;function Aa(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Gf;return t===n}function Rf(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var jf="[object Arguments]";function Os(t){return vt(t)&&cn(t)==jf}var Su=Object.prototype,zf=Su.hasOwnProperty,Hf=Su.propertyIsEnumerable,gr=Os(function(){return arguments}())?Os:function(t){return vt(t)&&zf.call(t,"callee")&&!Hf.call(t,"callee")};function Jf(){return!1}var Au=typeof Je=="object"&&Je&&!Je.nodeType&&Je,Bs=Au&&typeof Ue=="object"&&Ue&&!Ue.nodeType&&Ue,Uf=Bs&&Bs.exports===Au,Ns=Uf?st.Buffer:void 0,Vf=Ns?Ns.isBuffer:void 0,mr=Vf||Jf,qf="[object Arguments]",Yf="[object Array]",Wf="[object Boolean]",Zf="[object Date]",$f="[object Error]",Kf="[object Function]",Xf="[object Map]",Qf="[object Number]",ep="[object Object]",tp="[object RegExp]",np="[object Set]",rp="[object String]",ip="[object WeakMap]",op="[object ArrayBuffer]",ap="[object DataView]",sp="[object Float32Array]",lp="[object Float64Array]",up="[object Int8Array]",cp="[object Int16Array]",dp="[object Int32Array]",hp="[object Uint8Array]",fp="[object Uint8ClampedArray]",pp="[object Uint16Array]",gp="[object Uint32Array]",ce={};ce[sp]=ce[lp]=ce[up]=ce[cp]=ce[dp]=ce[hp]=ce[fp]=ce[pp]=ce[gp]=!0;ce[qf]=ce[Yf]=ce[op]=ce[Wf]=ce[ap]=ce[Zf]=ce[$f]=ce[Kf]=ce[Xf]=ce[Qf]=ce[ep]=ce[tp]=ce[np]=ce[rp]=ce[ip]=!1;function mp(t){return vt(t)&&Sa(t.length)&&!!ce[cn(t)]}function Ni(t){return function(e){return t(e)}}var Lu=typeof Je=="object"&&Je&&!Je.nodeType&&Je,cr=Lu&&typeof Ue=="object"&&Ue&&!Ue.nodeType&&Ue,vp=cr&&cr.exports===Lu,ho=vp&&bu.process,On=function(){try{var t=cr&&cr.require&&cr.require("util").types;return t||ho&&ho.binding&&ho.binding("util")}catch{}}(),Gs=On&&On.isTypedArray,La=Gs?Ni(Gs):mp,yp=Object.prototype,bp=yp.hasOwnProperty;function Cu(t,e){var n=Pe(t),r=!n&&gr(t),i=!n&&!r&&mr(t),o=!n&&!r&&!i&&La(t),a=n||r||i||o,s=a?Rf(t.length,String):[],l=s.length;for(var u in t)(e||bp.call(t,u))&&!(a&&(u=="length"||i&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Ma(u,l)))&&s.push(u);return s}function Iu(t,e){return function(n){return t(e(n))}}var wp=Iu(Object.keys,Object),Ep=Object.prototype,kp=Ep.hasOwnProperty;function Mp(t){if(!Aa(t))return wp(t);var e=[];for(var n in Object(t))kp.call(t,n)&&n!="constructor"&&e.push(n);return e}function Gi(t){return Rn(t)?Cu(t):Mp(t)}function xp(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var Sp=Object.prototype,Ap=Sp.hasOwnProperty;function Lp(t){if(!Ve(t))return xp(t);var e=Aa(t),n=[];for(var r in t)r=="constructor"&&(e||!Ap.call(t,r))||n.push(r);return n}function Du(t){return Rn(t)?Cu(t,!0):Lp(t)}var Cp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ip=/^\w*$/;function Ca(t,e){if(Pe(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||_n(t)?!0:Ip.test(t)||!Cp.test(t)||e!=null&&t in Object(e)}var vr=hn(Object,"create");function Dp(){this.__data__=vr?vr(null):{},this.size=0}function Pp(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Fp="__lodash_hash_undefined__",Tp=Object.prototype,_p=Tp.hasOwnProperty;function Op(t){var e=this.__data__;if(vr){var n=e[t];return n===Fp?void 0:n}return _p.call(e,t)?e[t]:void 0}var Bp=Object.prototype,Np=Bp.hasOwnProperty;function Gp(t){var e=this.__data__;return vr?e[t]!==void 0:Np.call(e,t)}var Rp="__lodash_hash_undefined__";function jp(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=vr&&e===void 0?Rp:e,this}function sn(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}sn.prototype.clear=Dp;sn.prototype.delete=Pp;sn.prototype.get=Op;sn.prototype.has=Gp;sn.prototype.set=jp;function zp(){this.__data__=[],this.size=0}function Ri(t,e){for(var n=t.length;n--;)if(Ar(t[n][0],e))return n;return-1}var Hp=Array.prototype,Jp=Hp.splice;function Up(t){var e=this.__data__,n=Ri(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Jp.call(e,n,1),--this.size,!0}function Vp(t){var e=this.__data__,n=Ri(e,t);return n<0?void 0:e[n][1]}function qp(t){return Ri(this.__data__,t)>-1}function Yp(t,e){var n=this.__data__,r=Ri(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Tt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Tt.prototype.clear=zp;Tt.prototype.delete=Up;Tt.prototype.get=Vp;Tt.prototype.has=qp;Tt.prototype.set=Yp;var yr=hn(st,"Map");function Wp(){this.size=0,this.__data__={hash:new sn,map:new(yr||Tt),string:new sn}}function Zp(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ji(t,e){var n=t.__data__;return Zp(e)?n[typeof e=="string"?"string":"hash"]:n.map}function $p(t){var e=ji(this,t).delete(t);return this.size-=e?1:0,e}function Kp(t){return ji(this,t).get(t)}function Xp(t){return ji(this,t).has(t)}function Qp(t,e){var n=ji(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function _t(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}_t.prototype.clear=Wp;_t.prototype.delete=$p;_t.prototype.get=Kp;_t.prototype.has=Xp;_t.prototype.set=Qp;var eg="Expected a function";function Ia(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(eg);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Ia.Cache||_t),n}Ia.Cache=_t;var tg=500;function ng(t){var e=Ia(t,function(r){return n.size===tg&&n.clear(),r}),n=e.cache;return e}var rg=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ig=/\\(\\)?/g,og=ng(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(rg,function(n,r,i,o){e.push(i?o.replace(ig,"$1"):r||n)}),e});function ag(t){return t==null?"":Eu(t)}function Pu(t,e){return Pe(t)?t:Ca(t,e)?[t]:og(ag(t))}function zi(t){if(typeof t=="string"||_n(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Da(t,e){e=Pu(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[zi(e[n++])];return n&&n==r?t:void 0}function ln(t,e,n){var r=t==null?void 0:Da(t,e);return r===void 0?n:r}function Fu(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Rs=Xe?Xe.isConcatSpreadable:void 0;function sg(t){return Pe(t)||gr(t)||!!(Rs&&t&&t[Rs])}function lg(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=sg),i||(i=[]);++o<a;){var s=t[o];n(s)?Fu(i,s):i[i.length]=s}return i}var Tu=Iu(Object.getPrototypeOf,Object),ug="[object Object]",cg=Function.prototype,dg=Object.prototype,_u=cg.toString,hg=dg.hasOwnProperty,fg=_u.call(Object);function pg(t){if(!vt(t)||cn(t)!=ug)return!1;var e=Tu(t);if(e===null)return!0;var n=hg.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&_u.call(n)==fg}function gg(){this.__data__=new Tt,this.size=0}function mg(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function vg(t){return this.__data__.get(t)}function yg(t){return this.__data__.has(t)}var bg=200;function wg(t,e){var n=this.__data__;if(n instanceof Tt){var r=n.__data__;if(!yr||r.length<bg-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new _t(r)}return n.set(t,e),this.size=n.size,this}function ot(t){var e=this.__data__=new Tt(t);this.size=e.size}ot.prototype.clear=gg;ot.prototype.delete=mg;ot.prototype.get=vg;ot.prototype.has=yg;ot.prototype.set=wg;var Ou=typeof Je=="object"&&Je&&!Je.nodeType&&Je,js=Ou&&typeof Ue=="object"&&Ue&&!Ue.nodeType&&Ue,Eg=js&&js.exports===Ou,zs=Eg?st.Buffer:void 0,Hs=zs?zs.allocUnsafe:void 0;function Bu(t,e){if(e)return t.slice();var n=t.length,r=Hs?Hs(n):new t.constructor(n);return t.copy(r),r}function kg(t,e){for(var n=-1,r=t==null?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Mg(){return[]}var xg=Object.prototype,Sg=xg.propertyIsEnumerable,Js=Object.getOwnPropertySymbols,Ag=Js?function(t){return t==null?[]:(t=Object(t),kg(Js(t),function(e){return Sg.call(t,e)}))}:Mg;function Lg(t,e,n){var r=e(t);return Pe(t)?r:Fu(r,n(t))}function Ho(t){return Lg(t,Gi,Ag)}var Jo=hn(st,"DataView"),Uo=hn(st,"Promise"),In=hn(st,"Set"),Us="[object Map]",Cg="[object Object]",Vs="[object Promise]",qs="[object Set]",Ys="[object WeakMap]",Ws="[object DataView]",Ig=dn(Jo),Dg=dn(yr),Pg=dn(Uo),Fg=dn(In),Tg=dn(jo),rt=cn;(Jo&&rt(new Jo(new ArrayBuffer(1)))!=Ws||yr&&rt(new yr)!=Us||Uo&&rt(Uo.resolve())!=Vs||In&&rt(new In)!=qs||jo&&rt(new jo)!=Ys)&&(rt=function(t){var e=cn(t),n=e==Cg?t.constructor:void 0,r=n?dn(n):"";if(r)switch(r){case Ig:return Ws;case Dg:return Us;case Pg:return Vs;case Fg:return qs;case Tg:return Ys}return e});var _g=Object.prototype,Og=_g.hasOwnProperty;function Bg(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Og.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var gi=st.Uint8Array;function Pa(t){var e=new t.constructor(t.byteLength);return new gi(e).set(new gi(t)),e}function Ng(t,e){var n=Pa(t.buffer);return new t.constructor(n,t.byteOffset,t.byteLength)}var Gg=/\w*$/;function Rg(t){var e=new t.constructor(t.source,Gg.exec(t));return e.lastIndex=t.lastIndex,e}var Zs=Xe?Xe.prototype:void 0,$s=Zs?Zs.valueOf:void 0;function jg(t){return $s?Object($s.call(t)):{}}function Nu(t,e){var n=e?Pa(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var zg="[object Boolean]",Hg="[object Date]",Jg="[object Map]",Ug="[object Number]",Vg="[object RegExp]",qg="[object Set]",Yg="[object String]",Wg="[object Symbol]",Zg="[object ArrayBuffer]",$g="[object DataView]",Kg="[object Float32Array]",Xg="[object Float64Array]",Qg="[object Int8Array]",em="[object Int16Array]",tm="[object Int32Array]",nm="[object Uint8Array]",rm="[object Uint8ClampedArray]",im="[object Uint16Array]",om="[object Uint32Array]";function am(t,e,n){var r=t.constructor;switch(e){case Zg:return Pa(t);case zg:case Hg:return new r(+t);case $g:return Ng(t);case Kg:case Xg:case Qg:case em:case tm:case nm:case rm:case im:case om:return Nu(t,n);case Jg:return new r;case Ug:case Yg:return new r(t);case Vg:return Rg(t);case qg:return new r;case Wg:return jg(t)}}function Gu(t){return typeof t.constructor=="function"&&!Aa(t)?gf(Tu(t)):{}}var sm="[object Map]";function lm(t){return vt(t)&&rt(t)==sm}var Ks=On&&On.isMap,um=Ks?Ni(Ks):lm,cm="[object Set]";function dm(t){return vt(t)&&rt(t)==cm}var Xs=On&&On.isSet,hm=Xs?Ni(Xs):dm,fm=1,Ru="[object Arguments]",pm="[object Array]",gm="[object Boolean]",mm="[object Date]",vm="[object Error]",ju="[object Function]",ym="[object GeneratorFunction]",bm="[object Map]",wm="[object Number]",zu="[object Object]",Em="[object RegExp]",km="[object Set]",Mm="[object String]",xm="[object Symbol]",Sm="[object WeakMap]",Am="[object ArrayBuffer]",Lm="[object DataView]",Cm="[object Float32Array]",Im="[object Float64Array]",Dm="[object Int8Array]",Pm="[object Int16Array]",Fm="[object Int32Array]",Tm="[object Uint8Array]",_m="[object Uint8ClampedArray]",Om="[object Uint16Array]",Bm="[object Uint32Array]",le={};le[Ru]=le[pm]=le[Am]=le[Lm]=le[gm]=le[mm]=le[Cm]=le[Im]=le[Dm]=le[Pm]=le[Fm]=le[bm]=le[wm]=le[zu]=le[Em]=le[km]=le[Mm]=le[xm]=le[Tm]=le[_m]=le[Om]=le[Bm]=!0;le[vm]=le[ju]=le[Sm]=!1;function ni(t,e,n,r,i,o){var a,s=e&fm;if(a!==void 0)return a;if(!Ve(t))return t;var l=Pe(t);if(l)a=Bg(t);else{var u=rt(t),h=u==ju||u==ym;if(mr(t))return Bu(t,s);if(u==zu||u==Ru||h&&!i)a=h?{}:Gu(t);else{if(!le[u])return i?t:{};a=am(t,u,s)}}o||(o=new ot);var c=o.get(t);if(c)return c;o.set(t,a),hm(t)?t.forEach(function(A){a.add(ni(A,e,n,A,t,o))}):um(t)&&t.forEach(function(A,M){a.set(M,ni(A,e,n,M,t,o))});var p=Ho,m=l?void 0:p(t);return Af(m||t,function(A,M){m&&(M=A,A=t[M]),Mu(a,M,ni(A,e,n,M,t,o))}),a}var Nm=1,Gm=4;function Qe(t){return ni(t,Nm|Gm)}var Rm="__lodash_hash_undefined__";function jm(t){return this.__data__.set(t,Rm),this}function zm(t){return this.__data__.has(t)}function Bn(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new _t;++e<n;)this.add(t[e])}Bn.prototype.add=Bn.prototype.push=jm;Bn.prototype.has=zm;function Hm(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function mi(t,e){return t.has(e)}var Jm=1,Um=2;function Hu(t,e,n,r,i,o){var a=n&Jm,s=t.length,l=e.length;if(s!=l&&!(a&&l>s))return!1;var u=o.get(t),h=o.get(e);if(u&&h)return u==e&&h==t;var c=-1,p=!0,m=n&Um?new Bn:void 0;for(o.set(t,e),o.set(e,t);++c<s;){var A=t[c],M=e[c];if(r)var D=a?r(M,A,c,e,t,o):r(A,M,c,t,e,o);if(D!==void 0){if(D)continue;p=!1;break}if(m){if(!Hm(e,function(P,E){if(!mi(m,E)&&(A===P||i(A,P,n,r,o)))return m.push(E)})){p=!1;break}}else if(!(A===M||i(A,M,n,r,o))){p=!1;break}}return o.delete(t),o.delete(e),p}function Vm(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Fa(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var qm=1,Ym=2,Wm="[object Boolean]",Zm="[object Date]",$m="[object Error]",Km="[object Map]",Xm="[object Number]",Qm="[object RegExp]",e0="[object Set]",t0="[object String]",n0="[object Symbol]",r0="[object ArrayBuffer]",i0="[object DataView]",Qs=Xe?Xe.prototype:void 0,fo=Qs?Qs.valueOf:void 0;function o0(t,e,n,r,i,o,a){switch(n){case i0:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case r0:return!(t.byteLength!=e.byteLength||!o(new gi(t),new gi(e)));case Wm:case Zm:case Xm:return Ar(+t,+e);case $m:return t.name==e.name&&t.message==e.message;case Qm:case t0:return t==e+"";case Km:var s=Vm;case e0:var l=r&qm;if(s||(s=Fa),t.size!=e.size&&!l)return!1;var u=a.get(t);if(u)return u==e;r|=Ym,a.set(t,e);var h=Hu(s(t),s(e),r,i,o,a);return a.delete(t),h;case n0:if(fo)return fo.call(t)==fo.call(e)}return!1}var a0=1,s0=Object.prototype,l0=s0.hasOwnProperty;function u0(t,e,n,r,i,o){var a=n&a0,s=Ho(t),l=s.length,u=Ho(e),h=u.length;if(l!=h&&!a)return!1;for(var c=l;c--;){var p=s[c];if(!(a?p in e:l0.call(e,p)))return!1}var m=o.get(t),A=o.get(e);if(m&&A)return m==e&&A==t;var M=!0;o.set(t,e),o.set(e,t);for(var D=a;++c<l;){p=s[c];var P=t[p],E=e[p];if(r)var B=a?r(E,P,p,e,t,o):r(P,E,p,t,e,o);if(!(B===void 0?P===E||i(P,E,n,r,o):B)){M=!1;break}D||(D=p=="constructor")}if(M&&!D){var O=t.constructor,R=e.constructor;O!=R&&"constructor"in t&&"constructor"in e&&!(typeof O=="function"&&O instanceof O&&typeof R=="function"&&R instanceof R)&&(M=!1)}return o.delete(t),o.delete(e),M}var c0=1,el="[object Arguments]",tl="[object Array]",Jr="[object Object]",d0=Object.prototype,nl=d0.hasOwnProperty;function h0(t,e,n,r,i,o){var a=Pe(t),s=Pe(e),l=a?tl:rt(t),u=s?tl:rt(e);l=l==el?Jr:l,u=u==el?Jr:u;var h=l==Jr,c=u==Jr,p=l==u;if(p&&mr(t)){if(!mr(e))return!1;a=!0,h=!1}if(p&&!h)return o||(o=new ot),a||La(t)?Hu(t,e,n,r,i,o):o0(t,e,l,n,r,i,o);if(!(n&c0)){var m=h&&nl.call(t,"__wrapped__"),A=c&&nl.call(e,"__wrapped__");if(m||A){var M=m?t.value():t,D=A?e.value():e;return o||(o=new ot),i(M,D,n,r,o)}}return p?(o||(o=new ot),u0(t,e,n,r,i,o)):!1}function Hi(t,e,n,r,i){return t===e?!0:t==null||e==null||!vt(t)&&!vt(e)?t!==t&&e!==e:h0(t,e,n,r,Hi,i)}var f0=1,p0=2;function g0(t,e,n,r){var i=n.length,o=i;if(t==null)return!o;for(t=Object(t);i--;){var a=n[i];if(a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<o;){a=n[i];var s=a[0],l=t[s],u=a[1];if(a[2]){if(l===void 0&&!(s in t))return!1}else{var h=new ot,c;if(!(c===void 0?Hi(u,l,f0|p0,r,h):c))return!1}}return!0}function Ju(t){return t===t&&!Ve(t)}function m0(t){for(var e=Gi(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ju(i)]}return e}function Uu(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function v0(t){var e=m0(t);return e.length==1&&e[0][2]?Uu(e[0][0],e[0][1]):function(n){return n===t||g0(n,t,e)}}function y0(t,e){return t!=null&&e in Object(t)}function b0(t,e,n){e=Pu(e,t);for(var r=-1,i=e.length,o=!1;++r<i;){var a=zi(e[r]);if(!(o=t!=null&&n(t,a)))break;t=t[a]}return o||++r!=i?o:(i=t==null?0:t.length,!!i&&Sa(i)&&Ma(a,i)&&(Pe(t)||gr(t)))}function w0(t,e){return t!=null&&b0(t,e,y0)}var E0=1,k0=2;function M0(t,e){return Ca(t)&&Ju(e)?Uu(zi(t),e):function(n){var r=ln(n,t);return r===void 0&&r===e?w0(n,t):Hi(e,r,E0|k0)}}function x0(t){return function(e){return e==null?void 0:e[t]}}function S0(t){return function(e){return Da(e,t)}}function A0(t){return Ca(t)?x0(zi(t)):S0(t)}function Vu(t){return typeof t=="function"?t:t==null?Oi:typeof t=="object"?Pe(t)?M0(t[0],t[1]):v0(t):A0(t)}function L0(t,e,n,r){for(var i=-1,o=t==null?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function C0(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var l=a[++i];if(n(o[l],l,o)===!1)break}return e}}var qu=C0();function I0(t,e){return t&&qu(t,e,Gi)}function D0(t,e){return function(n,r){if(n==null)return n;if(!Rn(n))return t(n,r);for(var i=n.length,o=-1,a=Object(n);++o<i&&r(a[o],o,a)!==!1;);return n}}var Yu=D0(I0);function P0(t,e,n,r){return Yu(t,function(i,o,a){e(r,i,n(i),a)}),r}function F0(t,e){return function(n,r){var i=Pe(n)?L0:P0,o={};return i(n,t,Vu(r),o)}}var po=function(){return st.Date.now()},T0="Expected a function",_0=Math.max,O0=Math.min;function Ta(t,e,n){var r,i,o,a,s,l,u=0,h=!1,c=!1,p=!0;if(typeof t!="function")throw new TypeError(T0);e=Ps(e)||0,Ve(n)&&(h=!!n.leading,c="maxWait"in n,o=c?_0(Ps(n.maxWait)||0,e):o,p="trailing"in n?!!n.trailing:p);function m(G){var J=r,d=i;return r=i=void 0,u=G,a=t.apply(d,J),a}function A(G){return u=G,s=setTimeout(P,e),h?m(G):a}function M(G){var J=G-l,d=G-u,f=e-J;return c?O0(f,o-d):f}function D(G){var J=G-l,d=G-u;return l===void 0||J>=e||J<0||c&&d>=o}function P(){var G=po();if(D(G))return E(G);s=setTimeout(P,M(G))}function E(G){return s=void 0,p&&r?m(G):(r=i=void 0,a)}function B(){s!==void 0&&clearTimeout(s),u=0,r=l=i=s=void 0}function O(){return s===void 0?a:E(po())}function R(){var G=po(),J=D(G);if(r=arguments,i=this,l=G,J){if(s===void 0)return A(l);if(c)return clearTimeout(s),s=setTimeout(P,e),m(l)}return s===void 0&&(s=setTimeout(P,e)),a}return R.cancel=B,R.flush=O,R}function Vo(t,e,n){(n!==void 0&&!Ar(t[e],n)||n===void 0&&!(e in t))&&Bi(t,e,n)}function Wu(t){return vt(t)&&Rn(t)}function qo(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function B0(t){return Of(t,Du(t))}function N0(t,e,n,r,i,o,a){var s=qo(t,n),l=qo(e,n),u=a.get(l);if(u){Vo(t,n,u);return}var h=o?o(s,l,n+"",t,e,a):void 0,c=h===void 0;if(c){var p=Pe(l),m=!p&&mr(l),A=!p&&!m&&La(l);h=l,p||m||A?Pe(s)?h=s:Wu(s)?h=yf(s):m?(c=!1,h=Bu(l,!0)):A?(c=!1,h=Nu(l,!0)):h=[]:pg(l)||gr(l)?(h=s,gr(s)?h=B0(s):(!Ve(s)||ka(s))&&(h=Gu(l))):c=!1}c&&(a.set(l,h),i(h,l,r,o,a),a.delete(l)),Vo(t,n,h)}function _a(t,e,n,r,i){t!==e&&qu(e,function(o,a){if(i||(i=new ot),Ve(o))N0(t,e,a,n,_a,r,i);else{var s=r?r(qo(t,a),o,a+"",t,e,i):void 0;s===void 0&&(s=o),Vo(t,a,s)}},Du)}var G0=xu(function(t,e,n,r){_a(t,e,n,r)});function R0(t,e,n){for(var r=-1,i=t==null?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function j0(t,e){var n=-1,r=Rn(t)?Array(t.length):[];return Yu(t,function(i,o,a){r[++n]=e(i,o,a)}),r}function z0(t,e){return Cn(e,function(n){return t[n]})}function H0(t){return t==null?[]:z0(t,Gi(t))}var J0=Math.min;function U0(t,e,n){for(var r=ku,i=t[0].length,o=t.length,a=o,s=Array(o),l=1/0,u=[];a--;){var h=t[a];l=J0(h.length,l),s[a]=i>=120&&h.length>=120?new Bn(a&&h):void 0}h=t[0];var c=-1,p=s[0];e:for(;++c<i&&u.length<l;){var m=h[c],A=m;if(m=m!==0?m:0,!(p?mi(p,A):r(u,A))){for(a=o;--a;){var M=s[a];if(!(M?mi(M,A):r(t[a],A)))continue e}p&&p.push(A),u.push(m)}}return u}function V0(t){return Wu(t)?t:[]}var q0=xa(function(t){var e=Cn(t,V0);return e.length&&e[0]===t[0]?U0(e):[]});function Lr(t,e){return Hi(t,e)}var Y0=F0(function(t,e,n){Bi(t,n,e)}),W0=xu(function(t,e,n){_a(t,e,n)});function Z0(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function $0(t,e){if(t!==e){var n=t!==void 0,r=t===null,i=t===t,o=_n(t),a=e!==void 0,s=e===null,l=e===e,u=_n(e);if(!s&&!u&&!o&&t>e||o&&a&&l&&!s&&!u||r&&a&&l||!n&&l||!i)return 1;if(!r&&!o&&!u&&t<e||u&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!l)return-1}return 0}function K0(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;++r<a;){var l=$0(i[r],o[r]);if(l){if(r>=s)return l;var u=n[r];return l*(u=="desc"?-1:1)}}return t.index-e.index}function X0(t,e,n){e.length?e=Cn(e,function(o){return Pe(o)?function(a){return Da(a,o.length===1?o[0]:o)}:o}):e=[Oi];var r=-1;e=Cn(e,Ni(Vu));var i=j0(t,function(o,a,s){var l=Cn(e,function(u){return u(o)});return{criteria:l,index:++r,value:o}});return Z0(i,function(o,a){return K0(o,a,n)})}var rl=xa(function(t,e){if(t==null)return[];var n=e.length;return n>1&&zo(t,e[0],e[1])?e=[]:n>2&&zo(e[0],e[1],e[2])&&(e=[e[0]]),X0(t,lg(e),[])}),Q0="Expected a function";function Zu(t,e,n){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(Q0);return Ve(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Ta(t,e,{leading:r,maxWait:e,trailing:i})}var ev=1/0,tv=In&&1/Fa(new In([,-0]))[1]==ev?function(t){return new In(t)}:vf,nv=200;function rv(t,e,n){var r=-1,i=ku,o=t.length,a=!0,s=[],l=s;if(n)a=!1,i=R0;else if(o>=nv){var u=tv(t);if(u)return Fa(u);a=!1,i=mi,l=new Bn}else l=s;e:for(;++r<o;){var h=t[r],c=h;if(h=n||h!==0?h:0,a&&c===c){for(var p=l.length;p--;)if(l[p]===c)continue e;s.push(h)}else i(l,c,n)||(l!==s&&l.push(c),s.push(h))}return s}function Yo(t,e){return e=typeof e=="function"?e:void 0,t&&t.length?rv(t,void 0,e):[]}const dr=(t,e)=>t[0]===e[0]&&t[1]===e[1],$u=t=>t.type==="Feature"&&t.geometry.type==="LineString",Ku=t=>t.type==="Feature"&&t.geometry.type==="Polygon",Xu=t=>t.type==="Feature"&&t.geometry.type==="MultiPolygon",il=(t,e)=>({lng:e[0]-t[0],lat:e[1]-t[1]}),vi=t=>Array.isArray(t)&&t.length>=2&&t.length<=3&&t.every(e=>typeof e=="number"),Cr=(t,e,n=!1)=>{let r=0;const i=["features","geometries","geometry","coordinates"],o=(a,s,l=!1)=>{vi(a)?(e({coordinate:a,path:s},r),r+=1):Array.isArray(a)?a.forEach((u,h)=>{l&&n&&h===a.length-1&&vi(u)||o(u,[...s,h],l)}):typeof a=="object"&&a!==null&&Ge(a).forEach(u=>{const h=a[u];if(i.includes(u)&&h){const c="type"in a&&a.type,p=c==="Polygon"||c==="MultiPolygon";o(h,[...s,u],p)}})};o(t,[])},Qu=(t,e)=>{let n={coordinate:[0,0],path:[]},r=-1;try{Cr(t,(i,o)=>{if(e[0]===i.coordinate[0]&&e[1]===i.coordinate[1])throw r=o,n=i,new Error("stop")})}catch{if(n)return{index:r,coordinate:n.coordinate,path:n.path}}return null},ec=(t,e)=>{let n=0;const r=["features","geometries","geometry","coordinates"],i=(o,a,s,l)=>{vi(o)&&vi(a)?(e({start:{coordinate:[...o],path:s},end:{coordinate:[...a],path:l}},n),n+=1):Array.isArray(o)?o.forEach((u,h)=>{i(u,o[h+1],[...s,h],[...s,h+1])}):typeof o=="object"&&o!==null&&Ge(o).forEach(u=>{const h=o[u];r.includes(u)&&h&&i(h,void 0,[...s,u],[])})};i(t,void 0,[],[])},Ji=(t,e)=>{let n={absCoordIndex:-1,featureIndex:-1,multiFeatureIndex:-1,geometryIndex:-1};try{Zt(t,(r,i,o,a,s)=>{if(r[0]===e[0]&&r[1]===e[1])throw n={absCoordIndex:i,featureIndex:o,multiFeatureIndex:a,geometryIndex:s},new Error("found")})}catch{}return n},Sn=(t,e)=>{const[n,r]=t,[i,o]=e,a=Math.min(n,i),s=Math.min(r,o),l=Math.max(n,i),u=Math.max(r,o);return[a,s,l,u]},Wo=(t,e)=>{const n=Sn(t,e),r=[n[0],n[1]],i=[n[2],n[3]],o=r[0],a=r[1],s=i[0],l=i[1];return{type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[o,a],[s,a],[s,l],[o,l],[o,a]]]}}},tc=t=>[t.geometry.coordinates[0],t.geometry.coordinates[1]],Oa=t=>{const e=vu(t);return[[e[0],e[1]],[e[2],e[3]]]},nc=t=>[t[0][0],t[0][1],t[1][0],t[1][1]],iv=(t,e)=>{const[n,r,i,o]=t,[a,s]=e;return a>=n&&a<=i&&s>=r&&s<=o},ov=(t,e)=>{const n=nc(t);return iv(n,e)},go=t=>{let e=0;return Zt(t,()=>{e+=1},!0),e},av=t=>{const e=[];return Zt(t,n=>{e.push([n[0],n[1]])},!0),e},rc=t=>{const e=av(t);return e.some(n=>!Lr(e[0],n))},ic=t=>{let e=null;try{Cr(t,n=>{throw e=n.coordinate,new Error("found")})}catch{return e}return null},ri=(t,e)=>Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2),sv=(t,e,n)=>{const[r,i]=[t[0],t[1]],[o,a]=[e[0],e[1]],[s,l]=[n[0],n[1]],u=o-r,h=a-i,c=s-r,p=l-i,m=c*u+p*h,A=u*u+h*h;let M=m/A;return M=Math.max(0,Math.min(1,M)),[r+M*u,i+M*h]},lv=(t,e)=>{const{absCoordIndex:n}=Ji(t,e);return n!==-1?(t.geometry.coordinates.splice(n,1),!0):!1},uv=(t,e)=>{const n=Ji(t,e);if(n.absCoordIndex!==-1){const r=[n.geometryIndex],i=ln(t.geometry.coordinates,r),o=i.findIndex(a=>Lr(a,e));return i.length<=4?(t.geometry.coordinates.splice(n.geometryIndex,1),!0):(i.splice(o,1),o===0&&(i[i.length-1]=[...i[0]]),!0)}return!1},cv=(t,e)=>{const n=Ji(t,e);if(n.absCoordIndex!==-1){const r=[n.multiFeatureIndex,n.geometryIndex],i=ln(t.geometry.coordinates,r),o=i.findIndex(a=>Lr(a,e));if(i.length<=4){r.pop();const a=ln(t.geometry.coordinates,n.multiFeatureIndex);return a.splice(n.geometryIndex,1),a.length===0&&t.geometry.coordinates.splice(n.multiFeatureIndex,1),!0}return i.splice(o,1),o===0&&(i[i.length-1]=[...i[0]]),!0}return!1},dv=(t,e)=>$u(t)?lv(t,e):Ku(t)?uv(t,e):Xu(t)?cv(t,e):!1,hv=(t,e="marker")=>({type:"Feature",properties:{shape:e},geometry:{type:"Point",coordinates:t}}),Ba=({center:t,radius:e,steps:n=80})=>{const r=Dh(t,e,{steps:n,units:"meters"});return r.geometry.coordinates[0][0]=[...r.geometry.coordinates[0][0]],r};function oc(t,e={}){let n=0,r=0,i=0;return Zt(t,function(o){n+=o[0],r+=o[1],i++},!0),zt([n/i,r/i],e.properties)}var ac=oc;const fv=["circle","rectangle"];class yi{constructor(e){b(this,"gm"),b(this,"id","no-id"),b(this,"parent",null),b(this,"shape"),b(this,"markers"),b(this,"shapeProperties",{center:null}),b(this,"source"),b(this,"orders",this.getEmptyOrders()),this.gm=e.gm,this.id=e.id,this.source=e.source,this.parent=e.parent,this.markers=new Map,this.shape=e.geoJsonShapeFeature.properties.shape,this.order=this.getFreeOrder(),this.addGeoJson(e.geoJsonShapeFeature)}get order(){const e=this.source.id;if(this.orders[e]!==null)return this.orders[e];throw new Error(`Null order for feature id: ${this.id}`)}set order(e){const n=this.source.id;this.orders[n]=e}getEmptyOrders(){return Object.fromEntries(rr(N).map(e=>[e,null]))}get temporary(){return this.source.id===N.temporary}get sourceName(){return this.source.id}getFreeOrder(){return this.getSourceGeoJson().features.length}getGeoJson(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const e=this.getSourceGeoJson().features[this.order]||null;if(this.id!==(e==null?void 0:e.id))throw j.error(`Feature not found: ${this.id} !== ${e==null?void 0:e.id}`,e,this.getSourceGeoJson()),new Error("Feature not found");return e}getShapeProperty(e){return this.shapeProperties[e]}setShapeProperty(e,n){this.shapeProperties[e]=n}getSourceGeoJson(){return this.source.getGeoJson()}addGeoJson(e){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);const n=this.getSourceGeoJson();n.features[this.order]&&j.error("FeatureData.addGeoJson, not an empty feature",this.id,n);const r={...e,id:this.id,properties:{...e.properties,[Dn]:this.id}};n.features[this.order]=r,this.updateGeoJsonCenter(r),this.gm.features.updateSourceData({diff:{add:[r]},sourceName:this.sourceName})}removeGeoJson(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const e=this.getSourceGeoJson();delete e.features[this.order],this.gm.features.updateSourceData({diff:{remove:[this.id]},sourceName:this.sourceName}),this.order=null}removeMarkers(){this.markers.forEach(e=>{e.instance instanceof wa?e.instance.remove():this.gm.features.delete(e.instance)}),this.markers=new Map}updateGeoJsonGeometry(e){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const n=this.getSourceGeoJson();n.features[this.order].geometry=e;const r={update:[n.features[this.order]]};this.gm.features.updateSourceData({diff:r,sourceName:this.sourceName})}updateGeoJsonProperties(e){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`);this.fixOrder();const n=this.getSourceGeoJson();n.features[this.order].properties={...n.features[this.order].properties,...e};const r={update:[n.features[this.order]]};this.gm.features.updateSourceData({diff:r,sourceName:this.sourceName})}updateGeoJsonCenter(e){if(this.shape==="circle"){const n=tc(ac(e));this.setShapeProperty("center",n)}}convertToPolygon(){return this.isConvertableToPolygon()?(this.shape="polygon",this.shapeProperties.center=null,!0):!1}isConvertableToPolygon(){return fv.includes(this.shape)}fixOrder(){if(!this.isFeatureAvailable())throw new Error(`Feature not found: "${this.id}"`)}isFeatureAvailable(){return this.order!==null}changeSource({sourceName:e,atomic:n}){n?this.gm.features.withAtomicSourcesUpdate(()=>this.actualChangeSource({sourceName:e,atomic:n})):this.actualChangeSource({sourceName:e,atomic:n})}actualChangeSource({sourceName:e,atomic:n}){if(this.source.id===e){j.error(`FeatureData.changeSource: feature "${this.id}" already has the source "${e}"`);return}const r=this.gm.features.sources[e];if(!r){j.error(`FeatureData.changeSource: missing source "${e}"`);return}const i=this.getGeoJson();this.removeGeoJson(),this.source=r,this.order=this.getFreeOrder(),this.addGeoJson(i),this.markers.forEach(o=>{o.instance instanceof yi&&o.instance.changeSource({sourceName:e,atomic:n})})}delete(){this.removeGeoJson(),this.removeMarkers(),this.id="no-id",this.orders=this.getEmptyOrders()}}const pv=["on","off"],sc=t=>fn(t)&&t.type==="control"&&pv.includes(t.action),fn=t=>!!(t&&typeof t=="object"&&"level"in t&&"type"in t&&"action"in t),Na=t=>fn(t)&&rn(t.action,wh),W="gm";class Ui{constructor(e){b(this,"gm"),this.gm=e}trackExclusiveModes(e){if(e.action!=="mode_start")return;const{sectionName:n,modeName:r}=this.getControlIds(e)||{},i=this.getControl(e);i!=null&&i.settings.exclusive&&this.gm.control.eachControlWithOptions(o=>{const a=o.control.type,s=o.control.targetMode;a===n&&s===r||o.controlOptions.active&&o.control.settings.exclusive&&this.gm.options.disableMode(a,s)})}trackRelatedModes(e){Na(e)&&this.gm.control.eachControlWithOptions(n=>{var r;const i=n.control;(r=i.settings.enabledBy)!=null&&r.includes(e.mode)&&(e.action==="mode_start"?this.gm.options.enableMode(i.type,i.targetMode):e.action==="mode_end"?this.gm.options.disableMode(i.type,i.targetMode):j.error("Unknown mode action",e.action))})}getControl(e){const{modeName:n,sectionName:r}=this.getControlIds(e)||{};return n&&r?this.gm.control.getControl({actionType:r,modeName:n}):null}getControlOptions(e){const{modeName:n,sectionName:r}=this.getControlIds(e)||{};return n&&r?this.gm.options.getControlOptions({actionType:r,modeName:n}):null}getControlIds(e){let n=null,r=null;return e.action==="mode_start"?(n=e.type,r=e.mode):sc(e)&&(n=e.section,r=e.target),n&&r?{sectionName:n,modeName:r}:null}}class gv{isInstanceAvailable(){return this.sourceInstance?!0:(j.error("Source instance is not available"),!1)}}const mv=["intersection_violation","containment_violation"],Vi=t=>fn(t)&&t.type==="helper",vv=t=>Vi(t)&&t.mode==="geofencing"&&rn(t.action,mv),yv=["draw","edit","helper"];class Ga{constructor(e){b(this,"gm"),b(this,"options",[]),b(this,"actions",[]),b(this,"flags",{featureCreateAllowed:!0,featureUpdateAllowed:!0}),b(this,"internalMapEventHandlers",{[`${W}:helper`]:this.handleHelperEvent.bind(this)}),this.gm=e}startAction(){this.gm.events.bus.attachEvents(this.internalMapEventHandlers),this.gm.events.bus.attachEvents(this.mapEventHandlers),this.onStartAction()}endAction(){this.onEndAction(),this.gm.events.bus.detachEvents(this.mapEventHandlers),this.gm.events.bus.detachEvents(this.internalMapEventHandlers)}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}getOptionValue(e){const n=this.options.find(r=>r.name===e);if(!n)throw new Error(`Option ${e} not found`);if(n.type==="toggle")return n.value;if(n.type==="select")return n.value.value;throw new Error(`Unknown option type: ${JSON.stringify(n)}`)}applyOptionValue(e,n){const r=this.options.find(i=>i.name===e);if(!r){j.error("Option not found",e,n);return}if(r.type==="toggle"&&typeof n=="boolean")r.value=n;else if(r.type==="select"){const i=r.choices.find(o=>o.value===n);i&&(r.value=i)}else j.error("Can't apply option value",e,n,r)}handleHelperEvent(e){return vv(e)?this.handleGeofencingViolationEvent(e):{next:!0}}handleGeofencingViolationEvent(e){return e.actionType==="draw"?this.flags.featureCreateAllowed=!1:e.actionType==="edit"&&(this.flags.featureUpdateAllowed=!1),{next:!0}}fireBeforeFeatureCreate({geoJsonFeatures:e,forceMode:n=void 0}){this.flags.featureCreateAllowed=!0;const r={level:"system",type:this.actionType,mode:n||this.mode,action:"before_create",geoJsonFeatures:e};this.gm.events.fire(`${W}:${this.actionType}`,r)}fireBeforeFeatureUpdate({features:e,geoJsonFeatures:n,forceMode:r=void 0}){this.flags.featureUpdateAllowed=!0;const i={level:"system",type:this.actionType,mode:r||this.mode,action:"before_update",features:e,geoJsonFeatures:n};this.gm.events.fire(`${W}:${this.actionType}`,i)}}const Ra=t=>fn(t)&&t.type==="draw",lc=t=>fn(t)&&t.type==="draw"&&"variant"in t&&t.variant==="line_drawer",bi=["marker","circle","circle_marker","text_marker","line","rectangle","polygon"],bv=["freehand","custom_shape"],uc=[...bi,...bv];class Ot extends Ga{constructor(){super(...arguments),b(this,"actionType","draw"),b(this,"shape",null),b(this,"featureData",null)}saveFeature(){if(this.featureData){const e=this.featureData.getGeoJson();this.removeTmpFeature(),this.gm.features.createFeature({sourceName:N.main,shapeGeoJson:e})}else j.error("BaseDraw.saveFeature: no featureData to save")}removeTmpFeature(){this.featureData&&(this.featureData.temporary||j.error("Not a temporary feature to remove",this.featureData),this.gm.features.delete(this.featureData),this.featureData=null)}fireMarkerPointerStartEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,n={level:"system",variant:null,type:"draw",mode:this.shape,action:"start",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${W}:draw`,n)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker||!this.shape)return;const e=this.gm.markerPointer.marker,n={level:"system",variant:null,type:"draw",mode:this.shape,action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:this.featureData};this.gm.events.fire(`${W}:draw`,n)}fireMarkerPointerFinishEvent(){if(!this.shape)return;const e={level:"system",variant:null,type:"draw",mode:this.shape,action:"finish"};this.gm.events.fire(`${W}:draw`,e)}forwardLineDrawerEvent(e){if(!lc(e)||!this.shape)return{next:!0};if(e.action==="start"||e.action==="update"){const n={level:"system",type:"draw",mode:this.shape,variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${W}:draw`,n)}else if(e.action==="finish"||e.action==="cancel"){const n={level:"system",type:"draw",mode:this.shape,variant:null,action:e.action};this.gm.events.fire(`${W}:draw`,n)}return{next:!0}}}const It=11102230246251565e-32,Se=134217729,wv=(3+8*It)*It;function mo(t,e,n,r,i){let o,a,s,l,u=e[0],h=r[0],c=0,p=0;h>u==h>-u?(o=u,u=e[++c]):(o=h,h=r[++p]);let m=0;if(c<t&&p<n)for(h>u==h>-u?(a=u+o,s=o-(a-u),u=e[++c]):(a=h+o,s=o-(a-h),h=r[++p]),o=a,s!==0&&(i[m++]=s);c<t&&p<n;)h>u==h>-u?(a=o+u,l=a-o,s=o-(a-l)+(u-l),u=e[++c]):(a=o+h,l=a-o,s=o-(a-l)+(h-l),h=r[++p]),o=a,s!==0&&(i[m++]=s);for(;c<t;)a=o+u,l=a-o,s=o-(a-l)+(u-l),u=e[++c],o=a,s!==0&&(i[m++]=s);for(;p<n;)a=o+h,l=a-o,s=o-(a-l)+(h-l),h=r[++p],o=a,s!==0&&(i[m++]=s);return(o!==0||m===0)&&(i[m++]=o),m}function Ev(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}function Ir(t){return new Float64Array(t)}const kv=(3+16*It)*It,Mv=(2+12*It)*It,xv=(9+64*It)*It*It,wn=Ir(4),ol=Ir(8),al=Ir(12),sl=Ir(16),Ce=Ir(4);function Sv(t,e,n,r,i,o,a){let s,l,u,h,c,p,m,A,M,D,P,E,B,O,R,G,J,d;const f=t-i,g=n-i,v=e-o,y=r-o;O=f*y,p=Se*f,m=p-(p-f),A=f-m,p=Se*y,M=p-(p-y),D=y-M,R=A*D-(O-m*M-A*M-m*D),G=v*g,p=Se*v,m=p-(p-v),A=v-m,p=Se*g,M=p-(p-g),D=g-M,J=A*D-(G-m*M-A*M-m*D),P=R-J,c=R-P,wn[0]=R-(P+c)+(c-J),E=O+P,c=E-O,B=O-(E-c)+(P-c),P=B-G,c=B-P,wn[1]=B-(P+c)+(c-G),d=E+P,c=d-E,wn[2]=E-(d-c)+(P-c),wn[3]=d;let S=Ev(4,wn),F=Mv*a;if(S>=F||-S>=F||(c=t-f,s=t-(f+c)+(c-i),c=n-g,u=n-(g+c)+(c-i),c=e-v,l=e-(v+c)+(c-o),c=r-y,h=r-(y+c)+(c-o),s===0&&l===0&&u===0&&h===0)||(F=xv*a+wv*Math.abs(S),S+=f*h+y*s-(v*u+g*l),S>=F||-S>=F))return S;O=s*y,p=Se*s,m=p-(p-s),A=s-m,p=Se*y,M=p-(p-y),D=y-M,R=A*D-(O-m*M-A*M-m*D),G=l*g,p=Se*l,m=p-(p-l),A=l-m,p=Se*g,M=p-(p-g),D=g-M,J=A*D-(G-m*M-A*M-m*D),P=R-J,c=R-P,Ce[0]=R-(P+c)+(c-J),E=O+P,c=E-O,B=O-(E-c)+(P-c),P=B-G,c=B-P,Ce[1]=B-(P+c)+(c-G),d=E+P,c=d-E,Ce[2]=E-(d-c)+(P-c),Ce[3]=d;const k=mo(4,wn,4,Ce,ol);O=f*h,p=Se*f,m=p-(p-f),A=f-m,p=Se*h,M=p-(p-h),D=h-M,R=A*D-(O-m*M-A*M-m*D),G=v*u,p=Se*v,m=p-(p-v),A=v-m,p=Se*u,M=p-(p-u),D=u-M,J=A*D-(G-m*M-A*M-m*D),P=R-J,c=R-P,Ce[0]=R-(P+c)+(c-J),E=O+P,c=E-O,B=O-(E-c)+(P-c),P=B-G,c=B-P,Ce[1]=B-(P+c)+(c-G),d=E+P,c=d-E,Ce[2]=E-(d-c)+(P-c),Ce[3]=d;const x=mo(k,ol,4,Ce,al);O=s*h,p=Se*s,m=p-(p-s),A=s-m,p=Se*h,M=p-(p-h),D=h-M,R=A*D-(O-m*M-A*M-m*D),G=l*u,p=Se*l,m=p-(p-l),A=l-m,p=Se*u,M=p-(p-u),D=u-M,J=A*D-(G-m*M-A*M-m*D),P=R-J,c=R-P,Ce[0]=R-(P+c)+(c-J),E=O+P,c=E-O,B=O-(E-c)+(P-c),P=B-G,c=B-P,Ce[1]=B-(P+c)+(c-G),d=E+P,c=d-E,Ce[2]=E-(d-c)+(P-c),Ce[3]=d;const T=mo(x,al,4,Ce,sl);return sl[T-1]}function Av(t,e,n,r,i,o){const a=(e-o)*(n-i),s=(t-i)*(r-o),l=a-s,u=Math.abs(a+s);return Math.abs(l)>=kv*u?l:-Sv(t,e,n,r,i,o,u)}function Lv(t,e){var n,r,i=0,o,a,s,l,u,h,c,p=t[0],m=t[1],A=e.length;for(n=0;n<A;n++){r=0;var M=e[n],D=M.length-1;if(h=M[0],h[0]!==M[D][0]&&h[1]!==M[D][1])throw new Error("First and last coordinates in a ring must be the same");for(a=h[0]-p,s=h[1]-m,r;r<D;r++){if(c=M[r+1],l=c[0]-p,u=c[1]-m,s===0&&u===0){if(l<=0&&a>=0||a<=0&&l>=0)return 0}else if(u>=0&&s<=0||u<=0&&s>=0){if(o=Av(a,l,s,u,0,0),o===0)return 0;(o>0&&u>0&&s<=0||o<0&&u<=0&&s>0)&&i++}h=c,s=u,a=l}}return i%2!==0}function un(t,e,n={}){if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=ge(t),i=Sr(e),o=i.type,a=e.bbox;let s=i.coordinates;if(a&&Cv(r,a)===!1)return!1;o==="Polygon"&&(s=[s]);let l=!1;for(var u=0;u<s.length;++u){const h=Lv(r,s[u]);if(h===0)return!n.ignoreBoundary;h&&(l=!0)}return l}function Cv(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}class cc{constructor(e=[],n=Iv){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:r}=this,i=n[e];for(;e>0;){const o=e-1>>1,a=n[o];if(r(i,a)>=0)break;n[e]=a,e=o}n[e]=i}_down(e){const{data:n,compare:r}=this,i=this.length>>1,o=n[e];for(;e<i;){let a=(e<<1)+1,s=n[a];const l=a+1;if(l<this.length&&r(n[l],s)<0&&(a=l,s=n[l]),r(s,o)>=0)break;n[e]=s,e=a}n[e]=o}}function Iv(t,e){return t<e?-1:t>e?1:0}function dc(t,e){return t.p.x>e.p.x?1:t.p.x<e.p.x?-1:t.p.y!==e.p.y?t.p.y>e.p.y?1:-1:1}function Dv(t,e){return t.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?t.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class ll{constructor(e,n,r,i){this.p={x:e[0],y:e[1]},this.featureId=n,this.ringId=r,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function Pv(t,e){if(t.type==="FeatureCollection"){const n=t.features;for(let r=0;r<n.length;r++)ul(n[r],e)}else ul(t,e)}let Ur=0,Vr=0,qr=0;function ul(t,e){const n=t.type==="Feature"?t.geometry:t;let r=n.coordinates;(n.type==="Polygon"||n.type==="MultiLineString")&&(r=[r]),n.type==="LineString"&&(r=[[r]]);for(let i=0;i<r.length;i++)for(let o=0;o<r[i].length;o++){let a=r[i][o][0],s=null;Vr=Vr+1;for(let l=0;l<r[i][o].length-1;l++){s=r[i][o][l+1];const u=new ll(a,Ur,Vr,qr),h=new ll(s,Ur,Vr,qr+1);u.otherEvent=h,h.otherEvent=u,dc(u,h)>0?(h.isLeftEndpoint=!0,u.isLeftEndpoint=!1):(u.isLeftEndpoint=!0,h.isLeftEndpoint=!1),e.push(u),e.push(h),a=s,qr=qr+1}}Ur=Ur+1}let Fv=class{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}};function Tv(t,e){if(t===null||e===null||t.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.rightSweepEvent)||t.leftSweepEvent.isSamePoint(e.leftSweepEvent)||t.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const n=t.leftSweepEvent.p.x,r=t.leftSweepEvent.p.y,i=t.rightSweepEvent.p.x,o=t.rightSweepEvent.p.y,a=e.leftSweepEvent.p.x,s=e.leftSweepEvent.p.y,l=e.rightSweepEvent.p.x,u=e.rightSweepEvent.p.y,h=(u-s)*(i-n)-(l-a)*(o-r),c=(l-a)*(r-s)-(u-s)*(n-a),p=(i-n)*(r-s)-(o-r)*(n-a);if(h===0)return!1;const m=c/h,A=p/h;if(m>=0&&m<=1&&A>=0&&A<=1){const M=n+m*(i-n),D=r+m*(o-r);return[M,D]}return!1}function _v(t,e){e=e||!1;const n=[],r=new cc([],Dv);for(;t.length;){const i=t.pop();if(i.isLeftEndpoint){const o=new Fv(i);for(let a=0;a<r.data.length;a++){const s=r.data[a];if(e&&s.leftSweepEvent.featureId===i.featureId)continue;const l=Tv(o,s);l!==!1&&n.push(l)}r.push(o)}else i.isLeftEndpoint===!1&&r.pop()}return n}function Ov(t,e){const n=new cc([],dc);return Pv(t,n),_v(n,e)}var Bv=Ov;function Dr(t,e,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:i=!0}=n;let o=[];t.type==="FeatureCollection"?o=o.concat(t.features):t.type==="Feature"?o.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&o.push(mt(t)),e.type==="FeatureCollection"?o=o.concat(e.features):e.type==="Feature"?o.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&o.push(mt(e));const a=Bv(xe(o),i);let s=[];if(r){const l={};a.forEach(u=>{const h=u.join(",");l[h]||(l[h]=!0,s.push(u))})}else s=a;return xe(s.map(l=>zt(l)))}var Nv=Dr;function qi(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return hc(t);case"FeatureCollection":return Gv(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ja(t);default:throw new Error("unknown GeoJSON type")}}function hc(t){const e={type:"Feature"};return Object.keys(t).forEach(n=>{switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=fc(t.properties),t.geometry==null?e.geometry=null:e.geometry=ja(t.geometry),e}function fc(t){const e={};return t&&Object.keys(t).forEach(n=>{const r=t[n];typeof r=="object"?r===null?e[n]=null:Array.isArray(r)?e[n]=r.map(i=>i):e[n]=fc(r):e[n]=r}),e}function Gv(t){const e={type:"FeatureCollection"};return Object.keys(t).forEach(n=>{switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(n=>hc(n)),e}function ja(t){const e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(n=>ja(n)),e):(e.coordinates=pc(t.coordinates),e)}function pc(t){const e=t;return typeof e[0]!="object"?e.slice():e.map(n=>pc(n))}var gc=qi;function Zo(t){const e=He(t);let n=0,r=1,i,o;for(;r<e.length;)i=o||e[0],o=e[r],n+=(o[0]-i[0])*(o[1]+i[1]),r++;return n>0}function Rv(t,e={}){var n,r;if(e=e||{},!Ea(e))throw new Error("options is invalid");const i=(n=e.mutate)!=null?n:!1,o=(r=e.reverse)!=null?r:!1;if(!t)throw new Error("<geojson> is required");if(typeof o!="boolean")throw new Error("<reverse> must be a boolean");if(typeof i!="boolean")throw new Error("<mutate> must be a boolean");!i&&t.type!=="Point"&&t.type!=="MultiPoint"&&(t=qi(t));const a=[];switch(t.type){case"GeometryCollection":return xr(t,function(s){ii(s,o)}),t;case"FeatureCollection":return Ut(t,function(s){const l=ii(s,o);Ut(l,function(u){a.push(u)})}),xe(a)}return ii(t,o)}function ii(t,e){switch(t.type==="Feature"?t.geometry.type:t.type){case"GeometryCollection":return xr(t,function(n){ii(n,e)}),t;case"LineString":return cl(He(t),e),t;case"Polygon":return dl(He(t),e),t;case"MultiLineString":return He(t).forEach(function(n){cl(n,e)}),t;case"MultiPolygon":return He(t).forEach(function(n){dl(n,e)}),t;case"Point":case"MultiPoint":return t}}function cl(t,e){Zo(t)===e&&t.reverse()}function dl(t,e){Zo(t[0])!==e&&t[0].reverse();for(let n=1;n<t.length;n++)Zo(t[n])===e&&t[n].reverse()}var jv=Rv;const zv=["Point","MultiPoint"],Hv=["LineString","MultiLineString","Polygon","MultiPolygon"],mc=t=>zv.includes(t.geometry.type),$o=t=>Hv.includes(t.geometry.type),Jv=(t,e)=>(Cr(t,n=>{const r=n.coordinate;r[0]+=e.lng,r[1]+=e.lat}),t),Uv=(t,e)=>{const n=Qe(t.getGeoJson());return Jv(n,e),n},Vv=(t,e)=>{try{Cr(t,n=>{if(!un(n.coordinate,e))throw new Error("stop")})}catch{return!1}return!0},hl=(t,e)=>{const n=Vv(t,e);return mc(t)?n:n&&$o(t)?!Nv(t,e,{ignoreSelfIntersections:!0}).features.length:!1},za=t=>{const e=t.getGeoJson();return typeof e!="object"?null:ic(e)},qv=t=>{if($o(t)){const e=jv(t,{mutate:!1});if(e.type==="Feature"&&$o(e))return{...e,properties:t.properties||{}}}return mc(t)?t:null},vc=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"];function vo(t){return vc.includes(t)}const Yv=t=>!!(t&&typeof t=="object"&&"once"in t&&typeof t.once=="function"),we=(t,e={warning:!1})=>{if(!t)return e.warning&&j.warn("Empty event",t),!1;const n=typeof t=="object"&&"lngLat"in t&&"point"in t&&"type"in t&&"originalEvent"in t&&typeof t.type=="string"&&vc.includes(t.type);return!n&&e.warning&&j.warn("Not a pointer event",t),n},N={main:`${W}_main`,temporary:`${W}_temporary`,standby:`${W}_standby`},Dn="_gmid";class Wv{constructor(e){b(this,"gm"),b(this,"featureCounter",0),b(this,"featureStore",new Map),b(this,"featureStoreAllowedSources",[N.main,N.temporary]),b(this,"autoUpdatesEnabled",!0),b(this,"diffUpdatesEnabled",!0),b(this,"sources"),b(this,"defaultSourceName",N.main),b(this,"updateStorage"),b(this,"delayedSourceUpdateMethods"),b(this,"layers"),this.gm=e,this.sources=Object.fromEntries(rr(N).map(n=>[n,null])),this.updateStorage=Object.fromEntries(rr(N).map(n=>[n,{add:[],remove:[],update:[]}])),this.delayedSourceUpdateMethods=Object.fromEntries(rr(N).map(n=>[n,{throttled:this.getDelayedSourceUpdateMethod({sourceName:n,type:"throttled"}),debounced:this.getDelayedSourceUpdateMethod({sourceName:n,type:"debounced"})}])),this.layers=[]}init(){if(Object.values(this.sources).some(e=>e!==null)){j.warn("features.init(): features are already initialized");return}Ge(this.sources).forEach(e=>{this.sources[e]=this.createSource(e)}),this.layers=this.createLayers()}get forEach(){return this.filteredForEach(e=>!e.temporary)}get tmpForEach(){return this.filteredForEach(e=>e.temporary)}getNewFeatureId(){return this.featureCounter+=1,`feature-${this.featureCounter}`}filteredForEach(e){return n=>{this.featureStore.forEach((r,i,o)=>{e(r)&&n(r,i,o)})}}has(e,n){const r=this.featureStore.get(n);return!!r&&(r==null?void 0:r.source)===this.sources[e]}get(e,n){const r=this.featureStore.get(n)||null;return(r==null?void 0:r.source)===this.sources[e]?r:null}add(e){if(this.featureStore.has(e.id)){j.error(`features.add: feature with the id "${e.id}" already exists`);return}this.featureStoreAllowedSources.includes(e.source.id)&&this.featureStore.set(e.id,e)}setDefaultSourceName(e){this.defaultSourceName=e}getDelayedSourceUpdateMethod({sourceName:e,type:n}){if(n==="throttled")return Zu(()=>this.updateSourceByStorage(e),2*this.gm.options.settings.throttlingDelay,{leading:!1,trailing:!0});if(n==="debounced")return Ta(()=>this.updateSourceByStorage(e),2*this.gm.options.settings.throttlingDelay,{leading:!0,trailing:!1});throw new Error("Features: getDelayedSourceUpdateMethod: invalid type")}updateSourceByStorage(e){const n=this.sources[e],r=this.updateStorage[e],i=Object.values(r).some(o=>o.length);n&&i&&(n.updateData(r),this.resetDiffStorage(e))}resetDiffStorage(e){const n=this.updateStorage[e];n.add=[],n.remove=[],n.update=[]}withAtomicSourcesUpdate(e){try{return this.autoUpdatesEnabled=!1,e()}finally{rr(N).forEach(n=>{this.updateSourceByStorage(n)}),this.autoUpdatesEnabled=!0}}updateSourceData({diff:e,sourceName:n}){this.gm.features.diffUpdatesEnabled?this.updateSourceDataWithDiff({diff:e,sourceName:n}):this.setSourceData({diff:e,sourceName:n})}updateSourceDataWithDiff({diff:e,sourceName:n}){const r=this.updateStorage[n];e.add&&(r.add=r.add.concat(e.add)),e.update&&(r.update=r.update.concat(e.update)),e.remove&&(r.remove=r.remove.concat(e.remove)),this.gm.features.autoUpdatesEnabled&&(this.delayedSourceUpdateMethods[n].throttled(),this.delayedSourceUpdateMethods[n].debounced())}setSourceData({sourceName:e}){j.warn("Review this Features.setSourceData() method");const n=this.getSourceGeoJson(e);n.features=n.features.filter(r=>!!r),this.setSourceGeoJson({geoJson:n,sourceName:e})}createSource(e){const n=this.gm.mapAdapter.addSource(e,{type:"FeatureCollection",features:[]});if(n)return n;throw new Error(`Features: failed to create the source: "${e}"`)}delete(e){let n;e instanceof yi?n=e:n=this.featureStore.get(e)||null,n?(n.removeMarkers(),n.removeGeoJson(),this.featureStore.delete(n.id)):j.error(`features.delete: feature "${e}" not found`)}getFeatureByMouseEvent({event:e,sourceNames:n}){if(!we(e,{warning:!0}))return null;const r=[e.point.x,e.point.y],i=this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:r,sourceNames:n});return i.length?i[0]:null}getFeaturesByGeoJsonBounds({geoJson:e,sourceNames:n}){const r=Oa(e),i=this.gm.mapAdapter.coordBoundsToScreenBounds(r);return this.getFeaturesByScreenBounds({bounds:i,sourceNames:n})}getFeaturesByScreenBounds({bounds:e,sourceNames:n}){return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:e,sourceNames:n})}createFeature({featureId:e,shapeGeoJson:n,parent:r,sourceName:i,imported:o}){const a=this.sources[i];if(!a)return j.error("Features.createFeature Missing source for feature creation"),null;const s=e||n.properties[Dn]||this.getNewFeatureId();if(this.featureStore.get(s))return j.error(`Features.createFeature: feature with the id "${s}" already exists`,this.featureStore.get(s)),null;const l=new yi({gm:this.gm,id:s,parent:r||null,source:a,geoJsonShapeFeature:Qe(n)});return this.add(l),!l.temporary&&!o&&this.fireFeatureCreatedEvent(l),this.featureCounter+=1,l}importGeoJson(e){const n="features"in e?e.features:[e],r={stats:{total:0,success:0,failed:0},addedFeatures:[]};return n.forEach(i=>{let o=null;r.stats.total+=1;const a=qv(i);a&&(o=this.importGeoJsonFeature(a)),o?(r.addedFeatures.push(o),r.stats.success+=1):r.stats.failed+=1}),r}importGeoJsonFeature(e){const n=this.defaultSourceName,r=this.getFeatureShapeByGeoJson(e);if(!r)return j.error("features.addGeoJsonFeature: unknown shape",r),null;const i=e.id||`${n}-feature-${this.featureCounter}`;return this.createFeature({featureId:e.id,shapeGeoJson:{...e,properties:{...e.properties,[Dn]:i,shape:r}},sourceName:n,imported:!0})}getAll(){return this.exportGeoJson()}exportGeoJson(){return this.asGeoJsonFeatureCollection({sourceNames:[N.main,N.standby]})}getSourceGeoJson(e){const n=this.sources[e];if(!n)throw new Error(`getSourceGeoJson: missing source "${e}"`);return n.getGeoJson()}setSourceGeoJson({geoJson:e,sourceName:n}){const r=this.sources[n];if(!r)throw new Error(`setSourceGeoJson: missing source "${n}"`);r.setGeoJson(e)}asGeoJsonFeatureCollection({shapeTypes:e,sourceNames:n}){const r={type:"FeatureCollection",features:[]};return n.forEach(i=>{const o=this.sources[i];o&&o.getGeoJson().features.filter(a=>!!a).forEach(a=>{(e===void 0||e.includes(a.properties.shape))&&r.features.push(a)})}),r}convertSourceToGm(e){const n=[],r=e.getGeoJson();return("features"in r?r.features:[r]).forEach(i=>{const o=this.addGeoJsonFeature({shapeGeoJson:i,defaultSource:!0});o&&n.push(o)}),this.gm.mapAdapter.getSource(e.id).remove({removeLayers:!0}),n}addGeoJsonFeature({shapeGeoJson:e,sourceName:n,defaultSource:r}){let i;if(r?(i=this.defaultSourceName,n&&j.warn("features.addGeoJsonFeature: default source is set, sourceName is ignored")):i=n||null,!i)return j.error("features.addGeoJsonFeature: missing sourceName"),null;const o=this.getFeatureShapeByGeoJson(e);return o?this.createFeature({featureId:e.id,shapeGeoJson:{...e,properties:{...e.properties,shape:o}},sourceName:i}):(j.error("features.addGeoJsonFeature: unknown shape",o),null)}createLayers(){const e=[];return Ge(this.gm.options.layerStyles).forEach(n=>{Ge(this.gm.options.layerStyles[n]).forEach(r=>{this.gm.options.layerStyles[n][r].forEach(i=>{const o=this.createGenericLayer({layerId:`${r}-${n}-${i.type}-layer`,partialStyle:i,shape:n,sourceName:r});o&&e.push(o)})})}),e}createGenericLayer({layerId:e,sourceName:n,partialStyle:r,shape:i}){const o={...r,id:e,source:n,filter:["in",["get","shape"],["literal",[i]]]};return this.gm.mapAdapter.addLayer(o)}getFeatureShapeByGeoJson(e){const n={Point:"marker",LineString:"line",Polygon:"polygon",MultiPolygon:"polygon"},r=e.properties;return r!=null&&r.shape&&bi.includes(r==null?void 0:r.shape)?r==null?void 0:r.shape:n[e.geometry.type]||null}createMarkerFeature({parentFeature:e,coordinate:n,type:r,sourceName:i}){return this.createFeature({sourceName:i,parent:e,shapeGeoJson:{type:"Feature",geometry:{type:"Point",coordinates:n},properties:{shape:`${r}_marker`}}})}updateMarkerFeaturePosition(e,n){e.updateGeoJsonGeometry({type:"Point",coordinates:n})}fireFeatureCreatedEvent(e){if(rn(e.shape,bi)){const n={level:"system",type:"draw",mode:e.shape,action:"feature_created",featureData:e};this.gm.events.fire(`${W}:draw`,n)}}}const yo=t=>[{type:"circle",paint:{"circle-radius":t.circleMarkerRadius,"circle-color":t.fillColor,"circle-opacity":t.fillOpacity,"circle-stroke-color":t.lineColor,"circle-stroke-width":t.lineWidth,"circle-stroke-opacity":t.lineOpacity}}],En=t=>[{type:"circle",paint:{"circle-radius":7,"circle-color":"#ffffff","circle-opacity":1,"circle-stroke-color":t.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],bo=t=>[{type:"line",paint:{"line-color":t.lineColor,"line-opacity":t.lineOpacity,"line-width":t.lineWidth}}],wo=()=>[{type:"symbol",layout:{"icon-image":"default-marker","icon-size":.18,"icon-allow-overlap":!0,"icon-anchor":"bottom"}}],xt=t=>[{type:"fill",paint:{"fill-color":t.fillColor,"fill-opacity":t.fillOpacity}},{type:"line",paint:{"line-color":t.lineColor,"line-opacity":t.lineOpacity,"line-width":t.lineWidth}}],Eo=t=>[{type:"circle",paint:{"circle-radius":6,"circle-color":"#ffffff","circle-opacity":.6,"circle-stroke-color":t.lineColor,"circle-stroke-width":2,"circle-stroke-opacity":1}}],ko=()=>[{type:"line",paint:{"line-color":"#00979f","line-width":1.8,"line-dasharray":[2,1]}}],Mo=()=>[{type:"symbol",layout:{"text-field":["get","text"],"text-justify":"center"},paint:{"text-color":"black","text-halo-color":"#fff","text-halo-width":2}}],de={[N.main]:{lineColor:"#278cda",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10},[N.temporary]:{lineColor:"#ff5600",lineOpacity:.8,lineWidth:3,fillColor:"#4fb3ff",fillOpacity:.4,circleMarkerRadius:10},[N.standby]:{lineColor:"#787878",lineOpacity:.8,lineWidth:3,fillColor:"#a5a5a5",fillOpacity:.4,circleMarkerRadius:10}},Zv={line:{[N.main]:bo(de[N.main]),[N.temporary]:bo(de[N.temporary]),[N.standby]:bo(de[N.standby])},circle:{[N.main]:xt(de[N.main]),[N.temporary]:xt(de[N.temporary]),[N.standby]:xt(de[N.standby])},rectangle:{[N.main]:xt(de[N.main]),[N.temporary]:xt(de[N.temporary]),[N.standby]:xt(de[N.standby])},polygon:{[N.main]:xt(de[N.main]),[N.temporary]:xt(de[N.temporary]),[N.standby]:xt(de[N.standby])},marker:{[N.temporary]:wo(),[N.main]:wo(),[N.standby]:wo()},circle_marker:{[N.main]:yo(de[N.main]),[N.temporary]:yo(de[N.temporary]),[N.standby]:yo(de[N.standby])},text_marker:{[N.main]:Mo(),[N.temporary]:Mo(),[N.standby]:Mo()},dom_marker:{[N.main]:[],[N.temporary]:[],[N.standby]:[]},center_marker:{[N.main]:En(de[N.main]),[N.temporary]:En(de[N.temporary]),[N.standby]:En(de[N.standby])},vertex_marker:{[N.main]:En(de[N.main]),[N.temporary]:En(de[N.temporary]),[N.standby]:En(de[N.standby])},edge_marker:{[N.main]:Eo(de[N.main]),[N.temporary]:Eo(de[N.temporary]),[N.standby]:Eo(de[N.standby])},snap_guide:{[N.main]:ko(),[N.temporary]:ko(),[N.standby]:ko()}},wi={type:"Feature",properties:{shape:"polygon"},geometry:{type:"MultiPolygon",coordinates:[[[[4,51.2],[5.4,52.4],[6.8,51.2],[4,51.2]]]]}},yc={type:"Feature",properties:{shape:"rectangle"},geometry:{type:"Polygon",coordinates:[[[-.47,51.67],[1.43,51.67],[1.43,53.32],[-.47,53.32],[-.47,51.67]]]}},$v={settings:{throttlingDelay:10,controlsPosition:"top-left"},layerStyles:Zv,controls:{draw:{marker:{title:"Marker",icon:re.marker,uiEnabled:!0,active:!1},circle_marker:{title:"Circle Marker",icon:re.circle_marker,uiEnabled:!0,active:!1},text_marker:{title:"Text Marker",icon:re.text_marker,uiEnabled:!0,active:!1},circle:{title:"Circle",icon:re.circle,uiEnabled:!0,active:!1},line:{title:"Line",icon:re.line,uiEnabled:!0,active:!1},rectangle:{title:"Rectangle",icon:re.rectangle,uiEnabled:!0,active:!1},polygon:{title:"Polygon",icon:re.polygon,uiEnabled:!0,active:!1},freehand:{title:"Freehand",icon:re.freehand,uiEnabled:!1,active:!1},custom_shape:{title:"Custom shape",icon:re.custom_shape,uiEnabled:!1,active:!1,options:[{type:"select",label:"Shape",name:"shape",value:{title:"Triangle",value:JSON.stringify(wi)},choices:[{title:"Triangle",value:JSON.stringify(wi)},{title:"Rectangle",value:JSON.stringify(yc)}]}]}},edit:{drag:{title:"Drag",icon:re.drag,uiEnabled:!0,active:!1},change:{title:"Change",icon:re.change,uiEnabled:!0,active:!1},rotate:{title:"Rotate",icon:re.rotate,uiEnabled:!0,active:!1},scale:{title:"Scale",icon:re.scale,uiEnabled:!1,active:!1},copy:{title:"Copy",icon:re.copy,uiEnabled:!1,active:!1},cut:{title:"Cut",icon:re.cut,uiEnabled:!0,active:!1},split:{title:"Split",icon:re.split,uiEnabled:!1,active:!1},union:{title:"Union",icon:re.union,uiEnabled:!1,active:!1},difference:{title:"Difference",icon:re.difference,uiEnabled:!1,active:!1},line_simplification:{title:"Line simplification",icon:re.line_simplification,uiEnabled:!1,active:!1},lasso:{title:"Lasso select",icon:re.lasso,uiEnabled:!1,active:!1},delete:{title:"Delete",icon:re.delete,uiEnabled:!0,active:!1}},helper:{shape_markers:{title:"Shape markers",icon:null,uiEnabled:!0,active:!1},snapping:{title:"Snapping",icon:re.snapping,uiEnabled:!0,active:!1},pin:{title:"Pin",icon:re.pin,uiEnabled:!1,active:!1},snap_guides:{title:"Snap guides",icon:re.snap_guides,uiEnabled:!1,active:!1},measurements:{title:"Measurements",icon:re.measurements,uiEnabled:!1,active:!1},auto_trace:{title:"Auto trace line",icon:re.auto_trace,uiEnabled:!1,active:!1},geofencing:{title:"Geofencing",icon:re.geofencing,uiEnabled:!1,active:!1},zoom_to_features:{title:"Zoom to features",icon:re.zoom_to_features,uiEnabled:!0,active:!1},click_to_edit:{title:"Click to edit",icon:re.click_to_edit,uiEnabled:!1,active:!1}}}};JSON.stringify(wi),JSON.stringify(wi),JSON.stringify(yc);const bc=()=>Qe($v),Kv=!1;var Ha=Array.isArray,Xv=Array.prototype.indexOf,Ja=Array.from,wc=Object.defineProperty,hr=Object.getOwnPropertyDescriptor,Ec=Object.getOwnPropertyDescriptors,Qv=Object.prototype,e1=Array.prototype,Ua=Object.getPrototypeOf;const Pn=()=>{};function t1(t){return t()}function Ko(t){for(var e=0;e<t.length;e++)t[e]()}const at=2,kc=4,Yi=8,Va=16,Bt=32,Pr=64,Ei=128,Ke=256,ki=512,Fe=1024,Nt=2048,jn=4096,Dt=8192,Wi=16384,n1=32768,qa=65536,r1=1<<19,Mc=1<<20,on=Symbol("$state"),i1=Symbol("");let Mi=[];function o1(){var t=Mi;Mi=[],Ko(t)}function a1(t){Mi.length===0&&queueMicrotask(o1),Mi.push(t)}function xc(t){return t===this.v}function Sc(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Ac(t){return!Sc(t,this.v)}function s1(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function l1(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function u1(t){throw new Error("https://svelte.dev/e/effect_orphan")}function c1(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function d1(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function h1(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function f1(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function p1(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Fr=!1,g1=!1;function m1(){Fr=!0}const Ya=1,Wa=2,Lc=4,v1=8,y1=16,b1=1,w1=2,Be=Symbol();function Za(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let ie=null;function fl(t){ie=t}function $a(t){return E1().get(t)}function zn(t,e=!1,n){ie={p:ie,c:null,e:null,m:!1,s:t,x:null,l:null},Fr&&!e&&(ie.l={s:null,u:null,r1:[],r2:ze(!1)})}function Hn(t){const e=ie;if(e!==null){const a=e.e;if(a!==null){var n=ae,r=oe;e.e=null;try{for(var i=0;i<a.length;i++){var o=a[i];Wt(o.effect),Yt(o.reaction),eo(o.fn)}}finally{Wt(n),Yt(r)}}ie=e.p,e.m=!0}return{}}function Zi(){return!Fr||ie!==null&&ie.l===null}function E1(t){return ie===null&&Za(),ie.c??(ie.c=new Map(k1(ie)||void 0))}function k1(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}function ze(t,e){var n={f:0,v:t,reactions:null,equals:xc,rv:0,wv:0};return n}function Cc(t){return Ic(ze(t))}function Ka(t,e=!1){var n;const r=ze(t);return e||(r.equals=Ac),Fr&&ie!==null&&ie.l!==null&&((n=ie.l).s??(n.s=[])).push(r),r}function M1(t,e=!1){return Ic(Ka(t,e))}function Ic(t){return oe!==null&&!it&&(oe.f&at)!==0&&(gt===null?D1([t]):gt.push(t)),t}function Me(t,e){return oe!==null&&!it&&Zi()&&(oe.f&(at|Va))!==0&&(gt===null||!gt.includes(t))&&p1(),Xo(t,e)}function Xo(t,e){return t.equals(e)||(t.v,t.v=e,t.wv=Gc(),Dc(t,Nt),Zi()&&ae!==null&&(ae.f&Fe)!==0&&(ae.f&(Bt|Pr))===0&&(Lt===null?P1([t]):Lt.push(t))),e}function Dc(t,e){var n=t.reactions;if(n!==null)for(var r=Zi(),i=n.length,o=0;o<i;o++){var a=n[o],s=a.f;(s&Nt)===0&&(!r&&a===ae||(yt(a,e),(s&(Fe|Ke))!==0&&((s&at)!==0?Dc(a,jn):Qi(a))))}}function Xa(t){var e=at|Nt,n=oe!==null&&(oe.f&at)!==0?oe:null;return ae===null||n!==null&&(n.f&Ke)!==0?e|=Ke:ae.f|=Mc,{ctx:ie,deps:null,effects:null,equals:xc,f:e,fn:t,reactions:null,rv:0,v:null,wv:0,parent:n??ae}}function Pc(t){const e=Xa(t);return e.equals=Ac,e}function Fc(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Pt(e[n])}}function x1(t){for(var e=t.parent;e!==null;){if((e.f&at)===0)return e;e=e.parent}return null}function S1(t){var e,n=ae;Wt(x1(t));try{Fc(t),e=jc(t)}finally{Wt(n)}return e}function Tc(t){var e=S1(t),n=(Jt||(t.f&Ke)!==0)&&t.deps!==null?jn:Fe;yt(t,n),t.equals(e)||(t.v=e,t.wv=Gc())}let A1=!1;function ht(t,e=null,n){if(typeof t!="object"||t===null||on in t)return t;const r=Ua(t);if(r!==Qv&&r!==e1)return t;var i=new Map,o=Ha(t),a=ze(0);o&&i.set("length",ze(t.length));var s;return new Proxy(t,{defineProperty(l,u,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&d1();var c=i.get(u);return c===void 0?(c=ze(h.value),i.set(u,c)):Me(c,ht(h.value,s)),!0},deleteProperty(l,u){var h=i.get(u);if(h===void 0)u in l&&i.set(u,ze(Be));else{if(o&&typeof u=="string"){var c=i.get("length"),p=Number(u);Number.isInteger(p)&&p<c.v&&Me(c,p)}Me(h,Be),pl(a)}return!0},get(l,u,h){var c;if(u===on)return t;var p=i.get(u),m=u in l;if(p===void 0&&(!m||(c=hr(l,u))!=null&&c.writable)&&(p=ze(ht(m?l[u]:Be,s)),i.set(u,p)),p!==void 0){var A=ee(p);return A===Be?void 0:A}return Reflect.get(l,u,h)},getOwnPropertyDescriptor(l,u){var h=Reflect.getOwnPropertyDescriptor(l,u);if(h&&"value"in h){var c=i.get(u);c&&(h.value=ee(c))}else if(h===void 0){var p=i.get(u),m=p==null?void 0:p.v;if(p!==void 0&&m!==Be)return{enumerable:!0,configurable:!0,value:m,writable:!0}}return h},has(l,u){var h;if(u===on)return!0;var c=i.get(u),p=c!==void 0&&c.v!==Be||Reflect.has(l,u);if(c!==void 0||ae!==null&&(!p||(h=hr(l,u))!=null&&h.writable)){c===void 0&&(c=ze(p?ht(l[u],s):Be),i.set(u,c));var m=ee(c);if(m===Be)return!1}return p},set(l,u,h,c){var p,m=i.get(u),A=u in l;if(o&&u==="length")for(var M=h;M<m.v;M+=1){var D=i.get(M+"");D!==void 0?Me(D,Be):M in l&&(D=ze(Be),i.set(M+"",D))}m===void 0?(!A||(p=hr(l,u))!=null&&p.writable)&&(m=ze(void 0),Me(m,ht(h,s)),i.set(u,m)):(A=m.v!==Be,Me(m,ht(h,s)));var P=Reflect.getOwnPropertyDescriptor(l,u);if(P!=null&&P.set&&P.set.call(c,h),!A){if(o&&typeof u=="string"){var E=i.get("length"),B=Number(u);Number.isInteger(B)&&B>=E.v&&Me(E,B+1)}pl(a)}return!0},ownKeys(l){ee(a);var u=Reflect.ownKeys(l).filter(p=>{var m=i.get(p);return m===void 0||m.v!==Be});for(var[h,c]of i)c.v!==Be&&!(h in l)&&u.push(h);return u},setPrototypeOf(){h1()}})}function pl(t,e=1){Me(t,t.v+e)}function gl(t){return t!==null&&typeof t=="object"&&on in t?t[on]:t}function L1(t,e){return Object.is(gl(t),gl(e))}var ml,_c,Oc,Bc;function C1(){if(ml===void 0){ml=window,_c=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype;Oc=hr(e,"firstChild").get,Bc=hr(e,"nextSibling").get,t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__styles=null,t.__e=void 0,Text.prototype.__t=void 0}}function $i(t=""){return document.createTextNode(t)}function br(t){return Oc.call(t)}function Ki(t){return Bc.call(t)}function Ht(t,e){return br(t)}function qt(t,e){{var n=br(t);return n instanceof Comment&&n.data===""?Ki(n):n}}function xi(t,e=1,n=!1){let r=t;for(;e--;)r=Ki(r);return r}function I1(t){t.textContent=""}let oi=!1,Qo=!1,Si=null,ai=!1,Qa=!1;function vl(t){Qa=t}let si=[],oe=null,it=!1;function Yt(t){oe=t}let ae=null;function Wt(t){ae=t}let gt=null;function D1(t){gt=t}let De=null,je=0,Lt=null;function P1(t){Lt=t}let Nc=1,Ai=0,Jt=!1;function Gc(){return++Nc}function Tr(t){var e,n=t.f;if((n&Nt)!==0)return!0;if((n&jn)!==0){var r=t.deps,i=(n&Ke)!==0;if(r!==null){var o,a,s=(n&ki)!==0,l=i&&ae!==null&&!Jt,u=r.length;if(s||l){var h=t,c=h.parent;for(o=0;o<u;o++)a=r[o],(s||!((e=a==null?void 0:a.reactions)!=null&&e.includes(h)))&&(a.reactions??(a.reactions=[])).push(h);s&&(h.f^=ki),l&&c!==null&&(c.f&Ke)===0&&(h.f^=Ke)}for(o=0;o<u;o++)if(a=r[o],Tr(a)&&Tc(a),a.wv>t.wv)return!0}(!i||ae!==null&&!Jt)&&yt(t,Fe)}return!1}function F1(t,e){for(var n=e;n!==null;){if((n.f&Ei)!==0)try{n.fn(t);return}catch{n.f^=Ei}n=n.parent}throw oi=!1,t}function T1(t){return(t.f&Wi)===0&&(t.parent===null||(t.parent.f&Ei)===0)}function Xi(t,e,n,r){if(oi){if(n===null&&(oi=!1),T1(e))throw t;return}n!==null&&(oi=!0);{F1(t,e);return}}function Rc(t,e,n=!0){var r=t.reactions;if(r!==null)for(var i=0;i<r.length;i++){var o=r[i];(o.f&at)!==0?Rc(o,e,!1):e===o&&(n?yt(o,Nt):(o.f&Fe)!==0&&yt(o,jn),Qi(o))}}function jc(t){var e,n=De,r=je,i=Lt,o=oe,a=Jt,s=gt,l=ie,u=it,h=t.f;De=null,je=0,Lt=null,Jt=(h&Ke)!==0&&(it||!ai||oe===null),oe=(h&(Bt|Pr))===0?t:null,gt=null,fl(t.ctx),it=!1,Ai++;try{var c=(0,t.fn)(),p=t.deps;if(De!==null){var m;if(Li(t,je),p!==null&&je>0)for(p.length=je+De.length,m=0;m<De.length;m++)p[je+m]=De[m];else t.deps=p=De;if(!Jt)for(m=je;m<p.length;m++)((e=p[m]).reactions??(e.reactions=[])).push(t)}else p!==null&&je<p.length&&(Li(t,je),p.length=je);if(Zi()&&Lt!==null&&!it&&p!==null&&(t.f&(at|jn|Nt))===0)for(m=0;m<Lt.length;m++)Rc(Lt[m],t);return o!==null&&Ai++,c}finally{De=n,je=r,Lt=i,oe=o,Jt=a,gt=s,fl(l),it=u}}function _1(t,e){let n=e.reactions;if(n!==null){var r=Xv.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(e.f&at)!==0&&(De===null||!De.includes(e))&&(yt(e,jn),(e.f&(Ke|ki))===0&&(e.f^=ki),Fc(e),Li(e,0))}function Li(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)_1(t,n[r])}function es(t){var e=t.f;if((e&Wi)===0){yt(t,Fe);var n=ae,r=ie,i=ai;ae=t,ai=!0;try{(e&Va)!==0?V1(t):Uc(t),Jc(t);var o=jc(t);t.teardown=typeof o=="function"?o:null,t.wv=Nc;var a=t.deps,s;Kv&&g1&&t.f&Nt}catch(l){Xi(l,t,n,r||t.ctx)}finally{ai=i,ae=n}}}function O1(){try{c1()}catch(t){if(Si!==null)Xi(t,Si,null);else throw t}}function B1(){try{for(var t=0;si.length>0;){t++>1e3&&O1();var e=si,n=e.length;si=[];for(var r=0;r<n;r++){var i=e[r];(i.f&Fe)===0&&(i.f^=Fe);var o=G1(i);N1(o)}}}finally{Qo=!1,Si=null}}function N1(t){var e=t.length;if(e!==0)for(var n=0;n<e;n++){var r=t[n];if((r.f&(Wi|Dt))===0)try{Tr(r)&&(es(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Vc(r):r.fn=null))}catch(i){Xi(i,r,null,r.ctx)}}}function Qi(t){Qo||(Qo=!0,queueMicrotask(B1));for(var e=Si=t;e.parent!==null;){e=e.parent;var n=e.f;if((n&(Pr|Bt))!==0){if((n&Fe)===0)return;e.f^=Fe}}si.push(e)}function G1(t){for(var e=[],n=t.first;n!==null;){var r=n.f,i=(r&Bt)!==0,o=i&&(r&Fe)!==0;if(!o&&(r&Dt)===0){if((r&kc)!==0)e.push(n);else if(i)n.f^=Fe;else{var a=oe;try{oe=n,Tr(n)&&es(n)}catch(u){Xi(u,n,null,n.ctx)}finally{oe=a}}var s=n.first;if(s!==null){n=s;continue}}var l=n.parent;for(n=n.next;n===null&&l!==null;)n=l.next,l=l.parent}return e}function ee(t){var e=t.f,n=(e&at)!==0;if(oe!==null&&!it){gt!==null&&gt.includes(t)&&f1();var r=oe.deps;t.rv<Ai&&(t.rv=Ai,De===null&&r!==null&&r[je]===t?je++:De===null?De=[t]:(!Jt||!De.includes(t))&&De.push(t))}else if(n&&t.deps===null&&t.effects===null){var i=t,o=i.parent;o!==null&&(o.f&Ke)===0&&(i.f^=Ke)}return n&&(i=t,Tr(i)&&Tc(i)),t.v}function _r(t){var e=it;try{return it=!0,t()}finally{it=e}}const R1=-7169;function yt(t,e){t.f=t.f&R1|e}function j1(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(on in t)ea(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&on in n&&ea(n)}}}function ea(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ea(t[r],e)}catch{}const n=Ua(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=Ec(n);for(let i in r){const o=r[i].get;if(o)try{o.call(t)}catch{}}}}}function zc(t){ae===null&&oe===null&&u1(),oe!==null&&(oe.f&Ke)!==0&&ae===null&&l1(),Qa&&s1()}function z1(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Jn(t,e,n,r=!0){var i=(t&Pr)!==0,o=ae,a={ctx:ie,deps:null,nodes_start:null,nodes_end:null,f:t|Nt,first:null,fn:e,last:null,next:null,parent:i?null:o,prev:null,teardown:null,transitions:null,wv:0};if(n)try{es(a),a.f|=n1}catch(u){throw Pt(a),u}else e!==null&&Qi(a);var s=n&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&(Mc|Ei))===0;if(!s&&!i&&r&&(o!==null&&z1(a,o),oe!==null&&(oe.f&at)!==0)){var l=oe;(l.effects??(l.effects=[])).push(a)}return a}function H1(t){const e=Jn(Yi,null,!1);return yt(e,Fe),e.teardown=t,e}function ta(t){zc();var e=ae!==null&&(ae.f&Bt)!==0&&ie!==null&&!ie.m;if(e){var n=ie;(n.e??(n.e=[])).push({fn:t,effect:ae,reaction:oe})}else{var r=eo(t);return r}}function J1(t){return zc(),Hc(t)}function U1(t){const e=Jn(Pr,t,!0);return(n={})=>new Promise(r=>{n.outro?Ci(e,()=>{Pt(e),r(void 0)}):(Pt(e),r(void 0))})}function eo(t){return Jn(kc,t,!1)}function Hc(t){return Jn(Yi,t,!0)}function Ct(t,e=[],n=Xa){const r=e.map(n);return to(()=>t(...r.map(ee)))}function to(t,e=0){return Jn(Yi|Va|e,t,!0)}function Nn(t,e=!0){return Jn(Yi|Bt,t,!0,e)}function Jc(t){var e=t.teardown;if(e!==null){const n=Qa,r=oe;vl(!0),Yt(null);try{e.call(null)}finally{vl(n),Yt(r)}}}function Uc(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){var r=n.next;Pt(n,e),n=r}}function V1(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Bt)===0&&Pt(e),e=n}}function Pt(t,e=!0){var n=!1;if((e||(t.f&r1)!==0)&&t.nodes_start!==null){for(var r=t.nodes_start,i=t.nodes_end;r!==null;){var o=r===i?null:Ki(r);r.remove(),r=o}n=!0}Uc(t,e&&!n),Li(t,0),yt(t,Wi);var a=t.transitions;if(a!==null)for(const l of a)l.stop();Jc(t);var s=t.parent;s!==null&&s.first!==null&&Vc(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=null}function Vc(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Ci(t,e){var n=[];ts(t,n,!0),qc(n,()=>{Pt(t),e&&e()})}function qc(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function ts(t,e,n){if((t.f&Dt)===0){if(t.f^=Dt,t.transitions!==null)for(const a of t.transitions)(a.is_global||n)&&e.push(a);for(var r=t.first;r!==null;){var i=r.next,o=(r.f&qa)!==0||(r.f&Bt)!==0;ts(r,e,o?n:!1),r=i}}}function Ii(t){Yc(t,!0)}function Yc(t,e){if((t.f&Dt)!==0){t.f^=Dt,(t.f&Fe)===0&&(t.f^=Fe),Tr(t)&&(yt(t,Nt),Qi(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&qa)!==0||(n.f&Bt)!==0;Yc(n,i?e:!1),n=r}if(t.transitions!==null)for(const o of t.transitions)(o.is_global||e)&&o.in()}}const q1=["touchstart","touchmove"];function Y1(t){return q1.includes(t)}let yl=!1;function W1(){yl||(yl=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Z1(t){var e=oe,n=ae;Yt(null),Wt(null);try{return t()}finally{Yt(e),Wt(n)}}function Wc(t,e,n,r=n){t.addEventListener(e,()=>Z1(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),W1()}const Zc=new Set,na=new Set;function ns(t){for(var e=0;e<t.length;e++)Zc.add(t[e]);for(var n of na)n(t)}function Yr(t){var e,n=this,r=n.ownerDocument,i=t.type,o=((e=t.composedPath)==null?void 0:e.call(t))||[],a=o[0]||t.target,s=0,l=t.__root;if(l){var u=o.indexOf(l);if(u!==-1&&(n===document||n===window)){t.__root=n;return}var h=o.indexOf(n);if(h===-1)return;u<=h&&(s=u)}if(a=o[s]||t.target,a!==n){wc(t,"currentTarget",{configurable:!0,get(){return a||r}});var c=oe,p=ae;Yt(null),Wt(null);try{for(var m,A=[];a!==null;){var M=a.assignedSlot||a.parentNode||a.host||null;try{var D=a["__"+i];if(D!==void 0&&(!a.disabled||t.target===a))if(Ha(D)){var[P,...E]=D;P.apply(a,[t,...E])}else D.call(a,t)}catch(B){m?A.push(B):m=B}if(t.cancelBubble||M===n||M===null)break;a=M}if(m){for(let B of A)queueMicrotask(()=>{throw B});throw m}}finally{t.__root=n,delete t.currentTarget,Yt(c),Wt(p)}}}function $c(t){var e=document.createElement("template");return e.innerHTML=t,e.content}function wr(t,e){var n=ae;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function lt(t,e){var n=(e&b1)!==0,r=(e&w1)!==0,i,o=!t.startsWith("<!>");return()=>{i===void 0&&(i=$c(o?t:"<!>"+t),n||(i=br(i)));var a=r||_c?document.importNode(i,!0):i.cloneNode(!0);if(n){var s=br(a),l=a.lastChild;wr(s,l)}else wr(a,a);return a}}function bl(t=""){{var e=$i(t+"");return wr(e,e),e}}function Gn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=$i();return t.append(e,n),wr(e,n),t}function me(t,e){t!==null&&t.before(e)}function Fn(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function $1(t,e){return K1(t,e)}const kn=new Map;function K1(t,{target:e,anchor:n,props:r={},events:i,context:o,intro:a=!0}){C1();var s=new Set,l=c=>{for(var p=0;p<c.length;p++){var m=c[p];if(!s.has(m)){s.add(m);var A=Y1(m);e.addEventListener(m,Yr,{passive:A});var M=kn.get(m);M===void 0?(document.addEventListener(m,Yr,{passive:A}),kn.set(m,1)):kn.set(m,M+1)}}};l(Ja(Zc)),na.add(l);var u=void 0,h=U1(()=>{var c=n??e.appendChild($i());return Nn(()=>{if(o){zn({});var p=ie;p.c=o}i&&(r.$$events=i),u=t(c,r)||{},o&&Hn()}),()=>{var p;for(var m of s){e.removeEventListener(m,Yr);var A=kn.get(m);--A===0?(document.removeEventListener(m,Yr),kn.delete(m)):kn.set(m,A)}na.delete(l),c!==n&&((p=c.parentNode)==null||p.removeChild(c))}});return ra.set(u,h),u}let ra=new WeakMap;function X1(t,e){const n=ra.get(t);return n?(ra.delete(t),n(e)):Promise.resolve()}function ft(t,e,[n,r]=[0,0]){var i=t,o=null,a=null,s=Be,l=n>0?qa:0,u=!1;const h=(p,m=!0)=>{u=!0,c(m,p)},c=(p,m)=>{s!==(s=p)&&(s?(o?Ii(o):m&&(o=Nn(()=>m(i))),a&&Ci(a,()=>{a=null})):(a?Ii(a):m&&(a=Nn(()=>m(i,[n+1,r]))),o&&Ci(o,()=>{o=null})))};to(()=>{u=!1,e(h),u||c(null,null)},l)}function Er(t,e){return e}function Q1(t,e,n,r){for(var i=[],o=e.length,a=0;a<o;a++)ts(e[a].e,i,!0);var s=o>0&&i.length===0&&n!==null;if(s){var l=n.parentNode;I1(l),l.append(n),r.clear(),jt(t,e[0].prev,e[o-1].next)}qc(i,()=>{for(var u=0;u<o;u++){var h=e[u];s||(r.delete(h.k),jt(t,h.prev,h.next)),Pt(h.e,!s)}})}function kr(t,e,n,r,i,o=null){var a=t,s={flags:e,items:new Map,first:null},l=(e&Lc)!==0;if(l){var u=t;a=u.appendChild($i())}var h=null,c=!1,p=Pc(()=>{var m=n();return Ha(m)?m:m==null?[]:Ja(m)});to(()=>{var m=ee(p),A=m.length;c&&A===0||(c=A===0,ey(m,s,a,i,e,r,n),o!==null&&(A===0?h?Ii(h):h=Nn(()=>o(a)):h!==null&&Ci(h,()=>{h=null})),ee(p))})}function ey(t,e,n,r,i,o,a){var s,l,u,h,c=(i&v1)!==0,p=(i&(Ya|Wa))!==0,m=t.length,A=e.items,M=e.first,D=M,P,E=null,B,O=[],R=[],G,J,d,f;if(c)for(f=0;f<m;f+=1)G=t[f],J=o(G,f),d=A.get(J),d!==void 0&&((s=d.a)==null||s.measure(),(B??(B=new Set)).add(d));for(f=0;f<m;f+=1){if(G=t[f],J=o(G,f),d=A.get(J),d===void 0){var g=D?D.e.nodes_start:n;E=ny(g,e,E,E===null?e.first:E.next,G,J,f,r,i,a),A.set(J,E),O=[],R=[],D=E.next;continue}if(p&&ty(d,G,f,i),(d.e.f&Dt)!==0&&(Ii(d.e),c&&((l=d.a)==null||l.unfix(),(B??(B=new Set)).delete(d))),d!==D){if(P!==void 0&&P.has(d)){if(O.length<R.length){var v=R[0],y;E=v.prev;var S=O[0],F=O[O.length-1];for(y=0;y<O.length;y+=1)wl(O[y],v,n);for(y=0;y<R.length;y+=1)P.delete(R[y]);jt(e,S.prev,F.next),jt(e,E,S),jt(e,F,v),D=v,E=F,f-=1,O=[],R=[]}else P.delete(d),wl(d,D,n),jt(e,d.prev,d.next),jt(e,d,E===null?e.first:E.next),jt(e,E,d),E=d;continue}for(O=[],R=[];D!==null&&D.k!==J;)(D.e.f&Dt)===0&&(P??(P=new Set)).add(D),R.push(D),D=D.next;if(D===null)continue;d=D}O.push(d),E=d,D=d.next}if(D!==null||P!==void 0){for(var k=P===void 0?[]:Ja(P);D!==null;)(D.e.f&Dt)===0&&k.push(D),D=D.next;var x=k.length;if(x>0){var T=(i&Lc)!==0&&m===0?n:null;if(c){for(f=0;f<x;f+=1)(u=k[f].a)==null||u.measure();for(f=0;f<x;f+=1)(h=k[f].a)==null||h.fix()}Q1(e,k,T,A)}}c&&a1(()=>{var I;if(B!==void 0)for(d of B)(I=d.a)==null||I.apply()}),ae.first=e.first&&e.first.e,ae.last=E&&E.e}function ty(t,e,n,r){(r&Ya)!==0&&Xo(t.v,e),(r&Wa)!==0?Xo(t.i,n):t.i=n}function ny(t,e,n,r,i,o,a,s,l,u){var h=(l&Ya)!==0,c=(l&y1)===0,p=h?c?Ka(i):ze(i):i,m=(l&Wa)===0?a:ze(a),A={i:m,v:p,k:o,a:null,e:null,prev:n,next:r};try{return A.e=Nn(()=>s(t,p,m,u),A1),A.e.prev=n&&n.e,A.e.next=r&&r.e,n===null?e.first=A:(n.next=A,n.e.next=A.e),r!==null&&(r.prev=A,r.e.prev=A.e),A}finally{}}function wl(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,o=t.e.nodes_start;o!==r;){var a=Ki(o);i.before(o),o=a}}function jt(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function ry(t,e,n,r,i){var o=t,a="",s;to(()=>{a!==(a=e()??"")&&(s!==void 0&&(Pt(s),s=void 0),a!==""&&(s=Nn(()=>{var l=a+"",u=$c(l);wr(br(u),u.lastChild),o.before(u)})))})}const El=[...` 	
\r\f \v\uFEFF`];function iy(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var o=i.length,a=0;(a=r.indexOf(i,a))>=0;){var s=a+o;(a===0||El.includes(r[a-1]))&&(s===r.length||El.includes(r[s]))?r=(a===0?"":r.substring(0,a))+r.substring(s+1):a=s}}return r===""?null:r}function ia(t,e,n,r,i,o){var a=t.__className;if(a!==n){var s=iy(n,r,o);s==null?t.removeAttribute("class"):t.className=s,t.__className=n}else if(o)for(var l in o){var u=!!o[l];(i==null||u!==!!i[l])&&t.classList.toggle(l,u)}return o}function nn(t,e,n,r){var i=t.__attributes??(t.__attributes={});i[e]!==(i[e]=n)&&(e==="style"&&"__styles"in t&&(t.__styles={}),e==="loading"&&(t[i1]=n),n==null?t.removeAttribute(e):typeof n!="string"&&oy(t).includes(e)?t[e]=n:t.setAttribute(e,n))}var kl=new Map;function oy(t){var e=kl.get(t.nodeName);if(e)return e;kl.set(t.nodeName,e=[]);for(var n,r=t,i=Element.prototype;i!==r;){n=Ec(r);for(var o in n)n[o].set&&e.push(o);r=Ua(r)}return e}function ay(t,e,n=e){Wc(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),_r(e)==null&&n(t.checked),Hc(()=>{var r=e();t.checked=!!r})}function Kc(t,e,n){if(t.multiple)return uy(t,e);for(var r of t.options){var i=fr(r);if(L1(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function sy(t,e){eo(()=>{var n=new MutationObserver(()=>{var r=t.__value;Kc(t,r)});return n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{n.disconnect()}})}function ly(t,e,n=e){var r=!0;Wc(t,"change",i=>{var o=i?"[selected]":":checked",a;if(t.multiple)a=[].map.call(t.querySelectorAll(o),fr);else{var s=t.querySelector(o)??t.querySelector("option:not([disabled])");a=s&&fr(s)}n(a)}),eo(()=>{var i=e();if(Kc(t,i,r),r&&i===void 0){var o=t.querySelector(":checked");o!==null&&(i=fr(o),n(i))}t.__value=i,r=!1}),sy(t)}function uy(t,e){for(var n of t.options)n.selected=~e.indexOf(fr(n))}function fr(t){return"__value"in t?t.__value:t.value}function cy(t=!1){const e=ie,n=e.l.u;if(!n)return;let r=()=>j1(e.s);if(t){let i=0,o={};const a=Xa(()=>{let s=!1;const l=e.s;for(const u in l)l[u]!==o[u]&&(o[u]=l[u],s=!0);return s&&i++,i});r=()=>ee(a)}n.b.length&&J1(()=>{Ml(e,r),Ko(n.b)}),ta(()=>{const i=_r(()=>n.m.map(t1));return()=>{for(const o of i)typeof o=="function"&&o()}}),n.a.length&&ta(()=>{Ml(e,r),Ko(n.a)})}function Ml(t,e){if(t.l.s)for(const n of t.l.s)ee(n);e()}let oa=Symbol();function dy(t,e,n){const r=n[e]??(n[e]={store:null,source:Ka(void 0),unsubscribe:Pn});if(r.store!==t&&!(oa in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Pn;else{var i=!0;r.unsubscribe=Qc(t,o=>{i?r.source.v=o:Me(r.source,o)}),i=!1}return t&&oa in n?my(t):ee(r.source)}function hy(){const t={};function e(){H1(()=>{for(var n in t)t[n].unsubscribe();wc(t,oa,{enumerable:!1,value:!0})})}return[t,e]}function Xc(t){ie===null&&Za(),Fr&&ie.l!==null?py(ie).m.push(t):ta(()=>{const e=_r(t);if(typeof e=="function")return e})}function fy(t){ie===null&&Za(),Xc(()=>()=>_r(t))}function py(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}function Qc(t,e,n){if(t==null)return e(void 0),Pn;const r=_r(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const Mn=[];function gy(t,e=Pn){let n=null;const r=new Set;function i(s){if(Sc(t,s)&&(t=s,n)){const l=!Mn.length;for(const u of r)u[1](),Mn.push(u,t);if(l){for(let u=0;u<Mn.length;u+=2)Mn[u][0](Mn[u+1]);Mn.length=0}}}function o(s){i(s(t))}function a(s,l=Pn){const u=[s,l];return r.add(u),r.size===1&&(n=e(i,o)||Pn),s(t),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:i,update:o,subscribe:a}}function my(t){let e;return Qc(t,n=>e=n)(),e}const vy={controls:Qe(cu),options:bc().controls},aa=gy(vy),yy="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yy);m1();const xl=(t,e,n)=>{var r,i;if(!e.actionInstance||!e.actionOption){j.error("Can't apply option value",e.actionInstance,e.actionOption);return}if(((r=e.actionOption)==null?void 0:r.type)==="toggle"){const o=t.target;Me(n,ht(o.checked))}else if(((i=e.actionOption)==null?void 0:i.type)==="select"){const o=t.target;Me(n,ht(o.value))}e.actionInstance.applyOptionValue(e.actionOption.name,ee(n))};var by=lt("<option> </option>"),wy=lt('<label class="svelte-1892xbw"> </label> <select class="svelte-1892xbw"></select>',1),Ey=lt('<label class="svelte-1892xbw"><input type="checkbox" class="svelte-1892xbw"> </label>'),ky=lt("<span>Unknown type</span>"),My=lt('<div class="action-option svelte-1892xbw"><!></div>');function xy(t,e){zn(e,!0);let n=Cc("");Xc(()=>{e.actionOption&&(e.actionOption.type==="select"?Me(n,ht(e.actionOption.value.value)):e.actionOption.type==="toggle"&&Me(n,ht(e.actionOption.value)))});var r=Gn(),i=qt(r);{var o=a=>{var s=My(),l=Ht(s);{var u=c=>{var p=wy(),m=qt(p),A=Ht(m),M=xi(m,2);M.__change=[xl,e,n],kr(M,21,()=>e.actionOption.choices,Er,(D,P)=>{var E=by(),B={},O=Ht(E);Ct(()=>{B!==(B=ee(P).value)&&(E.value=(E.__value=ee(P).value)==null?"":ee(P).value),Fn(O,ee(P).title)}),me(D,E)}),Ct(()=>{nn(m,"for",e.actionOption.name),Fn(A,e.actionOption.label),nn(M,"id",e.actionOption.name)}),ly(M,()=>ee(n),D=>Me(n,D)),me(c,p)},h=(c,p)=>{{var m=M=>{var D=Ey(),P=Ht(D);P.__change=[xl,e,n];var E=xi(P);Ct(B=>{nn(D,"for",e.actionOption.name),nn(P,"id",B),Fn(E,` ${e.actionOption.label??""}`)},[()=>String(e.actionOption.name)]),ay(P,()=>ee(n),B=>Me(n,B)),me(M,D)},A=M=>{var D=ky();me(M,D)};ft(c,M=>{e.actionOption.type==="toggle"&&typeof ee(n)=="boolean"?M(m):M(A,!1)},p)}};ft(l,c=>{e.actionOption.type==="select"?c(u):c(h,!1)})}me(a,s)};ft(i,a=>{e.actionOption&&a(o)})}me(t,r),Hn()}ns(["change"]);const Sy=(t,e)=>{if(t.preventDefault(),!e.actionInstance||!e.subAction){j.error("Can't run a SubAction",e.actionInstance,e.subAction);return}e.subAction.method()};var Ay=lt('<button type="submit" class="sub-action svelte-1x28ief"> </button>');function Ly(t,e){zn(e,!0);var n=Gn(),r=qt(n);{var i=o=>{var a=Ay();a.__click=[Sy,e];var s=Ht(a);Ct(()=>{nn(a,"title",e.subAction.label),Fn(s,e.subAction.label)}),me(o,a)};ft(r,o=>{e.subAction&&o(i)})}me(t,n),Hn()}ns(["click"]);var Cy=lt("<!> <!>",1);function Iy(t,e){zn(e,!0);const n=$a("gm"),r=e.control.type,i=e.control.targetMode;let o=Cc(null);r&&i&&Me(o,ht(n.actionInstances[`${r}__${i}`]||null));var a=Gn(),s=qt(a);{var l=u=>{var h=Cy(),c=qt(h);kr(c,17,()=>ee(o).options,Er,(m,A)=>{xy(m,{get actionInstance(){return ee(o)},get actionOption(){return ee(A)}})});var p=xi(c,2);kr(p,17,()=>ee(o).actions,Er,(m,A)=>{Ly(m,{get actionInstance(){return ee(o)},get subAction(){return ee(A)}})}),me(u,h)};ft(s,u=>{ee(o)&&u(l)})}me(t,a),Hn()}/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */const{entries:ed,setPrototypeOf:Sl,isFrozen:Dy,getPrototypeOf:Py,getOwnPropertyDescriptor:Fy}=Object;let{freeze:Te,seal:et,create:td}=Object,{apply:sa,construct:la}=typeof Reflect<"u"&&Reflect;Te||(Te=function(t){return t});et||(et=function(t){return t});sa||(sa=function(t,e,n){return t.apply(e,n)});la||(la=function(t,e){return new t(...e)});const Wr=_e(Array.prototype.forEach),Ty=_e(Array.prototype.lastIndexOf),Al=_e(Array.prototype.pop),Zn=_e(Array.prototype.push),_y=_e(Array.prototype.splice),li=_e(String.prototype.toLowerCase),xo=_e(String.prototype.toString),Ll=_e(String.prototype.match),$n=_e(String.prototype.replace),Oy=_e(String.prototype.indexOf),By=_e(String.prototype.trim),nt=_e(Object.prototype.hasOwnProperty),Ie=_e(RegExp.prototype.test),Kn=Ny(TypeError);function _e(t){return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return sa(t,e,r)}}function Ny(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return la(t,n)}}function Q(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:li;Sl&&Sl(t,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const o=n(i);o!==i&&(Dy(e)||(e[r]=o),i=o)}t[i]=!0}return t}function Gy(t){for(let e=0;e<t.length;e++)nt(t,e)||(t[e]=null);return t}function en(t){const e=td(null);for(const[n,r]of ed(t))nt(t,n)&&(Array.isArray(r)?e[n]=Gy(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=en(r):e[n]=r);return e}function Xn(t,e){for(;t!==null;){const r=Fy(t,e);if(r){if(r.get)return _e(r.get);if(typeof r.value=="function")return _e(r.value)}t=Py(t)}function n(){return null}return n}const Cl=Te(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),So=Te(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Ao=Te(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ry=Te(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Lo=Te(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),jy=Te(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Il=Te(["#text"]),Dl=Te(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Co=Te(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Pl=Te(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Zr=Te(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),zy=et(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Hy=et(/<%[\w\W]*|[\w\W]*%>/gm),Jy=et(/\$\{[\w\W]*/gm),Uy=et(/^data-[\-\w.\u00B7-\uFFFF]+$/),Vy=et(/^aria-[\-\w]+$/),nd=et(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),qy=et(/^(?:\w+script|data):/i),Yy=et(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),rd=et(/^html$/i),Wy=et(/^[a-z][.\w]*(-[.\w]+)+$/i);var Fl=Object.freeze({__proto__:null,ARIA_ATTR:Vy,ATTR_WHITESPACE:Yy,CUSTOM_ELEMENT:Wy,DATA_ATTR:Uy,DOCTYPE_NAME:rd,ERB_EXPR:Hy,IS_ALLOWED_URI:nd,IS_SCRIPT_OR_DATA:qy,MUSTACHE_EXPR:zy,TMPLIT_EXPR:Jy});const Qn={element:1,text:3,progressingInstruction:7,comment:8,document:9},Zy=function(){return typeof window>"u"?null:window},$y=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let n=null;const r="data-tt-policy-suffix";e&&e.hasAttribute(r)&&(n=e.getAttribute(r));const i="dompurify"+(n?"#"+n:"");try{return t.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},Tl=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function id(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zy();const e=w=>id(w);if(e.version="3.2.4",e.removed=[],!t||!t.document||t.document.nodeType!==Qn.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,i=r.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:s,Element:l,NodeFilter:u,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:c,DOMParser:p,trustedTypes:m}=t,A=l.prototype,M=Xn(A,"cloneNode"),D=Xn(A,"remove"),P=Xn(A,"nextSibling"),E=Xn(A,"childNodes"),B=Xn(A,"parentNode");if(typeof a=="function"){const w=n.createElement("template");w.content&&w.content.ownerDocument&&(n=w.content.ownerDocument)}let O,R="";const{implementation:G,createNodeIterator:J,createDocumentFragment:d,getElementsByTagName:f}=n,{importNode:g}=r;let v=Tl();e.isSupported=typeof ed=="function"&&typeof B=="function"&&G&&G.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:y,ERB_EXPR:S,TMPLIT_EXPR:F,DATA_ATTR:k,ARIA_ATTR:x,IS_SCRIPT_OR_DATA:T,ATTR_WHITESPACE:I,CUSTOM_ELEMENT:_}=Fl;let{IS_ALLOWED_URI:q}=Fl,H=null;const X=Q({},[...Cl,...So,...Ao,...Lo,...Il]);let Y=null;const K=Q({},[...Dl,...Co,...Pl,...Zr]);let U=Object.seal(td(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,te=null,bt=!0,wt=!0,Gt=!1,Ae=!0,Oe=!1,ve=!0,ue=!1,se=!1,no=!1,gn=!1,Br=!1,Nr=!1,as=!0,ss=!1;const Ed="user-content-";let ro=!0,qn=!1,mn={},vn=null;const ls=Q({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let us=null;const cs=Q({},["audio","video","img","source","image","track"]);let io=null;const ds=Q({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Gr="http://www.w3.org/1998/Math/MathML",Rr="http://www.w3.org/2000/svg",Et="http://www.w3.org/1999/xhtml";let yn=Et,oo=!1,ao=null;const kd=Q({},[Gr,Rr,Et],xo);let jr=Q({},["mi","mo","mn","ms","mtext"]),zr=Q({},["annotation-xml"]);const Md=Q({},["title","style","font","a","script"]);let Yn=null;const xd=["application/xhtml+xml","text/html"],Sd="text/html";let ye=null,bn=null;const Ad=n.createElement("form"),hs=function(w){return w instanceof RegExp||w instanceof Function},so=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(bn&&bn===w)){if((!w||typeof w!="object")&&(w={}),w=en(w),Yn=xd.indexOf(w.PARSER_MEDIA_TYPE)===-1?Sd:w.PARSER_MEDIA_TYPE,ye=Yn==="application/xhtml+xml"?xo:li,H=nt(w,"ALLOWED_TAGS")?Q({},w.ALLOWED_TAGS,ye):X,Y=nt(w,"ALLOWED_ATTR")?Q({},w.ALLOWED_ATTR,ye):K,ao=nt(w,"ALLOWED_NAMESPACES")?Q({},w.ALLOWED_NAMESPACES,xo):kd,io=nt(w,"ADD_URI_SAFE_ATTR")?Q(en(ds),w.ADD_URI_SAFE_ATTR,ye):ds,us=nt(w,"ADD_DATA_URI_TAGS")?Q(en(cs),w.ADD_DATA_URI_TAGS,ye):cs,vn=nt(w,"FORBID_CONTENTS")?Q({},w.FORBID_CONTENTS,ye):ls,Z=nt(w,"FORBID_TAGS")?Q({},w.FORBID_TAGS,ye):{},te=nt(w,"FORBID_ATTR")?Q({},w.FORBID_ATTR,ye):{},mn=nt(w,"USE_PROFILES")?w.USE_PROFILES:!1,bt=w.ALLOW_ARIA_ATTR!==!1,wt=w.ALLOW_DATA_ATTR!==!1,Gt=w.ALLOW_UNKNOWN_PROTOCOLS||!1,Ae=w.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Oe=w.SAFE_FOR_TEMPLATES||!1,ve=w.SAFE_FOR_XML!==!1,ue=w.WHOLE_DOCUMENT||!1,gn=w.RETURN_DOM||!1,Br=w.RETURN_DOM_FRAGMENT||!1,Nr=w.RETURN_TRUSTED_TYPE||!1,no=w.FORCE_BODY||!1,as=w.SANITIZE_DOM!==!1,ss=w.SANITIZE_NAMED_PROPS||!1,ro=w.KEEP_CONTENT!==!1,qn=w.IN_PLACE||!1,q=w.ALLOWED_URI_REGEXP||nd,yn=w.NAMESPACE||Et,jr=w.MATHML_TEXT_INTEGRATION_POINTS||jr,zr=w.HTML_INTEGRATION_POINTS||zr,U=w.CUSTOM_ELEMENT_HANDLING||{},w.CUSTOM_ELEMENT_HANDLING&&hs(w.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(U.tagNameCheck=w.CUSTOM_ELEMENT_HANDLING.tagNameCheck),w.CUSTOM_ELEMENT_HANDLING&&hs(w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(U.attributeNameCheck=w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),w.CUSTOM_ELEMENT_HANDLING&&typeof w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(U.allowCustomizedBuiltInElements=w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Oe&&(wt=!1),Br&&(gn=!0),mn&&(H=Q({},Il),Y=[],mn.html===!0&&(Q(H,Cl),Q(Y,Dl)),mn.svg===!0&&(Q(H,So),Q(Y,Co),Q(Y,Zr)),mn.svgFilters===!0&&(Q(H,Ao),Q(Y,Co),Q(Y,Zr)),mn.mathMl===!0&&(Q(H,Lo),Q(Y,Pl),Q(Y,Zr))),w.ADD_TAGS&&(H===X&&(H=en(H)),Q(H,w.ADD_TAGS,ye)),w.ADD_ATTR&&(Y===K&&(Y=en(Y)),Q(Y,w.ADD_ATTR,ye)),w.ADD_URI_SAFE_ATTR&&Q(io,w.ADD_URI_SAFE_ATTR,ye),w.FORBID_CONTENTS&&(vn===ls&&(vn=en(vn)),Q(vn,w.FORBID_CONTENTS,ye)),ro&&(H["#text"]=!0),ue&&Q(H,["html","head","body"]),H.table&&(Q(H,["tbody"]),delete Z.tbody),w.TRUSTED_TYPES_POLICY){if(typeof w.TRUSTED_TYPES_POLICY.createHTML!="function")throw Kn('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof w.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Kn('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');O=w.TRUSTED_TYPES_POLICY,R=O.createHTML("")}else O===void 0&&(O=$y(m,i)),O!==null&&typeof R=="string"&&(R=O.createHTML(""));Te&&Te(w),bn=w}},fs=Q({},[...So,...Ao,...Ry]),ps=Q({},[...Lo,...jy]),Ld=function(w){let V=B(w);(!V||!V.tagName)&&(V={namespaceURI:yn,tagName:"template"});const z=li(w.tagName),ne=li(V.tagName);return ao[w.namespaceURI]?w.namespaceURI===Rr?V.namespaceURI===Et?z==="svg":V.namespaceURI===Gr?z==="svg"&&(ne==="annotation-xml"||jr[ne]):!!fs[z]:w.namespaceURI===Gr?V.namespaceURI===Et?z==="math":V.namespaceURI===Rr?z==="math"&&zr[ne]:!!ps[z]:w.namespaceURI===Et?V.namespaceURI===Rr&&!zr[ne]||V.namespaceURI===Gr&&!jr[ne]?!1:!ps[z]&&(Md[z]||!fs[z]):!!(Yn==="application/xhtml+xml"&&ao[w.namespaceURI]):!1},$t=function(w){Zn(e.removed,{element:w});try{B(w).removeChild(w)}catch{D(w)}},Hr=function(w,V){try{Zn(e.removed,{attribute:V.getAttributeNode(w),from:V})}catch{Zn(e.removed,{attribute:null,from:V})}if(V.removeAttribute(w),w==="is")if(gn||Br)try{$t(V)}catch{}else try{V.setAttribute(w,"")}catch{}},gs=function(w){let V=null,z=null;if(no)w="<remove></remove>"+w;else{const pe=Ll(w,/^[\r\n\t ]+/);z=pe&&pe[0]}Yn==="application/xhtml+xml"&&yn===Et&&(w='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+w+"</body></html>");const ne=O?O.createHTML(w):w;if(yn===Et)try{V=new p().parseFromString(ne,Yn)}catch{}if(!V||!V.documentElement){V=G.createDocument(yn,"template",null);try{V.documentElement.innerHTML=oo?R:ne}catch{}}const Ee=V.body||V.documentElement;return w&&z&&Ee.insertBefore(n.createTextNode(z),Ee.childNodes[0]||null),yn===Et?f.call(V,ue?"html":"body")[0]:ue?V.documentElement:Ee},ms=function(w){return J.call(w.ownerDocument||w,w,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},lo=function(w){return w instanceof c&&(typeof w.nodeName!="string"||typeof w.textContent!="string"||typeof w.removeChild!="function"||!(w.attributes instanceof h)||typeof w.removeAttribute!="function"||typeof w.setAttribute!="function"||typeof w.namespaceURI!="string"||typeof w.insertBefore!="function"||typeof w.hasChildNodes!="function")},vs=function(w){return typeof s=="function"&&w instanceof s};function kt(w,V,z){Wr(w,ne=>{ne.call(e,V,z,bn)})}const ys=function(w){let V=null;if(kt(v.beforeSanitizeElements,w,null),lo(w))return $t(w),!0;const z=ye(w.nodeName);if(kt(v.uponSanitizeElement,w,{tagName:z,allowedTags:H}),w.hasChildNodes()&&!vs(w.firstElementChild)&&Ie(/<[/\w]/g,w.innerHTML)&&Ie(/<[/\w]/g,w.textContent)||w.nodeType===Qn.progressingInstruction||ve&&w.nodeType===Qn.comment&&Ie(/<[/\w]/g,w.data))return $t(w),!0;if(!H[z]||Z[z]){if(!Z[z]&&ws(z)&&(U.tagNameCheck instanceof RegExp&&Ie(U.tagNameCheck,z)||U.tagNameCheck instanceof Function&&U.tagNameCheck(z)))return!1;if(ro&&!vn[z]){const ne=B(w)||w.parentNode,Ee=E(w)||w.childNodes;if(Ee&&ne){const pe=Ee.length;for(let Mt=pe-1;Mt>=0;--Mt){const qe=M(Ee[Mt],!0);qe.__removalCount=(w.__removalCount||0)+1,ne.insertBefore(qe,P(w))}}}return $t(w),!0}return w instanceof l&&!Ld(w)||(z==="noscript"||z==="noembed"||z==="noframes")&&Ie(/<\/no(script|embed|frames)/i,w.innerHTML)?($t(w),!0):(Oe&&w.nodeType===Qn.text&&(V=w.textContent,Wr([y,S,F],ne=>{V=$n(V,ne," ")}),w.textContent!==V&&(Zn(e.removed,{element:w.cloneNode()}),w.textContent=V)),kt(v.afterSanitizeElements,w,null),!1)},bs=function(w,V,z){if(as&&(V==="id"||V==="name")&&(z in n||z in Ad))return!1;if(!(wt&&!te[V]&&Ie(k,V))&&!(bt&&Ie(x,V))){if(!Y[V]||te[V]){if(!(ws(w)&&(U.tagNameCheck instanceof RegExp&&Ie(U.tagNameCheck,w)||U.tagNameCheck instanceof Function&&U.tagNameCheck(w))&&(U.attributeNameCheck instanceof RegExp&&Ie(U.attributeNameCheck,V)||U.attributeNameCheck instanceof Function&&U.attributeNameCheck(V))||V==="is"&&U.allowCustomizedBuiltInElements&&(U.tagNameCheck instanceof RegExp&&Ie(U.tagNameCheck,z)||U.tagNameCheck instanceof Function&&U.tagNameCheck(z))))return!1}else if(!io[V]&&!Ie(q,$n(z,I,""))&&!((V==="src"||V==="xlink:href"||V==="href")&&w!=="script"&&Oy(z,"data:")===0&&us[w])&&!(Gt&&!Ie(T,$n(z,I,"")))&&z)return!1}return!0},ws=function(w){return w!=="annotation-xml"&&Ll(w,_)},Es=function(w){kt(v.beforeSanitizeAttributes,w,null);const{attributes:V}=w;if(!V||lo(w))return;const z={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Y,forceKeepAttr:void 0};let ne=V.length;for(;ne--;){const Ee=V[ne],{name:pe,namespaceURI:Mt,value:qe}=Ee,ut=ye(pe);let Le=pe==="value"?qe:By(qe);if(z.attrName=ut,z.attrValue=Le,z.keepAttr=!0,z.forceKeepAttr=void 0,kt(v.uponSanitizeAttribute,w,z),Le=z.attrValue,ss&&(ut==="id"||ut==="name")&&(Hr(pe,w),Le=Ed+Le),ve&&Ie(/((--!?|])>)|<\/(style|title)/i,Le)){Hr(pe,w);continue}if(z.forceKeepAttr||(Hr(pe,w),!z.keepAttr))continue;if(!Ae&&Ie(/\/>/i,Le)){Hr(pe,w);continue}Oe&&Wr([y,S,F],Id=>{Le=$n(Le,Id," ")});const ks=ye(w.nodeName);if(bs(ks,ut,Le)){if(O&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!Mt)switch(m.getAttributeType(ks,ut)){case"TrustedHTML":{Le=O.createHTML(Le);break}case"TrustedScriptURL":{Le=O.createScriptURL(Le);break}}try{Mt?w.setAttributeNS(Mt,pe,Le):w.setAttribute(pe,Le),lo(w)?$t(w):Al(e.removed)}catch{}}}kt(v.afterSanitizeAttributes,w,null)},Cd=function w(V){let z=null;const ne=ms(V);for(kt(v.beforeSanitizeShadowDOM,V,null);z=ne.nextNode();)kt(v.uponSanitizeShadowNode,z,null),ys(z),Es(z),z.content instanceof o&&w(z.content);kt(v.afterSanitizeShadowDOM,V,null)};return e.sanitize=function(w){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=null,ne=null,Ee=null,pe=null;if(oo=!w,oo&&(w="<!-->"),typeof w!="string"&&!vs(w))if(typeof w.toString=="function"){if(w=w.toString(),typeof w!="string")throw Kn("dirty is not a string, aborting")}else throw Kn("toString is not a function");if(!e.isSupported)return w;if(se||so(V),e.removed=[],typeof w=="string"&&(qn=!1),qn){if(w.nodeName){const ut=ye(w.nodeName);if(!H[ut]||Z[ut])throw Kn("root node is forbidden and cannot be sanitized in-place")}}else if(w instanceof s)z=gs("<!---->"),ne=z.ownerDocument.importNode(w,!0),ne.nodeType===Qn.element&&ne.nodeName==="BODY"||ne.nodeName==="HTML"?z=ne:z.appendChild(ne);else{if(!gn&&!Oe&&!ue&&w.indexOf("<")===-1)return O&&Nr?O.createHTML(w):w;if(z=gs(w),!z)return gn?null:Nr?R:""}z&&no&&$t(z.firstChild);const Mt=ms(qn?w:z);for(;Ee=Mt.nextNode();)ys(Ee),Es(Ee),Ee.content instanceof o&&Cd(Ee.content);if(qn)return w;if(gn){if(Br)for(pe=d.call(z.ownerDocument);z.firstChild;)pe.appendChild(z.firstChild);else pe=z;return(Y.shadowroot||Y.shadowrootmode)&&(pe=g.call(r,pe,!0)),pe}let qe=ue?z.outerHTML:z.innerHTML;return ue&&H["!doctype"]&&z.ownerDocument&&z.ownerDocument.doctype&&z.ownerDocument.doctype.name&&Ie(rd,z.ownerDocument.doctype.name)&&(qe="<!DOCTYPE "+z.ownerDocument.doctype.name+`>
`+qe),Oe&&Wr([y,S,F],ut=>{qe=$n(qe,ut," ")}),O&&Nr?O.createHTML(qe):qe},e.setConfig=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};so(w),se=!0},e.clearConfig=function(){bn=null,se=!1},e.isValidAttribute=function(w,V,z){bn||so({});const ne=ye(w),Ee=ye(V);return bs(ne,Ee,z)},e.addHook=function(w,V){typeof V=="function"&&Zn(v[w],V)},e.removeHook=function(w,V){if(V!==void 0){const z=Ty(v[w],V);return z===-1?void 0:_y(v[w],z,1)[0]}return Al(v[w])},e.removeHooks=function(w){v[w]=[]},e.removeAllHooks=function(){v=Tl()},e}var Ky=id();const Xy=(t,e,n)=>{e.control&&e.controlOptions?n.options.toggleMode(e.control.type,e.control.targetMode):j.error("Control or controlOptions not defined",e.control,e.controlOptions)};var Qy=lt("<div><!></div>"),e2=lt('<div class="control-container svelte-1rd72r"><button type="button"><!></button> <!></div>');function t2(t,e){var n;zn(e,!0);const r=(n=e.controlOptions)!=null&&n.icon?Ky.sanitize(e.controlOptions.icon.trim()):null,i=$a("gm"),o=i.control.getDefaultPosition();var a=Gn(),s=qt(a);{var l=u=>{var h=e2(),c=Ht(h);let p;c.__click=[Xy,e,i];var m=Ht(c);{var A=E=>{var B=Gn(),O=qt(B);ry(O,()=>r),me(E,B)},M=(E,B)=>{{var O=G=>{var J=bl();Ct(d=>Fn(J,d),[()=>e.controlOptions.title.slice(0,2)]),me(G,J)},R=G=>{var J=bl();Ct(()=>Fn(J,e.control.targetMode)),me(G,J)};ft(E,G=>{e.controlOptions.title?G(O):G(R,!1)},B)}};ft(m,E=>{e.controlOptions.icon?E(A):E(M,!1)})}var D=xi(c,2);{var P=E=>{var B=Qy();let O;var R=Ht(B);Iy(R,{get control(){return e.control}}),Ct((G,J)=>O=ia(B,1,"control-menu svelte-1rd72r",null,O,{"menu-right":G,"menu-left":J}),[()=>o.endsWith("left"),()=>o.endsWith("right")]),me(E,B)};ft(D,E=>{e.controlOptions.active&&E(P)})}Ct(()=>{nn(c,"id",`id_${e.control.type}_${e.control.targetMode}`),p=ia(c,1,`gm-control-button ${e.control.type}-${e.control.targetMode}`,"svelte-1rd72r",p,{active:e.controlOptions.active}),nn(c,"title",e.controlOptions.title)}),me(u,h)};ft(s,u=>{e.control&&e.controlOptions&&e.controlOptions.uiEnabled&&u(l)})}me(t,a),Hn()}ns(["click"]);var n2=lt("<div></div>"),r2=lt('<div class="gm-reactive-controls svelte-16ufo3a"></div>');function i2(t,e){zn(e,!1);const[n,r]=hy();let i=dy(aa,"$controlsStore",n),o=i.controls,a=M1(i.options);const s=`${$a("gm").mapAdapter.mapType}gl`,l=aa.subscribe(c=>{o=c.controls,Me(a,c.options)});fy(l);const u=(c,p)=>{const m=o==null?void 0:o[c];return(m==null?void 0:m[p])||null};cy();var h=r2();kr(h,5,()=>Object.entries(ee(a)),Er,(c,p)=>{let m=()=>ee(p)[0],A=()=>ee(p)[1];var M=n2();kr(M,5,()=>Object.entries(A()),Er,(D,P)=>{let E=()=>ee(P)[0],B=()=>ee(P)[1];var O=Gn();const R=Pc(()=>u(m(),E()));var G=qt(O);{var J=d=>{t2(d,{get control(){return ee(R)},get controlOptions(){return B()}})};ft(G,d=>{ee(R)&&d(J)})}me(D,O)}),Ct(()=>ia(M,1,`${s}-ctrl ${s}-ctrl-group group-${m()}`,"svelte-16ufo3a")),me(c,M)}),me(t,h),Hn(),r()}class o2{constructor(e){b(this,"gm"),this.gm=e}}class a2 extends o2{constructor(){super(...arguments),b(this,"controls",Qe(cu)),b(this,"reactiveControls",null),b(this,"container"),b(this,"mapEventHandlers",{[`${W}:draw`]:this.handleModeEvent.bind(this),[`${W}:edit`]:this.handleModeEvent.bind(this),[`${W}:helper`]:this.handleModeEvent.bind(this)})}onAdd(){if(this.createControls(),this.gm.events.bus.attachEvents(this.mapEventHandlers),!this.container)throw new Error("Controls container is not initialized");return this.container}createControls(e=void 0){if(this.controlsAdded()){j.warn("Can't add controls: controls already added");return}this.container=e||this.createHtmlContainer(),this.createReactivePanel()}onRemove(){this.gm.events.bus.detachEvents(this.mapEventHandlers),this.reactiveControls&&(X1(this.reactiveControls),this.reactiveControls=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=void 0}handleModeEvent(e){return Na(e)?(["mode_started","mode_ended"].includes(e.action)&&this.updateReactivePanel(),{next:!0}):{next:!0}}controlsAdded(){return!!this.reactiveControls}createReactivePanel(){if(!this.container){j.error("Can't create reactive panel: container is not initialized");return}this.syncModeStates();const e=new Map;e.set("gm",this.gm),this.reactiveControls=$1(i2,{target:this.container,context:e}),this.updateReactivePanel()}updateReactivePanel(){aa.update(()=>({controls:this.controls,options:this.gm.options.controls}))}createHtmlContainer(){const e=document.createElement("div");return e.classList.add("geoman-controls"),e}syncModeStates(){this.eachControlWithOptions(({control:e})=>{this.gm.options.syncModeState(e.type,e.targetMode)})}eachControlWithOptions(e){return Ge(this.controls).forEach(n=>{const r=this.controls[n];return Object.keys(r).forEach(i=>{const o=i,a=this.getControl({actionType:n,modeName:o}),s=this.gm.options.getControlOptions({actionType:n,modeName:o});a&&s?e({control:a,controlOptions:s}):j.error("Can't find control/controlOptions for",n,o)})})}getControl({actionType:e,modeName:n}){return e&&n&&this.controls[e][n]||null}getDefaultPosition(){return this.gm.options.settings.controlsPosition}}const s2=`_${W}`;class l2{constructor(e){b(this,"gm"),b(this,"globalEventsListener",null),this.gm=e}get map(){return this.gm.mapAdapter.getMapInstance()}processEvent(e,n){this.fireToMap("system",e.split(":")[1],{...n,level:"user"}),n.action==="mode_start"||n.action==="mode_end"?this.forwardModeToggledEvent(n):n.action==="feature_created"?this.forwardFeatureCreated(n):n.action==="feature_removed"?this.forwardFeatureRemoved(n):n.action==="feature_updated"?this.forwardFeatureUpdated(n):n.action==="feature_edit_start"?this.forwardFeatureEditStart(n):n.action==="feature_edit_end"?this.forwardFeatureEditEnd(n):(n.action==="loaded"||n.action==="unloaded")&&this.forwardGeomanLoaded(n)}forwardModeToggledEvent(e){const n=e.action==="mode_start";let r;if(e.type==="draw")r={enabled:n,shape:e.mode,map:this.map},this.fireToMap("converted","globaldrawmodetoggled",r),r={shape:e.mode,map:this.map},this.fireToMap("converted",n?"drawstart":"drawend",r);else if(e.type==="edit"){const i=this.getConvertedEditModeName(e.mode);r={enabled:n,map:this.map},this.fireToMap("converted",`global${i}modetoggled`,r)}else e.type==="helper"&&(r={enabled:n,map:this.map},this.fireToMap("converted",`global${e.mode}modetoggled`,r))}forwardFeatureCreated(e){const n={shape:e.mode,feature:e.featureData,map:this.map};this.fireToMap("converted","create",n)}forwardFeatureRemoved(e){const n={shape:e.mode,feature:e.featureData,map:this.map};this.fireToMap("converted","remove",n)}forwardFeatureUpdated(e){const n=["lasso"],r={map:this.map};e.sourceFeatures.length===1&&!n.includes(e.mode)?r.originalFeature=e.sourceFeatures[0]:r.originalFeatures=e.sourceFeatures,e.targetFeatures.length===1&&!n.includes(e.mode)?(r.feature=e.targetFeatures[0],r.shape=r.feature.shape):r.features=e.targetFeatures;const i=this.getConvertedEditModeName(e.mode);this.fireToMap("converted",`${i}`,r)}forwardFeatureEditStart(e){const n=this.getConvertedEditModeName(e.mode),r={shape:e.feature.shape,feature:e.feature,map:this.map};this.fireToMap("converted",`${n}start`,r)}forwardFeatureEditEnd(e){const n=this.getConvertedEditModeName(e.mode),r={shape:e.feature.shape,feature:e.feature,map:this.map};this.fireToMap("converted",`${n}end`,r)}forwardGeomanLoaded(e){this.fireToMap("converted",`${e.action}`,{map:this.map,[W]:this.gm})}fireToMap(e,n,r){const i=`${e==="system"?s2:W}:${n}`;this.globalEventsListener&&this.globalEventsListener({type:e,name:i,payload:r}),this.gm.mapAdapter.fire(i,r)}getConvertedEditModeName(e){return e==="change"?"edit":e}}class u2{constructor(e){b(this,"gm"),b(this,"forwarder"),b(this,"mapEventHandlers",{}),b(this,"gmEventHandlers",{}),this.gm=e,this.forwarder=new l2(e)}fireEvent(e,n){const r=this.gmEventHandlers[e];if(!r)return;const{controlHandler:i}=r;i(n),this.forwarder.processEvent(e,n)}attachEvents(e){Ge(e).forEach(n=>{const r=e[n];r&&this.on(n,r)})}detachEvents(e){Ge(e).forEach(n=>{const r=e[n];r&&this.off(n,r)})}on(e,n){e.startsWith(W)?this.onGmEvent(e,n):this.onMapEvent(e,n)}onGmEvent(e,n){var r;this.gmEventHandlers[e]||(this.gmEventHandlers[e]=this.createEventSection(e)),(r=this.gmEventHandlers[e])==null||r.handlers.unshift(n)}onMapEvent(e,n){var r;if(!this.mapEventHandlers[e]){const i=this.createEventSection(e);this.gm.mapAdapter.on(e,i.controlHandler),this.mapEventHandlers[e]=i}(r=this.mapEventHandlers[e])==null||r.handlers.unshift(n)}off(e,n){e.startsWith(`${W}`)?this.offGmEvent(e,n):this.offMapEvent(e,n)}offGmEvent(e,n){var r;const i=((r=this.gmEventHandlers[e])==null?void 0:r.handlers)||[],o=i.findIndex(a=>n===a);o===-1?j.warn("MapEvents: handler not found",e,n):(i.splice(o,1),i.length===0&&delete this.gmEventHandlers[e])}offMapEvent(e,n){var r,i;const o=((r=this.mapEventHandlers[e])==null?void 0:r.handlers)||[],a=o.findIndex(s=>n===s);if(a===-1)j.warn("MapEvents: handler not found",e,n);else if(o.splice(a,1),o.length===0){const s=(i=this.mapEventHandlers[e])==null?void 0:i.controlHandler;s&&this.gm.mapAdapter.off(e,s),delete this.mapEventHandlers[e]}}createEventSection(e){return{handlers:[],controlHandler:n=>{let r;if(fn(n)&&e.startsWith(`${W}`)?r=this.gmEventHandlers[e]:r=this.mapEventHandlers[e],!r){j.debug(`No handlers for eventName: "${e}"`);return}r.handlers.some(i=>{let o;return o=i(n),o&&typeof o=="object"&&"next"in o?!o.next:(j.error('EventsBus: handler should return an object with a "next" property'),!1)})}}}}class c2 extends Ui{constructor(e,n){super(e),b(this,"mapEventHandlers",{[`${W}:control`]:this.handleControlEvent.bind(this)}),n.attachEvents(this.mapEventHandlers)}handleControlEvent(e){return sc(e)?(this.getControl(e)||j.error("Control not found, event payload",e),{next:!0}):{next:!0}}}class od extends Ot{constructor(){super(...arguments),b(this,"mode","circle"),b(this,"shape","circle"),b(this,"circleCenterPoint",null),b(this,"circleCenterLngLat",null),b(this,"mapEventHandlers",{mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)})}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.gm.markerPointer.disable(),this.fireFinishEvent()}createFeature(){const e=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(this.circleCenterLngLat||[0,0]),sourceName:N.temporary});return e&&this.circleCenterLngLat&&e.setShapeProperty("center",this.circleCenterLngLat),e}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}createMarker(){const e=document.createElement("div");e.innerHTML=du;const n=e.firstChild;return n.style.color="#278cda",n.style.width="28px",n.style.height="28px",n.style.pointerEvents="none",this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"center",element:n},[0,0])}getControlMarkerData(){const e=this.gm.markerPointer.marker;return e?{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}}:null}fireStartEvent(e,n){const r={level:"system",type:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:n};this.gm.events.fire(`${W}:draw`,r)}fireUpdateEvent(e,n){const r={level:"system",type:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:n};this.gm.events.fire(`${W}:draw`,r)}fireFinishEvent(){const e={level:"system",type:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${W}:draw`,e)}}class d2 extends od{constructor(){super(...arguments),b(this,"mode","circle_marker"),b(this,"shape","circle_marker")}onStartAction(){this.gm.markerPointer.enable({customMarker:this.createMarker()})}onEndAction(){this.fireMarkerPointerFinishEvent(),super.onEndAction()}onMouseMove(){return this.fireMarkerPointerUpdateEvent(),{next:!0}}onMouseClick(e){var n;const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray();return this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(),this.circleCenterLngLat=r,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.updateFeaturePosition(this.circleCenterLngLat),this.saveFeature()),{next:!1}}updateFeaturePosition(e){if(!this.featureData)return;const n=this.getFeatureGeoJson(e);this.featureData.updateGeoJsonGeometry(n.geometry)}}const h2=()=>"ontouchstart"in window||navigator.maxTouchPoints>0||matchMedia("(hover: none)").matches?!0:"msMaxTouchPoints"in navigator&&typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0,Un=(t,e,n=10)=>{const r={...t};return Ge(t).forEach(i=>{const o=t[i];typeof o=="function"?r[i]=Zu(o.bind(e),n,{leading:!0,trailing:!1}):j.error("convertToThrottled: item is not a function",t[i])}),r},f2=(t,e,n=10)=>{const r={...t};return Ge(t).forEach(i=>{const o=t[i];typeof o=="function"?r[i]=Ta(o.bind(e),n,{leading:!1,trailing:!0}):j.error("convertToDebounced: item is not a function",t[i])}),r};class p2 extends od{constructor(){super(...arguments),b(this,"mode","circle"),b(this,"shape","circle"),b(this,"throttledMethods",Un({updateFeatureGeoJson:this.updateFeatureGeoJson},this,this.gm.options.settings.throttlingDelay))}onMouseClick(e){var n;if(!we(e))return{next:!0};const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray();if(this.circleCenterPoint&&this.circleCenterLngLat)this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,r)]}),this.flags.featureCreateAllowed&&(this.saveCircleFeature(r),this.circleCenterLngLat=null,this.circleCenterPoint=null,this.fireFinishEvent());else if(this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed){this.circleCenterLngLat=r,this.circleCenterPoint=this.gm.mapAdapter.project(this.circleCenterLngLat),this.featureData=this.createFeature();const i=this.getControlMarkerData();this.featureData&&i&&this.fireStartEvent(this.featureData,i)}return{next:!1}}onMouseMove(){if(this.circleCenterLngLat&&this.gm.markerPointer.marker){const e=this.gm.markerPointer.marker.getLngLat();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getCircleGeoJson(this.circleCenterLngLat,e)]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeatureGeoJson(e)}return this.circleCenterPoint||this.fireMarkerPointerUpdateEvent(),{next:!1}}updateFeatureGeoJson(e){if(this.featureData&&this.circleCenterLngLat){const n=this.getCircleGeoJson(this.circleCenterLngLat,e);this.featureData.updateGeoJsonGeometry(n.geometry);const r=this.getControlMarkerData();r&&this.fireUpdateEvent(this.featureData,r)}}saveCircleFeature(e){var n;if(this.circleCenterLngLat&&this.featureData){const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e;this.updateFeatureGeoJson(r),this.featureData.setShapeProperty("center",this.circleCenterLngLat),this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()}}isFeatureGeoJsonValid(){return this.featureData?rc(this.featureData.getGeoJson()):!1}getCircleGeoJson(e,n){const r=this.gm.mapAdapter.getDistance(e,n);return{...Ba({center:e,radius:r}),properties:{shape:this.shape}}}}function g2(t,e,{ignoreSelfIntersections:n=!0}={ignoreSelfIntersections:!0}){let r=!0;return Vt(t,i=>{Vt(e,o=>{if(r===!1)return!1;r=m2(i.geometry,o.geometry,n)})}),r}function m2(t,e,n){switch(t.type){case"Point":switch(e.type){case"Point":return!w2(t.coordinates,e.coordinates);case"LineString":return!_l(e,t);case"Polygon":return!un(t,e)}break;case"LineString":switch(e.type){case"Point":return!_l(t,e);case"LineString":return!v2(t,e,n);case"Polygon":return!Ol(e,t,n)}break;case"Polygon":switch(e.type){case"Point":return!un(e,t);case"LineString":return!Ol(t,e,n);case"Polygon":return!y2(e,t,n)}}return!1}function _l(t,e){for(let n=0;n<t.coordinates.length-1;n++)if(b2(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function v2(t,e,n){return Dr(t,e,{ignoreSelfIntersections:n}).features.length>0}function Ol(t,e,n){for(const r of e.coordinates)if(un(r,t))return!0;return Dr(e,Ro(t),{ignoreSelfIntersections:n}).features.length>0}function y2(t,e,n){for(const r of t.coordinates[0])if(un(r,e))return!0;for(const r of e.coordinates[0])if(un(r,t))return!0;return Dr(Ro(t),Ro(e),{ignoreSelfIntersections:n}).features.length>0}function b2(t,e,n){const r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1];return r*a-i*o!==0?!1:Math.abs(o)>=Math.abs(a)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}function w2(t,e){return t[0]===e[0]&&t[1]===e[1]}function E2(t,e,n={}){let r;return n.final?r=Bl(ge(e),ge(t)):r=Bl(ge(t),ge(e)),r>180?-(360-r):r}function Bl(t,e){const n=be(t[1]),r=be(e[1]);let i=be(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);const o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),a=Math.atan2(i,o);return(Tn(a)+360)%360}function k2(t,e,n={}){const r=ge(t),i=ge(e);i[0]+=i[0]-r[0]>180?-360:r[0]-i[0]>180?360:0;const o=M2(r,i);return mu(o,"meters",n.units)}function M2(t,e,n){n=n===void 0?ke:Number(n);const r=n,i=t[1]*Math.PI/180,o=e[1]*Math.PI/180,a=o-i;let s=Math.abs(e[0]-t[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);const l=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),u=Math.abs(l)>1e-11?a/l:Math.cos(i);return Math.sqrt(a*a+u*u*s*s)*r}function x2(t,e,n,r={}){const i=e<0;let o=mu(Math.abs(e),r.units,"meters");i&&(o=-Math.abs(o));const a=ge(t),s=S2(a,o,n);return s[0]+=s[0]-a[0]>180?-360:a[0]-s[0]>180?360:0,zt(s,r.properties)}function S2(t,e,n,r){r=r===void 0?ke:Number(r);const i=e/r,o=t[0]*Math.PI/180,a=be(t[1]),s=be(n),l=i*Math.cos(s);let u=a+l;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);const h=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),c=Math.abs(h)>1e-11?l/h:Math.cos(a),p=i*Math.sin(s)/c;return[((o+p)*180/Math.PI+540)%360-180,u*180/Math.PI]}const ad=["drag","change","rotate","scale","copy","cut","split","union","difference","line_simplification","lasso","delete"];class Or extends Ga{constructor(){super(...arguments),b(this,"actionType","edit"),b(this,"featureData",null),b(this,"cursorExcludedLayerIds",["rectangle-line","polygon-line","circle-line"]),b(this,"layerEventHandlersData",[])}startAction(){this.setEventsForLayers("mouseenter",this.setCursorToPointer.bind(this)),this.setEventsForLayers("mouseleave",this.setCursorToEmpty.bind(this)),super.startAction()}endAction(){this.clearEventsForLayers(),super.endAction()}setCursorToPointer(){this.gm.mapAdapter.setCursor("pointer")}setCursorToEmpty(){this.gm.mapAdapter.setCursor("")}setEventsForLayers(e,n){this.gm.features.layers.map(r=>r.id).filter(r=>!this.cursorExcludedLayerIds.some(i=>r.includes(i))).forEach(r=>{this.gm.mapAdapter.on(e,r,n),this.layerEventHandlersData.push({eventName:e,layerId:r,callback:n})})}clearEventsForLayers(){this.layerEventHandlersData.forEach(({eventName:e,layerId:n,callback:r})=>{this.gm.mapAdapter.off(e,n,r)}),this.layerEventHandlersData=[]}updateFeatureGeoJson({featureData:e,featureGeoJson:n,forceMode:r=void 0}){return this.flags.featureUpdateAllowed?(e.shape==="circle"&&n.properties.center&&e.setShapeProperty("center",n.properties.center),e.updateGeoJsonGeometry(n.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:[e],forceMode:r}),!0):!1}fireFeatureUpdatedEvent({sourceFeatures:e,targetFeatures:n,markerData:r=void 0,forceMode:i=void 0}){const o={level:"system",type:"edit",action:"feature_updated",mode:i||this.mode,sourceFeatures:e,targetFeatures:n,markerData:r||null};this.gm.events.fire(`${W}:edit`,o)}fireFeatureEditStartEvent({feature:e,forceMode:n=void 0}){const r={level:"system",type:"edit",action:"feature_edit_start",mode:n||this.mode,feature:e};this.gm.events.fire(`${W}:edit`,r)}fireFeatureEditEndEvent({feature:e,forceMode:n=void 0}){const r={level:"system",type:"edit",action:"feature_edit_end",mode:n||this.mode,feature:e};this.gm.events.fire(`${W}:edit`,r)}fireMarkerPointerUpdateEvent(){if(!this.gm.markerPointer.marker)return;const e=this.gm.markerPointer.marker,n={level:"system",variant:null,type:"draw",mode:this.getLineDrawerMode(),action:"update",markerData:{type:"dom",instance:e,position:{coordinate:e.getLngLat(),path:[-1]}},featureData:null};this.gm.events.fire(`${W}:draw`,n)}forwardLineDrawerEvent(e){if(!lc(e)||!["cut","split"].includes(this.mode))return{next:!0};if(e.action==="start"||e.action==="update"){const n={level:"system",type:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action,featureData:e.featureData,markerData:e.markerData};this.gm.events.fire(`${W}:draw`,n)}else if(e.action==="finish"||e.action==="cancel"){const n={level:"system",type:"draw",mode:this.getLineDrawerMode(),variant:null,action:e.action};this.gm.events.fire(`${W}:draw`,n)}return{next:!0}}fireFeatureRemovedEvent(e){if(rn(e.shape,bi)){const n={level:"system",type:"edit",mode:e.shape,action:"feature_removed",featureData:e};this.gm.events.fire(`${W}:edit`,n)}}getLineDrawerMode(){return this.mode==="cut"?"polygon":(this.mode,"line")}}const sd=["shape_markers","pin","snapping","snap_guides","measurements","auto_trace","geofencing","zoom_to_features","click_to_edit"];class pn extends Ga{constructor(){super(...arguments),b(this,"actionType","helper")}}const Vn=t=>fn(t)&&t.type==="edit",A2=t=>yv.includes(t),L2=t=>uc.includes(t),C2=t=>ad.includes(t),I2=t=>sd.includes(t),D2=t=>L2(t)||C2(t)||I2(t),ua=(t,e)=>(t%e+e)%e;class ld extends pn{constructor(){super(...arguments),b(this,"mode","snap_guides"),b(this,"features",new Map),b(this,"mapEventHandlers",{})}onStartAction(){}onEndAction(){this.removeSnapGuides()}updateSnapGuides(e,n,r=!1){var i;const o=new Set(this.features.keys());e&&n&&this.getSnapGuidesLines(e,n,r).forEach(a=>{const s=JSON.stringify(a);if(this.features.has(s)){o.delete(s);return}const l=[this.createGuideLine(a,{orthogonal:!1}),this.createGuideLine(a,{orthogonal:!0})].filter(u=>u!==null);l.length&&this.features.set(s,l)}),o.forEach(a=>this.removeSnapGuide(a)),(i=this.snappingHelper)==null||i.setCustomSnappingCoordinates(this.mode,this.getGuideLinesIntersections())}removeSnapGuides(){this.features.forEach(e=>{e.forEach(n=>{var r;(r=this.snappingHelper)==null||r.removeCustomSnappingFeature(n.featureData),this.gm.features.delete(n.featureData)})}),this.features.clear()}removeSnapGuide(e){const n=this.features.get(e);n==null||n.forEach(r=>{var i;(i=this.snappingHelper)==null||i.removeCustomSnappingFeature(r.featureData),this.gm.features.delete(r.featureData)}),this.features.delete(e)}getGuideLinesIntersections(){const e=[],n=Array.from(this.features.values()).flat().map(r=>r.lineLngLats).map(r=>r.map(i=>this.gm.mapAdapter.project(i)));for(let r=0;r<n.length;r+=1)for(let i=r+1;i<n.length;i+=1)if(n[r].length===2||n[i].length===2){const o=this.getLinesIntersection(n[r],n[i]);if(o){const a=this.gm.mapAdapter.unproject(o);ov(this.gm.globalLngLatBounds,a)&&e.push(a)}}return Yo(e,Lr)}getSnapGuidesLines(e,n,r=!1){const i=[],o=Qu(e,n);if(!o)return j.error("getSnapGuidesCoordsForLine: position not found"),[];const a=o.path.slice(0,-1),s=Qe(ln(e,a,[]));s.length>2&&dr(s[0],s.at(-1))&&s.pop();const l=o.path.at(-1),u=ua(l+1,s.length),h=ua(l-1,s.length);if(s.length===1){const c=s[h];return i.push([c,[c[0]+.1,c[1]]]),i}return l===s.length-1?(i.push([s[0],s[1]]),r?i.push([s[l],s[l-1]]):s.length>2&&i.push([s[l-1],s[l-2]]),i):(i.push([s[h],s[l]]),h!==u&&i.push([s[u],s[l]]),i)}createGuideLine(e,{orthogonal:n}){if(dr(e[0],e[1]))return null;const r=this.getGuideLineLngLats(e,{orthogonal:n});if(!r)return null;const i=this.createGuideLineFeature(r);return i?{lineLngLats:[r[0],r[1]],featureData:i}:null}getGuideLineLngLats(e,{orthogonal:n}){const r=this.gm.mapAdapter.project(e[0]),i=this.gm.mapAdapter.project(e[1]);let o=[r,i];n&&(o=this.rotateLine90Degrees(o));const a=this.getLineBoundsCoordinates(o);return a?a.map(s=>this.gm.mapAdapter.unproject(s)):null}createGuideLineFeature(e){var n;const r=this.gm.features.createFeature({shapeGeoJson:this.getLineGeoJson(e),sourceName:N.temporary});return r?((n=this.snappingHelper)==null||n.addCustomSnappingFeature(r),r):null}getLineGeoJson(e){return{type:"Feature",properties:{shape:"snap_guide"},geometry:{type:"LineString",coordinates:e}}}rotateLine90Degrees(e){const[n,r]=e,i=[r[0]-n[0],r[1]-n[1]],o=[-i[1],i[0]],a=[o[0]+n[0],o[1]+n[1]];return[n,a]}getLineBoundsCoordinates(e){const n=this.getGlobalPlanarBounds(),r=[{coordIndex:0,boundsLine:[n.leftTop,n.rightTop]},{coordIndex:1,boundsLine:[n.rightTop,n.rightBottom]},{coordIndex:0,boundsLine:[n.leftBottom,n.rightBottom]},{coordIndex:1,boundsLine:[n.leftTop,n.leftBottom]}].map(i=>{const{coordIndex:o,boundsLine:a}=i,s=this.getLinesIntersection(e,i.boundsLine);return s&&s[o]>=a[0][o]&&s[o]<=a[1][o]?s:null}).filter(i=>i!==null);return r.length!==2?null:r}getGlobalPlanarBounds(){const e=nc(this.gm.globalLngLatBounds),n=this.gm.mapAdapter.project([e[0],e[3]]),r=this.gm.mapAdapter.project([e[2],e[3]]),i=this.gm.mapAdapter.project([e[2],e[1]]),o=this.gm.mapAdapter.project([e[0],e[1]]);return{leftTop:n,rightTop:r,rightBottom:i,leftBottom:o}}getLinesIntersection(e,n){const[r,i]=e[0],[o,a]=e[1],[s,l]=n[0],[u,h]=n[1],c=(r-o)*(l-h)-(i-a)*(s-u);return c===0?null:[((r*a-i*o)*(s-u)-(r-o)*(s*h-l*u))/c,((r*a-i*o)*(l-h)-(i-a)*(s*h-l*u))/c]}}const P2=`<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21">
    <circle cx="10.5" cy="10.5" r="9.213" fill="#fff" stroke="#278cda" stroke-width="2.303"/>
</svg>
`,F2={dom:P2},ud=(t,e=void 0)=>{const n=document.createElement("div");n.classList.add("marker-wrapper"),n.style.lineHeight="0",n.innerHTML=F2[t];const r=n.firstChild;return e&&Object.assign(r.style,e),n};function T2(t,e={}){var n,r,i,o=e.properties,a=(n=e.autoComplete)!=null?n:!0,s=(r=e.orderCoords)!=null?r:!0,l=(i=e.mutate)!=null?i:!1;switch(l||(t=qi(t)),t.type){case"FeatureCollection":var u=[];return t.features.forEach(function(h){u.push(He(Nl(h,{},a,s)))}),fu(u,o);default:return Nl(t,o,a,s)}}function Nl(t,e,n,r){e=e||(t.type==="Feature"?t.properties:{});var i=Sr(t),o=i.coordinates,a=i.type;if(!o.length)throw new Error("line must contain coordinates");switch(a){case"LineString":return n&&(o=Gl(o)),an([o],e);case"MultiLineString":var s=[],l=0;return o.forEach(function(u){if(n&&(u=Gl(u)),r){var h=_2(At(pr(u)));h>l?(s.unshift(u),l=h):s.push(u)}else s.push(u)}),an(s,e);default:throw new Error("geometry type "+a+" is not supported")}}function Gl(t){var e=t[0],n=e[0],r=e[1],i=t[t.length-1],o=i[0],a=i[1];return(n!==o||r!==a)&&t.push(e),t}function _2(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.abs(e-r)*Math.abs(n-i)}var rs=T2;class is extends Ot{constructor(e,n={snappingMarkers:"none",targetShape:"line"}){super(e),b(this,"mode","line"),b(this,"snappingKey","line_drawer"),b(this,"drawOptions"),b(this,"shapeLngLats",[]),b(this,"throttledMethods",Un({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay)),b(this,"mapEventHandlers",{[`${W}:helper`]:this.handleGmHelperEvent.bind(this),click:this.onMouseClick.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this)}),b(this,"drawerEventHandlers",{firstMarkerClick:null,lastMarkerClick:null,nMarkerClick:null}),this.drawOptions=n}get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return e instanceof ld?e:null}get autoTraceEnabled(){var e;return((e=this.gm.options.controls.helper.auto_trace)==null?void 0:e.active)||!1}get autoTraceHelperInstance(){return this.autoTraceEnabled&&Object.values(this.gm.actionInstances).find(e=>e instanceof pn&&e.mode==="auto_trace")||null}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){var e;this.gm.markerPointer.disable(),this.endShape(),(e=this.snapGuidesInstance)==null||e.removeSnapGuides()}handleGmHelperEvent(e){return Vi(e)?(e.mode==="snap_guides"&&e.action==="mode_start"&&this.updateSnapGuides(),{next:!0}):(j.error("LineDrawer.handleGmHelperEvent: invalid event",e),{next:!0})}updateSnapGuides(){var e;if(this.snapGuidesInstance){const n=(e=this.featureData)==null?void 0:e.getGeoJson();n&&n.geometry.coordinates.pop(),this.snapGuidesInstance.updateSnapGuides(n||null,this.shapeLngLats.at(-1)||null,!0)}}on(e,n){this.drawerEventHandlers[e]=n}onMouseClick(e){var n;if(!we(e,{warning:!0}))return{next:!0};const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray();if(this.featureData){const i=this.getClickedMarkerInfo(e);this.handleNextVertex(r,i)}else this.isFeatureAllowed(hv(r))&&this.startShape(r);return this.updateSnapGuides(),{next:!0}}handleNextVertex(e,n){var r,i,o,a,s,l;if(!this.featureData){j.error("LineDrawer.handleNextVertex: no featureData");return}const u=this.featureData.markers.size,h=this.getMarkerClickEventData(n.index);n.index<u-1&&this.addPoint(e,n),n.index!==-1&&(n.index===0?(i=(r=this.drawerEventHandlers).firstMarkerClick)==null||i.call(r,h):n.index>0&&n.index===u-1&&((a=(o=this.drawerEventHandlers).lastMarkerClick)==null||a.call(o,h)),n.index>=0&&((l=(s=this.drawerEventHandlers).nMarkerClick)==null||l.call(s,h)))}getMarkerClickEventData(e){const n=this.getFeatureGeoJson({withControlMarker:!1});return{markerIndex:e,shapeCoordinates:this.getShapeCoordinates({withControlMarker:!1}),geoJson:n,bounds:Oa(n)}}onMouseMove(e){return we(e,{warning:!0})?(this.featureData&&this.shapeLngLats.length&&this.updateFeatureSource(),{next:!0}):{next:!0}}startShape(e){this.shapeLngLats=[e],this.featureData=this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson({withControlMarker:!0}),sourceName:N.temporary});const n={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",0]}};this.featureData&&(this.featureData.markers.set(n.position.path.join("."),n),this.setSnapping(),this.fireStartEvent(this.featureData,n)),this.gm.mapAdapter.disableMapInteractions(["doubleClickZoom"])}endShape(){this.removeSnapping(),this.removeTmpFeature(),this.shapeLngLats=[],this.gm.mapAdapter.enableMapInteractions(["doubleClickZoom"]),this.fireStopEvent()}setSnapping(){if(!this.snappingHelper)return;const e=this.drawOptions.snappingMarkers;e==="none"?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[]):e==="all"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,this.shapeLngLats):e==="first"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[0]]):e==="last"&&this.shapeLngLats.length?this.snappingHelper.setCustomSnappingCoordinates(this.snappingKey,[this.shapeLngLats[this.shapeLngLats.length-1]]):j.error("LineDrawer.setSnapping: invalid data",e,this.shapeLngLats)}removeSnapping(){this.snappingHelper&&this.snappingHelper.clearCustomSnappingCoordinates(this.snappingKey)}getClickedMarkerInfo(e){if(!this.featureData)return{index:-1,path:null};let n=0,r=null;try{this.featureData.markers.forEach((i,o)=>{if(i.instance instanceof wa){const a=i.instance.getElement()||null,s=e.originalEvent.target,l=s instanceof Element?s:null;if(a&&a.contains(l))throw r=o,new Error("stop")}n+=1})}catch{if(r)return{index:n,path:r}}return{index:-1,path:null}}addPoint(e,n){const r=this.featureData;if(!r){j.error("LineDrawer.addPoint: no featureData");return}const i=this.getAddedLngLats(e,n),o=this.getFeatureGeoJsonWithType({withControlMarker:!0,coordinates:this.shapeLngLats.concat(i)});this.isFeatureAllowed(o)&&(i.forEach(a=>{this.shapeLngLats.push(a);const s=this.addMarker(a,r);this.fireUpdateEvent(r,s)}),this.updateFeatureSource())}isFeatureAllowed(e){return this.gm.getActiveDrawModes().length?(this.fireBeforeFeatureCreate({geoJsonFeatures:[e]}),this.flags.featureCreateAllowed):!0}getAddedLngLats(e,n){if(!this.featureData)return j.error("LineDrawer.getCurrentLngLats: no featureData"),[];const r=this.getMarkerInfoLngLat(n)||e,i=this.getAutoTracePath(r);return[...(i==null?void 0:i.slice(1,-1))||[],r]}getAutoTracePath(e){const n=this.shapeLngLats.at(-1);return this.autoTraceEnabled&&this.autoTraceHelperInstance&&n&&this.autoTraceHelperInstance.getShortestPath(n,e)||null}getMarkerInfoLngLat(e){if(this.featureData&&e.path){const n=this.featureData.markers.get(e.path);if(n&&n.type==="dom")return n.instance.getLngLat();j.error("LineDrawer.addPoint: no markerData",e)}return null}addMarker(e,n){const r={type:"dom",instance:this.createMarker(e),position:{coordinate:e,path:["geometry","coordinates",this.shapeLngLats.length]}};return n.markers.set(r.position.path.join("."),{type:"dom",instance:r.instance,position:{coordinate:e,path:[]}}),r}createMarker(e){return this.gm.mapAdapter.createDomMarker({element:ud("dom",{pointerEvents:"auto",cursor:"pointer"}),anchor:"center"},e)}updateFeatureSource(){if(this.featureData&&(this.featureData.updateGeoJsonGeometry(this.getFeatureGeoJson({withControlMarker:!0}).geometry),this.gm.markerPointer.marker)){const e={type:"dom",instance:this.gm.markerPointer.marker,position:{coordinate:this.gm.markerPointer.marker.getLngLat(),path:["geometry","coordinates",this.shapeLngLats.length]}};this.fireUpdateEvent(this.featureData,e)}}getFeatureGeoJson({withControlMarker:e,coordinates:n=void 0}){return{type:"Feature",properties:{shape:"line"},geometry:{type:"LineString",coordinates:n||this.getShapeCoordinates({withControlMarker:e})}}}getFeatureGeoJsonWithType({withControlMarker:e,coordinates:n=void 0}){const r=this.getFeatureGeoJson({withControlMarker:e,coordinates:n});return this.drawOptions.targetShape==="polygon"&&r.geometry.coordinates.length>3?rs(r,{properties:r.properties}):r}getShapeCoordinates({withControlMarker:e}){const n=[...this.shapeLngLats];return e&&this.gm.markerPointer.marker&&n.push(this.gm.markerPointer.marker.getLngLat()),n}fireStartEvent(e,n){this.gm.events.fire(`${W}:draw`,{level:"system",type:"draw",mode:"line",variant:"line_drawer",action:"start",featureData:e,markerData:n})}fireUpdateEvent(e,n){this.gm.events.fire(`${W}:draw`,{level:"system",type:"draw",mode:"line",variant:"line_drawer",action:"update",featureData:e,markerData:n})}fireStopEvent(){this.gm.events.fire(`${W}:draw`,{level:"system",type:"draw",mode:"line",action:"finish",variant:"line_drawer"})}}class O2 extends Ot{constructor(){super(...arguments),b(this,"mode","line"),b(this,"shape","line"),b(this,"lineDrawer",new is(this.gm,{snappingMarkers:"first",targetShape:"line"})),b(this,"mapEventHandlers",{[`${W}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("nMarkerClick",this.lineFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return we(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}lineFinished(e){this.lineDrawer.endShape();let n=e.shapeCoordinates;return e.markerIndex>0&&(n=n.slice(0,e.markerIndex+1)),n.length<2?null:this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(n),sourceName:N.main})}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"LineString",coordinates:e}}}}class B2 extends Ot{constructor(){super(...arguments),b(this,"mode","marker"),b(this,"shape","marker"),b(this,"mapEventHandlers",{click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){const e=this.createMarker();this.gm.markerPointer.enable({customMarker:e}),this.fireMarkerPointerStartEvent()}onEndAction(){this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseClick(e){return we(e)&&(this.featureData=this.createFeature(e),this.featureData&&this.saveFeature()),{next:!1}}onMouseMove(e){return!we(e)||!this.gm.markerPointer.marker?{next:!0}:(this.fireMarkerPointerUpdateEvent(),{next:!0})}createMarker(){const e=document.createElement("div");return e.style.backgroundImage=`url("${uu}")`,e.style.width="36px",e.style.height="36px",e.style.backgroundSize="cover",e.style.pointerEvents="none",this.gm.mapAdapter.createDomMarker({draggable:!1,anchor:"bottom",element:e},[0,0])}createFeature(e){var n;const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray(),i=this.getFeatureGeoJson(r);return i&&(this.fireBeforeFeatureCreate({geoJsonFeatures:[i]}),this.flags.featureCreateAllowed)?this.gm.features.createFeature({shapeGeoJson:i,sourceName:N.temporary}):null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape},geometry:{type:"Point",coordinates:e}}}}function N2(t){var e={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return Ut(t,n=>{var r;switch((r=n.geometry)==null?void 0:r.type){case"Point":e.MultiPoint.coordinates.push(n.geometry.coordinates),e.MultiPoint.properties.push(n.properties);break;case"MultiPoint":e.MultiPoint.coordinates.push(...n.geometry.coordinates),e.MultiPoint.properties.push(n.properties);break;case"LineString":e.MultiLineString.coordinates.push(n.geometry.coordinates),e.MultiLineString.properties.push(n.properties);break;case"MultiLineString":e.MultiLineString.coordinates.push(...n.geometry.coordinates),e.MultiLineString.properties.push(n.properties);break;case"Polygon":e.MultiPolygon.coordinates.push(n.geometry.coordinates),e.MultiPolygon.properties.push(n.properties);break;case"MultiPolygon":e.MultiPolygon.coordinates.push(...n.geometry.coordinates),e.MultiPolygon.properties.push(n.properties);break}}),xe(Object.keys(e).filter(function(n){return e[n].coordinates.length}).sort().map(function(n){var r={type:n,coordinates:e[n].coordinates},i={collectedProperties:e[n].properties};return mt(r,i)}))}var G2=N2;function R2(t,e,n,r,i){cd(t,e,n||0,r||t.length-1,i||j2)}function cd(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,a=e-n+1,s=Math.log(o),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1),h=Math.max(n,Math.floor(e-a*l/o+u)),c=Math.min(r,Math.floor(e+(o-a)*l/o+u));cd(t,e,h,c,i)}var p=t[e],m=n,A=r;for(er(t,n,e),i(t[r],p)>0&&er(t,n,r);m<A;){for(er(t,m,A),m++,A--;i(t[m],p)<0;)m++;for(;i(t[A],p)>0;)A--}i(t[n],p)===0?er(t,n,A):(A++,er(t,A,r)),A<=e&&(n=A+1),e<=A&&(r=A-1)}}function er(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function j2(t,e){return t<e?-1:t>e?1:0}class $e{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let n=this.data;const r=[];if(!Kr(e,n))return r;const i=this.toBBox,o=[];for(;n;){for(let a=0;a<n.children.length;a++){const s=n.children[a],l=n.leaf?i(s):s;Kr(e,l)&&(n.leaf?r.push(s):Do(e,l)?this._all(s,r):o.push(s))}n=o.pop()}return r}collides(e){let n=this.data;if(!Kr(e,n))return!1;const r=[];for(;n;){for(let i=0;i<n.children.length;i++){const o=n.children[i],a=n.leaf?this.toBBox(o):o;if(Kr(e,a)){if(n.leaf||Do(e,a))return!0;r.push(o)}}n=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let n=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=An([]),this}remove(e,n){if(!e)return this;let r=this.data;const i=this.toBBox(e),o=[],a=[];let s,l,u;for(;r||o.length;){if(r||(r=o.pop(),l=o[o.length-1],s=a.pop(),u=!0),r.leaf){const h=z2(e,r.children,n);if(h!==-1)return r.children.splice(h,1),o.push(r),this._condense(o),this}!u&&!r.leaf&&Do(r,i)?(o.push(r),a.push(s),s=0,l=r,r=r.children[0]):l?(s++,r=l.children[s],u=!1):r=null}return this}toBBox(e){return e}compareMinX(e,n){return e.minX-n.minX}compareMinY(e,n){return e.minY-n.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,n){const r=[];for(;e;)e.leaf?n.push(...e.children):r.push(...e.children),e=r.pop();return n}_build(e,n,r,i){const o=r-n+1;let a=this._maxEntries,s;if(o<=a)return s=An(e.slice(n,r+1)),xn(s,this.toBBox),s;i||(i=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,i-1))),s=An([]),s.leaf=!1,s.height=i;const l=Math.ceil(o/a),u=l*Math.ceil(Math.sqrt(a));Rl(e,n,r,u,this.compareMinX);for(let h=n;h<=r;h+=u){const c=Math.min(h+u-1,r);Rl(e,h,c,l,this.compareMinY);for(let p=h;p<=c;p+=l){const m=Math.min(p+l-1,c);s.children.push(this._build(e,p,m,i-1))}}return xn(s,this.toBBox),s}_chooseSubtree(e,n,r,i){for(;i.push(n),!(n.leaf||i.length-1===r);){let o=1/0,a=1/0,s;for(let l=0;l<n.children.length;l++){const u=n.children[l],h=Io(u),c=U2(e,u)-h;c<a?(a=c,o=h<o?h:o,s=u):c===a&&h<o&&(o=h,s=u)}n=s||n.children[0]}return n}_insert(e,n,r){const i=r?e:this.toBBox(e),o=[],a=this._chooseSubtree(i,this.data,n,o);for(a.children.push(e),or(a,i);n>=0&&o[n].children.length>this._maxEntries;)this._split(o,n),n--;this._adjustParentBBoxes(i,o,n)}_split(e,n){const r=e[n],i=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,i);const a=this._chooseSplitIndex(r,o,i),s=An(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,xn(r,this.toBBox),xn(s,this.toBBox),n?e[n-1].children.push(s):this._splitRoot(r,s)}_splitRoot(e,n){this.data=An([e,n]),this.data.height=e.height+1,this.data.leaf=!1,xn(this.data,this.toBBox)}_chooseSplitIndex(e,n,r){let i,o=1/0,a=1/0;for(let s=n;s<=r-n;s++){const l=ir(e,0,s,this.toBBox),u=ir(e,s,r,this.toBBox),h=V2(l,u),c=Io(l)+Io(u);h<o?(o=h,i=s,a=c<a?c:a):h===o&&c<a&&(a=c,i=s)}return i||r-n}_chooseSplitAxis(e,n,r){const i=e.leaf?this.compareMinX:H2,o=e.leaf?this.compareMinY:J2,a=this._allDistMargin(e,n,r,i),s=this._allDistMargin(e,n,r,o);a<s&&e.children.sort(i)}_allDistMargin(e,n,r,i){e.children.sort(i);const o=this.toBBox,a=ir(e,0,n,o),s=ir(e,r-n,r,o);let l=$r(a)+$r(s);for(let u=n;u<r-n;u++){const h=e.children[u];or(a,e.leaf?o(h):h),l+=$r(a)}for(let u=r-n-1;u>=n;u--){const h=e.children[u];or(s,e.leaf?o(h):h),l+=$r(s)}return l}_adjustParentBBoxes(e,n,r){for(let i=r;i>=0;i--)or(n[i],e)}_condense(e){for(let n=e.length-1,r;n>=0;n--)e[n].children.length===0?n>0?(r=e[n-1].children,r.splice(r.indexOf(e[n]),1)):this.clear():xn(e[n],this.toBBox)}}function z2(t,e,n){if(!n)return e.indexOf(t);for(let r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function xn(t,e){ir(t,0,t.children.length,e,t)}function ir(t,e,n,r,i){i||(i=An(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=e;o<n;o++){const a=t.children[o];or(i,t.leaf?r(a):a)}return i}function or(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function H2(t,e){return t.minX-e.minX}function J2(t,e){return t.minY-e.minY}function Io(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function $r(t){return t.maxX-t.minX+(t.maxY-t.minY)}function U2(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function V2(t,e){const n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function Do(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Kr(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function An(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Rl(t,e,n,r,i){const o=[e,n];for(;o.length;){if(n=o.pop(),e=o.pop(),n-e<=r)continue;const a=e+Math.ceil((n-e)/r/2)*r;R2(t,a,e,n,i),o.push(e,a,a,n)}}function q2(t){return Lh(t,(e,n)=>e+Y2(n),0)}function Y2(t){let e=0,n;switch(t.type){case"Polygon":return jl(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)e+=jl(t.coordinates[n]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function jl(t){let e=0;if(t&&t.length>0){e+=Math.abs(zl(t[0]));for(let n=1;n<t.length;n++)e-=Math.abs(zl(t[n]))}return e}var W2=ke*ke/2,Po=Math.PI/180;function zl(t){const e=t.length-1;if(e<=2)return 0;let n=0,r=0;for(;r<e;){const i=t[r],o=t[r+1===e?0:r+1],a=t[r+2>=e?(r+2)%e:r+2],s=i[0]*Po,l=o[1]*Po,u=a[0]*Po;n+=(u-s)*Math.sin(l),r++}return n*W2}function Z2(t,e,n){if(t.geometry.type!=="Polygon")throw new Error("The input feature must be a Polygon");n===void 0&&(n=1);var r=t.geometry.coordinates,i=[],o={};if(n){for(var a=[],s=0;s<r.length;s++)for(var l=0;l<r[s].length-1;l++)a.push(D(s,l));var u=new $e;u.load(a)}for(var h=0;h<r.length;h++)for(var c=0;c<r[h].length-1;c++)if(n){var p=u.search(D(h,c));p.forEach(function(P){var E=P.ring,B=P.edge;M(h,c,E,B)})}else for(var m=0;m<r.length;m++)for(var A=0;A<r[m].length-1;A++)M(h,c,m,A);return e||(i={type:"Feature",geometry:{type:"MultiPoint",coordinates:i}}),i;function M(P,E,B,O){var R=r[P][E],G=r[P][E+1],J=r[B][O],d=r[B][O+1],f=$2(R,G,J,d);if(f!==null){var g,v;if(G[0]!==R[0]?g=(f[0]-R[0])/(G[0]-R[0]):g=(f[1]-R[1])/(G[1]-R[1]),d[0]!==J[0]?v=(f[0]-J[0])/(d[0]-J[0]):v=(f[1]-J[1])/(d[1]-J[1]),!(g>=1||g<=0||v>=1||v<=0)){var y=f,S=!o[y];S&&(o[y]=!0),e?i.push(e(f,P,E,R,G,g,B,O,J,d,v,S)):i.push(f)}}}function D(P,E){var B=r[P][E],O=r[P][E+1],R,G,J,d;return B[0]<O[0]?(R=B[0],G=O[0]):(R=O[0],G=B[0]),B[1]<O[1]?(J=B[1],d=O[1]):(J=O[1],d=B[1]),{minX:R,minY:J,maxX:G,maxY:d,ring:P,edge:E}}}function $2(t,e,n,r){if(ar(t,n)||ar(t,r)||ar(e,n)||ar(r,n))return null;var i=t[0],o=t[1],a=e[0],s=e[1],l=n[0],u=n[1],h=r[0],c=r[1],p=(i-a)*(u-c)-(o-s)*(l-h);if(p===0)return null;var m=((i*s-o*a)*(l-h)-(i-a)*(l*c-u*h))/p,A=((i*s-o*a)*(u-c)-(o-s)*(l*c-u*h))/p;return[m,A]}function ar(t,e){if(!t||!e||t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!ar(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}function K2(t){if(t.type!="Feature")throw new Error("The input must a geojson object of type Feature");if(t.geometry===void 0||t.geometry==null)throw new Error("The input must a geojson object with a non-empty geometry");if(t.geometry.type!="Polygon")throw new Error("The input must be a geojson Polygon");for(var e=t.geometry.coordinates.length,n=[],r=0;r<e;r++){var i=t.geometry.coordinates[r];sr(i[0],i[i.length-1])||i.push(i[0]);for(var o=0;o<i.length-1;o++)n.push(i[o])}if(!Q2(n))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var a=n.length,s=Z2(t,function(Y,K,U,Z,te,bt,wt,Gt,Ae,Oe,ve,ue){return[Y,K,U,Z,te,bt,wt,Gt,Ae,Oe,ve,ue]}),l=s.length;if(l==0){for(var u=[],r=0;r<e;r++)u.push(an([t.geometry.coordinates[r]],{parent:-1,winding:X2(t.geometry.coordinates[r])}));var _=xe(u);return q(),H(),_}for(var h=[],c=[],r=0;r<e;r++){h.push([]);for(var o=0;o<t.geometry.coordinates[r].length-1;o++)h[r].push([new Hl(t.geometry.coordinates[r][Ln(o+1,t.geometry.coordinates[r].length-1)],1,[r,o],[r,Ln(o+1,t.geometry.coordinates[r].length-1)],void 0)]),c.push(new Jl(t.geometry.coordinates[r][o],[r,Ln(o-1,t.geometry.coordinates[r].length-1)],[r,o],void 0,void 0,!1,!0))}for(var r=0;r<l;r++)h[s[r][1]][s[r][2]].push(new Hl(s[r][0],s[r][5],[s[r][1],s[r][2]],[s[r][6],s[r][7]],void 0)),s[r][11]&&c.push(new Jl(s[r][0],[s[r][1],s[r][2]],[s[r][6],s[r][7]],void 0,void 0,!0,!0));for(var p=c.length,r=0;r<h.length;r++)for(var o=0;o<h[r].length;o++)h[r][o].sort(function(U,Z){return U.param<Z.param?-1:1});for(var m=[],r=0;r<p;r++)m.push({minX:c[r].coord[0],minY:c[r].coord[1],maxX:c[r].coord[0],maxY:c[r].coord[1],index:r});var A=new $e;A.load(m);for(var r=0;r<h.length;r++)for(var o=0;o<h[r].length;o++)for(var M=0;M<h[r][o].length;M++){var D;M==h[r][o].length-1?D=h[r][Ln(o+1,t.geometry.coordinates[r].length-1)][0].coord:D=h[r][o][M+1].coord;var P=A.search({minX:D[0],minY:D[1],maxX:D[0],maxY:D[1]})[0];h[r][o][M].nxtIsectAlongEdgeIn=P.index}for(var r=0;r<h.length;r++)for(var o=0;o<h[r].length;o++)for(var M=0;M<h[r][o].length;M++){var D=h[r][o][M].coord,P=A.search({minX:D[0],minY:D[1],maxX:D[0],maxY:D[1]})[0],E=P.index;E<a?c[E].nxtIsectAlongRingAndEdge2=h[r][o][M].nxtIsectAlongEdgeIn:sr(c[E].ringAndEdge1,h[r][o][M].ringAndEdgeIn)?c[E].nxtIsectAlongRingAndEdge1=h[r][o][M].nxtIsectAlongEdgeIn:c[E].nxtIsectAlongRingAndEdge2=h[r][o][M].nxtIsectAlongEdgeIn}for(var B=[],r=0,o=0;o<e;o++){for(var O=r,M=0;M<t.geometry.coordinates[o].length-1;M++)c[r].coord[0]<c[O].coord[0]&&(O=r),r++;for(var R=c[O].nxtIsectAlongRingAndEdge2,M=0;M<c.length;M++)if(c[M].nxtIsectAlongRingAndEdge1==O||c[M].nxtIsectAlongRingAndEdge2==O){var G=M;break}var J=ui([c[G].coord,c[O].coord,c[R].coord],!0)?1:-1;B.push({isect:O,parent:-1,winding:J})}B.sort(function(Y,K){return c[Y.isect].coord>c[K.isect].coord?-1:1});for(var u=[];B.length>0;){var d=B.pop(),f=d.isect,g=d.parent,v=d.winding,y=u.length,S=[c[f].coord],F=f;if(c[f].ringAndEdge1Walkable)var k=c[f].ringAndEdge1,x=c[f].nxtIsectAlongRingAndEdge1;else var k=c[f].ringAndEdge2,x=c[f].nxtIsectAlongRingAndEdge2;for(;!sr(c[f].coord,c[x].coord);){S.push(c[x].coord);for(var T=void 0,r=0;r<B.length;r++)if(B[r].isect==x){T=r;break}if(T!=null&&B.splice(T,1),sr(k,c[x].ringAndEdge1)){if(k=c[x].ringAndEdge2,c[x].ringAndEdge2Walkable=!1,c[x].ringAndEdge1Walkable){var I={isect:x};ui([c[F].coord,c[x].coord,c[c[x].nxtIsectAlongRingAndEdge2].coord],v==1)?(I.parent=g,I.winding=-v):(I.parent=y,I.winding=v),B.push(I)}F=x,x=c[x].nxtIsectAlongRingAndEdge2}else{if(k=c[x].ringAndEdge1,c[x].ringAndEdge1Walkable=!1,c[x].ringAndEdge2Walkable){var I={isect:x};ui([c[F].coord,c[x].coord,c[c[x].nxtIsectAlongRingAndEdge1].coord],v==1)?(I.parent=g,I.winding=-v):(I.parent=y,I.winding=v),B.push(I)}F=x,x=c[x].nxtIsectAlongRingAndEdge1}}S.push(c[x].coord),u.push(an([S],{index:y,parent:g,winding:v,netWinding:void 0}))}var _=xe(u);q(),H();function q(){for(var Y=[],K=0;K<_.features.length;K++)_.features[K].properties.parent==-1&&Y.push(K);if(Y.length>1)for(var K=0;K<Y.length;K++){for(var U=-1,Z=1/0,te=0;te<_.features.length;te++)Y[K]!=te&&un(_.features[Y[K]].geometry.coordinates[0][0],_.features[te],{ignoreBoundary:!0})&&q2(_.features[te])<Z&&(U=te);_.features[Y[K]].properties.parent=U}}function H(){for(var Y=0;Y<_.features.length;Y++)if(_.features[Y].properties.parent==-1){var K=_.features[Y].properties.winding;_.features[Y].properties.netWinding=K,X(Y,K)}}function X(Y,K){for(var U=0;U<_.features.length;U++)if(_.features[U].properties.parent==Y){var Z=K+_.features[U].properties.winding;_.features[U].properties.netWinding=Z,X(U,Z)}}return _}var Hl=function(t,e,n,r,i){this.coord=t,this.param=e,this.ringAndEdgeIn=n,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=i},Jl=function(t,e,n,r,i,o,a){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=n,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=a};function ui(t,e){if(typeof e>"u"&&(e=!0),t.length!=3)throw new Error("This function requires an array of three points [x,y]");var n=(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0]);return n>=0==e}function X2(t){for(var e=0,n=0;n<t.length-1;n++)t[n][0]<t[e][0]&&(e=n);if(ui([t[Ln(e-1,t.length-1)],t[e],t[Ln(e+1,t.length-1)]],!0))var r=1;else var r=-1;return r}function sr(t,e){if(!t||!e||t.length!=e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!sr(t[n],e[n]))return!1}else if(t[n]!=e[n])return!1;return!0}function Ln(t,e){return(t%e+e)%e}function Q2(t){for(var e={},n=1,r=0,i=t.length;r<i;++r){if(Object.prototype.hasOwnProperty.call(e,t[r])){n=0;break}e[t[r]]=1}return n}function eb(t){var e=[];return Vt(t,function(n){n.geometry.type==="Polygon"&&Ut(K2(n),function(r){e.push(an(r.geometry.coordinates,n.properties))})}),xe(e)}var tb=eb;class nb extends Ot{constructor(){super(...arguments),b(this,"mode","polygon"),b(this,"shape","polygon"),b(this,"lineDrawer",new is(this.gm,{snappingMarkers:"first",targetShape:"polygon"})),b(this,"mapEventHandlers",{[`${W}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onEndAction(){this.lineDrawer.endAction()}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.polygonFinished.bind(this))}onMouseMove(e){return we(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}polygonFinished(e){if(this.lineDrawer.endShape(),e.shapeCoordinates.length<3)return;const n=this.fixShapeGeoJson(rs(e.geoJson));n&&this.gm.features.createFeature({shapeGeoJson:{...n,properties:{...n.properties,shape:this.shape}},sourceName:N.main})}fixShapeGeoJson(e){try{return gc(G2(tb(e))).features[0]}catch{return null}}}class rb extends Ot{constructor(){super(...arguments),b(this,"mode","rectangle"),b(this,"shape","rectangle"),b(this,"startLngLat",null),b(this,"mapEventHandlers",{mousemove:this.onMouseMove.bind(this),click:this.onMouseClick.bind(this)}),b(this,"throttledMethods",Un({updateFeaturePosition:this.updateFeaturePosition},this,this.gm.options.settings.throttlingDelay))}onStartAction(){this.gm.markerPointer.enable()}onEndAction(){this.removeTmpFeature(),this.startLngLat=null,this.gm.markerPointer.disable(),this.fireFinishEvent()}onMouseClick(e){var n;if(!we(e,{warning:!0}))return{next:!1};const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray();if(this.startLngLat){const i=this.getFeatureGeoJson(Sn(this.startLngLat,r));this.fireBeforeFeatureCreate({geoJsonFeatures:[i]}),this.flags.featureCreateAllowed&&this.finishShape(r)}else{const i=this.getFeatureGeoJson(Sn(r,r));if(this.fireBeforeFeatureCreate({geoJsonFeatures:[i]}),this.flags.featureCreateAllowed){const o=this.startShape(r);if(o){const a=this.getControlMarkerData(["geometry","coordinates",4]);this.fireStartEvent(o,a)}}}return{next:!1}}onMouseMove(e){var n;if(!we(e,{warning:!0}))return{next:!1};if(!this.startLngLat)return this.fireMarkerPointerUpdateEvent(),{next:!1};const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray(),i=Sn(this.startLngLat,r),o=this.getFeatureGeoJson(i);return this.fireBeforeFeatureCreate({geoJsonFeatures:[o]}),this.flags.featureCreateAllowed&&this.throttledMethods.updateFeaturePosition(i),{next:!1}}startShape(e){this.startLngLat=e;const n=Sn(this.startLngLat,this.startLngLat);return this.featureData=this.createFeature(n),this.featureData}finishShape(e){if(this.startLngLat){const n=Sn(this.startLngLat,e);this.throttledMethods.updateFeaturePosition(n)}this.featureData&&(this.isFeatureGeoJsonValid()?this.saveFeature():this.removeTmpFeature()),this.startLngLat=null,this.fireFinishEvent()}createFeature(e){return this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:N.temporary})}isFeatureGeoJsonValid(){return this.featureData?rc(this.featureData.getGeoJson()):!1}getFeatureGeoJson(e){return{...Wo([e[0],e[2]],[e[2],e[3]]),properties:{shape:this.shape}}}updateFeaturePosition(e){if(!this.featureData)return;const n=Wo([e[0],e[1]],[e[2],e[3]]);this.featureData.updateGeoJsonGeometry(n.geometry);const r=this.getControlMarkerData(["geometry","coordinates",4]);this.fireUpdateEvent(this.featureData,r)}getControlMarkerData(e){const n=this.gm.markerPointer.marker;return n?{type:"dom",instance:n,position:{coordinate:n.getLngLat(),path:e}}:null}fireStartEvent(e,n){const r={level:"system",type:"draw",mode:this.shape,variant:null,action:"start",featureData:e,markerData:n};this.gm.events.fire(`${W}:draw`,r)}fireUpdateEvent(e,n){const r={level:"system",type:"draw",mode:this.shape,variant:null,action:"update",featureData:e,markerData:n};this.gm.events.fire(`${W}:draw`,r)}fireFinishEvent(){const e={level:"system",type:"draw",mode:this.shape,variant:null,action:"finish"};this.gm.events.fire(`${W}:draw`,e)}}class ib extends Ot{constructor(){super(...arguments),b(this,"mode","text_marker"),b(this,"shape","text_marker"),b(this,"textarea",null),b(this,"mapEventHandlers",{click:this.onMouseClick.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0})}onEndAction(){this.removeTextarea(),this.removeTmpFeature(),this.featureData=null,this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent()}onMouseMove(e){return we(e,{warning:!0})?(this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}onMouseClick(e){var n;if(!we(e,{warning:!0}))return{next:!0};if(this.textarea)this.endShape(),this.gm.markerPointer.enable({invisibleMarker:!0,lngLat:e.lngLat.toArray()}),this.fireMarkerPointerUpdateEvent();else{const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray();this.fireBeforeFeatureCreate({geoJsonFeatures:[this.getFeatureGeoJson(r)]}),this.flags.featureCreateAllowed&&(this.featureData=this.createFeature(r),this.gm.markerPointer.disable(),this.fireMarkerPointerFinishEvent())}return{next:!1}}createFeature(e){const n=this.gm.mapAdapter.project(e);return this.createTextarea(n),this.gm.features.createFeature({shapeGeoJson:this.getFeatureGeoJson(e),sourceName:N.temporary})}endShape(){var e;const n=((e=this.textarea)==null?void 0:e.value)||"";this.removeTextarea(),n.trim()?(this.updateFeatureSource(n),this.saveFeature()):this.removeTmpFeature()}createTextarea(e){this.textarea=document.createElement("textarea"),this.textarea.style.position="absolute",this.textarea.style.left=`${e[0]}px`,this.textarea.style.top=`${e[1]}px`,this.textarea.style.opacity="0.7",this.gm.mapAdapter.getContainer().appendChild(this.textarea),this.textarea.focus()}removeTextarea(){var e;(e=this.textarea)==null||e.remove(),this.textarea=null}getFeatureGeoJson(e){return{type:"Feature",properties:{shape:this.shape,text:""},geometry:{type:"Point",coordinates:e}}}updateFeatureSource(e){this.featureData&&this.featureData.updateGeoJsonProperties({shape:this.shape,text:e})}}const ca={marker:B2,circle:p2,circle_marker:d2,text_marker:ib,line:O2,rectangle:rb,polygon:nb,freehand:null,custom_shape:null},ob=(t,e)=>ca[e]?new ca[e](t):(j.error(`Draw "${e}" is not available`),null);class ab extends Ui{constructor(e,n){super(e),b(this,"mapEventHandlers",{[`${W}:draw`]:this.handleDrawEvent.bind(this)}),n.attachEvents(this.mapEventHandlers)}handleDrawEvent(e){if(!Ra(e))return{next:!0};const n=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(n,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(n)),{next:!0}}start(e,n){const r=ob(this.gm,n.mode);r&&(e in this.gm.actionInstances&&j.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=r,r.startAction())}end(e){const n=this.gm.actionInstances[e];n instanceof Ot?(n.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for draw event "${e}":`,n)}}class os extends Or{constructor(){super(...arguments),b(this,"mode","drag"),b(this,"isDragging",!1),b(this,"previousLngLat",null),b(this,"pointBasedShapes",["marker","circle_marker","text_marker"]),b(this,"throttledMethods",Un({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay)),b(this,"mapEventHandlers",{[`${W}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mousemove:this.throttledMethods.onMouseMove.bind(this),touchmove:this.throttledMethods.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this)}),b(this,"getUpdatedGeoJsonHandlers",{marker:this.moveSource.bind(this),circle:this.moveCircle.bind(this),circle_marker:this.moveSource.bind(this),text_marker:this.moveSource.bind(this),line:this.moveSource.bind(this),rectangle:this.moveSource.bind(this),polygon:this.moveSource.bind(this)})}onMouseDown(e){var n;return this.featureData=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[N.main]}),this.featureData&&this.getUpdatedGeoJsonHandlers[this.featureData.shape]?(this.featureData.changeSource({sourceName:N.temporary,atomic:!0}),this.gm.mapAdapter.setDragPan(!1),this.isDragging=!0,(n=this.snappingHelper)==null||n.addExcludedFeature(this.featureData),this.isPointBasedShape()&&this.alignShapeCenterWithControlMarker(this.featureData,e),this.fireFeatureEditStartEvent({feature:this.featureData,forceMode:"drag"}),{next:!1}):{next:!0}}onMouseUp(){var e;return this.featureData?((e=this.snappingHelper)==null||e.clearExcludedFeatures(),this.featureData.changeSource({sourceName:N.main,atomic:!0}),this.isDragging=!1,this.previousLngLat=null,this.gm.mapAdapter.setDragPan(!0),this.fireFeatureEditEndEvent({feature:this.featureData,forceMode:"drag"}),this.featureData=null,{next:!0}):{next:!0}}onMouseMove(e){var n;if(!this.isDragging||!we(e,{warning:!0}))return{next:!0};if(this.featureData){const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray();this.moveFeature(this.featureData,r)}return{next:!1}}isPointBasedShape(){return!!this.featureData&&this.pointBasedShapes.includes(this.featureData.shape)}alignShapeCenterWithControlMarker(e,n){var r;const i=za(e);i&&((r=this.gm.markerPointer.marker)==null||r.setLngLat(i),this.onMouseMove(n))}moveFeature(e,n){if(!this.isDragging)return;if(!this.previousLngLat){this.previousLngLat=n;return}const r=this.getUpdatedGeoJsonHandlers[e.shape];if(r){const i=r(e,this.previousLngLat,n);if(!i){j.error("BaseDrag.moveFeature: invalid updatedGeoJson",e);return}this.fireBeforeFeatureUpdate({features:[e],geoJsonFeatures:[i],forceMode:"drag"}),this.updateFeatureGeoJson({featureData:e,featureGeoJson:i,forceMode:"drag"})&&(this.previousLngLat=n)}}moveSource(e,n,r){const i=il(n,r);return Uv(e,i)}moveCircle(e,n,r){if(e.shape!=="circle")return j.error("BaseDrag.moveCircle: invalid shape type",e),null;const i=e.getShapeProperty("center");if(!i)return j.error("BaseDrag.moveCircle: missing center in the featureData",e),null;const o=e.getGeoJson(),a=il(n,r),s=ic(o);if(!s)return j.error("BaseDrag.moveCircle: missing center circleRimLngLat"),null;const l=[i[0]+a.lng,i[1]+a.lat],u=Ba({center:l,radius:this.gm.mapAdapter.getDistance(i,s)});return{type:"Feature",properties:{shape:"circle",center:l},geometry:u.geometry}}}class sb extends os{constructor(){super(...arguments),b(this,"mode","change"),b(this,"cutVertexShapeTypes",["line","polygon","rectangle"]),b(this,"markerData",null),b(this,"shapeUpdateHandlers",{marker:this.updateSingleVertex.bind(this),circle:this.updateCircle.bind(this),circle_marker:this.updateSingleVertex.bind(this),text_marker:this.updateSingleVertex.bind(this),line:this.updateSingleVertex.bind(this),rectangle:this.updateRectangle.bind(this),polygon:this.updateSingleVertex.bind(this)})}get snapGuidesInstance(){const e=this.gm.actionInstances.helper__snap_guides;return e instanceof ld?e:null}onStartAction(){}onEndAction(){var e;(e=this.snapGuidesInstance)==null||e.removeSnapGuides()}handleGmEdit(e){var n;if(!Vn(e))return{next:!0};if(e.action==="marker_move"&&e.lngLatStart&&e.markerData){if(e.markerData.type==="vertex")return this.moveVertex(e),{next:!1};if(e.lngLatEnd)return this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}}return e.action==="marker_right_click"?(this.cutVertex(e),this.fireFeatureEditEndEvent({feature:e.featureData})):e.action==="edge_marker_click"?this.insertVertex(e):e.action==="marker_captured"?(e.featureData.changeSource({sourceName:N.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(this.markerData=null,(n=this.snapGuidesInstance)==null||n.removeSnapGuides(),e.featureData.changeSource({sourceName:N.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}}moveVertex(e){var n,r,i;this.markerData||(this.markerData=e.markerData||null,(n=this.snapGuidesInstance)==null||n.updateSnapGuides(e.featureData.getGeoJson(),e.lngLatStart));const o=e.featureData,a=o.shape,s=((i=(r=this.shapeUpdateHandlers)[a])==null?void 0:i.call(r,e))||null;s?(this.fireBeforeFeatureUpdate({features:[o],geoJsonFeatures:[s]}),this.updateFeatureGeoJson({featureData:o,featureGeoJson:s})):j.error("EditChange.moveVertex: invalid geojson",s,e)}cutVertex(e){const n=e.featureData;if(e.markerData.type!=="vertex"||!this.cutVertexShapeTypes.includes(n.shape))return;let r=!1;const i=n.getGeoJson(),o=e.markerData.instance;if($u(i)){if(go(i)<=2){this.gm.features.delete(n);return}}else if(Xu(i)){if(go(i)<=3){this.gm.features.delete(n);return}}else if(Ku(i)&&go(i)<=3){this.gm.features.delete(n);return}const a=za(o);a&&(r=dv(i,a)),r?(n.convertToPolygon(),n.updateGeoJsonGeometry(i.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[n],targetFeatures:[n],markerData:e.markerData})):j.error("EditChange.cutVertex: feature not updated",e)}insertVertex(e){if(e.markerData.type!=="edge")return;const n=e.featureData.getGeoJson(),r=e.markerData.segment.end.path,i=r.pop(),o=ln(n,r);typeof i=="number"&&(o.splice(i,0,[...e.markerData.position.coordinate]),e.featureData.updateGeoJsonGeometry(n.geometry),e.featureData.convertToPolygon(),this.fireFeatureUpdatedEvent({sourceFeatures:[e.featureData],targetFeatures:[e.featureData],markerData:e.markerData}))}updateSingleVertex({featureData:e,lngLatEnd:n,markerData:r}){const i=Qe(e.getGeoJson()),o=Qe(r.position.path),a=o.pop(),s=ln(i,o);return Array.isArray(s)&&typeof a=="number"?(s[a]=[...n],a===0&&e.shape==="polygon"&&(s[s.length-1]=[...n])):j.error("BaseDrag.moveSingleVertex: invalid coordinates",i,o),i}updateCircle({featureData:e,lngLatEnd:n}){if(e.shape!=="circle"||e.shapeProperties.center===null)return j.error("BaseDrag.moveCircle: invalid shape type / missing center",e),null;const r=e.shapeProperties.center,i=Ba({center:r,radius:this.gm.mapAdapter.getDistance(r,n)});return{type:"Feature",properties:{shape:"circle",center:r},geometry:i.geometry}}updateRectangle({featureData:e,lngLatStart:n,lngLatEnd:r}){const i=e.getGeoJson(),o=i.geometry.coordinates[0],{absCoordIndex:a}=Ji(i,n);if(a===-1)return j.error("EditChange.updateRectangle: start vertex not found",e),null;const s=ua(a-2,4),l=o[s];return Wo(r,l)}}const lb=t=>t.length>0;function ub(t,e,{ignoreSelfIntersections:n=!0}={}){let r=!1;return Vt(t,i=>{Vt(e,o=>{if(r===!0)return!0;r=!g2(i.geometry,o.geometry,{ignoreSelfIntersections:n})})}),r}var cb=ub,db=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Fo=Math.ceil,We=Math.floor,Ne="[BigNumber Error] ",Ul=Ne+"Number primitive has more than 15 significant digits: ",tt=1e14,$=14,Vl=9007199254740991,To=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Rt=1e7,Re=1e9;function dd(t){var e,n,r,i=E.prototype={constructor:E,toString:null,valueOf:null},o=new E(1),a=20,s=4,l=-7,u=21,h=-1e7,c=1e7,p=!1,m=1,A=0,M={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},D="0123456789abcdefghijklmnopqrstuvwxyz",P=!0;function E(d,f){var g,v,y,S,F,k,x,T,I=this;if(!(I instanceof E))return new E(d,f);if(f==null){if(d&&d._isBigNumber===!0){I.s=d.s,!d.c||d.e>c?I.c=I.e=null:d.e<h?I.c=[I.e=0]:(I.e=d.e,I.c=d.c.slice());return}if((k=typeof d=="number")&&d*0==0){if(I.s=1/d<0?(d=-d,-1):1,d===~~d){for(S=0,F=d;F>=10;F/=10,S++);S>c?I.c=I.e=null:(I.e=S,I.c=[d]);return}T=String(d)}else{if(!db.test(T=String(d)))return r(I,T,k);I.s=T.charCodeAt(0)==45?(T=T.slice(1),-1):1}(S=T.indexOf("."))>-1&&(T=T.replace(".","")),(F=T.search(/e/i))>0?(S<0&&(S=F),S+=+T.slice(F+1),T=T.substring(0,F)):S<0&&(S=T.length)}else{if(he(f,2,D.length,"Base"),f==10&&P)return I=new E(d),G(I,a+I.e+1,s);if(T=String(d),k=typeof d=="number"){if(d*0!=0)return r(I,T,k,f);if(I.s=1/d<0?(T=T.slice(1),-1):1,E.DEBUG&&T.replace(/^0\.0*|\./,"").length>15)throw Error(Ul+d)}else I.s=T.charCodeAt(0)===45?(T=T.slice(1),-1):1;for(g=D.slice(0,f),S=F=0,x=T.length;F<x;F++)if(g.indexOf(v=T.charAt(F))<0){if(v=="."){if(F>S){S=x;continue}}else if(!y&&(T==T.toUpperCase()&&(T=T.toLowerCase())||T==T.toLowerCase()&&(T=T.toUpperCase()))){y=!0,F=-1,S=0;continue}return r(I,String(d),k,f)}k=!1,T=n(T,f,10,I.s),(S=T.indexOf("."))>-1?T=T.replace(".",""):S=T.length}for(F=0;T.charCodeAt(F)===48;F++);for(x=T.length;T.charCodeAt(--x)===48;);if(T=T.slice(F,++x)){if(x-=F,k&&E.DEBUG&&x>15&&(d>Vl||d!==We(d)))throw Error(Ul+I.s*d);if((S=S-F-1)>c)I.c=I.e=null;else if(S<h)I.c=[I.e=0];else{if(I.e=S,I.c=[],F=(S+1)%$,S<0&&(F+=$),F<x){for(F&&I.c.push(+T.slice(0,F)),x-=$;F<x;)I.c.push(+T.slice(F,F+=$));F=$-(T=T.slice(F)).length}else F-=x;for(;F--;T+="0");I.c.push(+T)}}else I.c=[I.e=0]}E.clone=dd,E.ROUND_UP=0,E.ROUND_DOWN=1,E.ROUND_CEIL=2,E.ROUND_FLOOR=3,E.ROUND_HALF_UP=4,E.ROUND_HALF_DOWN=5,E.ROUND_HALF_EVEN=6,E.ROUND_HALF_CEIL=7,E.ROUND_HALF_FLOOR=8,E.EUCLID=9,E.config=E.set=function(d){var f,g;if(d!=null)if(typeof d=="object"){if(d.hasOwnProperty(f="DECIMAL_PLACES")&&(g=d[f],he(g,0,Re,f),a=g),d.hasOwnProperty(f="ROUNDING_MODE")&&(g=d[f],he(g,0,8,f),s=g),d.hasOwnProperty(f="EXPONENTIAL_AT")&&(g=d[f],g&&g.pop?(he(g[0],-1e9,0,f),he(g[1],0,Re,f),l=g[0],u=g[1]):(he(g,-1e9,Re,f),l=-(u=g<0?-g:g))),d.hasOwnProperty(f="RANGE"))if(g=d[f],g&&g.pop)he(g[0],-1e9,-1,f),he(g[1],1,Re,f),h=g[0],c=g[1];else if(he(g,-1e9,Re,f),g)h=-(c=g<0?-g:g);else throw Error(Ne+f+" cannot be zero: "+g);if(d.hasOwnProperty(f="CRYPTO"))if(g=d[f],g===!!g)if(g)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))p=g;else throw p=!g,Error(Ne+"crypto unavailable");else p=g;else throw Error(Ne+f+" not true or false: "+g);if(d.hasOwnProperty(f="MODULO_MODE")&&(g=d[f],he(g,0,9,f),m=g),d.hasOwnProperty(f="POW_PRECISION")&&(g=d[f],he(g,0,Re,f),A=g),d.hasOwnProperty(f="FORMAT"))if(g=d[f],typeof g=="object")M=g;else throw Error(Ne+f+" not an object: "+g);if(d.hasOwnProperty(f="ALPHABET"))if(g=d[f],typeof g=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(g))P=g.slice(0,10)=="0123456789",D=g;else throw Error(Ne+f+" invalid: "+g)}else throw Error(Ne+"Object expected: "+d);return{DECIMAL_PLACES:a,ROUNDING_MODE:s,EXPONENTIAL_AT:[l,u],RANGE:[h,c],CRYPTO:p,MODULO_MODE:m,POW_PRECISION:A,FORMAT:M,ALPHABET:D}},E.isBigNumber=function(d){if(!d||d._isBigNumber!==!0)return!1;if(!E.DEBUG)return!0;var f,g,v=d.c,y=d.e,S=d.s;e:if({}.toString.call(v)=="[object Array]"){if((S===1||S===-1)&&y>=-1e9&&y<=Re&&y===We(y)){if(v[0]===0){if(y===0&&v.length===1)return!0;break e}if(f=(y+1)%$,f<1&&(f+=$),String(v[0]).length==f){for(f=0;f<v.length;f++)if(g=v[f],g<0||g>=tt||g!==We(g))break e;if(g!==0)return!0}}}else if(v===null&&y===null&&(S===null||S===1||S===-1))return!0;throw Error(Ne+"Invalid BigNumber: "+d)},E.maximum=E.max=function(){return O(arguments,-1)},E.minimum=E.min=function(){return O(arguments,1)},E.random=function(){var d=9007199254740992,f=Math.random()*d&2097151?function(){return We(Math.random()*d)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(g){var v,y,S,F,k,x=0,T=[],I=new E(o);if(g==null?g=a:he(g,0,Re),F=Fo(g/$),p)if(crypto.getRandomValues){for(v=crypto.getRandomValues(new Uint32Array(F*=2));x<F;)k=v[x]*131072+(v[x+1]>>>11),k>=9e15?(y=crypto.getRandomValues(new Uint32Array(2)),v[x]=y[0],v[x+1]=y[1]):(T.push(k%1e14),x+=2);x=F/2}else if(crypto.randomBytes){for(v=crypto.randomBytes(F*=7);x<F;)k=(v[x]&31)*281474976710656+v[x+1]*1099511627776+v[x+2]*4294967296+v[x+3]*16777216+(v[x+4]<<16)+(v[x+5]<<8)+v[x+6],k>=9e15?crypto.randomBytes(7).copy(v,x):(T.push(k%1e14),x+=7);x=F/7}else throw p=!1,Error(Ne+"crypto unavailable");if(!p)for(;x<F;)k=f(),k<9e15&&(T[x++]=k%1e14);for(F=T[--x],g%=$,F&&g&&(k=To[$-g],T[x]=We(F/k)*k);T[x]===0;T.pop(),x--);if(x<0)T=[S=0];else{for(S=-1;T[0]===0;T.splice(0,1),S-=$);for(x=1,k=T[0];k>=10;k/=10,x++);x<$&&(S-=$-x)}return I.e=S,I.c=T,I}}(),E.sum=function(){for(var d=1,f=arguments,g=new E(f[0]);d<f.length;)g=g.plus(f[d++]);return g},n=function(){var d="0123456789";function f(g,v,y,S){for(var F,k=[0],x,T=0,I=g.length;T<I;){for(x=k.length;x--;k[x]*=v);for(k[0]+=S.indexOf(g.charAt(T++)),F=0;F<k.length;F++)k[F]>y-1&&(k[F+1]==null&&(k[F+1]=0),k[F+1]+=k[F]/y|0,k[F]%=y)}return k.reverse()}return function(g,v,y,S,F){var k,x,T,I,_,q,H,X,Y=g.indexOf("."),K=a,U=s;for(Y>=0&&(I=A,A=0,g=g.replace(".",""),X=new E(v),q=X.pow(g.length-Y),A=I,X.c=f(St(Ye(q.c),q.e,"0"),10,y,d),X.e=X.c.length),H=f(g,v,y,F?(k=D,d):(k=d,D)),T=I=H.length;H[--I]==0;H.pop());if(!H[0])return k.charAt(0);if(Y<0?--T:(q.c=H,q.e=T,q.s=S,q=e(q,X,K,U,y),H=q.c,_=q.r,T=q.e),x=T+K+1,Y=H[x],I=y/2,_=_||x<0||H[x+1]!=null,_=U<4?(Y!=null||_)&&(U==0||U==(q.s<0?3:2)):Y>I||Y==I&&(U==4||_||U==6&&H[x-1]&1||U==(q.s<0?8:7)),x<1||!H[0])g=_?St(k.charAt(1),-K,k.charAt(0)):k.charAt(0);else{if(H.length=x,_)for(--y;++H[--x]>y;)H[x]=0,x||(++T,H=[1].concat(H));for(I=H.length;!H[--I];);for(Y=0,g="";Y<=I;g+=k.charAt(H[Y++]));g=St(g,T,k.charAt(0))}return g}}(),e=function(){function d(v,y,S){var F,k,x,T,I=0,_=v.length,q=y%Rt,H=y/Rt|0;for(v=v.slice();_--;)x=v[_]%Rt,T=v[_]/Rt|0,F=H*x+T*q,k=q*x+F%Rt*Rt+I,I=(k/S|0)+(F/Rt|0)+H*T,v[_]=k%S;return I&&(v=[I].concat(v)),v}function f(v,y,S,F){var k,x;if(S!=F)x=S>F?1:-1;else for(k=x=0;k<S;k++)if(v[k]!=y[k]){x=v[k]>y[k]?1:-1;break}return x}function g(v,y,S,F){for(var k=0;S--;)v[S]-=k,k=v[S]<y[S]?1:0,v[S]=k*F+v[S]-y[S];for(;!v[0]&&v.length>1;v.splice(0,1));}return function(v,y,S,F,k){var x,T,I,_,q,H,X,Y,K,U,Z,te,bt,wt,Gt,Ae,Oe,ve=v.s==y.s?1:-1,ue=v.c,se=y.c;if(!ue||!ue[0]||!se||!se[0])return new E(!v.s||!y.s||(ue?se&&ue[0]==se[0]:!se)?NaN:ue&&ue[0]==0||!se?ve*0:ve/0);for(Y=new E(ve),K=Y.c=[],T=v.e-y.e,ve=S+T+1,k||(k=tt,T=Ze(v.e/$)-Ze(y.e/$),ve=ve/$|0),I=0;se[I]==(ue[I]||0);I++);if(se[I]>(ue[I]||0)&&T--,ve<0)K.push(1),_=!0;else{for(wt=ue.length,Ae=se.length,I=0,ve+=2,q=We(k/(se[0]+1)),q>1&&(se=d(se,q,k),ue=d(ue,q,k),Ae=se.length,wt=ue.length),bt=Ae,U=ue.slice(0,Ae),Z=U.length;Z<Ae;U[Z++]=0);Oe=se.slice(),Oe=[0].concat(Oe),Gt=se[0],se[1]>=k/2&&Gt++;do{if(q=0,x=f(se,U,Ae,Z),x<0){if(te=U[0],Ae!=Z&&(te=te*k+(U[1]||0)),q=We(te/Gt),q>1)for(q>=k&&(q=k-1),H=d(se,q,k),X=H.length,Z=U.length;f(H,U,X,Z)==1;)q--,g(H,Ae<X?Oe:se,X,k),X=H.length,x=1;else q==0&&(x=q=1),H=se.slice(),X=H.length;if(X<Z&&(H=[0].concat(H)),g(U,H,Z,k),Z=U.length,x==-1)for(;f(se,U,Ae,Z)<1;)q++,g(U,Ae<Z?Oe:se,Z,k),Z=U.length}else x===0&&(q++,U=[0]);K[I++]=q,U[0]?U[Z++]=ue[bt]||0:(U=[ue[bt]],Z=1)}while((bt++<wt||U[0]!=null)&&ve--);_=U[0]!=null,K[0]||K.splice(0,1)}if(k==tt){for(I=1,ve=K[0];ve>=10;ve/=10,I++);G(Y,S+(Y.e=I+T*$-1)+1,F,_)}else Y.e=T,Y.r=+_;return Y}}();function B(d,f,g,v){var y,S,F,k,x;if(g==null?g=s:he(g,0,8),!d.c)return d.toString();if(y=d.c[0],F=d.e,f==null)x=Ye(d.c),x=v==1||v==2&&(F<=l||F>=u)?Qr(x,F):St(x,F,"0");else if(d=G(new E(d),f,g),S=d.e,x=Ye(d.c),k=x.length,v==1||v==2&&(f<=S||S<=l)){for(;k<f;x+="0",k++);x=Qr(x,S)}else if(f-=F,x=St(x,S,"0"),S+1>k){if(--f>0)for(x+=".";f--;x+="0");}else if(f+=S-k,f>0)for(S+1==k&&(x+=".");f--;x+="0");return d.s<0&&y?"-"+x:x}function O(d,f){for(var g,v,y=1,S=new E(d[0]);y<d.length;y++)v=new E(d[y]),(!v.s||(g=Kt(S,v))===f||g===0&&S.s===f)&&(S=v);return S}function R(d,f,g){for(var v=1,y=f.length;!f[--y];f.pop());for(y=f[0];y>=10;y/=10,v++);return(g=v+g*$-1)>c?d.c=d.e=null:g<h?d.c=[d.e=0]:(d.e=g,d.c=f),d}r=function(){var d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,f=/^([^.]+)\.$/,g=/^\.([^.]+)$/,v=/^-?(Infinity|NaN)$/,y=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(S,F,k,x){var T,I=k?F:F.replace(y,"");if(v.test(I))S.s=isNaN(I)?null:I<0?-1:1;else{if(!k&&(I=I.replace(d,function(_,q,H){return T=(H=H.toLowerCase())=="x"?16:H=="b"?2:8,!x||x==T?q:_}),x&&(T=x,I=I.replace(f,"$1").replace(g,"0.$1")),F!=I))return new E(I,T);if(E.DEBUG)throw Error(Ne+"Not a"+(x?" base "+x:"")+" number: "+F);S.s=null}S.c=S.e=null}}();function G(d,f,g,v){var y,S,F,k,x,T,I,_=d.c,q=To;if(_){e:{for(y=1,k=_[0];k>=10;k/=10,y++);if(S=f-y,S<0)S+=$,F=f,x=_[T=0],I=We(x/q[y-F-1]%10);else if(T=Fo((S+1)/$),T>=_.length)if(v){for(;_.length<=T;_.push(0));x=I=0,y=1,S%=$,F=S-$+1}else break e;else{for(x=k=_[T],y=1;k>=10;k/=10,y++);S%=$,F=S-$+y,I=F<0?0:We(x/q[y-F-1]%10)}if(v=v||f<0||_[T+1]!=null||(F<0?x:x%q[y-F-1]),v=g<4?(I||v)&&(g==0||g==(d.s<0?3:2)):I>5||I==5&&(g==4||v||g==6&&(S>0?F>0?x/q[y-F]:0:_[T-1])%10&1||g==(d.s<0?8:7)),f<1||!_[0])return _.length=0,v?(f-=d.e+1,_[0]=q[($-f%$)%$],d.e=-f||0):_[0]=d.e=0,d;if(S==0?(_.length=T,k=1,T--):(_.length=T+1,k=q[$-S],_[T]=F>0?We(x/q[y-F]%q[F])*k:0),v)for(;;)if(T==0){for(S=1,F=_[0];F>=10;F/=10,S++);for(F=_[0]+=k,k=1;F>=10;F/=10,k++);S!=k&&(d.e++,_[0]==tt&&(_[0]=1));break}else{if(_[T]+=k,_[T]!=tt)break;_[T--]=0,k=1}for(S=_.length;_[--S]===0;_.pop());}d.e>c?d.c=d.e=null:d.e<h&&(d.c=[d.e=0])}return d}function J(d){var f,g=d.e;return g===null?d.toString():(f=Ye(d.c),f=g<=l||g>=u?Qr(f,g):St(f,g,"0"),d.s<0?"-"+f:f)}return i.absoluteValue=i.abs=function(){var d=new E(this);return d.s<0&&(d.s=1),d},i.comparedTo=function(d,f){return Kt(this,new E(d,f))},i.decimalPlaces=i.dp=function(d,f){var g,v,y,S=this;if(d!=null)return he(d,0,Re),f==null?f=s:he(f,0,8),G(new E(S),d+S.e+1,f);if(!(g=S.c))return null;if(v=((y=g.length-1)-Ze(this.e/$))*$,y=g[y])for(;y%10==0;y/=10,v--);return v<0&&(v=0),v},i.dividedBy=i.div=function(d,f){return e(this,new E(d,f),a,s)},i.dividedToIntegerBy=i.idiv=function(d,f){return e(this,new E(d,f),0,1)},i.exponentiatedBy=i.pow=function(d,f){var g,v,y,S,F,k,x,T,I,_=this;if(d=new E(d),d.c&&!d.isInteger())throw Error(Ne+"Exponent not an integer: "+J(d));if(f!=null&&(f=new E(f)),k=d.e>14,!_.c||!_.c[0]||_.c[0]==1&&!_.e&&_.c.length==1||!d.c||!d.c[0])return I=new E(Math.pow(+J(_),k?d.s*(2-Xr(d)):+J(d))),f?I.mod(f):I;if(x=d.s<0,f){if(f.c?!f.c[0]:!f.s)return new E(NaN);v=!x&&_.isInteger()&&f.isInteger(),v&&(_=_.mod(f))}else{if(d.e>9&&(_.e>0||_.e<-1||(_.e==0?_.c[0]>1||k&&_.c[1]>=24e7:_.c[0]<8e13||k&&_.c[0]<=9999975e7)))return S=_.s<0&&Xr(d)?-0:0,_.e>-1&&(S=1/S),new E(x?1/S:S);A&&(S=Fo(A/$+2))}for(k?(g=new E(.5),x&&(d.s=1),T=Xr(d)):(y=Math.abs(+J(d)),T=y%2),I=new E(o);;){if(T){if(I=I.times(_),!I.c)break;S?I.c.length>S&&(I.c.length=S):v&&(I=I.mod(f))}if(y){if(y=We(y/2),y===0)break;T=y%2}else if(d=d.times(g),G(d,d.e+1,1),d.e>14)T=Xr(d);else{if(y=+J(d),y===0)break;T=y%2}_=_.times(_),S?_.c&&_.c.length>S&&(_.c.length=S):v&&(_=_.mod(f))}return v?I:(x&&(I=o.div(I)),f?I.mod(f):S?G(I,A,s,F):I)},i.integerValue=function(d){var f=new E(this);return d==null?d=s:he(d,0,8),G(f,f.e+1,d)},i.isEqualTo=i.eq=function(d,f){return Kt(this,new E(d,f))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(d,f){return Kt(this,new E(d,f))>0},i.isGreaterThanOrEqualTo=i.gte=function(d,f){return(f=Kt(this,new E(d,f)))===1||f===0},i.isInteger=function(){return!!this.c&&Ze(this.e/$)>this.c.length-2},i.isLessThan=i.lt=function(d,f){return Kt(this,new E(d,f))<0},i.isLessThanOrEqualTo=i.lte=function(d,f){return(f=Kt(this,new E(d,f)))===-1||f===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(d,f){var g,v,y,S,F=this,k=F.s;if(d=new E(d,f),f=d.s,!k||!f)return new E(NaN);if(k!=f)return d.s=-f,F.plus(d);var x=F.e/$,T=d.e/$,I=F.c,_=d.c;if(!x||!T){if(!I||!_)return I?(d.s=-f,d):new E(_?F:NaN);if(!I[0]||!_[0])return _[0]?(d.s=-f,d):new E(I[0]?F:s==3?-0:0)}if(x=Ze(x),T=Ze(T),I=I.slice(),k=x-T){for((S=k<0)?(k=-k,y=I):(T=x,y=_),y.reverse(),f=k;f--;y.push(0));y.reverse()}else for(v=(S=(k=I.length)<(f=_.length))?k:f,k=f=0;f<v;f++)if(I[f]!=_[f]){S=I[f]<_[f];break}if(S&&(y=I,I=_,_=y,d.s=-d.s),f=(v=_.length)-(g=I.length),f>0)for(;f--;I[g++]=0);for(f=tt-1;v>k;){if(I[--v]<_[v]){for(g=v;g&&!I[--g];I[g]=f);--I[g],I[v]+=tt}I[v]-=_[v]}for(;I[0]==0;I.splice(0,1),--T);return I[0]?R(d,I,T):(d.s=s==3?-1:1,d.c=[d.e=0],d)},i.modulo=i.mod=function(d,f){var g,v,y=this;return d=new E(d,f),!y.c||!d.s||d.c&&!d.c[0]?new E(NaN):!d.c||y.c&&!y.c[0]?new E(y):(m==9?(v=d.s,d.s=1,g=e(y,d,0,3),d.s=v,g.s*=v):g=e(y,d,0,m),d=y.minus(g.times(d)),!d.c[0]&&m==1&&(d.s=y.s),d)},i.multipliedBy=i.times=function(d,f){var g,v,y,S,F,k,x,T,I,_,q,H,X,Y,K,U=this,Z=U.c,te=(d=new E(d,f)).c;if(!Z||!te||!Z[0]||!te[0])return!U.s||!d.s||Z&&!Z[0]&&!te||te&&!te[0]&&!Z?d.c=d.e=d.s=null:(d.s*=U.s,!Z||!te?d.c=d.e=null:(d.c=[0],d.e=0)),d;for(v=Ze(U.e/$)+Ze(d.e/$),d.s*=U.s,x=Z.length,_=te.length,x<_&&(X=Z,Z=te,te=X,y=x,x=_,_=y),y=x+_,X=[];y--;X.push(0));for(Y=tt,K=Rt,y=_;--y>=0;){for(g=0,q=te[y]%K,H=te[y]/K|0,F=x,S=y+F;S>y;)T=Z[--F]%K,I=Z[F]/K|0,k=H*T+I*q,T=q*T+k%K*K+X[S]+g,g=(T/Y|0)+(k/K|0)+H*I,X[S--]=T%Y;X[S]=g}return g?++v:X.splice(0,1),R(d,X,v)},i.negated=function(){var d=new E(this);return d.s=-d.s||null,d},i.plus=function(d,f){var g,v=this,y=v.s;if(d=new E(d,f),f=d.s,!y||!f)return new E(NaN);if(y!=f)return d.s=-f,v.minus(d);var S=v.e/$,F=d.e/$,k=v.c,x=d.c;if(!S||!F){if(!k||!x)return new E(y/0);if(!k[0]||!x[0])return x[0]?d:new E(k[0]?v:y*0)}if(S=Ze(S),F=Ze(F),k=k.slice(),y=S-F){for(y>0?(F=S,g=x):(y=-y,g=k),g.reverse();y--;g.push(0));g.reverse()}for(y=k.length,f=x.length,y-f<0&&(g=x,x=k,k=g,f=y),y=0;f;)y=(k[--f]=k[f]+x[f]+y)/tt|0,k[f]=tt===k[f]?0:k[f]%tt;return y&&(k=[y].concat(k),++F),R(d,k,F)},i.precision=i.sd=function(d,f){var g,v,y,S=this;if(d!=null&&d!==!!d)return he(d,1,Re),f==null?f=s:he(f,0,8),G(new E(S),d,f);if(!(g=S.c))return null;if(y=g.length-1,v=y*$+1,y=g[y]){for(;y%10==0;y/=10,v--);for(y=g[0];y>=10;y/=10,v++);}return d&&S.e+1>v&&(v=S.e+1),v},i.shiftedBy=function(d){return he(d,-9007199254740991,Vl),this.times("1e"+d)},i.squareRoot=i.sqrt=function(){var d,f,g,v,y,S=this,F=S.c,k=S.s,x=S.e,T=a+4,I=new E("0.5");if(k!==1||!F||!F[0])return new E(!k||k<0&&(!F||F[0])?NaN:F?S:1/0);if(k=Math.sqrt(+J(S)),k==0||k==1/0?(f=Ye(F),(f.length+x)%2==0&&(f+="0"),k=Math.sqrt(+f),x=Ze((x+1)/2)-(x<0||x%2),k==1/0?f="5e"+x:(f=k.toExponential(),f=f.slice(0,f.indexOf("e")+1)+x),g=new E(f)):g=new E(k+""),g.c[0]){for(x=g.e,k=x+T,k<3&&(k=0);;)if(y=g,g=I.times(y.plus(e(S,y,T,1))),Ye(y.c).slice(0,k)===(f=Ye(g.c)).slice(0,k))if(g.e<x&&--k,f=f.slice(k-3,k+1),f=="9999"||!v&&f=="4999"){if(!v&&(G(y,y.e+a+2,0),y.times(y).eq(S))){g=y;break}T+=4,k+=4,v=1}else{(!+f||!+f.slice(1)&&f.charAt(0)=="5")&&(G(g,g.e+a+2,1),d=!g.times(g).eq(S));break}}return G(g,g.e+a+1,s,d)},i.toExponential=function(d,f){return d!=null&&(he(d,0,Re),d++),B(this,d,f,1)},i.toFixed=function(d,f){return d!=null&&(he(d,0,Re),d=d+this.e+1),B(this,d,f)},i.toFormat=function(d,f,g){var v,y=this;if(g==null)d!=null&&f&&typeof f=="object"?(g=f,f=null):d&&typeof d=="object"?(g=d,d=f=null):g=M;else if(typeof g!="object")throw Error(Ne+"Argument not an object: "+g);if(v=y.toFixed(d,f),y.c){var S,F=v.split("."),k=+g.groupSize,x=+g.secondaryGroupSize,T=g.groupSeparator||"",I=F[0],_=F[1],q=y.s<0,H=q?I.slice(1):I,X=H.length;if(x&&(S=k,k=x,x=S,X-=S),k>0&&X>0){for(S=X%k||k,I=H.substr(0,S);S<X;S+=k)I+=T+H.substr(S,k);x>0&&(I+=T+H.slice(S)),q&&(I="-"+I)}v=_?I+(g.decimalSeparator||"")+((x=+g.fractionGroupSize)?_.replace(new RegExp("\\d{"+x+"}\\B","g"),"$&"+(g.fractionGroupSeparator||"")):_):I}return(g.prefix||"")+v+(g.suffix||"")},i.toFraction=function(d){var f,g,v,y,S,F,k,x,T,I,_,q,H=this,X=H.c;if(d!=null&&(k=new E(d),!k.isInteger()&&(k.c||k.s!==1)||k.lt(o)))throw Error(Ne+"Argument "+(k.isInteger()?"out of range: ":"not an integer: ")+J(k));if(!X)return new E(H);for(f=new E(o),T=g=new E(o),v=x=new E(o),q=Ye(X),S=f.e=q.length-H.e-1,f.c[0]=To[(F=S%$)<0?$+F:F],d=!d||k.comparedTo(f)>0?S>0?f:T:k,F=c,c=1/0,k=new E(q),x.c[0]=0;I=e(k,f,0,1),y=g.plus(I.times(v)),y.comparedTo(d)!=1;)g=v,v=y,T=x.plus(I.times(y=T)),x=y,f=k.minus(I.times(y=f)),k=y;return y=e(d.minus(g),v,0,1),x=x.plus(y.times(T)),g=g.plus(y.times(v)),x.s=T.s=H.s,S=S*2,_=e(T,v,S,s).minus(H).abs().comparedTo(e(x,g,S,s).minus(H).abs())<1?[T,v]:[x,g],c=F,_},i.toNumber=function(){return+J(this)},i.toPrecision=function(d,f){return d!=null&&he(d,1,Re),B(this,d,f,2)},i.toString=function(d){var f,g=this,v=g.s,y=g.e;return y===null?v?(f="Infinity",v<0&&(f="-"+f)):f="NaN":(d==null?f=y<=l||y>=u?Qr(Ye(g.c),y):St(Ye(g.c),y,"0"):d===10&&P?(g=G(new E(g),a+y+1,s),f=St(Ye(g.c),g.e,"0")):(he(d,2,D.length,"Base"),f=n(St(Ye(g.c),y,"0"),10,d,v,!0)),v<0&&g.c[0]&&(f="-"+f)),f},i.valueOf=i.toJSON=function(){return J(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,t!=null&&E.set(t),E}function Ze(t){var e=t|0;return t>0||t===e?e:e-1}function Ye(t){for(var e,n,r=1,i=t.length,o=t[0]+"";r<i;){for(e=t[r++]+"",n=$-e.length;n--;e="0"+e);o+=e}for(i=o.length;o.charCodeAt(--i)===48;);return o.slice(0,i+1||1)}function Kt(t,e){var n,r,i=t.c,o=e.c,a=t.s,s=e.s,l=t.e,u=e.e;if(!a||!s)return null;if(n=i&&!i[0],r=o&&!o[0],n||r)return n?r?0:-s:a;if(a!=s)return a;if(n=a<0,r=l==u,!i||!o)return r?0:!i^n?1:-1;if(!r)return l>u^n?1:-1;for(s=(l=i.length)<(u=o.length)?l:u,a=0;a<s;a++)if(i[a]!=o[a])return i[a]>o[a]^n?1:-1;return l==u?0:l>u^n?1:-1}function he(t,e,n,r){if(t<e||t>n||t!==We(t))throw Error(Ne+(r||"Argument")+(typeof t=="number"?t<e||t>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function Xr(t){var e=t.c.length-1;return Ze(t.e/$)==e&&t.c[e]%2!=0}function Qr(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function St(t,e,n){var r,i;if(e<0){for(i=n+".";++e;i+=n);t=i+t}else if(r=t.length,++e>r){for(i=n,e-=r;--e;i+=n);t+=i}else e<r&&(t=t.slice(0,e)+"."+t.slice(e));return t}var pt=dd(),hb=class{constructor(t){b(this,"key"),b(this,"left",null),b(this,"right",null),this.key=t}},tr=class extends hb{constructor(t){super(t)}},fb=class{constructor(){b(this,"size",0),b(this,"modificationCount",0),b(this,"splayCount",0)}splay(t){const e=this.root;if(e==null)return this.compare(t,t),-1;let n=null,r=null,i=null,o=null,a=e;const s=this.compare;let l;for(;;)if(l=s(a.key,t),l>0){let u=a.left;if(u==null||(l=s(u.key,t),l>0&&(a.left=u.right,u.right=a,a=u,u=a.left,u==null)))break;n==null?r=a:n.left=a,n=a,a=u}else if(l<0){let u=a.right;if(u==null||(l=s(u.key,t),l<0&&(a.right=u.left,u.left=a,a=u,u=a.right,u==null)))break;i==null?o=a:i.right=a,i=a,a=u}else break;return i!=null&&(i.right=a.left,a.left=o),n!=null&&(n.left=a.right,a.right=r),this.root!==a&&(this.root=a,this.splayCount++),l}splayMin(t){let e=t,n=e.left;for(;n!=null;){const r=n;e.left=r.right,r.right=e,e=r,n=e.left}return e}splayMax(t){let e=t,n=e.right;for(;n!=null;){const r=n;e.right=r.left,r.left=e,e=r,n=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let e=this.root;const n=e,r=e.left;if(this.size--,r==null)this.root=e.right;else{const i=e.right;e=this.splayMax(r),e.right=i,this.root=e}return this.modificationCount++,n}addNewRoot(t,e){this.size++,this.modificationCount++;const n=this.root;if(n==null){this.root=t;return}e<0?(t.left=n,t.right=n.right,n.right=null):(t.right=n,t.left=n.left,n.left=null),this.root=t}_first(){const t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){const t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},ql,Yl,Di=class lr extends fb{constructor(e,n){super(),b(this,"root",null),b(this,"compare"),b(this,"validKey"),b(this,ql,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=n??(r=>r!=null&&r!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const n of e)this.delete(n)}forEach(e){const n=this[Symbol.iterator]();let r;for(;r=n.next(),!r.done;)e(r.value,r.value,this)}add(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new tr(e),n),this}addAndReturn(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new tr(e),n),this.root.key}addAll(e){for(const n of e)this.add(n)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let r=n.right;for(;r!=null;)n=r,r=n.right;return n.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let r=n.left;for(;r!=null;)n=r,r=n.left;return n.key}retainAll(e){const n=new lr(this.compare,this.validKey),r=this.modificationCount;for(const i of e){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(i)&&this.splay(i)==0&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const n=new lr(this.compare,this.validKey);for(const r of this)e.has(r)&&n.add(r);return n}difference(e){const n=new lr(this.compare,this.validKey);for(const r of this)e.has(r)||n.add(r);return n}union(e){const n=this.clone();return n.addAll(e),n}clone(){const e=new lr(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function n(i,o){let a,s;do{if(a=i.left,s=i.right,a!=null){const l=new tr(a.key);o.left=l,n(a,l)}if(s!=null){const l=new tr(s.key);o.right=l,i=s,o=l}}while(s!=null)}const r=new tr(e.key);return n(e,r),r}toSet(){return this.clone()}entries(){return new gb(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Yl=Symbol.iterator,ql=Symbol.toStringTag,Yl)](){return new pb(this.wrap())}},hd=class{constructor(t){b(this,"tree"),b(this,"path",new Array),b(this,"modificationCount",null),b(this,"splayCount"),this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let n=this.tree.getRoot();for(;n!=null;)this.path.push(n),n=n.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},pb=class extends hd{getValue(t){return t.key}},gb=class extends hd{getValue(t){return[t.key,t.key]}},fd=t=>()=>t,da=t=>{const e=t?(n,r)=>r.minus(n).abs().isLessThanOrEqualTo(t):fd(!1);return(n,r)=>e(n,r)?0:n.comparedTo(r)};function mb(t){const e=t?(n,r,i,o,a)=>n.exponentiatedBy(2).isLessThanOrEqualTo(o.minus(r).exponentiatedBy(2).plus(a.minus(i).exponentiatedBy(2)).times(t)):fd(!1);return(n,r,i)=>{const o=n.x,a=n.y,s=i.x,l=i.y,u=a.minus(l).times(r.x.minus(s)).minus(o.minus(s).times(r.y.minus(l)));return e(u,o,a,s,l)?0:u.comparedTo(0)}}var vb=t=>t,yb=t=>{if(t){const e=new Di(da(t)),n=new Di(da(t)),r=(o,a)=>a.addAndReturn(o),i=o=>({x:r(o.x,e),y:r(o.y,n)});return i({x:new pt(0),y:new pt(0)}),i}return vb},ha=t=>({set:e=>{Ft=ha(e)},reset:()=>ha(t),compare:da(t),snap:yb(t),orient:mb(t)}),Ft=ha(),nr=(t,e)=>t.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(t.ur.y),fa=(t,e)=>{if(e.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(e.ll.y))return null;const n=t.ll.x.isLessThan(e.ll.x)?e.ll.x:t.ll.x,r=t.ur.x.isLessThan(e.ur.x)?t.ur.x:e.ur.x,i=t.ll.y.isLessThan(e.ll.y)?e.ll.y:t.ll.y,o=t.ur.y.isLessThan(e.ur.y)?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:o}}},ci=(t,e)=>t.x.times(e.y).minus(t.y.times(e.x)),pd=(t,e)=>t.x.times(e.x).plus(t.y.times(e.y)),Pi=t=>pd(t,t).sqrt(),bb=(t,e,n)=>{const r={x:e.x.minus(t.x),y:e.y.minus(t.y)},i={x:n.x.minus(t.x),y:n.y.minus(t.y)};return ci(i,r).div(Pi(i)).div(Pi(r))},wb=(t,e,n)=>{const r={x:e.x.minus(t.x),y:e.y.minus(t.y)},i={x:n.x.minus(t.x),y:n.y.minus(t.y)};return pd(i,r).div(Pi(i)).div(Pi(r))},Wl=(t,e,n)=>e.y.isZero()?null:{x:t.x.plus(e.x.div(e.y).times(n.minus(t.y))),y:n},Zl=(t,e,n)=>e.x.isZero()?null:{x:n,y:t.y.plus(e.y.div(e.x).times(n.minus(t.x)))},Eb=(t,e,n,r)=>{if(e.x.isZero())return Zl(n,r,t.x);if(r.x.isZero())return Zl(t,e,n.x);if(e.y.isZero())return Wl(n,r,t.y);if(r.y.isZero())return Wl(t,e,n.y);const i=ci(e,r);if(i.isZero())return null;const o={x:n.x.minus(t.x),y:n.y.minus(t.y)},a=ci(o,e).div(i),s=ci(o,r).div(i),l=t.x.plus(s.times(e.x)),u=n.x.plus(a.times(r.x)),h=t.y.plus(s.times(e.y)),c=n.y.plus(a.times(r.y)),p=l.plus(u).div(2),m=h.plus(c).div(2);return{x:p,y:m}},ct=class gd{constructor(e,n){b(this,"point"),b(this,"isLeft"),b(this,"segment"),b(this,"otherSE"),b(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}static compare(e,n){const r=gd.comparePoints(e.point,n.point);return r!==0?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:Fi.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x.isLessThan(n.x)?-1:e.x.isGreaterThan(n.x)?1:e.y.isLessThan(n.y)?-1:e.y.isGreaterThan(n.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let r=0,i=n.length;r<i;r++){const o=n[r];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const r=this.point.events[n];if(r.segment.consumedBy===void 0)for(let i=n+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&r.otherSE.point.events===o.otherSE.point.events&&r.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,r=this.point.events.length;n<r;n++){const i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const n=new Map,r=i=>{const o=i.otherSE;n.set(i,{sine:bb(this.point,e.point,o.point),cosine:wb(this.point,e.point,o.point)})};return(i,o)=>{n.has(i)||r(i),n.has(o)||r(o);const{sine:a,cosine:s}=n.get(i),{sine:l,cosine:u}=n.get(o);return a.isGreaterThanOrEqualTo(0)&&l.isGreaterThanOrEqualTo(0)?s.isLessThan(u)?1:s.isGreaterThan(u)?-1:0:a.isLessThan(0)&&l.isLessThan(0)?s.isLessThan(u)?-1:s.isGreaterThan(u)?1:0:l.isLessThan(a)?-1:l.isGreaterThan(a)?1:0}}},kb=class pa{constructor(e){b(this,"events"),b(this,"poly"),b(this,"_isExteriorRing"),b(this,"_enclosingRing"),this.events=e;for(let n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}static factory(e){const n=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];if(!o.isInResult()||o.ringOut)continue;let a=null,s=o.leftSE,l=o.rightSE;const u=[s],h=s.point,c=[];for(;a=s,s=l,u.push(s),s.point!==h;)for(;;){const p=s.getAvailableLinkedEvents();if(p.length===0){const M=u[0].point,D=u[u.length-1].point;throw new Error(`Unable to complete output ring starting at [${M.x}, ${M.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(p.length===1){l=p[0].otherSE;break}let m=null;for(let M=0,D=c.length;M<D;M++)if(c[M].point===s.point){m=M;break}if(m!==null){const M=c.splice(m)[0],D=u.splice(M.index);D.unshift(D[0].otherSE),n.push(new pa(D.reverse()));continue}c.push({index:u.length,point:s.point});const A=s.getLeftmostComparator(a);l=p.sort(A)[0].otherSE;break}n.push(new pa(u))}return n}getGeom(){let e=this.events[0].point;const n=[e];for(let u=1,h=this.events.length-1;u<h;u++){const c=this.events[u].point,p=this.events[u+1].point;Ft.orient(c,e,p)!==0&&(n.push(c),e=c)}if(n.length===1)return null;const r=n[0],i=n[1];Ft.orient(r,e,i)===0&&n.shift(),n.push(n[0]);const o=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:n.length-1,s=this.isExteriorRing()?n.length:-1,l=[];for(let u=a;u!=s;u+=o)l.push([n[u].x.toNumber(),n[u].y.toNumber()]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,n;let r=this.events[0];for(let a=1,s=this.events.length;a<s;a++){const l=this.events[a];ct.compare(r,l)>0&&(r=l)}let i=r.segment.prevInResult(),o=i?i.prevInResult():null;for(;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return((e=o.ringOut)==null?void 0:e.enclosingRing())!==i.ringOut?i.ringOut:(n=i.ringOut)==null?void 0:n.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}},$l=class{constructor(t){b(this,"exteriorRing"),b(this,"interiorRings"),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=this.exteriorRing.getGeom();if(t===null)return null;const e=[t];for(let n=0,r=this.interiorRings.length;n<r;n++){const i=this.interiorRings[n].getGeom();i!==null&&e.push(i)}return e}},Mb=class{constructor(t){b(this,"rings"),b(this,"polys"),this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const r=this.polys[e].getGeom();r!==null&&t.push(r)}return t}_composePolys(t){var e;const n=[];for(let r=0,i=t.length;r<i;r++){const o=t[r];if(!o.poly)if(o.isExteriorRing())n.push(new $l(o));else{const a=o.enclosingRing();a!=null&&a.poly||n.push(new $l(a)),(e=a==null?void 0:a.poly)==null||e.addInterior(o)}}return n}},xb=class{constructor(t,e=Fi.compare){b(this,"queue"),b(this,"tree"),b(this,"segments"),this.queue=t,this.tree=new Di(e),this.segments=[]}process(t){const e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),n;t.isLeft&&this.tree.add(e);let r=e,i=e;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(t.isLeft){let o=null;if(r){const s=r.getIntersection(e);if(s!==null&&(e.isAnEndpoint(s)||(o=s),!r.isAnEndpoint(s))){const l=this._splitSafely(r,s);for(let u=0,h=l.length;u<h;u++)n.push(l[u])}}let a=null;if(i){const s=i.getIntersection(e);if(s!==null&&(e.isAnEndpoint(s)||(a=s),!i.isAnEndpoint(s))){const l=this._splitSafely(i,s);for(let u=0,h=l.length;u<h;u++)n.push(l[u])}}if(o!==null||a!==null){let s=null;o===null?s=a:a===null?s=o:s=ct.comparePoints(o,a)<=0?o:a,this.queue.delete(e.rightSE),n.push(e.rightSE);const l=e.split(s);for(let u=0,h=l.length;u<h;u++)n.push(l[u])}n.length>0?(this.tree.delete(e),n.push(t)):(this.segments.push(e),e.prev=r)}else{if(r&&i){const o=r.getIntersection(i);if(o!==null){if(!r.isAnEndpoint(o)){const a=this._splitSafely(r,o);for(let s=0,l=a.length;s<l;s++)n.push(a[s])}if(!i.isAnEndpoint(o)){const a=this._splitSafely(i,o);for(let s=0,l=a.length;s<l;s++)n.push(a[s])}}}this.tree.delete(e)}return n}_splitSafely(t,e){this.tree.delete(t);const n=t.rightSE;this.queue.delete(n);const r=t.split(e);return r.push(n),t.consumedBy===void 0&&this.tree.add(t),r}},Sb=class{constructor(){b(this,"type"),b(this,"numMultiPolys")}run(t,e,n){ur.type=t;const r=[new Xl(e,!0)];for(let l=0,u=n.length;l<u;l++)r.push(new Xl(n[l],!1));if(ur.numMultiPolys=r.length,ur.type==="difference"){const l=r[0];let u=1;for(;u<r.length;)fa(r[u].bbox,l.bbox)!==null?u++:r.splice(u,1)}if(ur.type==="intersection")for(let l=0,u=r.length;l<u;l++){const h=r[l];for(let c=l+1,p=r.length;c<p;c++)if(fa(h.bbox,r[c].bbox)===null)return[]}const i=new Di(ct.compare);for(let l=0,u=r.length;l<u;l++){const h=r[l].getSweepEvents();for(let c=0,p=h.length;c<p;c++)i.add(h[c])}const o=new xb(i);let a=null;for(i.size!=0&&(a=i.first(),i.delete(a));a;){const l=o.process(a);for(let u=0,h=l.length;u<h;u++){const c=l[u];c.consumedBy===void 0&&i.add(c)}i.size!=0?(a=i.first(),i.delete(a)):a=null}Ft.reset();const s=kb.factory(o.segments);return new Mb(s).getGeom()}},ur=new Sb,ga=ur,Ab=0,Fi=class di{constructor(e,n,r,i){b(this,"id"),b(this,"leftSE"),b(this,"rightSE"),b(this,"rings"),b(this,"windings"),b(this,"ringOut"),b(this,"consumedBy"),b(this,"prev"),b(this,"_prevInResult"),b(this,"_beforeState"),b(this,"_afterState"),b(this,"_isInResult"),this.id=++Ab,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}static compare(e,n){const r=e.leftSE.point.x,i=n.leftSE.point.x,o=e.rightSE.point.x,a=n.rightSE.point.x;if(a.isLessThan(r))return 1;if(o.isLessThan(i))return-1;const s=e.leftSE.point.y,l=n.leftSE.point.y,u=e.rightSE.point.y,h=n.rightSE.point.y;if(r.isLessThan(i)){if(l.isLessThan(s)&&l.isLessThan(u))return 1;if(l.isGreaterThan(s)&&l.isGreaterThan(u))return-1;const c=e.comparePoint(n.leftSE.point);if(c<0)return 1;if(c>0)return-1;const p=n.comparePoint(e.rightSE.point);return p!==0?p:-1}if(r.isGreaterThan(i)){if(s.isLessThan(l)&&s.isLessThan(h))return-1;if(s.isGreaterThan(l)&&s.isGreaterThan(h))return 1;const c=n.comparePoint(e.leftSE.point);if(c!==0)return c;const p=e.comparePoint(n.rightSE.point);return p<0?1:p>0?-1:1}if(s.isLessThan(l))return-1;if(s.isGreaterThan(l))return 1;if(o.isLessThan(a)){const c=n.comparePoint(e.rightSE.point);if(c!==0)return c}if(o.isGreaterThan(a)){const c=e.comparePoint(n.rightSE.point);if(c<0)return 1;if(c>0)return-1}if(!o.eq(a)){const c=u.minus(s),p=o.minus(r),m=h.minus(l),A=a.minus(i);if(c.isGreaterThan(p)&&m.isLessThan(A))return 1;if(c.isLessThan(p)&&m.isGreaterThan(A))return-1}return o.isGreaterThan(a)?1:o.isLessThan(a)||u.isLessThan(h)?-1:u.isGreaterThan(h)?1:e.id<n.id?-1:e.id>n.id?1:0}static fromRing(e,n,r){let i,o,a;const s=ct.comparePoints(e,n);if(s<0)i=e,o=n,a=1;else if(s>0)i=n,o=e,a=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const l=new ct(i,!0),u=new ct(o,!1);return new di(l,u,[r],[a])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(n)?e:n},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(n)?e:n}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Ft.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const n=this.bbox(),r=e.bbox(),i=fa(n,r);if(i===null)return null;const o=this.leftSE.point,a=this.rightSE.point,s=e.leftSE.point,l=e.rightSE.point,u=nr(n,s)&&this.comparePoint(s)===0,h=nr(r,o)&&e.comparePoint(o)===0,c=nr(n,l)&&this.comparePoint(l)===0,p=nr(r,a)&&e.comparePoint(a)===0;if(h&&u)return p&&!c?a:!p&&c?l:null;if(h)return c&&o.x.eq(l.x)&&o.y.eq(l.y)?null:o;if(u)return p&&a.x.eq(s.x)&&a.y.eq(s.y)?null:s;if(p&&c)return null;if(p)return a;if(c)return l;const m=Eb(o,this.vector(),s,e.vector());return m===null||!nr(i,m)?null:Ft.snap(m)}split(e){const n=[],r=e.events!==void 0,i=new ct(e,!0),o=new ct(e,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);const s=new di(i,a,this.rings.slice(),this.windings.slice());return ct.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),ct.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}consume(e){let n=this,r=e;for(;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const i=di.compare(n,r);if(i!==0){if(i>0){const o=n;n=r,r=o}if(n.prev===r){const o=n;n=r,r=o}for(let o=0,a=r.rings.length;o<a;o++){const s=r.rings[o],l=r.windings[o],u=n.rings.indexOf(s);u===-1?(n.rings.push(s),n.windings.push(l)):n.windings[u]+=l}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,l=this.rings.length;s<l;s++){const u=this.rings[s],h=this.windings[s],c=n.indexOf(u);c===-1?(n.push(u),r.push(h)):r[c]+=h}const o=[],a=[];for(let s=0,l=n.length;s<l;s++){if(r[s]===0)continue;const u=n[s],h=u.poly;if(a.indexOf(h)===-1)if(u.isExterior)o.push(h);else{a.indexOf(h)===-1&&a.push(h);const c=o.indexOf(u.poly);c!==-1&&o.splice(c,1)}}for(let s=0,l=o.length;s<l;s++){const u=o[s].multiPoly;i.indexOf(u)===-1&&i.push(u)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(ga.type){case"union":{const r=e.length===0,i=n.length===0;this._isInResult=r!==i;break}case"intersection":{let r,i;e.length<n.length?(r=e.length,i=n.length):(r=n.length,i=e.length),this._isInResult=i===ga.numMultiPolys&&r<i;break}case"xor":{const r=Math.abs(e.length-n.length);this._isInResult=r%2===1;break}case"difference":{const r=i=>i.length===1&&i[0].isSubject;this._isInResult=r(e)!==r(n);break}}return this._isInResult}},Kl=class{constructor(t,e,n){if(b(this,"poly"),b(this,"isExterior"),b(this,"segments"),b(this,"bbox"),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=Ft.snap({x:new pt(t[0][0]),y:new pt(t[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let o=1,a=t.length;o<a;o++){if(typeof t[o][0]!="number"||typeof t[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=Ft.snap({x:new pt(t[o][0]),y:new pt(t[o][1])});s.x.eq(i.x)&&s.y.eq(i.y)||(this.segments.push(Fi.fromRing(i,s,this)),s.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.x),s.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.y),s.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.x),s.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.y),i=s)}(!r.x.eq(i.x)||!r.y.eq(i.y))&&this.segments.push(Fi.fromRing(i,r,this))}getSweepEvents(){const t=[];for(let e=0,n=this.segments.length;e<n;e++){const r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}},Lb=class{constructor(t,e){if(b(this,"multiPoly"),b(this,"exteriorRing"),b(this,"interiorRings"),b(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Kl(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,r=t.length;n<r;n++){const i=new Kl(t[n],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){const r=this.interiorRings[e].getSweepEvents();for(let i=0,o=r.length;i<o;i++)t.push(r[i])}return t}},Xl=class{constructor(t,e){if(b(this,"isSubject"),b(this,"polys"),b(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new pt(Number.POSITIVE_INFINITY),y:new pt(Number.POSITIVE_INFINITY)},ur:{x:new pt(Number.NEGATIVE_INFINITY),y:new pt(Number.NEGATIVE_INFINITY)}};for(let n=0,r=t.length;n<r;n++){const i=new Lb(t[n],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const r=this.polys[e].getSweepEvents();for(let i=0,o=r.length;i<o;i++)t.push(r[i])}return t}},Cb=(t,...e)=>ga.run("difference",t,e);Ft.set;function Ib(t){const e=[];if(xr(t,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const n=t.features[0].properties||{},r=Cb(e[0],...e.slice(1));return r.length===0?null:r.length===1?an(r[0],n):fu(r,n)}var Db=Ib;function md(t){var e=new $e(t);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:At(n),$e.prototype.insert.call(this,n)},e.load=function(n){var r=[];return Array.isArray(n)?n.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:At(i),r.push(i)}):Ut(n,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:At(i),r.push(i)}),$e.prototype.load.call(this,r)},e.remove=function(n,r){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:At(n),$e.prototype.remove.call(this,n,r)},e.clear=function(){return $e.prototype.clear.call(this)},e.search=function(n){var r=$e.prototype.search.call(this,this.toBBox(n));return xe(r)},e.collides=function(n){return $e.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=$e.prototype.all.call(this);return xe(n)},e.toJSON=function(){return $e.prototype.toJSON.call(this)},e.fromJSON=function(n){return $e.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var r;if(n.bbox)r=n.bbox;else if(Array.isArray(n)&&n.length===4)r=n;else if(Array.isArray(n)&&n.length===6)r=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")r=At(n);else if(n.type==="FeatureCollection")r=At(n);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},e}function Pb(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=dt(t.slice(0,2),[r,n]),a=dt(t.slice(0,2),[e,i]);if(o>=a){var s=(n+i)/2;return[e,s-(r-e)/2,r,s+(r-e)/2]}else{var l=(e+r)/2;return[l-(i-n)/2,n,l+(i-n)/2,i]}}function Fb(t,e){if(e=e??{},!Ea(e))throw new Error("options is invalid");var n=e.precision,r=e.coordinates,i=e.mutate;if(n=n==null||isNaN(n)?6:n,r=r==null||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if(typeof n!="number")throw new Error("<precision> must be a number");if(typeof r!="number")throw new Error("<coordinates> must be a number");(i===!1||i===void 0)&&(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return Zt(t,function(a){Tb(a,o,r)}),t}function Tb(t,e,n){t.length>n&&t.splice(n,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*e)/e;return t}function _b(t){if(!t)throw new Error("geojson is required");const e=[];return Vt(t,n=>{Ob(n,e)}),xe(e)}function Ob(t,e){let n=[];const r=t.geometry;if(r!==null){switch(r.type){case"Polygon":n=He(r);break;case"LineString":n=[He(r)]}n.forEach(i=>{Bb(i,t.properties).forEach(o=>{o.id=e.length,e.push(o)})})}}function Bb(t,e){const n=[];return t.reduce((r,i)=>{const o=pr([r,i],e);return o.bbox=Nb(r,i),n.push(o),i}),n}function Nb(t,e){const n=t[0],r=t[1],i=e[0],o=e[1],a=n<i?n:i,s=r<o?r:o,l=n>i?n:i,u=r>o?r:o;return[a,s,l,u]}var Gb=Object.defineProperty,Rb=Object.defineProperties,jb=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,zb=Object.prototype.hasOwnProperty,Hb=Object.prototype.propertyIsEnumerable,eu=(t,e,n)=>e in t?Gb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tu=(t,e)=>{for(var n in e||(e={}))zb.call(e,n)&&eu(t,n,e[n]);if(Ql)for(var n of Ql(e))Hb.call(e,n)&&eu(t,n,e[n]);return t},nu=(t,e)=>Rb(t,jb(e));function Jb(t,e,n={}){if(!t||!e)throw new Error("lines and pt are required arguments");const r=ge(e);let i=zt([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),o=0;return Vt(t,function(a,s,l){const u=He(a);for(let h=0;h<u.length-1;h++){const c=zt(u[h]);c.properties.dist=dt(e,c,n);const p=ge(c),m=zt(u[h+1]);m.properties.dist=dt(e,m,n);const A=ge(m),M=dt(c,m,n);let D,P;p[0]===r[0]&&p[1]===r[1]?[D,,P]=[p,void 0,!1]:A[0]===r[0]&&A[1]===r[1]?[D,,P]=[A,void 0,!0]:[D,,P]=qb(c.geometry.coordinates,m.geometry.coordinates,ge(e));let E;D&&(E=zt(D,{dist:dt(e,D,n),multiFeatureIndex:l,location:o+dt(c,D,n)})),E&&E.properties.dist<i.properties.dist&&(i=nu(tu({},E),{properties:nu(tu({},E.properties),{index:P?h+1:h})})),o+=M}}),i}function Ub(t,e){const[n,r,i]=t,[o,a,s]=e;return n*o+r*a+i*s}function Vb(t,e){const[n,r,i]=t,[o,a,s]=e;return[r*s-i*a,i*o-n*s,n*a-r*o]}function ru(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2))}function Xt(t,e){const n=Ub(t,e)/(ru(t)*ru(e));return Math.acos(Math.min(Math.max(n,-1),1))}function _o(t){const e=be(t[1]),n=be(t[0]);return[Math.cos(e)*Math.cos(n),Math.cos(e)*Math.sin(n),Math.sin(e)]}function Qt(t){const[e,n,r]=t,i=Tn(Math.asin(r));return[Tn(Math.atan2(n,e)),i]}function qb(t,e,n){const r=_o(t),i=_o(e),o=_o(n),[a,s,l]=o,[u,h,c]=Vb(r,i),p=h*l-c*s,m=c*a-u*l,A=u*s-h*a,M=A*h-m*c,D=p*c-A*u,P=m*u-p*h,E=1/Math.sqrt(Math.pow(M,2)+Math.pow(D,2)+Math.pow(P,2)),B=[M*E,D*E,P*E],O=[-1*M*E,-1*D*E,-1*P*E],R=Xt(r,i),G=Xt(r,B),J=Xt(i,B),d=Xt(r,O),f=Xt(i,O);let g;return G<d&&G<f||J<d&&J<f?g=B:g=O,Xt(r,g)>R||Xt(i,g)>R?dt(Qt(g),Qt(r))<=dt(Qt(g),Qt(i))?[Qt(r),!0,!1]:[Qt(i),!1,!0]:[Qt(g),!1,!1]}function Yb(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=As(t),r=As(e);if(n!=="LineString")throw new Error("line must be LineString");if(r==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(r==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var i=Fb(e,{precision:7});switch(r){case"Point":return ma(t,i);case"MultiPoint":return iu(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return iu(t,Dr(t,i,{ignoreSelfIntersections:!0}))}}function iu(t,e){var n=[],r=md();return Vt(e,function(i){if(n.forEach(function(s,l){s.id=l}),!n.length)n=ma(t,i).features,n.forEach(function(s){s.bbox||(s.bbox=Pb(At(s)))}),r.load(xe(n));else{var o=r.search(i);if(o.features.length){var a=vd(i,o);n=n.filter(function(s){return s.id!==a.id}),r.remove(a),Ut(ma(a,i),function(s){n.push(s),r.insert(s)})}}}),xe(n)}function ma(t,e){var n=[],r=He(t)[0],i=He(t)[t.geometry.coordinates.length-1];if(Oo(r,ge(e))||Oo(i,ge(e)))return xe([t]);var o=md(),a=_b(t);o.load(a);var s=o.search(e);if(!s.features.length)return xe([t]);var l=vd(e,s),u=[r],h=Ah(a,function(c,p,m){var A=He(p)[1],M=ge(e);return m===l.id?(c.push(M),n.push(pr(c)),Oo(M,A)?[M]:[M,A]):(c.push(A),c)},u);return h.length>1&&n.push(pr(h)),xe(n)}function vd(t,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var n,r=1/0;return Ut(e,function(i){var o=Jb(i,t),a=o.properties.dist;a<r&&(n=i,r=a)}),n}function Oo(t,e){return t[0]===e[0]&&t[1]===e[1]}var Wb=Yb;class Zb extends Or{constructor(){super(...arguments),b(this,"mode","cut"),b(this,"lineDrawer",new is(this.gm,{snappingMarkers:"first",targetShape:"polygon"})),b(this,"cutShapesAllowed",["circle","line","rectangle","polygon"]),b(this,"mapEventHandlers",{[`${W}:draw`]:this.forwardLineDrawerEvent.bind(this),mousemove:this.onMouseMove.bind(this)})}onStartAction(){this.lineDrawer.startAction(),this.lineDrawer.on("firstMarkerClick",this.cutPolygonFinished.bind(this))}onEndAction(){this.lineDrawer.endAction()}onMouseMove(e){return we(e)?(this.lineDrawer.featureData||this.fireMarkerPointerUpdateEvent(),{next:!0}):{next:!0}}cutPolygonFinished(e){this.lineDrawer.endShape();const n=rs(e.geoJson),r=this.getBBoxFeaturesByPolygon(n);this.cutFeaturesByPolygon(r,n)}getBBoxFeaturesByPolygon(e){const n=Oa(e),r=this.gm.mapAdapter.coordBoundsToScreenBounds(n);return this.gm.mapAdapter.queryFeaturesByScreenCoordinates({queryCoordinates:r,sourceNames:[N.main]})}cutFeaturesByPolygon(e,n){e.forEach(r=>{if(hl(r.getGeoJson(),n)){this.gm.features.delete(r),this.fireFeatureRemovedEvent(r);return}if(cb(r.getGeoJson(),n)&&this.cutShapesAllowed.includes(r.shape)){if(r.shape==="line"){this.cutLineFeatureByPolygon(r,n);return}this.cutPolygonFeatureByPolygon(r.id,n)}})}cutLineFeatureByPolygon(e,n){const r=e.getGeoJson(),i=Wb(r,n);if(i.features.length===0)return;const o=[];if(i.features.filter(a=>!hl(a,n)).forEach(a=>{const s=this.createLineFeature(gc(a));s&&o.push(s)}),this.gm.features.delete(e),!lb(o)){j.error("cutLineFeatureByPolygon: resultFeatures not found",i);return}this.fireFeatureUpdatedEvent({sourceFeatures:[e],targetFeatures:o})}createLineFeature(e){const n={...e,properties:{shape:"line"}};return this.gm.features.createFeature({shapeGeoJson:n,sourceName:N.main})}cutPolygonFeatureByPolygon(e,n){const r=this.gm.features.get(N.main,e);if(!r){j.warn("cutPolygonFeatureByPolygon: featureData not found",e);return}r.convertToPolygon();const i=r.getGeoJson(),o=this.getGeoJsonDifference(i,n);o&&(r.updateGeoJsonGeometry(o.geometry),this.fireFeatureUpdatedEvent({sourceFeatures:[r],targetFeatures:[r]}))}getGeoJsonDifference(e,n){const r=xe([e,n]),i=Db(r);return i?i.type==="Feature"?i:(i.type==="FeatureCollection"&&j.error("getGeoJsonDifference: FeatureCollection detected (not supported)",i),null):null}}class $b extends Or{constructor(){super(...arguments),b(this,"mode","delete"),b(this,"mapEventHandlers",{click:this.onMouseClick.bind(this)})}onStartAction(){this.gm.markerPointer.enable({invisibleMarker:!0}),this.gm.markerPointer.pauseSnapping()}onEndAction(){this.gm.markerPointer.resumeSnapping(),this.gm.markerPointer.disable()}onMouseClick(e){if(!we(e,{warning:!0}))return{next:!1};const n=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[N.main]});return n&&(this.gm.features.delete(n),this.fireFeatureRemovedEvent(n)),{next:!1}}}class Kb extends os{constructor(){super(...arguments),b(this,"mode","drag")}onStartAction(){}onEndAction(){}handleGmEdit(e){return Vn(e)?e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(this.previousLngLat||(this.previousLngLat=e.lngLatStart),this.moveFeature(e.featureData,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(this.isDragging=!0,e.featureData.changeSource({sourceName:N.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(this.previousLngLat=null,this.isDragging=!1,e.featureData.changeSource({sourceName:N.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}):(j.error("EditDrag.handleGmEdit: not an edit event",e),{next:!0})}}function yd(t,e,n={}){if(n.final===!0)return Xb(t,e);const r=ge(t),i=ge(e),o=be(r[0]),a=be(i[0]),s=be(r[1]),l=be(i[1]),u=Math.sin(a-o)*Math.cos(l),h=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(a-o);return Tn(Math.atan2(u,h))}function Xb(t,e){let n=yd(e,t);return n=(n+180)%360,n}var ou=yd;function Qb(t,e,n){if(n=n||{},!Ea(n))throw new Error("options is invalid");const r=n.pivot,i=n.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("angle is required");if(e===0)return t;const o=r??oc(t);return(i===!1||i===void 0)&&(t=qi(t)),Zt(t,function(a){const s=E2(o,a)+e,l=k2(o,a),u=He(x2(o,l,s));a[0]=u[0],a[1]=u[1]}),t}var e4=Qb;class t4 extends os{constructor(){super(...arguments),b(this,"mode","rotate"),b(this,"convertFeaturesTypes",["rectangle"])}onStartAction(){}onEndAction(){}handleGmEdit(e){var n;return Vn(e)?e.action==="marker_move"&&e.lngLatStart&&e.lngLatEnd?(((n=e.markerData)==null?void 0:n.type)==="vertex"?this.moveVertex(e):this.moveSource(e.featureData,e.lngLatStart,e.lngLatEnd),{next:!1}):(e.action==="marker_captured"?(e.featureData.changeSource({sourceName:N.temporary,atomic:!0}),this.fireFeatureEditStartEvent({feature:e.featureData})):e.action==="marker_released"&&(e.featureData.changeSource({sourceName:N.main,atomic:!0}),this.fireFeatureEditEndEvent({feature:e.featureData})),{next:!0}):(j.error("EditChange.handleGmEdit: not an edit event",e),{next:!1})}moveVertex(e){this.rotateFeature(e.featureData,e)}rotateFeature(e,n){const r=Qe(e.getGeoJson()),i=tc(ac(r)),o=this.calculateRotationAngle(i,n.lngLatStart,n.lngLatEnd);r.geometry=e4(r,o,{pivot:i}).geometry,this.fireBeforeFeatureUpdate({features:[e],geoJsonFeatures:[r]}),this.updateFeatureGeoJson({featureData:e,featureGeoJson:r})&&e.convertToPolygon()}calculateRotationAngle(e,n,r){const i=ou(e,n);return(ou(e,r)-i+360)%360}}const va={drag:Kb,change:sb,rotate:t4,scale:null,copy:null,cut:Zb,split:null,union:null,difference:null,line_simplification:null,lasso:null,delete:$b},n4=(t,e)=>va[e]?new va[e](t):(j.error(`Edit "${e}" is not available`),null);class r4 extends Ui{constructor(e,n){super(e),b(this,"mapEventHandlers",{[`${W}:edit`]:this.handleEditEvent.bind(this)}),n.attachEvents(this.mapEventHandlers)}handleEditEvent(e){if(!Vn(e))return{next:!0};const n=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(n,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(n)),{next:!0}}start(e,n){if(n.action!=="mode_start")return;const r=n4(this.gm,n.mode);r&&(e in this.gm.actionInstances&&j.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=r,r.startAction())}end(e){const n=this.gm.actionInstances[e];n instanceof Or?(n.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}": `,n)}}const i4=(t,e)=>{let n=null;try{t.forEach(r=>{if(e(r))throw n=r,new Error("found")})}catch{}return n};var au;class o4 extends pn{constructor(){super(...arguments),b(this,"mode","shape_markers"),b(this,"pinEnabled",((au=this.gm.options.controls.helper.pin)==null?void 0:au.active)||!1),b(this,"previousPosition",null),b(this,"activeMarker",null),b(this,"activeFeatureData",null),b(this,"sharedMarkers",[]),b(this,"allowedShapes",["circle","line","rectangle","polygon"]),b(this,"edgeMarkersAllowed",!1),b(this,"edgeMarkerAllowedShapes",["line","rectangle","polygon"]),b(this,"shapeMarkerAllowedModes",["drag","change","cut","split"]),b(this,"mapEventHandlers",{[`${W}:draw`]:this.handleGmDraw.bind(this),[`${W}:edit`]:this.handleGmEdit.bind(this),mousedown:this.onMouseDown.bind(this),touchstart:this.onMouseDown.bind(this),mouseup:this.onMouseUp.bind(this),touchend:this.onMouseUp.bind(this),mousemove:this.onMouseMove.bind(this),touchmove:this.onMouseMove.bind(this),contextmenu:this.onMouseRightButtonClick.bind(this)}),b(this,"throttledMethods",Un({sendMarkerMoveEvent:this.sendMarkerMoveEvent,sendMarkerRightClickEvent:this.sendMarkerRightClickEvent},this,this.gm.options.settings.throttlingDelay)),b(this,"debouncedMethods",f2({refreshMarkers:this.refreshMarkers},this,this.gm.options.settings.throttlingDelay*10))}onStartAction(){this.isShapeMarkerAllowed()&&this.gm.markerPointer.enable({invisibleMarker:!0}),this.edgeMarkersAllowed=this.gm.getActiveEditModes().includes("change"),this.addMarkers()}onEndAction(){this.gm.markerPointer.disable(),this.removeMarkers()}setPin(e){this.pinEnabled=e}onMouseDown(e){var n;const r=["mousedown","touchstart"];if(!we(e,{warning:!0})||!r.includes(e.type))return{next:!0};if(e.type==="mousedown"&&e.originalEvent.button!==0)return{next:!0};const i=this.getFeatureMarkerByMouseEvent(e);return this.activeMarker=i||null,this.activeFeatureData=(i==null?void 0:i.instance.parent)||null,this.activeMarker&&this.activeFeatureData?(this.previousPosition=za(this.activeMarker.instance),this.gm.mapAdapter.setDragPan(!1),this.activeMarker.type==="edge"&&this.sendMarkerEvent("edge_marker_click",this.activeFeatureData,this.activeMarker),this.pinEnabled?(this.sharedMarkers=this.getSharedMarkers(this.activeMarker.position.coordinate),this.sharedMarkers.forEach(o=>{var a;return(a=this.snappingHelper)==null?void 0:a.addExcludedFeature(o.featureData)})):(n=this.snappingHelper)==null||n.addExcludedFeature(this.activeFeatureData),this.sendMarkerEvent("marker_captured",this.activeFeatureData,this.activeMarker),{next:!1}):{next:!0}}onMouseUp(){var e;if(!this.activeMarker)return{next:!0};const n={featureData:this.activeFeatureData,markerData:this.activeMarker};return this.activeMarker=null,this.activeFeatureData=null,this.sharedMarkers=[],(e=this.snappingHelper)==null||e.clearExcludedFeatures(),this.previousPosition=null,this.gm.mapAdapter.setDragPan(!0),n.featureData&&n.markerData?(this.sendMarkerEvent("marker_released",n.featureData,n.markerData),{next:!1}):(j.debug("ShapeMarkersHelper.onMouseUp: no active marker or featureData",n),{next:!0})}onMouseMove(e){return!this.activeMarker||!we(e,{warning:!0})?{next:!0}:(this.throttledMethods.sendMarkerMoveEvent(e),{next:!1})}onMouseRightButtonClick(e){const n=this.getFeatureMarkerByMouseEvent(e);return n&&n.instance.parent?(this.throttledMethods.sendMarkerRightClickEvent(n.instance.parent,n),{next:!1}):{next:!0}}isShapeMarkerAllowed(){return q0(this.shapeMarkerAllowedModes,this.gm.getActiveEditModes()).length>0}convertToVertexMarker(e){if(e.type==="edge"&&e.instance.parent){const n=e.position,r=e.instance.parent;this.removeMarker(e);const i=this.createMarker({type:"vertex",positionData:n,parentFeature:r}),o=r.getGeoJson(),a=Qu(o,n.coordinate);if(a){const s=a.path.join("."),l=r.markers.get(s);return l&&this.removeMarker(l),r.markers.set(s,i),i}}return j.error("ShapeMarkersHelper.convertToVertexMarker: invalid marker type",e),e}getSharedMarkers(e){const n=[];return this.gm.features.forEach(r=>{r.markers.forEach(i=>{i.type==="vertex"&&dr(i.position.coordinate,e)&&n.push({featureData:r,markerData:i})})}),n}getFeatureMarkerByMouseEvent(e){var n;const r=this.gm.features.getFeatureByMouseEvent({event:e,sourceNames:[N.main]});if((n=r==null?void 0:r.parent)!=null&&n.markers){const i=i4(r.parent.markers,o=>o.instance===r);if((i==null?void 0:i.type)!=="dom")return i}return null}addMarkers(){this.gm.features.forEach(e=>{if(!e||!this.allowedShapes.includes(e.shape))return;this.addCenterMarker(e);const n=this.getAllShapeSegments(e);n.forEach((r,i)=>{if(this.isMarkerIndexAllowed(e.shape,i,n.length)){const o=this.createOrUpdateVertexMarker(r.segment.start,e);if(e.markers.set(o.markerKey,o.markerData),e.shape==="line"&&i===n.length-1){const a=this.createOrUpdateVertexMarker(r.segment.end,e);e.markers.set(a.markerKey,a.markerData)}}if(this.isEdgeMarkerAllowed(e)){const o=this.createOrUpdateEdgeMarker(r,e);e.markers.set(o.markerKey,o.markerData)}})})}addCenterMarker(e){if(e.shapeProperties.center){const n=this.createMarker({type:"center",positionData:{path:[],coordinate:e.shapeProperties.center},parentFeature:e});e.markers.set("center",n)}}getAllShapeSegments(e){const n=e.getGeoJson(),r=[];return ec(n,(i,o)=>{r.push({segment:i,middle:this.getSegmentMiddlePosition(i),edgeMarkerKey:this.getEdgeMarkerKey(o)})}),r}isEdgeMarkerAllowed(e){return this.edgeMarkersAllowed&&this.edgeMarkerAllowedShapes.includes(e.shape)}isMarkerIndexAllowed(e,n,r){const i=Math.floor(r/4);return e==="circle"?(n+i/2)%i===0:!0}getEdgeMarkerKey(e){return`edge.${e}`}getSegmentMiddlePosition(e){const n=this.gm.mapAdapter.project(e.start.coordinate),r=this.gm.mapAdapter.project(e.end.coordinate),i=[(n[0]+r[0])/2,(n[1]+r[1])/2],o=e.start.path.slice(0,e.start.path.length-1).concat([-1]);return{coordinate:this.gm.mapAdapter.unproject(i),path:o}}removeMarkers(){this.gm.features.forEach((e,n)=>{const r=this.gm.features.get(N.main,n);r&&(r.markers.forEach(i=>{i.type!=="dom"?this.gm.features.delete(i.instance):j.error("Non a FeatureData marker",i)}),r.markers=new Map)})}removeMarker(e){if(e.type==="dom"){j.error("Wrong marker type",e);return}const n=e.instance.parent;if(!n){j.error("Missing parent feature data",e);return}try{n.markers.forEach((r,i)=>{if(r===e)throw this.gm.features.delete(r.instance),n.markers.delete(i),new Error("break")})}catch{}}createMarker({type:e,segment:n,positionData:r,parentFeature:i}){const o=r.coordinate,a=this.gm.features.createMarkerFeature({sourceName:i.sourceName,parentFeature:i,type:e,coordinate:o});if(!a)throw new Error(`Missine feature data for the "${e}" marker`);if(e==="edge"&&n)return{type:e,instance:a,position:Qe(r),segment:n};if(e==="vertex"||e==="center")return{type:e,instance:a,position:Qe(r)};throw new Error(`Invalid marker type "${e}" with segment: ${n}`)}handleGmDraw(e){return Ra(e)?(e.action==="feature_created"&&this.debouncedMethods.refreshMarkers(),{next:!0}):(j.error("ShapeMarkersHelper.handleGmDraw: not a draw event",e),{next:!0})}refreshMarkers(){this.removeMarkers(),this.addMarkers()}handleGmEdit(e){return Vn(e)?(e.action==="feature_updated"&&this.gm.features.withAtomicSourcesUpdate(()=>{this.handleShapeUpdate(e)}),{next:!0}):(j.error("ShapeMarkersHelper.handleGmEdit: not an edit event",e),{next:!0})}handleShapeUpdate(e){var n;const r=e.targetFeatures[0];if(!r){j.error("ShapeMarkersHelper.handleShapeUpdate: no featureData",e);return}((n=this.activeMarker)==null?void 0:n.type)==="edge"&&(this.activeMarker=this.convertToVertexMarker(this.activeMarker));const i=this.getAllShapeSegments(r),o=new Set(r.markers.keys());i.forEach((a,s)=>{if(this.isMarkerIndexAllowed(r.shape,s,i.length)){const l=this.createOrUpdateVertexMarker(a.segment.start,r);if(o.delete(l.markerKey),r.shape==="line"&&s===i.length-1){const u=this.createOrUpdateVertexMarker(a.segment.end,r);o.delete(u.markerKey)}}if(this.isEdgeMarkerAllowed(r)){const l=this.createOrUpdateEdgeMarker(a,r);o.delete(l.markerKey)}}),this.updateCenterMarkerPosition(r),o.delete("center"),o.forEach(a=>{const s=r.markers.get(a);s&&s.type!=="dom"?this.gm.features.delete(s.instance):j.error("Non a FeatureData marker"),r.markers.delete(a)})}createOrUpdateVertexMarker(e,n){const r=e.path.join(".");let i=n.markers.get(r)||null;if(i&&(i==null?void 0:i.type)!=="vertex")throw new Error(`Invalid marker type "${i==null?void 0:i.type}" for edge marker`);return i?(dr(i.position.coordinate,e.coordinate)||this.gm.features.updateMarkerFeaturePosition(i.instance,e.coordinate),i.position=e):(i=this.createMarker({type:"vertex",positionData:e,parentFeature:n}),n.markers.set(r,i)),{markerKey:r,markerData:i}}createOrUpdateEdgeMarker(e,n){let r=n.markers.get(e.edgeMarkerKey)||null;if(r&&(r==null?void 0:r.type)!=="edge")throw new Error(`Invalid marker type "${r==null?void 0:r.type}" for edge marker`);return r?(dr(r.position.coordinate,e.middle.coordinate)||r.instance.updateGeoJsonGeometry({type:"Point",coordinates:e.middle.coordinate}),r.position=e.middle,r.segment=e.segment):(r=this.createMarker({type:"edge",positionData:e.middle,segment:e.segment,parentFeature:n}),n.markers.set(e.edgeMarkerKey,r)),{markerKey:e.edgeMarkerKey,markerData:r}}updateCenterMarkerPosition(e){const n=e.markers.get("center")||null;n&&n.type!=="dom"&&e.shapeProperties.center&&(n.instance.updateGeoJsonGeometry({type:"Point",coordinates:e.shapeProperties.center}),n.position.coordinate=e.shapeProperties.center)}sendMarkerEvent(e,n,r){const i={level:"system",type:"edit",mode:"change",action:e,featureData:n,markerData:r};this.gm.events.fire(`${W}:edit`,i)}sendMarkerRightClickEvent(e,n){const r={level:"system",type:"edit",mode:"change",action:"marker_right_click",featureData:e,markerData:n};this.gm.events.fire(`${W}:edit`,r)}sendMarkerMoveEvent(e){var n;const r=((n=this.gm.markerPointer.marker)==null?void 0:n.getLngLat())||e.lngLat.toArray();this.activeMarker&&this.activeFeatureData&&(this.pinEnabled?this.sharedMarkers:[{markerData:this.activeMarker,featureData:this.activeFeatureData}]).forEach(i=>{if(this.previousPosition){const o={level:"system",type:"edit",mode:"drag",action:"marker_move",featureData:i.featureData,markerData:i.markerData,lngLatStart:this.previousPosition,lngLatEnd:r};this.gm.events.fire(`${W}:edit`,o)}}),this.previousPosition=r}}class a4 extends pn{constructor(){super(...arguments),b(this,"mode","snapping"),b(this,"tolerance",18),b(this,"excludedFeature",new Set),b(this,"customSnappingLngLats",new Map),b(this,"customSnappingFeatures",new Set),b(this,"lineSnappingShapes",["circle","line","rectangle","polygon","snap_guide"]),b(this,"mapEventHandlers",{}),b(this,"shapeSnappingHandlers",{marker:this.getPointsSnapping.bind(this),circle:this.getLineSnapping.bind(this),circle_marker:this.getPointsSnapping.bind(this),text_marker:this.getPointsSnapping.bind(this),line:this.getLineSnapping.bind(this),rectangle:this.getLineSnapping.bind(this),polygon:this.getLineSnapping.bind(this),snap_guide:this.getLineSnapping.bind(this)})}onStartAction(){this.gm.markerPointer.setSnapping(!0)}onEndAction(){this.gm.markerPointer.setSnapping(!1)}addExcludedFeature(e){this.excludedFeature.add(e)}clearExcludedFeatures(){this.excludedFeature.clear()}addCustomSnappingFeature(e){this.customSnappingFeatures.add(e)}removeCustomSnappingFeature(e){this.customSnappingFeatures.delete(e)}clearCustomSnappingFeature(){this.customSnappingFeatures.clear()}setCustomSnappingCoordinates(e,n){this.customSnappingLngLats.set(e,n)}clearCustomSnappingCoordinates(e){this.customSnappingLngLats.delete(e)}getSnappedLngLat(e,n){let r=this.getCustomLngLatsSnapping(n);if(r)return r;const i=this.getFeaturesInPointBounds(n).filter(o=>!this.excludedFeature.has(o));return r=this.getFeaturePointsSnapping(i,e,n),r||(r=this.getFeatureLinesSnapping(i,e,n),r)?r:e}getCustomLngLatsSnapping(e){const n={distance:1/0,lngLat:null};return this.customSnappingLngLats.forEach(r=>{r.forEach(i=>{const o=this.gm.mapAdapter.project(i),a=ri(e,o);a<this.tolerance&&a<n.distance&&(n.distance=a,n.lngLat=i)})}),n.lngLat}getFeaturePointsSnapping(e,n,r){let i=e.map(o=>({shape:o.shape,...this.getPointsSnapping(o,n,r)})).filter(o=>o.distance<this.tolerance);return i.length?(i=rl(i,["distance"]),i[0].lngLat):null}getFeatureLinesSnapping(e,n,r){let i=e.filter(o=>this.lineSnappingShapes.includes(o.shape)).map(o=>{const a=this.shapeSnappingHandlers[o.shape];return a?{shape:o.shape,...a(o,n,r)}:null}).filter(o=>o!==null&&o.distance<this.tolerance);return i.length?(i=rl(i,["distance"]),i[0].lngLat):null}getFeaturesInPointBounds(e){const n=[[e[0]-this.tolerance,e[1]-this.tolerance],[e[0]+this.tolerance,e[1]+this.tolerance]];return this.gm.features.getFeaturesByScreenBounds({bounds:n,sourceNames:[N.main,N.temporary]}).filter(r=>r.temporary?this.customSnappingFeatures.has(r):!0)||[]}getPointsSnapping(e,n,r){const i=e.getGeoJson(),o={distance:1/0,coord:null};return Cr(i,a=>{const s=this.gm.mapAdapter.project(a.coordinate),l=ri(r,s);l<this.tolerance&&l<o.distance&&(o.distance=l,o.coord=a.coordinate)},!0),{lngLat:o.coord?o.coord:n,distance:o.distance}}getLineSnapping(e,n,r){const i=e.getGeoJson();return this.getNearestLinePointData(i,n,r)}getNearestLinePointData(e,n,r){const i={lngLat:n,distance:1/0},o=this.gm.mapAdapter.getEuclideanNearestLngLat(e,n),a=this.gm.mapAdapter.project(o);return i.distance=ri(a,r),i.distance<this.tolerance&&(i.lngLat=o),i}}class s4 extends pn{constructor(){super(...arguments),b(this,"mode","zoom_to_features"),b(this,"mapEventHandlers",{})}onStartAction(){this.fitMapToFeatures(),setTimeout(()=>{this.gm.options.disableMode("helper","zoom_to_features")})}onEndAction(){}fitMapToFeatures(){const e=this.gm.features.asGeoJsonFeatureCollection({sourceNames:[N.main,N.standby]}),n=vu(e),r=[[n[0],n[1]],[n[2],n[3]]];try{this.gm.mapAdapter.fitBounds(r,{padding:20})}catch{j.warn("Wrong bounds for zooming to features",r,e)}}}const ya={shape_markers:o4,pin:null,snapping:a4,snap_guides:null,measurements:null,auto_trace:null,geofencing:null,zoom_to_features:s4,click_to_edit:null},l4=(t,e)=>ya[e]?new ya[e](t):(j.error(`Helper "${e}" is not available`),null);class u4 extends Ui{constructor(e,n){super(e),b(this,"mapEventHandlers",{[`${W}:helper`]:this.handleHelperEvent.bind(this)}),n.attachEvents(this.mapEventHandlers)}handleHelperEvent(e){if(!Vi(e))return{next:!0};const n=`${e.type}__${e.mode}`;return e.action==="mode_start"?(this.trackExclusiveModes(e),this.start(n,e),this.trackRelatedModes(e)):e.action==="mode_end"&&(this.trackRelatedModes(e),this.end(n)),{next:!0}}start(e,n){const r=l4(this.gm,n.mode);r&&(e in this.gm.actionInstances&&j.error(`Action instance "${e}" already exists`),this.gm.actionInstances[e]=r,r.startAction())}end(e){const n=this.gm.actionInstances[e];n instanceof pn?(n.endAction(),delete this.gm.actionInstances[e]):console.error(`Wrong action instance for edit event "${e}":`,n)}}class c4{constructor(e){b(this,"gm"),b(this,"bus"),b(this,"listeners",{}),this.gm=e,this.bus=new u2(this.gm),this.listeners={draw:new ab(this.gm,this.bus),edit:new r4(this.gm,this.bus),helper:new u4(this.gm,this.bus),control:new c2(this.gm,this.bus)}}fire(e,n){this.listeners[n.type]||j.error(`Can't find event listener for "${n.type}" event type`),this.bus.fireEvent(e,n)}}class d4{getEuclideanNearestLngLat(e,n){const r=this.project(n);let i=[0,0],o=1/0;return ec(e,a=>{const s=this.project(a.start.coordinate),l=this.project(a.end.coordinate),u=sv(s,l,r),h=ri(r,u);h<o&&(o=h,i=[u[0],u[1]])}),this.unproject(i)}getDistance(e,n){return Ph(e,n,{units:"meters"})}}class h4{isInstanceAvailable(){return this.layerInstance?!0:(j.error("layerInstance is not available"),!1)}}class Bo extends h4{constructor({gm:e,layerId:n,options:r}){super(),b(this,"gm"),b(this,"layerInstance",null),b(this,"mapInstance"),this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,r?this.layerInstance=this.createLayer(r):this.layerInstance=this.mapInstance.getLayer(n)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.id}get source(){if(!this.isInstanceAvailable())throw new Error("Layer instance is not available");return this.layerInstance.source}createLayer(e){return this.mapInstance.addLayer(e),this.mapInstance.getLayer(e.id)||null}remove(){this.isInstanceAvailable()&&this.mapInstance.removeLayer(this.id),this.layerInstance=null}}class f4 extends wa{constructor({mapInstance:e,options:n,lngLat:r}){super(),b(this,"markerInstance"),this.markerInstance=new _i.Marker(n).setLngLat(r).addTo(e)}getElement(){var e;return this.isMarkerInstanceAvailable()&&((e=this.markerInstance)==null?void 0:e.getElement())||null}setLngLat(e){var n;this.isMarkerInstanceAvailable()&&((n=this.markerInstance)==null||n.setLngLat(e))}getLngLat(){var e;return this.isMarkerInstanceAvailable()?((e=this.markerInstance)==null?void 0:e.getLngLat().toArray())||[0,0]:[0,0]}remove(){var e;(e=this.markerInstance)==null||e.remove()}}class p4{isInstanceAvailable(){return this.popupInstance?!0:(j.error("Popup instance is not available"),!1)}}class g4 extends p4{constructor({mapInstance:e,options:n,lngLat:r}){super(),b(this,"popupInstance"),this.popupInstance=new _i.Popup(n).addTo(e),r&&this.setLngLat(r)}getLngLat(){return this.isInstanceAvailable()?this.popupInstance.getLngLat().toArray()||[0,0]:[0,0]}setLngLat(e){this.isInstanceAvailable()&&this.popupInstance.setLngLat(e)}setHtml(e){this.isInstanceAvailable()&&this.popupInstance.setHTML(e)}remove(){this.isInstanceAvailable()&&this.popupInstance.remove()}}class su extends gv{constructor({gm:e,geoJson:n,sourceId:r}){super(),b(this,"gm"),b(this,"mapInstance"),b(this,"sourceInstance"),this.gm=e,this.mapInstance=this.gm.mapAdapter.mapInstance,n?this.sourceInstance=this.createSource({geoJson:n,sourceId:r}):this.sourceInstance=this.mapInstance.getSource(r)||null}get id(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.id}createSource({geoJson:e,sourceId:n}){return this.mapInstance.addSource(n,{type:"geojson",data:e}),this.mapInstance.getSource(n)||null}getGeoJson(){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.serialize().data}setGeoJson(e){if(!this.isInstanceAvailable())throw new Error("Source instance is not available");return this.sourceInstance.setData(e)}updateData(e){if(!this.isInstanceAvailable())return;const n=this.convertGeoJsonDiffToMlDiff(e);this.sourceInstance.updateData(n)}convertGeoJsonDiffToMlDiff(e){return{add:e.add,update:e.update.map(this.convertFeatureToMlUpdateDiff.bind(this)),remove:e.remove}}convertFeatureToMlUpdateDiff(e){const n=Object.entries(e.properties||{}).map(r=>({key:r[0],value:r[1]}));return{id:e.id,newGeometry:e.geometry,addOrUpdateProperties:n}}remove({removeLayers:e}){this.isInstanceAvailable()&&(e&&this.gm.mapAdapter.eachLayer(n=>{n.source===this.sourceInstance.id&&this.gm.mapAdapter.removeLayer(n.id)}),this.mapInstance.removeSource(this.sourceInstance.id))}}class m4 extends d4{constructor(e,n){super(),b(this,"gm"),b(this,"mapType","maplibre"),b(this,"mapInstance"),this.gm=n,this.mapInstance=e}getMapInstance(){return this.mapInstance}isLoaded(){return this.mapInstance.loaded()}getContainer(){return this.mapInstance.getContainer()}getCanvas(){return this.mapInstance.getCanvas()}addControl(e){this.mapInstance.addControl(e)}removeControl(e){this.mapInstance.removeControl(e)}async loadImage({id:e,image:n}){const r=await this.mapInstance.loadImage(n);this.mapInstance.addImage(e,r.data)}getBounds(){return this.mapInstance.getBounds().toArray()}fitBounds(e,n){this.mapInstance.fitBounds(e,n)}setCursor(e){this.mapInstance.getCanvas().style.cursor=e}disableMapInteractions(e){e.forEach(n=>{this.mapInstance[n].disable()})}enableMapInteractions(e){e.forEach(n=>{this.mapInstance[n].enable()})}setDragPan(e){e?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()}queryFeaturesByScreenCoordinates({queryCoordinates:e=void 0,sourceNames:n}){return Yo(this.mapInstance.queryRenderedFeatures(e).map(r=>({featureId:r.properties[Dn],featureSourceName:r.source})),Lr).map(({featureId:r,featureSourceName:i})=>r===void 0||!n.includes(i)?null:this.gm.features.get(i,r)||null).filter(r=>!!r)}queryGeoJsonFeatures({queryCoordinates:e=void 0,sourceNames:n}){const r=(i,o)=>(i==null?void 0:i.id)===(o==null?void 0:o.id);return Yo(this.mapInstance.queryRenderedFeatures(e).map(i=>{const o=this.convertToGeoJsonImportFeature(i);return o?{id:i.properties[Dn],sourceName:i.source,geoJson:o}:null}),r).filter(i=>!!i&&i.id!==void 0&&i.geoJson&&n.includes(i.sourceName))}convertToGeoJsonImportFeature(e){const n=e.properties[Dn];return n===void 0||e.geometry.type==="GeometryCollection"?null:{id:n,type:"Feature",properties:e.properties,geometry:e.geometry}}addSource(e,n){return new su({gm:this.gm,sourceId:e,geoJson:n})}getSource(e){return new su({gm:this.gm,sourceId:e})}addLayer(e){const n=e.id;return new Bo({gm:this.gm,layerId:n,options:e})}getLayer(e){return new Bo({gm:this.gm,layerId:e})}removeLayer(e){const n=this.getLayer(e);n&&n.remove()}eachLayer(e){this.mapInstance.getStyle().layers.forEach(n=>{e(new Bo({gm:this.gm,layerId:n.id}))})}createDomMarker(e,n){return new f4({mapInstance:this.mapInstance,options:e,lngLat:n})}createPopup(e,n){return new g4({mapInstance:this.mapInstance,options:e,lngLat:n})}project(e){const n=this.mapInstance.project(e);return[n.x,n.y]}unproject(e){const n=this.mapInstance.unproject(e);return[n.lng,n.lat]}coordBoundsToScreenBounds(e){const n=new _i.LngLatBounds(e),r=this.project(n.getSouthWest().toArray()),i=this.project(n.getNorthEast().toArray());return[r,i]}fire(e,n){this.mapInstance.fire(e,n)}on(e,n,r){if(typeof n=="string"&&r&&vo(e))this.mapInstance.on(e,n,r);else if(typeof n=="function")this.mapInstance.on(e,n);else throw new Error("Invalid arguments passed to 'on' method")}once(e,n,r){if(typeof n=="string"&&r&&vo(e))this.mapInstance.once(e,n,r);else if(typeof n=="function")this.mapInstance.once(e,n);else throw new Error("Invalid arguments passed to 'once' method.")}off(e,n,r){if(typeof n=="string"&&r&&vo(e))this.mapInstance.off(e,n,r);else if(typeof n=="function")this.mapInstance.off(e,n);else throw new Error("Invalid arguments passed to 'off' method")}}const v4=async(t,e)=>new m4(e,t),y4=(t,e)=>{if(Array.isArray(t)&&Array.isArray(e)){const n=Y0(t,"type");return e.forEach(r=>{n[r.type]?W0(n[r.type],r):n[r.type]=Qe(r)}),H0(n)}};class b4{constructor(e,n={}){b(this,"gm"),b(this,"settings"),b(this,"controls"),b(this,"layerStyles"),this.gm=e;const r=G0(bc(),n,y4);this.settings=r.settings,this.controls=r.controls,this.layerStyles=r.layerStyles}enableMode(e,n){const r=this.isModeEnabled(e,n),i=this.isModeAvailable(e,n);if(i||j.warn(`Unable to enable mode, "${e}:${n}" is not available`),r||!i)return;const o=this.controls[e][n];o?(o.active=!0,this.fireModeEvent(e,n,"mode_start"),this.fireControlEvent(e,n,"on"),this.fireModeEvent(e,n,"mode_started")):j.error("Can't find control section for",e,n)}disableMode(e,n){const r=this.isModeEnabled(e,n),i=this.isModeAvailable(e,n);if(!r||!i)return;const o=this.controls[e][n];o?(o.active=!1,this.fireModeEvent(e,n,"mode_end"),this.fireControlEvent(e,n,"off"),this.fireModeEvent(e,n,"mode_ended")):j.error("Can't find control section for",e,n)}syncModeState(e,n){const r=this.controls[e][n],i=this.isModeAvailable(e,n);r&&(i?r.active?this.enableMode(e,n):this.disableMode(e,n):(r.active=!1,r.uiEnabled=!1))}toggleMode(e,n){this.isModeEnabled(e,n)?this.disableMode(e,n):this.enableMode(e,n)}isModeEnabled(e,n){return!!Object.entries(this.gm.actionInstances).find(([r,i])=>r===`${e}__${n}`&&i)}isModeAvailable(e,n){return e==="draw"&&rn(n,uc)?!!ca[n]:e==="edit"&&rn(n,ad)?!!va[n]:e==="helper"&&rn(n,sd)?!!ya[n]:!1}getControlOptions({actionType:e,modeName:n}){return e&&n&&this.controls[e][n]||null}fireModeEvent(e,n,r){const i={level:"system",type:e,mode:n,action:r};Na(i)&&(Ra(i)?this.gm.events.fire(`${W}:${e}`,i):Vn(i)?this.gm.events.fire(`${W}:${e}`,i):Vi(i)&&this.gm.events.fire(`${W}:${e}`,i))}fireControlEvent(e,n,r){const i={level:"system",type:"control",section:e,target:n,action:r};this.gm.events.fire(`${W}:control`,i)}}class w4{constructor(e){b(this,"gm"),b(this,"marker",null),b(this,"tmpMarker",null),b(this,"snapping",!1),b(this,"oldSnapping"),this.gm=e,this.initEventHandlers()}initEventHandlers(){this.throttledMethods=Un({onMouseMove:this.onMouseMove},this,this.gm.options.settings.throttlingDelay),this.mapEventHandlers={mousemove:this.throttledMethods.onMouseMove.bind(this)}}get snappingHelper(){return this.gm.actionInstances.helper__snapping||null}setSnapping(e){if(e&&!this.snappingHelper){j.error("MarkerPointer: snapping is not available");return}this.snapping=e}pauseSnapping(){this.oldSnapping!==void 0&&j.error("MarkerPointer: snapping is already paused"),this.oldSnapping=this.snapping,this.setSnapping(!1)}resumeSnapping(){this.oldSnapping===void 0?(j.error("MarkerPointer: resumeSnapping is called before pauseSnapping"),this.setSnapping(!0)):(this.setSnapping(this.oldSnapping),this.oldSnapping=void 0)}enable({lngLat:e,customMarker:n,invisibleMarker:r}={lngLat:[0,0],customMarker:void 0,invisibleMarker:!1}){if(!h2()){if(n&&r)throw new Error("MarkerPointer: customMarker and invisibleMarker can't be used together");if(this.marker)throw new Error("MarkerPointer: marker is already enabled");this.gm.events.bus.attachEvents(this.mapEventHandlers),r?this.marker=this.createInvisibleMarker(e||[0,0]):this.marker=n||this.createMarker(e||[0,0]),this.gm.getActiveDrawModes().length&&this.gm.mapAdapter.setCursor("crosshair")}}disable(){this.marker&&(this.gm.events.bus.detachEvents(this.mapEventHandlers),this.marker.remove(),this.marker=null),this.gm.mapAdapter.setCursor("")}createMarker(e=[0,0]){return this.gm.mapAdapter.createDomMarker({anchor:"center",element:ud("dom",{pointerEvents:"none"})},e)}createInvisibleMarker(e=[0,0]){const n=document.createElement("div");return n.style.width="0px",n.style.height="0px",this.gm.mapAdapter.createDomMarker({anchor:"center",element:n},e)}onMouseMove(e){if(we(e,{warning:!0})&&this.marker)if(this.snapping&&this.snappingHelper){const n=[e.point.x,e.point.y],r=this.snappingHelper.getSnappedLngLat(e.lngLat.toArray(),n);this.marker.setLngLat(r)}else this.marker.setLngLat(e.lngLat.toArray());return{next:!0}}syncTmpMarker(e){this.tmpMarker||(this.tmpMarker=this.createMarker(e)),this.tmpMarker.setLngLat(e)}}class E4{constructor(e,n={}){b(this,"mapAdapterInstance",null),b(this,"globalLngLatBounds",this.getGlobalLngLatBounds()),b(this,"features"),b(this,"loaded",!1),b(this,"options"),b(this,"events"),b(this,"control"),b(this,"actionInstances",{}),b(this,"markerPointer");const r=Object.assign(e,{gm:this});this.options=new b4(this,n),this.events=new c4(this),this.features=new Wv(this),this.control=new a2(this),this.markerPointer=new w4(this),Yv(e)&&e.once("load",async()=>{this.mapAdapterInstance=await v4(this,r),this.features.init(),await this.addControls()})}get mapAdapter(){if(this.mapAdapterInstance)return this.mapAdapterInstance;throw j.trace("Map adapter is not initialized"),new Error("Map adapter is not initialized")}addControls(e=void 0){return new Promise(n=>{(async()=>{j.debug("handleCreateControls"),e?this.control.createControls(e):this.mapAdapter.addControl(this.control),await this.onMapLoad(),n()})().then()})}removeControl(){return new Promise(e=>{this.disableAllModes(),this.mapAdapter.removeControl(this.control),e()})}async onMapLoad(){this.loaded||(await this.mapAdapter.loadImage({id:"default-marker",image:uu}),this.events.fire(`${W}:control`,{level:"system",type:"control",action:"loaded"}),this.loaded=!0)}disableAllModes(){Ge(this.actionInstances).forEach(e=>{const[n,r]=e.split("__");A2(n)&&D2(r)&&this.options.disableMode(n,r)})}getActiveDrawModes(){return Ge(this.actionInstances).map(e=>{const n=this.actionInstances[e];return n instanceof Ot?n.mode:null}).filter(e=>e!==null)}getActiveEditModes(){return Ge(this.actionInstances).map(e=>{const n=this.actionInstances[e];return n instanceof Or?n.mode:null}).filter(e=>e!==null)}getActiveHelperModes(){return Ge(this.actionInstances).map(e=>{const n=this.actionInstances[e];return n instanceof pn?n.mode:null}).filter(e=>e!==null)}getGlobalLngLatBounds(){return[[-179.99999,-85.051129],[179.99999,85.051129]]}setGlobalEventsListener(e=null){this.events.bus.forwarder.globalEventsListener=e}enableMode(e,n){this.options.enableMode(e,n)}disableMode(e,n){this.options.disableMode(e,n)}toggleMode(e,n){this.options.toggleMode(e,n)}isModeEnabled(e,n){return this.options.isModeEnabled(e,n)}enableDraw(e){this.options.enableMode("draw",e)}disableDraw(){this.getActiveDrawModes().forEach(e=>this.options.disableMode("draw",e))}toggleDraw(e){this.options.toggleMode("draw",e)}drawEnabled(e){return this.options.isModeEnabled("draw",e)}enableGlobalDragMode(){this.options.enableMode("edit","drag")}disableGlobalDragMode(){this.options.disableMode("edit","drag")}toggleGlobalDragMode(){this.options.toggleMode("edit","drag")}globalDragModeEnabled(){return this.options.isModeEnabled("edit","drag")}enableGlobalEditMode(){this.options.enableMode("edit","change")}disableGlobalEditMode(){this.options.disableMode("edit","change")}toggleGlobalEditMode(){this.options.toggleMode("edit","change")}globalEditModeEnabled(){return this.options.isModeEnabled("edit","change")}enableGlobalRotateMode(){this.options.enableMode("edit","rotate")}disableGlobalRotateMode(){this.options.disableMode("edit","rotate")}toggleGlobalRotateMode(){this.options.toggleMode("edit","rotate")}globalRotateModeEnabled(){return this.options.isModeEnabled("edit","rotate")}enableGlobalScaleMode(){this.options.enableMode("edit","scale")}disableGlobalScaleMode(){this.options.disableMode("edit","scale")}toggleGlobalScaleMode(){this.options.toggleMode("edit","scale")}globalScaleModeEnabled(){return this.options.isModeEnabled("edit","scale")}enableGlobalCopyMode(){this.options.enableMode("edit","copy")}disableGlobalCopyMode(){this.options.disableMode("edit","copy")}toggleGlobalCopyMode(){this.options.toggleMode("edit","copy")}globalCopyModeEnabled(){return this.options.isModeEnabled("edit","copy")}enableGlobalCutMode(){this.options.enableMode("edit","cut")}disableGlobalCutMode(){this.options.disableMode("edit","cut")}toggleGlobalCutMode(){this.options.toggleMode("edit","cut")}globalCutModeEnabled(){return this.options.isModeEnabled("edit","cut")}enableGlobalSplitMode(){this.options.enableMode("edit","split")}disableGlobalSplitMode(){this.options.disableMode("edit","split")}toggleGlobalSplitMode(){this.options.toggleMode("edit","split")}globalSplitModeEnabled(){return this.options.isModeEnabled("edit","split")}enableGlobalUnionMode(){this.options.enableMode("edit","union")}disableGlobalUnionMode(){this.options.disableMode("edit","union")}toggleGlobalUnionMode(){this.options.toggleMode("edit","union")}globalUnionModeEnabled(){return this.options.isModeEnabled("edit","union")}enableGlobalDifferenceMode(){this.options.enableMode("edit","difference")}disableGlobalDifferenceMode(){this.options.disableMode("edit","difference")}toggleGlobalDifferenceMode(){this.options.toggleMode("edit","difference")}globalDifferenceModeEnabled(){return this.options.isModeEnabled("edit","difference")}enableGlobalLineSimplificationMode(){this.options.enableMode("edit","line_simplification")}disableGlobalLineSimplificationMode(){this.options.disableMode("edit","line_simplification")}toggleGlobalLineSimplificationMode(){this.options.toggleMode("edit","line_simplification")}globalLineSimplificationModeEnabled(){return this.options.isModeEnabled("edit","line_simplification")}enableGlobalLassoMode(){this.options.enableMode("edit","lasso")}disableGlobalLassoMode(){this.options.disableMode("edit","lasso")}toggleGlobalLassoMode(){this.options.toggleMode("edit","lasso")}globalLassoModeEnabled(){return this.options.isModeEnabled("edit","lasso")}enableGlobalRemovalMode(){this.options.enableMode("edit","delete")}disableGlobalRemovalMode(){this.options.disableMode("edit","delete")}toggleGlobalRemovalMode(){this.options.toggleMode("edit","delete")}globalRemovalModeEnabled(){return this.options.isModeEnabled("edit","delete")}}class k4{constructor(e={}){this.options={position:e.position||"topright",timeout:e.timeout||3e3,closable:e.closable!==!1,dismissable:e.dismissable!==!1,className:e.className||"",icons:Object.assign({info:"fa fa-info-circle",warning:"fa fa-exclamation-triangle",success:"fa fa-check-circle",alert:"fa fa-exclamation-circle",custom:"fa fa-cog"},e.icons),marginLeft:e.marginLeft||"",marginRight:e.marginRight||""},this._notifications=[]}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._container.className=`leaflet-control-notifications ${this.options.className}`,this.options.marginLeft&&(this._container.style.marginLeft=this.options.marginLeft),this.options.marginRight&&(this._container.style.marginRight=this.options.marginRight),this._container.addEventListener("wheel",n=>n.stopPropagation()),this._container.addEventListener("click",n=>n.stopPropagation()),e.getContainer().appendChild(this._container),this._container}onRemove(){this.clear(),this._container.remove(),this._map=null}_add(e,n,r,i={}){const o=Object.assign({},this.options,i),a=document.createElement("div");if(a.className=`leaflet-notification ${e}`,o.icons[e]){const l=document.createElement("div");l.className="leaflet-notification-icon";const u=document.createElement("i");u.className=o.icons[e],l.appendChild(u),a.appendChild(l)}const s=document.createElement("div");if(s.className="leaflet-notification-content",n){const l=document.createElement("div");l.className="leaflet-notification-title",l.innerHTML=n,s.appendChild(l)}if(r){const l=document.createElement("div");l.className="leaflet-notification-message",l.innerHTML=r,s.appendChild(l)}if(a.appendChild(s),o.dismissable&&(a.classList.add("dismissable"),a.addEventListener("click",()=>this._remove(a))),o.closable){const l=document.createElement("span");l.className="leaflet-notification-close-button",l.innerHTML="&times;",l.addEventListener("click",u=>{u.stopPropagation(),this._remove(a)}),a.appendChild(l)}return this._container.appendChild(a),this._notifications.push(a),requestAnimationFrame(()=>a.style.opacity="1"),setTimeout(()=>this._remove(a),o.timeout),a}_remove(e){const n=this._notifications.indexOf(e);n!==-1&&this._notifications.splice(n,1),e.style.opacity="0",setTimeout(()=>e.remove(),300)}info(e,n,r){return this._add("info",e,n,r)}warning(e,n,r){return this._add("warning",e,n,r)}success(e,n,r){return this._add("success",e,n,r)}alert(e,n,r){return this._add("alert",e,n,r)}custom(e,n,r){return this._add("custom",e,n,r)}clear(){this._notifications.slice().forEach(e=>this._remove(e))}}function M4(t){const e={collapsed:!1,layers:Pd(bd,"Legende")},n=new Fd(e);t.addControl(n,"top-right")}function x4(t){const{Identifier:e,Name:n,["Anzahl Stellplätze"]:r,["Adresse - Straße und Nummer"]:i,["Adresse - PLZ und Stadt"]:o,Ausrichtung:a,Linientyp:s,Verortung:l,["Letzter Aktualisierungszeitpunkt"]:u,Parkberechtigte:h,["Wochentag Beginn"]:c,["Wochentag Ende"]:p,["Zeitraum Beginn"]:m,["Zeitraum Ende"]:A,["Maximale Parkdauer Ende"]:M,Beschreibung:D,["Dubletten-ID"]:P,["Dublette - Weitere Informationen"]:E}=t;return"<table>                <tr>"+zd("Stadt Herrenberg")+(n==""||!n?"":'<th class="title">'+n+"</th>")+'</tr>            </table><br><table>                <tr>                    <td class="att">ID</td>                    <td class="attContent">'+e+'</td>               </tr><tr>                    <td class="att">Anzahl Stellplätze</td>                    <td class="attContent">'+r+"</td>                </tr>"+(i==""&&o==""||!i&&!o?"":'<tr>                    <td class="att">Adresse</td>                    <td class="attContent">'+i+", "+o+"</td>                </tr>")+(a==""||!a?"":'<tr>                    <td class="att">Ausrichtung</td>                    <td class="attContent">'+a+"</td>                </tr>")+(s==""||!s?"":'<tr>                    <td class="att">Linientyp</td>                    <td class="attContent">'+s+"</td>                </tr>")+(l==""||!l?"":'<tr>                    <td class="att">Verortung</td>                    <td class="attContent">'+l+"</td>                </tr>")+(u==""?"":'<tr>                    <td class="att">Letzter Aktualisierungszeitpunkt</td>                    <td class="attContent">'+u+"</td>                </tr>")+(c==null&&p==null&&m==null&&A==null?"":'<tr>                    <td class="att">Zeitraum</td>                    <td class="attContent">'+(c==null||p==null?"":c)+" "+m+" - "+(c==null||p==null?"":p)+" "+A+"</td>                </tr>")+(h==""||!h?"":'<tr>                    <td class="att">Parkberechtigte</td>                    <td class="attContent">'+h+"</td>                </tr>")+(M?'<tr>                    <td class="att">Maximale Parkdauer</td>                    <td class="attContent">'+M+"</td>                </tr>":"")+(!D||D==""?"":'<tr>                    <td class="att">Beschreibung</td>                    <td class="attContent">'+D+"</td>                </tr>")+"</table>"+(P==""&&E==""?"":'<br><table>                <div class="title2">Dubletten</div>'+(P==""?"":'<tr>                    <td class="att">ID</td>                    <td class="attContent">'+P+"</td>                </tr>")+(E==""?"":'<tr>                    <td class="att">Weitere Information</td>                    <td class="attContent">'+E+"</td>                </tr>")+"</table>")}const C={apiKey:"lNPer2Oz-Hc6Nc8PlY8Rdyd8mWc05m4I76eBtf5d",form:document.getElementById("form"),divSelectRecords:document.getElementById("divSelectRecords"),formParkingObject:document.getElementById("parkingObject")};C.formParkingObject.addEventListener("click",function(){C.formParkingObject.value!=""&&(C.formParkingAudienceCheckboxes=document.querySelectorAll("input.parkingAudienceCheckbox"),C.formName=document.getElementById("name"),C.formId=document.getElementById("id"),C.formCapacity=document.getElementById("capacity"),C.formStaticDataUpdatedAt=document.getElementById("staticDataUpdatedAt"),C.formWeekdayBegin=document.getElementById("weekdayBegin"),C.formWeekdayEnd=document.getElementById("weekdayEnd"),C.formHoursBegin=document.getElementById("hoursBegin"),C.formHoursEnd=document.getElementById("hoursEnd"),C.formMaxStay=document.getElementById("maxStay"),C.formDuplicateId=document.getElementById("duplicateId"),C.formDuplicateAdditionalInformation=document.getElementById("duplicateAdditionalInformation")),C.formParkingObject.value=="Parkstreifen"&&(C.formGeoJson=document.getElementById("geoJson"),C.formAddressStreetNumber=document.getElementById("addressStreetNumber"),C.formAddressZipCity=document.getElementById("addressZipCity"),C.formOrientation=document.getElementById("orientation"),C.formLineType=document.getElementById("lineType"),C.formParkingType=document.getElementById("parkingType"),C.formDescription=document.getElementById("description")),C.formParkingObject.value=="Einzelparkplatz"&&(C.formLongitude=document.getElementById("longitude"),C.formLatitude=document.getElementById("latitude"))});function S4(t,e){let n,r,i,o;t.on("gm:create",function(s){const l=s.feature.getGeoJson();function u(h,c){o={type:h,coordinates:c}}if(C.formParkingObject.value=="Parkstreifen"){let h=[];l.geometry.coordinates.forEach(function(c){h.push(Number(c[0].toFixed(6)),Number(c[1].toFixed(6)))}),n="LineString",u(n,h)}else C.formParkingObject.value=="Einzelparkplatz"&&(r=l.geometry.coordinates[0].toFixed(6),i=l.geometry.coordinates[1].toFixed(6),n="Point");n=="Point"&&(document.getElementById("longitude").value=i),n=="Point"&&(document.getElementById("latitude").value=r),n=="LineString"&&(document.getElementById("geoJson").value=JSON.stringify(o))});const a=[];C.formParkingObject.addEventListener("change",function(){C.formParkingObject.value!=""&&setTimeout(()=>{for(const s of document.querySelectorAll("input.parkingAudienceCheckbox"))s.addEventListener("change",function(){const l=a.indexOf(this.name);this.checked?l===-1&&a.push(this.name):l>-1&&a.splice(l,1)})},100)}),C.form.addEventListener("submit",async function(s){s.preventDefault();const l=i,u=r,h=o;var c=D=>D===""?null:Number(D),p=D=>D===""?null:D,m={[C.formName.name]:C.formName.value,Identifier:C.formId.value,Längengrad:l,Breitengrad:u,GeoJSON:h,[C.formOrientation.name]:C.formOrientation.value,[C.formLineType.name]:C.formLineType.value,[C.formParkingType.name]:C.formParkingType.value,[C.formAddressStreetNumber.name]:C.formAddressStreetNumber.value,[C.formAddressZipCity.name]:C.formAddressZipCity.value,[C.formCapacity.name]:c(C.formCapacity.value),[C.formStaticDataUpdatedAt.name]:C.formStaticDataUpdatedAt.value,Parkberechtigte:a,[C.formWeekdayBegin.name]:p(C.formWeekdayBegin.value),[C.formWeekdayEnd.name]:p(C.formWeekdayEnd.value),[C.formHoursBegin.name]:p(C.formHoursEnd.value),[C.formHoursEnd.name]:p(C.formHoursEnd.value),[C.formMaxStay.name]:p(C.formMaxStay.value),[C.formDescription.name]:C.formDescription.value,[C.formDuplicateId.name]:C.formDuplicateId.value,[C.formDuplicateAdditionalInformation.name]:C.formDuplicateAdditionalInformation.value};console.log(JSON.stringify(m));try{let D=C.formParkingObject.value=="Parkstreifen"?"https://app.nocodb.com/api/v2/tables/m8djfhqn3wv21gi/records":"https://app.nocodb.com/api/v2/tables/m4xmt3pj6vfggvp/records";const P=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json","xc-token":C.apiKey},body:JSON.stringify(m)}),E=L.control.notifications({timeout:2e3,position:"bottomright",closable:!0,dismissable:!0}).addTo(t);if(P.ok){var A="Erfassen erfolgreich";console.info("forms.js: Erfassen erfolgreich"),E.success(A),C.form.reset()}else{var M="Erfassen fehlgeschlagen";console.error("forms.js: Erfassen fehlgeschlagen"),E.alert(M)}}catch(D){console.error("Fehler beim Versuch, einen neuen Eintrag zu senden: ",D)}})}let lu=[],ei=[],bd=[],No=[],hi,fi;window.addEventListener("DOMContentLoaded",()=>{Hd(fe),Td(fe),_d(fe),fe.addControl(fi=new k4({timeout:3e3,closable:!0,dismissable:!0}),"bottom-right"),fe.on("load",()=>{lu=[{id:"sourceParkApiCarOnStreet",source:Rd}],lu.forEach(n=>Od(fe,n)),hi=function(){ei=[{url:"https://app.nocodb.com/api/v2/tables/m8djfhqn3wv21gi/records?offset=0&limit=25&where=&viewId=vw7kwxaqt2xvp9x0",id:"sourceParkingSites"},{url:"https://app.nocodb.com/api/v2/tables/m4xmt3pj6vfggvp/records?offset=0&limit=25&where=&viewId=vw0phi31f6rv7kn4",id:"sourceParkingSpots"}];const r={id:"parkingSites",label:"Parkstreifen",source:ei[0].id,subGroup:"Data Center",type:"line",paint:{"line-color":"black","line-width":2},layout:{visibility:"visible"},color:"black"},i={id:"parkingSpots",label:"Einzelparkplatz",source:ei[1].id,subGroup:"Data Center",type:"circle",paint:{"circle-radius":5,"circle-color":"#ffcc00","circle-stroke-color":"black","circle-stroke-width":1},layout:{visibility:"visible"},color:"#ffcc00"},o=ei.map(a=>fetch(a.url,{method:"GET",headers:{"xc-token":C.apiKey}}).then(s=>s.json()).then(s=>s.list||[]).then(s=>{const u={type:"FeatureCollection",features:s.map(h=>h.GeoJSON?{type:"Feature",geometry:h.GeoJSON,properties:h}:h.Breitengrad&&h.Längengrad?{type:"Feature",geometry:{type:"Point",coordinates:[h.Längengrad,h.Breitengrad]},properties:h}:null)};fe.addSource(a.id,{type:"geojson",data:u}),a.id===r.source&&(fe.getLayer(r.id)&&fe.removeLayer(r.id),fe.addLayer(r)),a.id===i.source&&(fe.getLayer(i.id)&&fe.removeLayer(i.id),fe.addLayer(i))}));return Promise.all(o).then(()=>{No=[r,i],Ms(fe,No,x4)})},hi().then(()=>{bd=[...No,...uo],uo.forEach(n=>Bd(fe,n)),M4(fe)}),C.form.addEventListener("submit",()=>setTimeout(hi,1e3)),S4(fe),fe.addSource("shape",Jd),fe.addLayer(Nd),fe.addLayer(Gd),Ms(fe,uo,jd);const t={settings:{controlsPosition:"bottom-right",throttlingDelay:100},controls:{draw:{circle_marker:{uiEnabled:!1},polygon:{uiEnabled:!1},line:{uiEnabled:!1},rectangle:{uiEnabled:!1},circle:{uiEnabled:!1},marker:{uiEnabled:!1},freehand:{uiEnabled:!1},text_marker:{uiEnabled:!1}},edit:{drag:{uiEnabled:!1},change:{uiEnabled:!1},rotate:{uiEnabled:!1},cut:{uiEnabled:!1},delete:{uiEnabled:!1},split:{uiEnabled:!1},scale:{uiEnabled:!1},copy:{uiEnabled:!1},union:{uiEnabled:!1},difference:{uiEnabled:!1},line_simplification:{uiEnabled:!1},lasso:{uiEnabled:!1}},helper:{shape_markers:{uiEnabled:!1},pin:{uiEnabled:!1},snapping:{uiEnabled:!1},snap_guides:{uiEnabled:!1},measurements:{uiEnabled:!1},auto_trace:{uiEnabled:!1},geofencing:{uiEnabled:!1},zoom_to_features:{uiEnabled:!1},click_to_edit:{uiEnabled:!1}}}},e=new E4(fe,t);C.formParkingObject.addEventListener("change",()=>{C.formParkingObject.value==="Parkstreifen"?setTimeout(()=>document.getElementById("geoJsonButton").addEventListener("click",()=>e.enableDraw("line")),100):C.formParkingObject.value==="Einzelparkplatz"?setTimeout(()=>document.getElementById("latLonButton").addEventListener("click",()=>e.enableDraw("circle_marker")),100):e.removeControl()})})});const A4=`

<div id="divForm">		

                <div><img id="formLogo" src="/img/MobiDataBW.svg"></a><img></div>

								<form id="form">


                <h2>Eingabemaske Straßen-Parkplätze</h2>

									
				<label for="parkingObject" class="mandatoryField">Parkobjekt*</label><br>
				<p>Angabe, ob Parkstreifen oder Einzelparkplatz erfasst werden sollen.</strong></p>
				<select id="parkingObject" name="Parkobjekt" required>
					<option value="" selected></option>
					<option value="Parkstreifen">Parkstreifen</option>
					<option value="Einzelparkplatz">Einzelparkplatz</option>
				</select>

				<label for="selectRecords">Daten aktualisieren</label><br>
				<p>Bereits erfasste Objekte können über die Auswahl des Namens ins Formular geladen werden und über die
					Schaltfläche <strong>Aktualisieren</strong> am Ende Formulars in der Datenbank aktualisiert werden.
				</p>
				<select id="divSelectRecords"></select>	

				
				<div id="divDatenmodell"></div>	

				<div id="divName"></div>	
				<div id="divId"></div>			
				<div id="divGeoJson"></div>
				<div id="divLongitudeLatitude"></div>				
				<div id="divAddress"></div>
				<div id="divCapacity"></div>
				<div id="divOrientation"></div>
				<div id="divLineType"></div>
				<div id="divParkingType"></div>		
				<div id="divStaticDataUpdatedAt"></div>		
				<div id="divParkingAudience"></div>	
				<div id="divWeekday"></div>			
				<div id="divHours"></div>
				<div id="divMaxStay"></div>				
				<div id="divDescription"></div>	

				<div id="divDubletten"></div>	
				<div id="divDuplicateId"></div>		
				<div id="divDuplicateAdditionalInformation"></div>	

				</form>

				</div>

			`;document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("divForm");if(!t){console.error('Element mit id="divForm" nicht gefunden!');return}t.innerHTML=A4});document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("parkingObject"),e=document.getElementById("divDatenmodell"),n=document.getElementById("divName"),r=document.getElementById("divId"),i=document.getElementById("divCapacity"),o=document.getElementById("divStaticDataUpdatedAt"),a=document.getElementById("divParkingAudience"),s=document.getElementById("divWeekday"),l=document.getElementById("divHours"),u=document.getElementById("divMaxStay"),h=document.getElementById("divDubletten"),c=document.getElementById("divDuplicateId"),p=document.getElementById("divDuplicateAdditionalInformation"),m=document.getElementById("divGeoJson"),A=document.getElementById("divAddress"),M=document.getElementById("divOrientation"),D=document.getElementById("divLineType"),P=document.getElementById("divParkingType"),E=document.getElementById("divDescription"),B=document.getElementById("divLongitudeLatitude"),O=document.getElementById("divSave");function R(d,f){let g=/^([1-9]\d*)$/;d.match(g)?f.innerText="":f.innerText="Bitte nur Ganzzahlen größer 0 angeben"}function G(d,f){let g=/\S+/;d.match(g)?f.id!="capacityValidation"&&(f.innerText=""):f.innerText="Pflichtfeld"}t.addEventListener("change",function(){J(),console.log("Parkobjekt gewechselt")});function J(){if(C.formParkingObject.value!=""?O.innerHTML=`
            <input type="submit" class="buttons" value="Speichern" id="submitButton">`:O.innerHTML="",divSelectRecords.addEventListener("change",function(){C.divSelectRecords.value!=""?O.innerHTML=`
                <input type="button" class="buttons" value="Speichern" id="updateButton">`:O.innerHTML=`
                <input type="submit" class="buttons" value="Speichern" id="submitButton">`}),e.innerHTML="",n.innerHTML="",r.innerHTML="",m.innerHTML="",B.innerHTML="",A.innerHTML="",i.innerHTML="",o.innerHTML="",a.innerHTML="",s.innerHTML="",l.innerHTML="",u.innerHTML="",M.innerHTML="",D.innerHTML="",P.innerHTML="",E.innerHTML="",h.innerHTML="",c.innerHTML="",p.innerHTML="",t.value!=""){e.innerHTML=`
            <h3>Datenmodell</h3>`,r.innerHTML=`
                    <label for=" id" class="mandatoryField">ID*</label><br>
                        <p>Eindeutige ID des Parkobjekt. Die ID wird automatisiert aus dem Namen erzeugt. Bei Bedarf kann ein eigener Name vergeben werden.</p>
                        <input type="text" id="id" name="ID" value="" required>
                            <div id="idValidation" class="formValidation"></div`,i.innerHTML=`
                            <label for="capacity" class="mandatoryField">Anzahl Stellplätze*</label><br>
                                <p>Gesamt-Anzahl generell zugänglicher Stellplätze</p>
                                <input type="number" id="capacity" name="Anzahl Stellplätze" required>
                                    <div id="capacityValidation" class="formValidation"></div>`,o.innerHTML=`
                                    <label for="staticDataUpdatedAt">Letzter Aktualisierungszeitpunkt</label><br>
                                        <p>Letzter Aktualisierungszeitpunkt, zu dem die statischen Daten aktualisiert wurden. <strong>Dieser Eintrag wird mit dem Aufrufen dieser Webseite automatisch gesetzt.</strong></p>
                                        <input type="datetime-local" id="staticDataUpdatedAt" name="Letzter Aktualisierungszeitpunkt">`,a.innerHTML=`
            <label for="parkingAudience">Einschränkung der Parkberechtigten</label><br>
            <p>Parkberechtigte, die diesen Parkplatz unter Umständen nutzen dürfen. Eine Mehrauswahl ist möglich. Wenn keine Auswahl getroffen wird, gibt es keine Einschränkungen.</p>
            <input type="checkbox" id="parkingAudienceDisabled" class="parkingAudienceCheckbox" name="Behinderte" value="Behinderte">
                                                    <label for="parkingAudienceDisabled" class="parkingAudienceCheckbox"> Behinderte</label><br>
                                                        <input type="checkbox" id="parkingAudienceWoman" class="parkingAudienceCheckbox" name="Frauen" value="Frauen">
                                                            <label for="parkingAudienceWoman" class="parkingAudienceCheckbox"> Frauen</label><br>
                                                                <input type="checkbox" id="parkingAudienceFamily" class="parkingAudienceCheckbox" name="Familien" value="Familien">
                                                                    <label for="parkingAudienceFamily" class="parkingAudienceCheckbox"> Familien</label><br>
                                                                        <input type="checkbox" id="parkingAudienceCharging" class="parkingAudienceCheckbox" name="zum Laden" value="zum Laden">
                                                                            <label for="parkingAudienceCharging" class="parkingAudienceCheckbox"> zum Laden</label><br>
                                                                                <input type="checkbox" id="parkingAudienceCarsharing" class="parkingAudienceCheckbox" name="Carsharing" value="Carsharing">
                                                                                    <label for="parkingAudienceCarsharing" class="parkingAudienceCheckbox"> Carsharing</label><br>
                                                                                        <input type="checkbox" id="parkingAudienceTaxi" class="parkingAudienceCheckbox" name="Taxi" value="Taxi">
                                                                                            <label for="parkingAudienceTaxi" class="parkingAudienceCheckbox"> Taxi</label><br>
                                                                                                <input type="checkbox" id="parkingAudienceDelivery" class="parkingAudienceCheckbox" name="Lieferverkehr" value="Lieferverkehr">
                                                                                                    <label for="parkingAudienceDelivery" class="parkingAudienceCheckbox"> Lieferverkehr</label><br>
                                                                                                        <input type="checkbox" id="parkingAudienceTruck" class="parkingAudienceCheckbox" name="Lastwagen" value="Lastwagen">
                                                                                                            <label for="parkingAudienceTruck" class="parkingAudienceCheckbox"> Lastwagen</label><br>
                                                                                                                <input type="checkbox" id="parkingAudienceBus" class="parkingAudienceCheckbox" name="Bus" value="Bus">
                                                                                                                    <label for="parkingAudienceBus" class="parkingAudienceCheckbox"> Bus</label><br>
                                                                                                                        <input type="checkbox" id="parkingAudienceClients" class="parkingAudienceCheckbox" name="Kunden" value="Kunden">
                                                                                                                            <label for="parkingAudienceClients" class="parkingAudienceCheckbox"> Kunden</label><br>
                                                                                                                                <input type="checkbox" id="parkingAudienceResidents" class="parkingAudienceCheckbox" name="Anwohner" value="Anwohner">
                                                                                                                                    <label for="parkingAudienceResidents" class="parkingAudienceCheckbox"> Anwohner</label><br>`,s.innerHTML=`
                                                                                                                                        <label for="weekdayBegin">Zeitraum</label><br>
                                                                                                                                            <p>z.B. Montag-Samstag 08:00-22:00, Sonntag 10:00-20:00</p>
                                                                                                                                            <div style="display:flex">
                                                                                                                                                <select style="margin-right:5px" id="weekdayBegin" name="Wochentag Beginn">
                                                                                                                                                    <option value="" selected></option>
                                                                                                                                                    <option value="Montag">Montag</option>
                                                                                                                                                    <option value="Dienstag">Dienstag</option>
                                                                                                                                                    <option value="Mittwoch">Mittwoch</option>
                                                                                                                                                    <option value="Donnerstag">Donnerstag</option>
                                                                                                                                                    <option value="Freitag">Freitag</option>
                                                                                                                                                    <option value="Samstag">Samstag</option>
                                                                                                                                                    <option value="Sonntag">Sonntag</option>
                                                                                                                                                </select>
                                                                                                                                                <select style="margin-left:5px" id="weekdayEnd" name="Wochentag Ende">
                                                                                                                                                    <option value="" selected></option>
                                                                                                                                                    <option value="Montag">Montag</option>
                                                                                                                                                    <option value="Dienstag">Dienstag</option>
                                                                                                                                                    <option value="Mittwoch">Mittwoch</option>
                                                                                                                                                    <option value="Donnerstag">Donnerstag</option>
                                                                                                                                                    <option value="Freitag">Freitag</option>
                                                                                                                                                    <option value="Samstag">Samstag</option>
                                                                                                                                                    <option value="Sonntag">Sonntag</option>
                                                                                                                                                </select>
                                                                                                                                            </div>`,l.innerHTML=`
                                                                                                                                            <div style="display:flex">
                                                                                                                                                <input style="margin-right:5px" type="time" id="hoursBegin" name="Zeitraum Beginn" value="">
                                                                                                                                                    <input style="margin-left:5px" type="time" id="hoursEnd" name="Zeitraum Ende" value="">
                                                                                                                                                    </div>`,u.innerHTML=`
                                                                                                                                                    <label for="maxStay">Maximale Parkdauer</label><br>
                                                                                                                                                        <p>Zeit, die das Fahrzeug hier maximal geparkt werden darf.</p>
                                                                                                                                                        <input type="time" id="maxStay" name="Maximale Parkdauer" value="">`,h.innerHTML=`
                                                                                                                                                            <h3 id="duplicates">Dubletten</h3>
                                                                                                                                                            <p>Wenn bereits in der Integrationsplattform angebundene Daten neu erfasst wurden, kann MobiData BW® darüber in Kenntnis gesetzt werden. Dadurch können mögliche Dubletten direkt                                                                                                                                                                erkannt werden.</p>`,c.innerHTML=`
                                                                                                                                                            <label for="duplicateId">ID</label><br>
                                                                                                                                                                <p>ID des <strong>ParkAPI-Objekts</strong> aus der Integrationsplattform für eine eindeutige Zuordnung. Die ID kann per Klick auf den Parkstreifen oder Einzelparkplatz                                                                                                                                                                    unter <strong>Integrationsplattform</strong> im Popup angezeigt werden.</p>
                                                                                                                                                                <input type="text" id="duplicateId" name="Dubletten-ID" value="">`,p.innerHTML=`
                                                                                                                                                                    <label for="duplicateAdditionalInformation">Weitere Informationen</label ><br>
                                                                                                                                                                        <p>Freitext-Feld für weitere Informationen, die MobiData BW® mitgeteilt werden sollen. Denkbar ist eine Begründung, warum es sich um eine Dublette handelt oder der Hinweis, dass                                                                                                                                                                            die bereits von MobiData BW® angebundenen Daten Fehler aufweisen.</p>
                                                                                                                                                                        <textarea id="duplicateAdditionalInformation" name="Dublette - Weitere Informationen"></textarea>`;const d=new Date,f=_=>String(_).padStart(2,"0"),g=d.getFullYear(),v=f(d.getMonth()+1),y=f(d.getDate()),S=f(d.getHours()),F=f(d.getMinutes());document.getElementById("staticDataUpdatedAt").value=`${g}-${v}-${y}T${S}:${F}`;const k=document.getElementById("id"),x=document.getElementById("idValidation");k.addEventListener("blur",function(){G(k.value,x)});const T=document.getElementById("capacity"),I=document.getElementById("capacityValidation");T.addEventListener("input",function(){R(T.value,I)}),T.addEventListener("blur",function(){G(T.value,I)})}if(t.value=="Parkstreifen"){n.innerHTML=`
            <label for="name" class="mandatoryField">Name*</label><br>
            <p>Name des Parkangebots</p>
            <input type="text" id="name" name="Name" value="" required>
            <div id="nameValidation" class="formValidation"></div>`,m.innerHTML=`
                                                                                                                                                                        <label for="geoJson" class="mandatoryField">GeoJSON*</label><br>
                                                                                                                                                                            <p>Bei Klick auf <strong>Linie erfassen</strong> wird in dieses Textfeld automatisch die Linien-Geometrie als GeoJSON übertragen.</p>
                                                                                                                                                                            <textarea id="geoJson" name="GeoJSON" required></textarea>
                                                                                                                                                                            <div id="geoJsonValidation" class="formValidation"></div>
                                                                                                                                                                            <input type="button" class="buttons" value="Linie erfassen" id="geoJsonButton">`,B.innerHTML="",A.innerHTML=`
                                                                                                                                                                                <label for="addressStreetNumber">Adresse</label><br>
                                                                                                                                                                                    <p>z.B. Bahnhofstraße 1, 77777 Bahnhofsstadt</p>
                                                                                                                                                                                    <div style="display:flex">
                                                                                                                                                                                        <input style="margin-right:5px" type="text" id="addressStreetNumber" name="Adresse - Straße und Nummer" value=""></input>
                                                                                                                                                                                        <input style="margin-left:5px" type="text" id="addressZipCity" name="Adresse - PLZ und Stadt" value=""></input>
                                                                                                                                                                                    </div>`,M.innerHTML=`
                                                                                                                                                                                    <label for="orientation">Ausrichtung des Parkstreifens</label><br>
                                                                                                                                                                                        <p>Beschreibt, wie das Fahrzeug in Bezug auf die Fahrtrichtung geparkt wird.</p>
                                                                                                                                                                                        <select id="orientation" name="Ausrichtung">
                                                                                                                                                                                            <option value="" selected></option>
                                                                                                                                                                                            <option value="längs">längs</option>
                                                                                                                                                                                            <option value="quer">quer</option>
                                                                                                                                                                                            <option value="diagonal">diagonal</option>
                                                                                                                                                                                        </select>`,D.innerHTML=`
                                                                                                                                                                                        <label for="lineType">Linientyp</label><br>
                                                                                                                                                                                            <p>Linientyp, der bei der Erfassung genutzt wird. Entweder handelt es sich um eine                                                                                                                                                                                                <span class="tooltip" data-tooltip="Linie, die durch die Mitte der Straße geht und die Parkstreifen auf beiden Straßenseiten erfasst.">Straßenmittellinie</span>
                                                                                                                                                                                                oder eine
                                                                                                                                                                                                <span class="tooltip" data-tooltip="Linie, die am Rand des Parkstreifens erfasst wird, sodass der Parkstreifen sich immer rechts davon befindet. Dieser Rand ist der Übergang            von Parkplatz zur Straße.">Parkrandlinie</span>
                                                                                                                                                                                                .</p>
                                                                                                                                                                                            <select id="lineType" name="Linientyp">
                                                                                                                                                                                                <option value="" selected></option>
                                                                                                                                                                                                <option value="Straßenmittellinie">Straßenmittellinie</option>
                                                                                                                                                                                                <option value="Parkrandlinie">Parkrandlinie</option>
                                                                                                                                                                                            </select>`,P.innerHTML=`
                                                                                                                                                                                            <label for="parkingType">Verortung</label><br>
                                                                                                                                                                                                <p>Beschreibt den Ort des Parkplatzes in Bezug auf die Fahrbahn.</p>
                                                                                                                                                                                                <select id="parkingType" name="Verortung">
                                                                                                                                                                                                    <option value="" selected></option>
                                                                                                                                                                                                    <option value="Fahrbahn">Fahrbahn</option>
                                                                                                                                                                                                    <option value="halb auf Bordstein">halb auf Bordstein</option>
                                                                                                                                                                                                    <option value="Bordstein">Bordstein</option>
                                                                                                                                                                                                    <option value="Seitenstreifen">Seitenstreifen</option>
                                                                                                                                                                                                </select>`,E.innerHTML=`
                                                                                                                                                                                                <label for="description" > Beschreibung</label > <br>
                                                                                                                                                                                                    <p>Freitext-Feld zur Beschreibung von weiteren Informationen für Nutzende</p>
                                                                                                                                                                                                    <textarea id="description" name="Beschreibung"></textarea>`;const d=document.getElementById("nameValidation"),f=document.getElementById("name");f.addEventListener("blur",function(){G(f.value,d)});const g=document.getElementById("geoJson"),v=document.getElementById("geoJsonValidation");g.addEventListener("blur",function(){G(g.value,v)})}if(t.value=="Einzelparkplatz"){n.innerHTML=`
            <label for="name">Name</label><br>
            <p>Name des Parkangebots</p>
            <input type="text" id="name" name="Name" value="">`,B.innerHTML=`
                                                                                                                                                                                                    <div style="display:flex">
                                                                                                                                                                                                        <div style="width:100%">
                                                                                                                                                                                                            <label for="longitude" style="justify-self:anchor-center" class="mandatoryField">Längengrad*</label><br>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        <div style="width:100%">
                                                                                                                                                                                                            <label for="latitude" style="justify-self:anchor-center" class="mandatoryField">Breitengrad*</label><br>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                    </div>
                                                                                                                                                                                                    <p>Bei Klick auf <strong>Punkt erfassen</strong> wird in die entsprechenden Felder automatisch die Koordinaten übertragen.</p>
                                                                                                                                                                                                    <div style="display:flex">
                                                                                                                                                                                                        <div style="width:100%">
                                                                                                                                                                                                            <input type="text" style="margin-right:5px" id="longitude" name="Längengrad" value="" required>
                                                                                                                                                                                                                <div id="longitudeValidation" style="justify-self:anchor-center" class="formValidation"></div>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        <div style="width:100%">
                                                                                                                                                                                                            <input type="text" style="margin-left:5px" id="latitude" name="Breitengrad" value="" required>
                                                                                                                                                                                                                <div id="latitudeValidation" style="justify-self:anchor-center" class="formValidation"></div>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                    </div>
                                                                                                                                                                                                    <input type="button" class="buttons" value="Punkt erfassen" id="latLonButton">`,m.innerHTML="";const d=document.getElementById("longitude"),f=document.getElementById("longitudeValidation");d.addEventListener("blur",function(){G(d.value,f)});const g=document.getElementById("latitude"),v=document.getElementById("latitudeValidation");g.addEventListener("blur",function(){G(g.value,v)})}if(document.getElementById("name")){const d=document.getElementById("name"),f=document.getElementById("id");d.addEventListener("blur",function(){f.value=d.value.toLowerCase().replace(" ","-"),C.formParkingObject.addEventListener("change",function(){f.value="",document.getElementById("idValidation").innerText=""})})}}});let Mr;Mr=async function(){let t;C.formParkingObject.addEventListener("change",async function(){try{let n=C.formParkingObject.value=="Parkstreifen"?"https://app.nocodb.com/api/v2/tables/m8djfhqn3wv21gi/records":"https://app.nocodb.com/api/v2/tables/m4xmt3pj6vfggvp/records";var e=await(await fetch(n,{method:"GET",headers:{"Content-Type":"application/json","xc-token":C.apiKey}})).json();t=e.list,wd(t,Mr)}catch(n){console.error("Fehler: ",n)}})};document.addEventListener("DOMContentLoaded",async function(){Mr()});C.form.addEventListener("submit",async function(t){t.preventDefault(),await Mr(),console.log("Aktueller Stand der Datenbank wird nach Erfassung abgerufen")});let wd;wd=function(t){const e=new Map;for(var n in t)e.set(t[n].Name,t[n].Id);var r=Array.from(e.keys());C.divSelectRecords.innerHTML="";var i=document.createElement("option");i.value="",i.selected=!0,C.divSelectRecords.appendChild(i);for(var o in t){var a=document.createElement("option");a.value=r[o],a.textContent=r[o],C.divSelectRecords.appendChild(a)}ba(t,e)};let ti,ba;ba=function(t,e){const n=document.getElementById("updateButton"),r=e.get(C.divSelectRecords.value);if(C.divSelectRecords.value!==""){for(let i in t)if(t[i].Id==r){if(C.formName.value=t[i][C.formName.name],C.formId.value=t[i].Identifier,C.formCapacity.value=t[i][C.formCapacity.name],C.formStaticDataUpdatedAt.value=t[i][C.formStaticDataUpdatedAt.name],t[i].Parkberechtigte!=null)for(const o of C.formParkingAudienceCheckboxes)t[i].Parkberechtigte.includes(o.name)&&(document.getElementById(o.id).checked=!0);C.formWeekdayBegin.value=t[i][C.formWeekdayBegin.name],C.formWeekdayEnd.value=t[i][C.formWeekdayEnd.name],C.formHoursBegin.value=t[i][C.formHoursBegin.name],C.formHoursEnd.value=t[i][C.formHoursEnd.name],C.formMaxStay.value=t[i][C.formMaxStay.name],C.formDuplicateId.value=t[i][C.formDuplicateId.name],C.formDuplicateAdditionalInformation.value=t[i][C.formDuplicateAdditionalInformation.name],C.formParkingObject.value=="Parkstreifen"&&(C.formGeoJson.value=JSON.stringify(t[i][C.formGeoJson.name]),C.formAddressStreetNumber.value=t[i][C.formAddressStreetNumber.name],C.formAddressZipCity.value=t[i][C.formAddressZipCity.name],C.formOrientation.value=t[i][C.formOrientation.name],C.formLineType.value=t[i][C.formLineType.name],C.formParkingType.value=t[i][C.formParkingType.name],C.formDescription.value=t[i][C.formDescription.name]),C.formParkingObject.value=="Einzelparkplatz"&&(C.formLongitude.value=t[i][C.formLongitude.name],C.formLatitude.value=t[i][C.formLatitude.name]),ti&&n.removeEventListener("click",ti),ti=async function(o){o.preventDefault();const a=e.get(divSelectRecords.value);await Ti(t,a),console.log("Aktualisierung erfolgt")},n.addEventListener("click",ti);break}}C.divSelectRecords.addEventListener("change",()=>{ba(t,e)})};const tn=[];C.formParkingObject.addEventListener("click",function(){C.formParkingObject.value!=""&&C.divSelectRecords.addEventListener("change",function(){tn.length=0,document.querySelectorAll("input.parkingAudienceCheckbox").forEach(t=>t.checked=!1),C.divSelectRecords.value!=""&&setTimeout(()=>{for(const t of document.querySelectorAll("input.parkingAudienceCheckbox"))t.checked&&tn.push(t.name),t.addEventListener("change",function(){const e=tn.indexOf(this.name);this.checked?e===-1&&tn.push(this.name):e>-1&&tn.splice(e,1),console.log(tn)})},100)})});var Ti;Ti&&(updateButton.removeEventListener("click",async function(){Ti(records,recordsId)}),console.log("Entfernen des letzten Hinzufügens des Event-Listeners"));Ti=async function(t,e){let n;if(C.formParkingObject.value=="Parkstreifen"?n={[C.formGeoJson.name]:JSON.parse(C.formGeoJson.value)}:C.formParkingObject.value=="Einzelparkplatz"&&(n={[C.formLongitude.name]:String(C.formLongitude.value),[C.formLatitude.name]:String(C.formLatitude.value)}),C.formId.value!=""&&C.formCapacity.value!=""&&(C.formLongitude!=""&&C.formLongitude!=""||C.formGeoJson!="")){if(C.formId.value!="Parkstreifen"||formName.value!=""){var r;for(var i in t)if(t[i].Id==e){const a=l=>l===""?null:Number(l),s=l=>l===""?null:l;r={Id:t[i].Id,[C.formName.name]:C.formName.value,Identifier:C.formId.value,...n,[C.formAddressStreetNumber.name]:C.formAddressStreetNumber.value,[C.formAddressZipCity.name]:C.formAddressZipCity.value,[C.formCapacity.name]:a(C.formCapacity.value),[C.formOrientation.name]:C.formOrientation.value,[C.formLineType.name]:C.formLineType.value,[C.formParkingType.name]:C.formParkingType.value,Parkberechtigte:tn,[C.formWeekdayBegin.name]:C.formWeekdayBegin.value,[C.formWeekdayEnd.name]:C.formWeekdayEnd.value,[C.formHoursBegin.name]:s(C.formHoursBegin.value),[C.formHoursEnd.name]:s(C.formHoursEnd.value),[C.formMaxStay.name]:s(C.formMaxStay.value),[C.formDescription.name]:C.formDescription.value,[C.formDuplicateId.name]:C.formDuplicateId.value,[C.formDuplicateAdditionalInformation.name]:C.formDuplicateAdditionalInformation.value};break}}try{let a=C.formParkingObject.value=="Parkstreifen"?"https://app.nocodb.com/api/v2/tables/m8djfhqn3wv21gi/records":"https://app.nocodb.com/api/v2/tables/m4xmt3pj6vfggvp/records";var o=await fetch(a,{method:"PATCH",headers:{"Content-Type":"application/json","xc-token":C.apiKey},body:JSON.stringify(r)});console.log(JSON.stringify(r)),o.ok?(fi.success("Aktualisieren erfolgreich"),hi(),C.form.reset(),Mr()):fi.error("Aktualisieren fehlgeschlagen")}catch(a){console.error("Fehler beim Versuch, einen bestehenden Eintrag zu aktualisieren: ",a)}}else fi.alert("Nicht alle Pflichtangaben gemacht")}});export default L4();
