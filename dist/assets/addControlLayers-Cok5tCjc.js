import{b as C}from"./paths-kVD327XS.js";import{l as k,a as E,b as G}from"./controlLayers-nwXqyDIR.js";function A(a){let e=!1;for(let i=0;i<a.length;i++){if(!a[i].checked){e=!1;break}e=!0}return e}function T(a,e){if(a.style.height=a.scrollHeight+"px",a.scrollHeight>50)a.style.height="36px",setTimeout(function(){var t=a.children;if(t.length>1&&t[e].style.display==="none")for(var r=e;r<t.length;r++)t[r].dataset.hidden||(t[r].style.display="block");else for(var r=e;r<t.length;r++)t[r].style.display="none";a.style.height="auto"},400);else{var i=a.children;if(i.length>1&&i[e].style.display==="none")for(var n=e;n<i.length;n++)i[n].dataset.hidden||(i[n].style.display="block");else for(var n=e;n<i.length;n++)i[n].style.display="none";a.style.height=a.scrollHeight+"px",setTimeout(function(){a.style.height="auto"},400)}}function v(a,e){let i=e.reduce((s,d)=>[...s,d.id],[]),n=a,t=n.getStyle().layers,r=w(t),o=new URLSearchParams(window.location.search),l=[...o.keys()];return[...o.values()],l.map(function(s){i.indexOf(s)>-1&&(g(t,r,s)||n.setLayoutProperty(s,"visibility","visible"))}),l}function _(a,e,i){let n=e===!0?"visible":"none";a.setLayoutProperty(i,"visibility",n)}function $(a,e){let i=a.filter(function(n){return n.id===e.id});return!!i[0].paint&&i[0].paint}function w(a){return a.reduce((e,i)=>[...e,i.id],[])}function g(a,e,i){var n=e.indexOf(i);return!(n<0)&&a[n].layout.visibility==="visible"}class y{constructor(e){e=e||{},this._collapsed=!1,(e.options&&e.options.collapsed||e&&e.collapsed)&&(this._collapsed=!0),e.options&&e.options.addLayers&&(this._addLayers=!0),this._layers=e.layers.reverse().slice(),this._layerIds=this._layers.reduce((o,l)=>[...o,l.id],[]);let i=[],n=[];i=this._layers.reduce(function(o,l){return[...o,l.directory]},[]),this._directories=[...new Set(i)],n=this._layers.reduce(function(o,l){return l.group||(l.group="Operational Layers"),[...o,l.group]},[]),this._groups=[...new Set(n)];let t={};this._directories.forEach(function(o){e.layers.forEach(function(l){l.directory===o&&(t[l.directory]={})})}),this._layers.forEach(function(o){o.group||(o.group="Operational Layers"),t[o.directory][o.group]=[]}),this._layers.forEach(function(o){t[o.directory][o.group].push(o)});let r=this._layers.slice();this._layers.forEach(function(o){o.name||(o.name=o.id),o.metadata||(o.metadata={}),o.metadata.layers||(o.metadata.layers=[o.id]),o.children&&r.forEach(l=>{l.parent&&l.parent===o.id&&(o.metadata.layers=[...o.metadata.layers,l.id])})}),this._layerControlConfig=t}onAdd(e){this._map=e;let i=this;this._sources=[],this._container=e.getContainer(),this._div=q(this._collapsed);const n=v(this._map,this._layers);this._layers.forEach(t=>{t.parent&&n.includes(t.parent)&&(e.setLayoutProperty(t.id,"visibility","visible"),m(t.id,!0)),t.parent&&n.includes(t.id)&&!n.includes(t.parent)&&(e.setLayoutProperty(t.id,"visibility","none"),e.setLayoutProperty(t.parent,"visibility","none"),m(t.id,!1))}),this._activeLayers=v(this._map,this._layers),this._mapLayers=this._map.getStyle().layers,this._mapLayerIds=w(this._mapLayers);for(let t in this._layerControlConfig){let r=t,o=0;this._layers.forEach(s=>{if(s.directory===t&&!s.parent){var d=g(this._mapLayers,this._mapLayerIds,s.id);d&&(o=o+1)}});let l=M(r,o);for(let s in this._layerControlConfig[t]){let d=z(s,this._layerControlConfig[t][s]),p=this._layerControlConfig[t][s];for(let u=0;u<p.length;u++){let c=p[u],h=$(this._mapLayers,c);!c.legend&&h&&(c.simpleLegend=D(h));let b;b=g(this._mapLayers,this._mapLayerIds,c.id);let{layerSelector:x,newSources:S}=O(this._map,c,b,this._sources);this._sources=S,d.appendChild(x)}l.appendChild(d)}this._div.appendChild(l)}return this._collapsed&&(this._div.addEventListener("mouseenter",function(t){setTimeout(function(){t.target.classList.remove("collapsed")},0)}),this._div.addEventListener("mouseleave",function(t){t.target.classList.add("collapsed")})),this._div.addEventListener("click",function(t){if(t.target.dataset.layerControl){t.target.classList.remove("collapsed");return}if(t.target.className==="checkbox"){t.target.children[0].click();return}if(t.target.dataset.mapLayer){if(_(e,t.target.checked,t.target.id),t.target.dataset.children){let r=document.querySelectorAll("[data-parent]");for(let o=0;o<r.length;o++)r[o].dataset.parent===t.target.id&&r[o].click()}return}if(t.target.dataset.mapLayer&&t.target.dataset.group!=!1){t.stopPropagation();let r=t.target.dataset.group,o=document.querySelectorAll("[data-group]");for(let l=0;l<o.length;l++)r!="false"&&o[l].dataset.group===r&&_(e,t.target.checked,o[l].id);return}if(t.target.dataset.layergroup){let r=t.target.parentElement.querySelectorAll("[data-master-layer]");if(A(r))for(let o=0;o<r.length;o++){let l=r[o];l.checked&&l.click()}else for(let o=0;o<r.length;o++)r[o].checked||r[o].click();return}if(t.target.dataset.directoryToggle){t.target.parentElement.children[2].style.display!="none"?t.target.parentElement.children[0].className="collapsed":t.target.parentElement.children[0].className="",T(t.target.parentElement,2),setTimeout(function(){V(t.target.parentElement)||(window.location.hash=t.target.id)},410),setTimeout(function(){i._map.resize()},450);return}}),this._collapsed&&this._map.on("click",function(){i._div.classList.add("collapsed")}),this._map.on("zoomend",function(){let t=this;document.querySelectorAll("[data-master-layer]").forEach(function(o){o.dataset.minzoom&&o.dataset.minzoom>t.getZoom()?(o.parentElement.style.opacity="0.3",o.disabled=!0):(o.parentElement.style.opacity="1",o.disabled=!1)})}),this._div}onRemove(e){this._map=e,this._div.parentNode.removeChild(this._div),this._map=void 0}}function O(a,e,i,n){let t=document.createElement("div");t.className="checkbox",t.title="Map Layer",e.hidden&&(t.style.display="none",t.dataset.hidden=!0);let r=document.createElement("input");r.name=e.name?e.name:e.id,r.type="checkbox",r.id=e.id,r.dataset.group=e.group?e.group:!1,e.metadata.lazyLoading&&e.metadata.source&&e.metadata.source.id&&e.metadata.source.type&&e.metadata.source.data&&(r.dataset.lazyLoading=!0,r.dataset.source=e.metadata.source.id,r.dataset.sourceType=e.metadata.source.type,r.dataset.sourceData=e.metadata.source.data,n.push(e.metadata.source.id)),e.minzoom&&(r.dataset.minzoom=e.minzoom),e.children&&(r.dataset.children=!0,r.dataset.masterLayer=!0),e.parent?r.dataset.parent=e.parent:r.dataset.masterLayer=!0,r.className="layer slide-toggle",r.dataset.mapLayer=!0,r.dataset.directory=e.directory?e.directory:"",i&&(r.checked=!0),L(a,r),r.onclick=function(){L(a,this),m(this.id,this.checked),H(this),I(this)};let o=document.createElement("label");o.setAttribute("for",e.id);let l=document.createElement("div");if(o.innerHTML=e.name?e.name:e.id,o.dataset.layerToggle="true",t.appendChild(r),t.appendChild(o),e.metadata&&e.metadata.filterSchema){let s=document.createElement("span");s.style.float="right",s.style.height="20px",s.style.opacity=.3,s.innerHTML=B(),s.onclick=function(){N(a,e)},s.onmouseenter=function(){this.style.opacity=1},s.onmouseleave=function(){this.style.opacity=.3},t.appendChild(s)}return t.appendChild(l),{layerSelector:t,newSources:n}}function L(a,e){if(e.dataset.lazyLoading&&e.checked&&!e.dataset.sourceLoaded){const i=a.getSource(e.dataset.source);if(!i)return;if(!i._data.features.length){const n=R(a);fetch(e.dataset.sourceData,{cache:"force-cache"}).then(t=>t.json()).then(t=>{const r=a.getSource(e.dataset.source);(r._data.features&&!r._data.features.length||r._data.geometries&&!r._data.geometries.length)&&a.getSource(e.dataset.source).setData(t),n.style.display="none",n.remove(),e.setAttribute("data-source-loaded",!0)})}}}function I(a){let e=a.closest(".mgl-layerControlDirectory"),i=e.querySelectorAll("[data-master-layer]"),n=0;i.forEach(function(t){t.checked&&(n=n+1)}),n>0?(e.children[1].children[0].innerHTML=n,e.children[1].children[0].style.display="block"):e.children[1].children[0].style.display="none"}function M(a,e){let i=document.createElement("div");i.dataset.accordian=!0,i.style.backgroundColor="white",i.className="mgl-layerControlDirectory";let n=document.createElement("button");n.dataset.directoryToggle=!0,i.appendChild(n);let t=document.createElement("div");t.className="directory",t.id=a.replace(/ /g,"_"),t.innerText=a,t.dataset.name=a,t.dataset.directoryToggle=!0;var r=document.createElement("span");return r.style.background="#0d84b3",r.className="mgl-layerControlDirectoryCounter",r.style.display=e===0?"none":"block",r.innerText=e||"",r.style.float="right",r.style.color="white",r.style.padding="1px 4px 0",t.appendChild(r),i.appendChild(t),i}function z(a,e,i){let n=document.createElement("div");n.style.margin="4px 0 4px 8px";let t=document.createElement("input");t.type="checkbox";let r="layerGroup_"+a.replace(/ /g,"_");t.id=r,t.style.display="none",t.dataset.layergroup=a;let o=document.createElement("label");return o.setAttribute("for",r),o.className="mgl-layerControlGroupHeading",o.textContent=a,n.appendChild(t),n.appendChild(o),n}function q(a){let e=document.createElement("div");return e["aria-label"]="Layer Control",e.dataset.layerControl="true",e.className="mapboxgl-ctrl mapboxgl-ctrl-group mgl-layerControl",a&&e.classList.add("collapsed"),e}function D(a){let e=Object.keys(a),i=!1;return e.indexOf("line-color")>-1&&f(a["line-color"])&&(i=`<icon class='fa fa-minus' style='color:${a["line-color"]};margin-right:6px;'></icon>`),e.indexOf("fill-color")>-1&&f(a["fill-color"])&&(i=`<icon class='fa fa-square' style='color:${a["fill-color"]};margin-right:6px;'></icon>`),e.indexOf("circle-color")>-1&&f(a["circle-color"])&&(i=`<icon class='fa fa-circle' style='color:${a["circle-color"]};margin-right:6px;'></icon>`),i}function f(a){return typeof a=="string"||a instanceof String}function m(a,e){let i=a,n=e,t=new URLSearchParams(window.location.search);if(n){if(t.set(i,!0),history.replaceState){let r=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+t.toString()+window.location.hash;window.history.replaceState({path:r},"",r)}}else if(t.delete(i),history.replaceState){let r=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+t.toString()+window.location.hash;window.history.replaceState({path:r},"",r)}}function H(a){let e=a.parentElement.querySelectorAll("[data-layer-child-legend]"),i=a.checked?"block":"none";for(let n=0;n<e.length;n++)e[n].style.display=i}function N(a,e){console.log(e);var i=e.id+"_FilterModal";if(document.getElementById(i))window.location.hash="#",window.location.hash=i;else{var n=document.createElement("div");n.id=i,n.classList="modal",n.style.alignItems="flex-start",n.innerHTML=`
    <a href="#close" class="modal-overlay" aria-label="Close" style="opacity: 0.8"></a>
    <div class="modal-container" style="width: 400px;">
      <div class="modal-header">
        <a href="#close" class="btn btn-clear float-right modal-close" aria-label="Close"></a>
        <div class="modal-title h4">
          <span>Filter ${e.name}</span>
        </div>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
      </div>
    </div>`;var t=document.createElement("form");t.innerHTML=`
      ${P(e.metadata.filterSchema)}
      <br>
      <button type="submit" class="btn btn-primary">Submit</button>
      <button class="btn btn-outline" type="reset" style="float:right">Reset</button>
    `,t.addEventListener("submit",function(r){r.preventDefault(),window.location.hash="#";var o=F(new FormData(t),e);console.log(o),o?e.metadata.layers.forEach(l=>{a.setFilter(l,o)}):e.metadata.layers.forEach(l=>{a.setFilter(l)})}),t.addEventListener("reset",function(r){e.metadata.layers.forEach(o=>{a.setFilter(o)})}),n.querySelector(".modal-body").appendChild(t),document.body.appendChild(n),window.location.hash="#",window.location.hash=i}}function F(a,e){const i=[...a.keys()],n=[...a.values()];for(var t=[],r=0;r<i.length;r++){if(i[r].includes("operator")||!n[r])continue;let o=n[r];switch(e.metadata.filterSchema[i[r]].type==="date"&&e.metadata.filterSchema[i[r]].epoch&&(o=new Date(o+"T00:00:00").getTime()),console.log(o),e.metadata.filterSchema[i[r]].type){case"date":t.push([n[r+1],["get",i[r]],o]);break;case"number":t.push([n[r+1],["get",i[r]],Number(o)]);break;default:t.push(["==",["get",i[r]],o])}}return t.length<1?null:["all",...t]}function P(a){let e="";for(let i in a){let n=i.replace(/_/g," ").toUpperCase();e+=`
    <div class="form-group">
      <label class="form-label" for="${i}">${n}</label>
      ${a[i].options?`<select id="${i}" class="form-select" name="${i}" ${a[i].required?'required="true"':""}>
          ${a[i].options.map(t=>`<option>${t}</option>`)}
         </select>`:`<input class="form-input" id="${i}" type="${a[i].type}" name="${i}"  ${a[i].readonly?'readonly="true"':""} ${a[i].required?'required="true"':""}>`}
      ${a[i].hint?`<p class="form-input-hint">${a[i].hint}</p>`:""}
    </div>
    `,(a[i].type==="date"||a[i].type==="number")&&(e+=`
      <div class="form-group">
        <label  class="form-label" for="${i}_operator">${n} OPERATOR</label>
        <select id="${i}_operator"  name="${i}_operator" class="form-select">
          <option>></option>
          <option>>=</option>
          <option>==</option>
          <option><=</option>
          <option><</option>
        </select>
      </div>
    `)}return e}function B(){return'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><path d="M0,0h24 M24,24H0" fill="none"/><path d="M4.25,5.61C6.27,8.2,10,13,10,13v6c0,0.55,0.45,1,1,1h2c0.55,0,1-0.45,1-1v-6c0,0,3.72-4.8,5.74-7.39 C20.25,4.95,19.78,4,18.95,4H5.04C4.21,4,3.74,4.95,4.25,5.61z"/><path d="M0,0h24v24H0V0z" fill="none"/></g></svg>'}function R(a){const e=`<svg version="1.1" id="L9" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve">
      <path fill="#fff" d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
        <animateTransform 
          attributeName="transform" 
          attributeType="XML" 
          type="rotate"
          dur="0.6s" 
          from="0 50 50"
          to="360 50 50" 
          repeatCount="indefinite" />
    </path>
  </svg>`,i=document.createElement("div");i.style.position="absolute",i.style.top=0,i.style.left=0,i.style.bottom=0,i.style.zIndex=1,i.style.width="100%",i.style.background="rgba(255,255,255,0.5)";let n=document.createElement("div");return n.innerHTML=e,n.style.position="absolute",n.style.display="block",n.style.top="50%",n.style.left="50%",n.style.width="120px",n.style.height="120px",n.style.transform="translate(-50%, -50%)",i.appendChild(n),a.getContainer().appendChild(i),i}function V(a){var e=a.getBoundingClientRect(),i=e.top,n=e.bottom,t=i>=0&&n<=window.innerHeight;return t}y.prototype._initGroupSettings=function(){this._groupSettings||(this._groupSettings={},this._layers.forEach(a=>{const e=a.group||"Operational Layers";this._groupSettings[e]||(this._groupSettings[e]={excludeOtherGroups:!1,exclusiveWithinGroup:!1,excludeGroups:null})}),this._layers.forEach(a=>{const e=this._groupSettings[a.group||"Operational Layers"];a.exclusiveWithinGroup&&(e.exclusiveWithinGroup=!0),Array.isArray(a.excludeGroups)&&(e.excludeGroups=a.excludeGroups.slice())}),this._exclusiveAllGroups===!0?Object.keys(this._groupSettings).forEach(a=>this._groupSettings[a].excludeOtherGroups=!0):Array.isArray(this._exclusiveGroupsList)&&this._exclusiveGroupsList.forEach(a=>{this._groupSettings[a]&&(this._groupSettings[a].excludeOtherGroups=!0)}))};function j(a){if(this._initGroupSettings(),a.target.dataset.layergroup){const t=a.target.dataset.layergroup,r=this._groupSettings[t]||{};setTimeout(()=>{if(r.excludeOtherGroups||Array.isArray(r.excludeGroups)){const o=r.excludeOtherGroups?Object.keys(this._groupSettings).filter(l=>l!==t):r.excludeGroups.slice();document.querySelectorAll("input[data-map-layer]").forEach(l=>{l.dataset.group&&o.includes(l.dataset.group)&&l.checked&&l.click()})}setTimeout(()=>{const{pathname:o,hash:l}=window.location;history.replaceState(null,"",o+l)},0)},0);return}let e=null,i=null,n=!1;if(a.target.dataset.mapLayer)e=a.target.dataset.group||null,i=a.target.dataset.subgroup||null,n=a.target.checked;else if(a.target.tagName==="LABEL"&&a.target.htmlFor){const t=document.getElementById(a.target.htmlFor);t&&t.dataset.mapLayer&&(e=t.dataset.group||null,i=t.dataset.subgroup||null,n=t.checked)}if(e&&n){const t=this._groupSettings[e]||{};if(t.excludeOtherGroups||Array.isArray(t.excludeGroups)){const r=t.excludeOtherGroups?Object.keys(this._groupSettings).filter(o=>o!==e):t.excludeGroups.slice();document.querySelectorAll("input[data-map-layer]").forEach(o=>{o.dataset.group&&r.includes(o.dataset.group)&&o.checked&&o.click()})}t.exclusiveWithinGroup&&i&&document.querySelectorAll(`input[data-map-layer][data-subgroup="${i}"]`).forEach(r=>{const o=a.target.dataset.mapLayer?a.target.id:a.target.htmlFor;r.id!==o&&r.checked&&r.click()}),setTimeout(()=>{const{pathname:r,hash:o}=window.location;history.replaceState(null,"",r+o)},0)}}(function(){const a=y.prototype.onAdd;y.prototype.onAdd=function(e){const i=a.call(this,e);return this._layers.forEach(n=>{const t=i.querySelector(`input#${CSS.escape(n.id)}[data-map-layer]`);t&&typeof n.subGroup=="string"&&n.subGroup&&(t.dataset.subgroup=n.subGroup)}),i.addEventListener("click",n=>{setTimeout(()=>j.call(this,n),0)},!1),i}})();function X(a,e,i){return a.map(n=>{const{id:t,label:r,color:o,group:l,subGroup:s="",type:d,exclusiveWithinGroup:p,symbol:u}=n;let c;l==="Baustellen"?c=`<img class='legendIcon' src='${C}img/controlElements/verkehrszeichen.svg'></img>`:l==="ÖPNV-Linien"||d==="line"?c=k(o):d==="fill"?c=E(o):c=G(o);const h=n.legendColor==="none"?"":typeof u=="function"?u():c;return{id:t,name:h+r,group:i=="group"?l:s||l,subGroup:s,directory:e,exclusiveWithinGroup:p,metadata:{lazyLoading:!0,source:{id:n.source,type:"geojson",data:n.url}}}}).reverse()}export{X as a,y as l};
