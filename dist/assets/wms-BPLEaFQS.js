import{o as f}from"./addControlLayers-B5C1aJ19.js";function R(t,c,g){t.on("mousemove",i=>{const s=c.filter(n=>t.getLayer(n.id)&&t.getLayoutProperty(n.id,"visibility")!=="none");t.getCanvas().style.cursor=s.length>0?"pointer":"normal"}),t.on("click",async i=>{const s=c.filter(e=>t.getLayer(e.id)&&t.getLayoutProperty(e.id,"visibility")!=="none");if(s.length===0)return;const n=t.getBounds(),a=t.getContainer().getBoundingClientRect(),l=[n.getSouth(),n.getWest(),n.getNorth(),n.getEast()].join(","),u=t.project(i.lngLat),d=s.map(async e=>{const o={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",LAYERS:e.layer,QUERY_LAYERS:e.layer,STYLES:e.style,BBOX:l,CRS:"EPSG:4326",WIDTH:a.width,HEIGHT:a.height,FORMAT:"image/png",INFO_FORMAT:"application/json",i:Math.round(u.x),j:Math.round(u.y),buffer:5};e.cql&&(o.CQL_FILTER=e.cql);const y=`https://api.mobidata-bw.de/geoserver/ows?${Object.keys(o).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(o[r])}`).join("&")}`;try{return await(await fetch(y)).json()}catch(r){return console.error("GetFeatureInfo-Fehler:",r),null}});(await Promise.all(d)).forEach(e=>{if(e.features.length>0){const o=e.features[0].properties;new f.Popup().setLngLat(i.lngLat).setHTML(g(o)).addTo(t)}})})}export{R as w};
